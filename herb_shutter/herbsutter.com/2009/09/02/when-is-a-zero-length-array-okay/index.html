<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>When is a zero-length array okay? | Sutter’s Mill</title>
<link rel="pingback" href="https://herbsutter.com/xmlrpc.php" />
<script type="text/javascript">
  WebFontConfig = {"typekit":{"id":"eyo0tqd"}};
  (function() {
    var wf = document.createElement('script');
    wf.src = 'https://s0.wp.com/wp-content/plugins/custom-fonts/js/webfont.js';
    wf.type = 'text/javascript';
    wf.async = 'true';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(wf, s);
	})();
</script><style id="jetpack-custom-fonts-css">.wf-active #header h1{font-size:2.12em;font-family:"ff-dagny-web-pro-1","ff-dagny-web-pro-2",sans-serif;font-style:normal;font-weight:400}.wf-active body{font-size:89.7%;font-family:"ff-basic-gothic-web-pro-1","ff-basic-gothic-web-pro-2",sans-serif}.wf-active #navigation{font-family:"ff-basic-gothic-web-pro-1","ff-basic-gothic-web-pro-2",sans-serif}.wf-active #navigation ul li.search{font-size:1.06em}.wf-active #navigation ul li.search input#searchsubmit{font-size:1.06em}.wf-active #content .post-info, .wf-active #content .postmetadata{font-size:1.06em}.wf-active #sidebar{font-size:1.06em}.wf-active #footer p.right{font-size:1.06em}.wf-active .commentnum{font-size:1.77em}.wf-active .commentlist li .cmtinfo{font-size:1.18em}.wf-active .commentlist li .cmtinfo em{font-size:1.06em}.wf-active #respond label{font-size:11.8px}.wf-active #respond .required{font-size:11.8px}.wf-active #respond .subscribe-label{font-size:14.2px}.wf-active #respond .comment-notes{font-size:13px}.wf-active .wp-caption p.wp-caption-text{font-size:13px}.wf-active #content h1, .wf-active h2, .wf-active h3, .wf-active h4, .wf-active h5, .wf-active h6{font-family:"ff-dagny-web-pro-1","ff-dagny-web-pro-2",sans-serif;font-style:normal;font-weight:400}.wf-active #header h2{font-size:1.18em;font-weight:400;font-family:"ff-dagny-web-pro-1","ff-dagny-web-pro-2",sans-serif;font-style:normal}.wf-active #content h3{font-size:1.65em;font-weight:400;font-style:normal}.wf-active #content h4{font-size:1.3em;font-style:normal;font-weight:400}.wf-active #content h5{font-size:1.18em;font-style:normal;font-weight:400}.wf-active #content .post h2{font-size:1.65em;font-weight:400;font-style:normal}.wf-active li.sidebox h2{font-weight:400;font-size:1.89em;font-style:normal}.wf-active .post h4{font-size:1.18em;font-weight:400;font-family:"ff-dagny-web-pro-1","ff-dagny-web-pro-2",sans-serif;font-style:normal}.wf-active .post h4 em{font-style:normal;font-weight:400}</style>
		<script src='https://r-login.wordpress.com/remote-login.php?action=js&amp;host=herbsutter.com&amp;id=3379246&amp;t=1542966092&amp;back=https%3A%2F%2Fherbsutter.com%2F2009%2F09%2F02%2Fwhen-is-a-zero-length-array-okay%2F' type="text/javascript"></script>
		<script type="text/javascript">
		/* <![CDATA[ */
			if ( 'function' === typeof WPRemoteLogin ) {
				document.cookie = "wordpress_test_cookie=test; path=/";
				if ( document.cookie.match( /(;|^)\s*wordpress_test_cookie\=/ ) ) {
					WPRemoteLogin();
				}
			}
		/* ]]> */
		</script>
		<link rel='dns-prefetch' href='//s2.wp.com' />
<link rel='dns-prefetch' href='//s0.wp.com' />
<link rel='dns-prefetch' href='//s1.wp.com' />
<link rel='dns-prefetch' href='//herbsutter.wordpress.com' />
<link rel="alternate" type="application/rss+xml" title="Sutter’s Mill &raquo; Feed" href="https://herbsutter.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="Sutter’s Mill &raquo; Comments Feed" href="https://herbsutter.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Sutter’s Mill &raquo; When is a zero-length array&nbsp;okay? Comments Feed" href="https://herbsutter.com/2009/09/02/when-is-a-zero-length-array-okay/feed/" />
	<script type="text/javascript">
		/* <![CDATA[ */
		function addLoadEvent(func) {
			var oldonload = window.onload;
			if (typeof window.onload != 'function') {
				window.onload = func;
			} else {
				window.onload = function () {
					oldonload();
					func();
				}
			}
		}
		/* ]]> */
	</script>
			<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s0.wp.com\/wp-content\/mu-plugins\/wpcom-smileys\/twemoji\/2\/72x72\/","ext":".png","svgUrl":"https:\/\/s0.wp.com\/wp-content\/mu-plugins\/wpcom-smileys\/twemoji\/2\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/s1.wp.com\/wp-includes\/js\/wp-emoji-release.min.js?m=1532082729h&ver=4.9.8"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56760,9792,65039],[55358,56760,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel='stylesheet' id='all-css-0-1' href='https://s2.wp.com/_static/??-eJyNkN1uwjAMhV9onsUG69W0Z0laE0zzp8QR6tvjUlUCwSpuonOS81knxkuGPkWhKBgaZN8cx4qeR6p4JsmmH+HmPvtaP/B1nOORI8uEcqKgYG4WA1eZfErjFtinQnofspE5EWhgQ15nRNnCQv5ZqVmetORmv0vWNFibC9UKegZuAZayT9wKuabWUnEwt0Tb2A9ofbotxBZTJpx/SE8DXi3hn+h9Rx4cSUVJGXKqqt5GaurZeGCNPJoFZoxJlsdVbE11lEB/aYRTfDBw9IbLFlpI9+NUOtTUnZ2hv/C7O+y/uu9uf+jOV8Xg7sY=?cssminify=yes' type='text/css' media='all' />
<link rel='stylesheet' id='print-css-1-1' href='https://s2.wp.com/wp-content/mu-plugins/global-print/global-print.css?m=1465851035h&cssminify=yes' type='text/css' media='print' />
<link rel='stylesheet' id='all-css-2-1' href='https://s0.wp.com/_static/??/wp-content/mu-plugins/actionbar/actionbar.css,/wp-content/themes/h4/global.css?m=1516985148j&cssminify=yes' type='text/css' media='all' />
<script type='text/javascript' src='https://s0.wp.com/_static/??-eJyFztEKwjAMBdAfsquTiXsRv6XWOFKXtDbphn69HeiDMBQCgdzDJXZOBtmP5QJiQ517gfx4rybIxv4ChnDITqEh5A/2kRVYF0vxjCOYIpDdUG+16BpXXIqiBCIVraTfLyFPCPNfFkCT8zeTQfC5tJ7o2Hb9Yde3+24bXjRNW9I='></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://herbsutter.wordpress.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://s1.wp.com/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Effective Concurrency: Design for Manycore&nbsp;Systems' href='https://herbsutter.com/2009/08/11/effective-concurrency-design-for-manycore-systems/' />
<link rel='next' title='&ldquo;What&rsquo;s the Best Way To Process a Pool of&nbsp;Work?&rdquo;' href='https://herbsutter.com/2009/09/28/whats-the-best-way-to-process-a-pool-of-work/' />
<meta name="generator" content="WordPress.com" />
<link rel="canonical" href="https://herbsutter.com/2009/09/02/when-is-a-zero-length-array-okay/" />
<link rel='shortlink' href='https://wp.me/peb5Y-4G' />
<link rel="alternate" type="application/json+oembed" href="https://public-api.wordpress.com/oembed/?format=json&amp;url=https%3A%2F%2Fherbsutter.com%2F2009%2F09%2F02%2Fwhen-is-a-zero-length-array-okay%2F&amp;for=wpcom-auto-discovery" /><link rel="alternate" type="application/xml+oembed" href="https://public-api.wordpress.com/oembed/?format=xml&amp;url=https%3A%2F%2Fherbsutter.com%2F2009%2F09%2F02%2Fwhen-is-a-zero-length-array-okay%2F&amp;for=wpcom-auto-discovery" />
<!-- Jetpack Open Graph Tags -->
<meta property="og:type" content="article" />
<meta property="og:title" content="When is a zero-length array okay?" />
<meta property="og:url" content="https://herbsutter.com/2009/09/02/when-is-a-zero-length-array-okay/" />
<meta property="og:description" content="I just received a reader email that asked about GotW #42: You write &quot;Non-Problem: Zero-Length Arrays Are Okay&quot;, but both 14882:2003 and N2914 &quot;[dcl.array]&quot; say &quot;If the cons…" />
<meta property="article:published_time" content="2009-09-02T12:41:25+00:00" />
<meta property="article:modified_time" content="2009-09-02T14:05:27+00:00" />
<meta property="og:site_name" content="Sutter’s Mill" />
<meta property="og:image" content="https://secure.gravatar.com/blavatar/4554b8d24c7f200dc5e2e1b18db1893f?s=200&amp;ts=1542966092" />
<meta property="og:image:width" content="200" />
<meta property="og:image:height" content="200" />
<meta property="og:locale" content="en_US" />
<meta name="twitter:site" content="@wordpressdotcom" />
<meta name="twitter:text:title" content="When is a zero-length array&nbsp;okay?" />
<meta name="twitter:image" content="https://secure.gravatar.com/blavatar/4554b8d24c7f200dc5e2e1b18db1893f?s=240" />
<meta name="twitter:card" content="summary" />
<meta property="article:publisher" content="https://www.facebook.com/WordPresscom" />

<!-- End Jetpack Open Graph Tags -->
<link rel="shortcut icon" type="image/x-icon" href="https://secure.gravatar.com/blavatar/4554b8d24c7f200dc5e2e1b18db1893f?s=32" sizes="16x16" />
<link rel="icon" type="image/x-icon" href="https://secure.gravatar.com/blavatar/4554b8d24c7f200dc5e2e1b18db1893f?s=32" sizes="16x16" />
<link rel="apple-touch-icon-precomposed" href="https://secure.gravatar.com/blavatar/4554b8d24c7f200dc5e2e1b18db1893f?s=114" />
<link rel='openid.server' href='https://herbsutter.wordpress.com/?openidserver=1' />
<link rel='openid.delegate' href='https://herbsutter.wordpress.com/' />
<link rel="search" type="application/opensearchdescription+xml" href="https://herbsutter.com/osd.xml" title="Sutter’s Mill" />
<link rel="search" type="application/opensearchdescription+xml" href="https://s1.wp.com/opensearch.xml" title="WordPress.com" />
		<style id="wpcom-hotfix-masterbar-style">
			@media screen and (min-width: 783px) {
				#wpadminbar .quicklinks li#wp-admin-bar-my-account.with-avatar > a img {
					margin-top: 5px;
				}
			}
		</style>
		<script type="text/javascript" id="webfont-output">
  
  WebFontConfig = {"typekit":{"id":"cjs1oxc"}};
  (function() {
    var wf = document.createElement('script');
    wf.src = ('https:' == document.location.protocol ? 'https' : 'http') +
      '://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';
    wf.type = 'text/javascript';
    wf.async = 'true';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(wf, s);
	})();
</script><style type="text/css">
.widget_twitter li {
	word-wrap: break-word;
}
</style>
<meta name="application-name" content="Sutter’s Mill" /><meta name="msapplication-window" content="width=device-width;height=device-height" /><meta name="msapplication-tooltip" content="Herb Sutter on software development" /><meta name="msapplication-task" content="name=Subscribe;action-uri=https://herbsutter.com/feed/;icon-uri=https://secure.gravatar.com/blavatar/4554b8d24c7f200dc5e2e1b18db1893f?s=16" /><meta name="msapplication-task" content="name=Sign up for a free blog;action-uri=http://wordpress.com/signup/;icon-uri=https://s1.wp.com/i/favicon.ico" /><meta name="msapplication-task" content="name=WordPress.com Support;action-uri=http://support.wordpress.com/;icon-uri=https://s1.wp.com/i/favicon.ico" /><meta name="msapplication-task" content="name=WordPress.com Forums;action-uri=http://forums.wordpress.com/;icon-uri=https://s1.wp.com/i/favicon.ico" /><meta name="description" content="I just received a reader email that asked about GotW #42: You write &quot;Non-Problem: Zero-Length Arrays Are Okay&quot;, but both 14882:2003 and N2914 &quot;[dcl.array]&quot; say &quot;If the constant-expression (5.19) is present, it shall be an integral constant expression and its value shall be greater than zero.&quot;. Shall we assume that you overrule the standard? :-)&hellip;" />
<style type="text/css">
			#header h1 a,
		#header h2 {
			color: #265E15 !important;
		}
				#headerimage {
			background: url('https://herbsutter.files.wordpress.com/2011/10/cropped-blog-header.jpg') no-repeat;
			height: 200px;
		}
	</style>
<link rel="amphtml" href="https://herbsutter.com/2009/09/02/when-is-a-zero-length-array-okay/amp/"><style type="text/css" id="syntaxhighlighteranchor"></style>
		<link rel="stylesheet" id="custom-css-css" type="text/css" href="https://s2.wp.com/?custom-css=1&#038;csblog=eb5Y&#038;cscache=6&#038;csrev=60" />
		</head>
<body id="section-index" class="post-template-default single single-post postid-290 single-format-standard mp6 customizer-styles-applied highlander-enabled highlander-light">


<div id="navigation" class="clearfix">
		<div class="menu">
		<ul>
			<li ><a href="https://herbsutter.com/" title="Home">Home</a></li>
			<li class="page_item page-item-912"><a href="https://herbsutter.com/welcome-to-the-jungle/">Welcome to the&nbsp;Jungle</a></li>
<li class="page_item page-item-864 page_item_has_children"><a href="https://herbsutter.com/gotw/">GotW</a></li>
<li class="page_item page-item-761"><a href="https://herbsutter.com/elements-of-modern-c-style/">Elements of Modern C++&nbsp;Style</a></li>
<li class="page_item page-item-2 page_item_has_children"><a href="https://herbsutter.com/about/">About</a></li>
									<li class="search"><form method="get" id="searchform" action="https://herbsutter.com"><input type="text" class="textbox" value="" name="s" id="s" /><input type="submit" id="searchsubmit" value="Search" /></form></li>
					</ul>
	</div>
</div><!-- end id:navigation -->

<div id="container">

<div id="header">
<h1><a href="https://herbsutter.com/" title="Sutter’s Mill">Sutter’s Mill</a></h1>
<h2>Herb Sutter on software development</h2>
</div><!-- end id:header -->


	
		<div id="feedarea">
	<dl>
		<dt><strong>Feeds:</strong></dt>

			<dd><a href="https://herbsutter.com/feed/">Posts</a></dd>
	
			<dd><a href="https://herbsutter.com/comments/feed/">Comments</a></dd>
		</dl>
	</div><!-- end id:feedarea -->
	
	<div id="headerimage">
</div><!-- end id:headerimage -->

<div id="content">
<div id="content-main">

		
									<div class="postnav">
				<div class="alignleft">&laquo; <a href="https://herbsutter.com/2009/08/11/effective-concurrency-design-for-manycore-systems/" rel="prev">Effective Concurrency: Design for Manycore&nbsp;Systems</a></div>
				<div class="alignright"><a href="https://herbsutter.com/2009/09/28/whats-the-best-way-to-process-a-pool-of-work/" rel="next">&ldquo;What&rsquo;s the Best Way To Process a Pool of&nbsp;Work?&rdquo;</a> &raquo;</div>
			</div>
			
			<div class="post-290 post type-post status-publish format-standard hentry category-c" id="post-290">
				<div class="posttitle">
					<h2>When is a zero-length array&nbsp;okay?</h2>
					<p class="post-info">2009-09-02 by <a href="https://herbsutter.com/author/herbsutter/" title="Posts by Herb Sutter">Herb Sutter</a>  </p>
				</div>

				<div class="entry">
					<p>I just received a reader email that asked about <a href="http://www.gotw.ca/gotw/042.htm">GotW #42</a>:</p>
<blockquote>
<p>You write &quot;<strong>Non-Problem: Zero-Length Arrays Are Okay</strong>&quot;, but both 14882:2003 and N2914 &quot;[dcl.array]&quot; say &quot;If the constant-expression (5.19) is present, it shall be an integral constant expression and its value shall be greater than zero.&quot;. Shall we assume that you overrule the standard? :-) Or am I missing something, like the meaning of &quot;derived-declarator-type-list&quot; (I can&#8217;t find it anywhere in 14882:2003)?</p>
</blockquote>
<p>I thought the answer might be of interest to other people, so I’m posting it here.</p>
<p>First, this reader gets kudos for consulting not only the ISO C++ standard, but also the current C++0x working draft from June (paper N2914), to do research before asking the question. Good stuff.</p>
<p>He also gets a small penalty point, though, for reading only the subhead text that he quoted from GotW #42, and not the actual short passage the heading introduces. The article already contains the answer to his qustion, and that answer is still the same in the current C++0x draft all these years later:</p>
<blockquote>
<p>From 5.3.4 [expr.new], paragraph 7:</p>
<p>When the value of the expression in a direct-new-declarator is zero, the allocation function is called to allocate an array with no elements. The pointer returned by the new-expression is non-null. [Note: If the library allocation function is called, the pointer returned is distinct from the pointer to any other object.]</p>
</blockquote>
<p>So the reader is quoting from 8.3.4 [dcl.array], which governs non-heap allocated arrays (e.g., T array[N];). In that case, a zero length is not allowed by the standard. You can’t rely on it in portable code because although it is allowed as an extension in some popular compilers (e.g., Gnu gcc) it is treated as an error in others (e.g., Visual C++).</p>
<p>But the case being discussed in GotW #42 is dynamically allocating an array using the array form of new (e.g., new T[n] where n is zero), which is governed by 5.3.4 [expr.new]. Here, zero length is okay for the reasons given in GotW #42:</p>
<blockquote>
<p>The result of &quot;new T[0]&quot; is just a pointer to an array with zero elements, and that pointer behaves just like any other result of &quot;new T[n]&quot; including the fact that you may not attempt to access more than n elements of the array&#8230; in this case, you may not attempt to access any elements at all, because there aren&#8217;t any. </p>
<p>&quot;Well, if you can&#8217;t do anything with zero-length arrays (other than remember their address),&quot; you may wonder, &quot;why should they be allowed?&quot; One important reason is that it makes it easier to write code that does dynamic array allocation. For example, the function f above would be needlessly more complex if it was forced to check the value of its n parameter before performing the &quot;new T[n]&quot; call.</p>
</blockquote>
<p>To make GotW #42 completely unambiguous, it could more specifically say that zero-length <em>heap-allocated</em> arrays are okay, which was the case being discussed in the article. But it always helps to read more than the subhead text.</p>
									</div>

				<p class="postmetadata">
					Posted in <a href="https://herbsutter.com/category/c/" rel="category tag">C++</a> | 											6 Comments									</p>
				
<!-- You can start editing here. -->

<h3 id="comments">6 Responses</h3>

	<ol class="commentlist">
			<li class="comment even thread-even depth-1 highlander-comment" id="comment-1537">
		<div id="div-comment-1537">
		<div class="cmtinfo"><em> on <a href="#comment-1537" title="">2009-10-23 at 6:04 am</a></em> <img alt='' src='https://0.gravatar.com/avatar/953fa050a7525c81cd4f0e30c4fb6b3e?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>doug</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_1537"></div><p>Why would the standard not allow zero length stack based arrays?  This completely breaks my design.</p>
<p>struct Validator {<br />
  int location;<br />
  char contents;<br />
};</p>
<p>static const Validator VALID[] =<br />
{<br />
  {0, {&#8216;a&#8217;, &#8216;b&#8217;, &#8216;c&#8217;}},<br />
  {3, {&#8216;d&#8217;, &#8216;e&#8217;}},<br />
  {6, {}},<br />
  {7, {&#8216;v&#8217;, &#8216;w&#8217;, &#8216;x&#8217;, &#8216;y&#8217;, &#8216;z&#8217;}},<br />
};</p>
<p>template inline size_t ARRAY_SIZE(const T (&amp;array)[N])<br />
{<br />
  return N;<br />
}</p>
<p>int main(int, char**) {<br />
  for (int i = 0; i &lt; ARRAY_SIZE(VALID); i++)<br />
  {<br />
    cout &lt;&lt; &quot;The Contents at location &quot; &lt;&lt; VALID[i].location &lt;&lt; &quot; are:&quot;;<br />
    for (int j = 0; j &lt; ARRAY_SIZE(VALID[i].contents; j++)<br />
    {<br />
      cout &lt;&lt; VALID[i].contents[j] &lt;&lt; &quot;, &quot;;<br />
    }<br />
    cout &lt;&lt; endl;<br />
  }<br />
}</p>
<p>There are good scenarios where you would want 0 length stack based arrays.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-1480">
		<div id="div-comment-1480">
		<div class="cmtinfo"><em> on <a href="#comment-1480" title="">2009-09-20 at 1:09 pm</a></em> <img alt='' src='https://0.gravatar.com/avatar/31a1c40a45079decc7f5525d2a873481?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>litb</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_1480"></div><p>You can safely do (A+N), but theoretically, i think there are problems with &amp;A[N] because A[N] is evaluated as an lvalue but it isn&#8217;t guaranteed to refer to an object. But &#8220;An lvalue refers to an object or function.&#8221; and there is no &#8220;empty lvalue&#8221;. If C++ had a rule like C that says in a &amp;*X, the *X expression isn&#8217;t evaluated (like in a sizeof, where *(int*)0 of course is perfectly legal), this would be different.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 highlander-comment" id="comment-1478">
		<div id="div-comment-1478">
		<div class="cmtinfo"><em> on <a href="#comment-1478" title="">2009-09-18 at 10:20 am</a></em> <img alt='' src='https://2.gravatar.com/avatar/2b7a5d682722dcd80620fe9deb9fccdf?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>Pavel Minaev</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_1478"></div><p>&gt; AFAIK, you can’t do it with an actual array of size 0 either.</p>
<p>You should be able to, since the Standard specifically allows to have a pointer one past the end of an array. I.e. for an array A of N elements, &amp;A[N] is valid, even though dereferencing it is not. I don&#8217;t see why it should suddenly be invalid for N=0.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-1467">
		<div id="div-comment-1467">
		<div class="cmtinfo"><em> on <a href="#comment-1467" title="">2009-09-09 at 11:13 pm</a></em> <img alt='' src='https://1.gravatar.com/avatar/1f64f9b0a9296bafcc7d3bb0012cffe4?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>Bill McGann</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_1467"></div><p>Re: Alex, no, you can&#8217;t do that.<br />
AFAIK, you can&#8217;t do it with an actual array of size 0 either.</p>
<p>If you really want to write that memcpy line, you should do:<br />
memcpy(pDest, vec.empty()?0:&amp;vec[0], vec.size());</p>
<p>&#8230;but you could also just use std::copy ;)</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 highlander-comment" id="comment-1466">
		<div id="div-comment-1466">
		<div class="cmtinfo"><em> on <a href="#comment-1466" title="">2009-09-08 at 9:46 am</a></em> <img alt='' src='https://0.gravatar.com/avatar/9f9fe22f37e1609f40754589672f6205?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>alex</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_1466"></div><p>Does this also apply to a vector of size 0?  So, for example is this code correct if the vector is empty?</p>
<p>    memcpy(pDest, &amp;vec[0], vec.size());</p>
<p>VC++ throws an SEH if checked iterators are turned on.  It makes code more cumbersome by having to check the size of vec before dereferencing it.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-1464">
		<div id="div-comment-1464">
		<div class="cmtinfo"><em> on <a href="#comment-1464" title="">2009-09-03 at 6:43 pm</a></em> <img alt='' src='https://2.gravatar.com/avatar/24a5e6352c9165f8cc98bb55dfe9c07f?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>tom</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_1464"></div><p>Thanks for the explanation. I&#8217;ve happened to used zero-length array before. It compiled(with VC++) and worked. So I never thought it could fail until I read this blog. </p>
<p>Now I recall that it was used something like this way,<br />
void f(size_t n)<br />
{<br />
  boost::shared_array si(new int[n]);<br />
//&#8230;<br />
}</p>
<p>It feels good that you realize you safely passed an edge only afterwards.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
	</ol>

	<div class="navigation">
		<div class="alignleft"></div>
		<div class="alignright"></div>
	</div>
	<br />

  	<p class="nocomments">Comments are closed.</p>
  <div class="post-content">
<p>
</p>
</div>

			</div>

		
		<p align="center"></p>

	</div><!-- end id:content-main -->
<div id="sidebar">
<ul>
<li class="sidebox"><h2><label for="subscribe-field">Follow by email</label></h2>
				<form action="https://subscribe.wordpress.com" method="post" accept-charset="utf-8" id="subscribe-blog">
																	<p><input type="text" name="email" style="width: 95%; padding: 1px 2px" placeholder="Enter your email address" value="" id="subscribe-field"/></p>
					
					<p>
						<input type="hidden" name="action" value="subscribe"/>
						<input type="hidden" name="blog_id" value="3379246"/>
						<input type="hidden" name="source" value="https://herbsutter.com/2009/09/02/when-is-a-zero-length-array-okay/"/>
						<input type="hidden" name="sub-type" value="widget"/>
						<input type="hidden" name="redirect_fragment" value="blog_subscription-3" />
						<input type="hidden" id="_wpnonce" name="_wpnonce" value="4590924cc6" />						<input type="submit" value="Subscribe" />
					</p>
				</form>
			
</li><li class="sidebox"><h2><a href='http://twitter.com/herbsutter'>Tweets</a></h2><ul class='tweets'></ul><a href="http://twitter.com/herbsutter"  class='twitter-follow-button' data-show-count='false' data-link-color='#265e15' data-text-color='#333333'>Follow @herbsutter</a></li><li class="sidebox"><h2>Popular</h2><ul>				<li>
										<a href="https://herbsutter.com/2018/11/13/trip-report-fall-iso-c-standards-meeting-san-diego/" class="bump-view" data-bump-view="tp">
						Trip report: Fall ISO C++ standards meeting (San Diego)					</a>
										</li>
								<li>
										<a href="https://herbsutter.com/gotw/" class="bump-view" data-bump-view="tp">
						GotW					</a>
										</li>
								<li>
										<a href="https://herbsutter.com/2018/09/20/lifetime-profile-v1-0-posted/" class="bump-view" data-bump-view="tp">
						Lifetime profile v1.0 posted					</a>
										</li>
				</ul></li><li class="sidebox"><h2>Categories</h2>		<ul>
				<li class="cat-item cat-item-291"><a href="https://herbsutter.com/category/apple/" >Apple</a>
</li>
	<li class="cat-item cat-item-49277"><a href="https://herbsutter.com/category/c-net/" >C# / .NET</a>
</li>
	<li class="cat-item cat-item-2426"><a href="https://herbsutter.com/category/c/" >C++</a>
</li>
	<li class="cat-item cat-item-69816"><a href="https://herbsutter.com/category/cloud/" >Cloud</a>
</li>
	<li class="cat-item cat-item-214618"><a href="https://herbsutter.com/category/concurrency/" >Concurrency</a>
</li>
	<li class="cat-item cat-item-8259773"><a href="https://herbsutter.com/category/effective-concurrency/" >Effective Concurrency</a>
</li>
	<li class="cat-item cat-item-3696745"><a href="https://herbsutter.com/category/friday-thoughts/" >Friday Thoughts</a>
</li>
	<li class="cat-item cat-item-3867746"><a href="https://herbsutter.com/category/c/gotw/" >GotW</a>
</li>
	<li class="cat-item cat-item-79"><a href="https://herbsutter.com/category/hardware/" >Hardware</a>
</li>
	<li class="cat-item cat-item-1017"><a href="https://herbsutter.com/category/java/" >Java</a>
</li>
	<li class="cat-item cat-item-637"><a href="https://herbsutter.com/category/microsoft/" >Microsoft</a>
</li>
	<li class="cat-item cat-item-420845"><a href="https://herbsutter.com/category/opinion-editorial/" >Opinion &amp; Editorial</a>
</li>
	<li class="cat-item cat-item-1633077"><a href="https://herbsutter.com/category/reader-qa/" >Reader Q&amp;A</a>
</li>
	<li class="cat-item cat-item-2301"><a href="https://herbsutter.com/category/software-development/" >Software Development</a>
</li>
	<li class="cat-item cat-item-393523"><a href="https://herbsutter.com/category/talks-events/" >Talks &amp; Events</a>
</li>
	<li class="cat-item cat-item-1"><a href="https://herbsutter.com/category/uncategorized/" >Uncategorized</a>
</li>
	<li class="cat-item cat-item-151"><a href="https://herbsutter.com/category/web/" >Web</a>
</li>
		</ul>
			</li></ul>
</div><!-- end id:sidebar -->
</div><!-- end id:content -->
</div><!-- end id:container -->
<div id="footer">
	<div id="colophon">
		<p><a href="https://wordpress.com/?ref=footer_blog">Blog at WordPress.com.</a></p>
		<p>WPThemes.</p>
		<br class="clear" />
	</div><!-- end #colophon-->
</div><!-- end #footer-->
<!--  -->
<script type='text/javascript' src='//0.gravatar.com/js/gprofiles.js?ver=201847y'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var WPGroHo = {"my_hash":""};
/* ]]> */
</script>
<script type='text/javascript' src='https://s1.wp.com/wp-content/mu-plugins/gravatar-hovercards/wpgroho.js?m=1380573781h'></script>

	<script>
		//initialize and attach hovercards to all gravatars
		jQuery( document ).ready( function( $ ) {

			if (typeof Gravatar === "undefined"){
				return;
			}

			if ( typeof Gravatar.init !== "function" ) {
				return;
			}			

			Gravatar.profile_cb = function( hash, id ) {
				WPGroHo.syncProfileData( hash, id );
			};
			Gravatar.my_hash = WPGroHo.my_hash;
			Gravatar.init( 'body', '#wp-admin-bar-my-account' );
		});
	</script>

		<div style="display:none">
	<div class="grofile-hash-map-953fa050a7525c81cd4f0e30c4fb6b3e">
	</div>
	<div class="grofile-hash-map-31a1c40a45079decc7f5525d2a873481">
	</div>
	<div class="grofile-hash-map-2b7a5d682722dcd80620fe9deb9fccdf">
	</div>
	<div class="grofile-hash-map-1f64f9b0a9296bafcc7d3bb0012cffe4">
	</div>
	<div class="grofile-hash-map-9f9fe22f37e1609f40754589672f6205">
	</div>
	<div class="grofile-hash-map-24a5e6352c9165f8cc98bb55dfe9c07f">
	</div>
	</div>
<script type='text/javascript' charset='UTF-8' id='polldaddyRatings'><!--//--><![CDATA[//><!--
PDRTJS_settings_468178_comm_1537={"id":468178,"unique_id":"wp-comment-1537","title":"Why%20would%20the%20standard%20not%20allow%20zero%20length%20stack%20based%20arrays%3F%20%20This%20completely%20breaks%20my%20design.struct%20Validator%20%7B%20%20int%20location%3B%20%20char%20contents%3B%7D%3Bstatic%20const%20Validator%20VALID%26%23091%3B%26%23093%3B%20%3D%20%7B%20%20%7B0%2C%20%7B%26%23039%3Ba%26%23039%3B%2C...","permalink":"https:\/\/herbsutter.com\/2009\/09\/02\/when-is-a-zero-length-array-okay\/#comment-1537","item_id":"_comm_1537"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_1537 == 'undefined' ){PDRTJS_468178_comm_1537 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_1537 );}}PDRTJS_settings_468178_comm_1480={"id":468178,"unique_id":"wp-comment-1480","title":"You%20can%20safely%20do%20%28A%2BN%29%2C%20but%20theoretically%2C%20i%20think%20there%20are%20problems%20with%20%26amp%3BA%26%23091%3BN%26%23093%3B%20because%20A%26%23091%3BN%26%23093%3B%20is%20evaluated%20as%20an%20lvalue%20but%20it%20isn%26%23039%3Bt%20guaranteed%20to%20refer%20to%20an%20object.%20But%20%26quot%3BAn%20lvalue%20refers%20t...","permalink":"https:\/\/herbsutter.com\/2009\/09\/02\/when-is-a-zero-length-array-okay\/#comment-1480","item_id":"_comm_1480"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_1480 == 'undefined' ){PDRTJS_468178_comm_1480 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_1480 );}}PDRTJS_settings_468178_comm_1478={"id":468178,"unique_id":"wp-comment-1478","title":"%26gt%3B%20AFAIK%2C%20you%20cant%20do%20it%20with%20an%20actual%20array%20of%20size%200%20either.You%20should%20be%20able%20to%2C%20since%20the%20Standard%20specifically%20allows%20to%20have%20a%20pointer%20one%20past%20the%20end%20of%20an%20array.%20I.e.%20for%20an%20array%20A%20...","permalink":"https:\/\/herbsutter.com\/2009\/09\/02\/when-is-a-zero-length-array-okay\/#comment-1478","item_id":"_comm_1478"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_1478 == 'undefined' ){PDRTJS_468178_comm_1478 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_1478 );}}PDRTJS_settings_468178_comm_1467={"id":468178,"unique_id":"wp-comment-1467","title":"Re%3A%20Alex%2C%20no%2C%20you%20can%26%23039%3Bt%20do%20that.AFAIK%2C%20you%20can%26%23039%3Bt%20do%20it%20with%20an%20actual%20array%20of%20size%200%20either.If%20you%20really%20want%20to%20write%20that%20memcpy%20line%2C%20you%20should%20do%3Amemcpy%28pDest%2C%20vec.empty%28%29%3F0%3A%26amp%3Bvec%26%23091%3B0%26%23093%3B%2C%20v...","permalink":"https:\/\/herbsutter.com\/2009\/09\/02\/when-is-a-zero-length-array-okay\/#comment-1467","item_id":"_comm_1467"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_1467 == 'undefined' ){PDRTJS_468178_comm_1467 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_1467 );}}PDRTJS_settings_468178_comm_1466={"id":468178,"unique_id":"wp-comment-1466","title":"Does%20this%20also%20apply%20to%20a%20vector%20of%20size%200%3F%20%20So%2C%20for%20example%20is%20this%20code%20correct%20if%20the%20vector%20is%20empty%3F%20%20%20%20memcpy%28pDest%2C%20%26amp%3Bvec%26%23091%3B0%26%23093%3B%2C%20vec.size%28%29%29%3BVC%2B%2B%20throws%20an%20SEH%20if%20checked%20iterators%20are%20tur...","permalink":"https:\/\/herbsutter.com\/2009\/09\/02\/when-is-a-zero-length-array-okay\/#comment-1466","item_id":"_comm_1466"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_1466 == 'undefined' ){PDRTJS_468178_comm_1466 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_1466 );}}PDRTJS_settings_468178_comm_1464={"id":468178,"unique_id":"wp-comment-1464","title":"Thanks%20for%20the%20explanation.%20I%26%23039%3Bve%20happened%20to%20used%20zero-length%20array%20before.%20It%20compiled%28with%20VC%2B%2B%29%20and%20worked.%20So%20I%20never%20thought%20it%20could%20fail%20until%20I%20read%20this%20blog.%20Now%20I%20recall%20that%20it%20was%20us...","permalink":"https:\/\/herbsutter.com\/2009\/09\/02\/when-is-a-zero-length-array-okay\/#comment-1464","item_id":"_comm_1464"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_1464 == 'undefined' ){PDRTJS_468178_comm_1464 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_1464 );}}
//--><!]]></script><script type='text/javascript' charset='UTF-8' src='https://polldaddy.com/js/rating/rating.js'></script><script type='text/javascript' src='https://platform.twitter.com/widgets.js?ver=20111117'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var actionbardata = {"siteID":"3379246","siteName":"Sutter\u2019s Mill","siteURL":"https:\/\/herbsutter.com","icon":"<img alt='' src='https:\/\/secure.gravatar.com\/blavatar\/4554b8d24c7f200dc5e2e1b18db1893f?s=50&d=https%3A%2F%2Fs2.wp.com%2Fi%2Flogo%2Fwpcom-gray-white.png' class='avatar avatar-50' height='50' width='50' \/>","canManageOptions":"","canCustomizeSite":"","isFollowing":"","themeSlug":"pub\/mistylook","signupURL":"https:\/\/wordpress.com\/start\/","loginURL":"https:\/\/herbsutter.wordpress.com\/wp-login.php?redirect_to=https%3A%2F%2Fherbsutter.com%2F2009%2F09%2F02%2Fwhen-is-a-zero-length-array-okay%2F","themeURL":"","xhrURL":"https:\/\/herbsutter.com\/wp-admin\/admin-ajax.php","nonce":"8fb9818ae2","isSingular":"1","isFolded":"","isLoggedIn":"","isMobile":"","subscribeNonce":"<input type=\"hidden\" id=\"_wpnonce\" name=\"_wpnonce\" value=\"4590924cc6\" \/>","referer":"https:\/\/herbsutter.com\/2009\/09\/02\/when-is-a-zero-length-array-okay\/","canFollow":"1","feedID":"171936","statusMessage":"","customizeLink":"https:\/\/herbsutter.wordpress.com\/wp-admin\/customize.php?url=https%3A%2F%2Fherbsutter.wordpress.com%2F2009%2F09%2F02%2Fwhen-is-a-zero-length-array-okay%2F","postID":"290","shortlink":"https:\/\/wp.me\/peb5Y-4G","canEditPost":"","editLink":"https:\/\/wordpress.com\/post\/herbsutter.com\/290","statsLink":"https:\/\/wordpress.com\/stats\/post\/290\/herbsutter.com","i18n":{"view":"View site","follow":"Follow","following":"Following","edit":"Edit","login":"Log in","signup":"Sign up","customize":"Customize","report":"Report this content","themeInfo":"Get theme: MistyLook","shortlink":"Copy shortlink","copied":"Copied","followedText":"New posts from this site will now appear in your <a href=\"https:\/\/wordpress.com\/\">Reader<\/a>","foldBar":"Collapse this bar","unfoldBar":"Expand this bar","editSubs":"Manage subscriptions","viewReader":"View site in Reader","viewReadPost":"View post in Reader","subscribe":"Sign me up","enterEmail":"Enter your email address","followers":"Join 19,532 other followers","alreadyUser":"Already have a WordPress.com account? <a href=\"https:\/\/herbsutter.wordpress.com\/wp-login.php?redirect_to=https%3A%2F%2Fherbsutter.com%2F2009%2F09%2F02%2Fwhen-is-a-zero-length-array-okay%2F\">Log in now.<\/a>","stats":"Stats"}};
/* ]]> */
</script>
<script type='text/javascript' src='https://s0.wp.com/_static/??-eJyVjcEOgjAQRH/IuoIYT8Zvqe2GLrQLdlvAv7ceJEYTEg+bTGbe7MA8KjNwQk7QCVicyOC47DvZwUcUshp9bokFPPUocM+Y0Wm2HuM3/CblwUkvjlrnyyWMv87GjraBWN10hKCloEWpYcIYyZb91fvzQ4ra9LJVMokGfpVWVehruFSnujo0x+Zcd0+y+3Rn'></script>
<script type="text/javascript">
// <![CDATA[
(function() {
try{
  if ( window.external &&'msIsSiteMode' in window.external) {
    if (window.external.msIsSiteMode()) {
      var jl = document.createElement('script');
      jl.type='text/javascript';
      jl.async=true;
      jl.src='/wp-content/plugins/ie-sitemode/custom-jumplist.php';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(jl, s);
    }
  }
}catch(e){}
})();
// ]]>
</script><script src="//stats.wp.com/w.js?56" type="text/javascript" async defer></script>
<script type="text/javascript">
_tkq = window._tkq || [];
_stq = window._stq || [];
_tkq.push(['storeContext', {'blog_id':'3379246','blog_tz':'-8','user_lang':'en','blog_lang':'en','user_id':'0'}]);
_stq.push(['view', {'blog':'3379246','v':'wpcom','tz':'-8','user_id':'0','post':'290','subd':'herbsutter'}]);
_stq.push(['extra', {'crypt':'UE40eW5QN0p8M2Y/RE1TaVhzUzFMbjdWNHpwZGhTayxPSUFCMGNrd29+Smw0TDhnZmRTK0hlRi9QSGh6bi9GXVhBJWIlZlR5U1JMLU8/MkNtblkvY1d1TjBELytHc0k/MXdHUVQyK2IyUVA5SjU1bj9VX3ExLHYsREFpcnlfNHYtXV1HSUIsLkJrcnp0eS5samtONE9GczNGJkhCfGxfSzIsTTFVZWlnc0ZuY2gxOWx5cjdVaF0/TFA5c0pUeHpGYS9pL1BFeTE1al1hcFZyLFM9JXNjM24tais1N1MlejRVRHl2X3lkbVQ9JVRibFdtQmJNN214clV3Qm0sN0xoazM/R1BPcyx8bU1oWzdGZCxSeVVDV1YlY2p4W1NiblZNdVssUXp4TGRTUjlwX1IzazguckpJSm5UflAuVkFsem1iUj1pOVkudEpCLUJIP0ZYdnN1JVA0'}]);
_stq.push([ 'clickTrackerInit', '3379246', '290' ]);
	</script>
<noscript><img src="https://pixel.wp.com/b.gif?v=noscript" style="height:0px;width:0px;overflow:hidden" alt="" /></noscript>
<script>
if ( 'object' === typeof wpcom_mobile_user_agent_info ) {

	wpcom_mobile_user_agent_info.init();
	var mobileStatsQueryString = "";
	
	if( false !== wpcom_mobile_user_agent_info.matchedPlatformName )
		mobileStatsQueryString += "&x_" + 'mobile_platforms' + '=' + wpcom_mobile_user_agent_info.matchedPlatformName;
	
	if( false !== wpcom_mobile_user_agent_info.matchedUserAgentName )
		mobileStatsQueryString += "&x_" + 'mobile_devices' + '=' + wpcom_mobile_user_agent_info.matchedUserAgentName;
	
	if( wpcom_mobile_user_agent_info.isIPad() )
		mobileStatsQueryString += "&x_" + 'ipad_views' + '=' + 'views';

	if( "" != mobileStatsQueryString ) {
		new Image().src = document.location.protocol + '//pixel.wp.com/g.gif?v=wpcom-no-pv' + mobileStatsQueryString + '&baba=' + Math.random();
	}
	
}
</script></body>
</html>