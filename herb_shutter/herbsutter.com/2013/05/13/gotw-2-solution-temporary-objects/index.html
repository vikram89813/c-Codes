<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>GotW #2 Solution: Temporary Objects | Sutter’s Mill</title>
<link rel="pingback" href="https://herbsutter.com/xmlrpc.php" />
<script type="text/javascript">
  WebFontConfig = {"typekit":{"id":"eyo0tqd"}};
  (function() {
    var wf = document.createElement('script');
    wf.src = 'https://s0.wp.com/wp-content/plugins/custom-fonts/js/webfont.js';
    wf.type = 'text/javascript';
    wf.async = 'true';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(wf, s);
	})();
</script><style id="jetpack-custom-fonts-css">.wf-active #header h1{font-size:2.12em;font-family:"ff-dagny-web-pro-1","ff-dagny-web-pro-2",sans-serif;font-style:normal;font-weight:400}.wf-active body{font-size:89.7%;font-family:"ff-basic-gothic-web-pro-1","ff-basic-gothic-web-pro-2",sans-serif}.wf-active #navigation{font-family:"ff-basic-gothic-web-pro-1","ff-basic-gothic-web-pro-2",sans-serif}.wf-active #navigation ul li.search{font-size:1.06em}.wf-active #navigation ul li.search input#searchsubmit{font-size:1.06em}.wf-active #content .post-info, .wf-active #content .postmetadata{font-size:1.06em}.wf-active #sidebar{font-size:1.06em}.wf-active #footer p.right{font-size:1.06em}.wf-active .commentnum{font-size:1.77em}.wf-active .commentlist li .cmtinfo{font-size:1.18em}.wf-active .commentlist li .cmtinfo em{font-size:1.06em}.wf-active #respond label{font-size:11.8px}.wf-active #respond .required{font-size:11.8px}.wf-active #respond .subscribe-label{font-size:14.2px}.wf-active #respond .comment-notes{font-size:13px}.wf-active .wp-caption p.wp-caption-text{font-size:13px}.wf-active #content h1, .wf-active h2, .wf-active h3, .wf-active h4, .wf-active h5, .wf-active h6{font-family:"ff-dagny-web-pro-1","ff-dagny-web-pro-2",sans-serif;font-style:normal;font-weight:400}.wf-active #header h2{font-size:1.18em;font-weight:400;font-family:"ff-dagny-web-pro-1","ff-dagny-web-pro-2",sans-serif;font-style:normal}.wf-active #content h3{font-size:1.65em;font-weight:400;font-style:normal}.wf-active #content h4{font-size:1.3em;font-style:normal;font-weight:400}.wf-active #content h5{font-size:1.18em;font-style:normal;font-weight:400}.wf-active #content .post h2{font-size:1.65em;font-weight:400;font-style:normal}.wf-active li.sidebox h2{font-weight:400;font-size:1.89em;font-style:normal}.wf-active .post h4{font-size:1.18em;font-weight:400;font-family:"ff-dagny-web-pro-1","ff-dagny-web-pro-2",sans-serif;font-style:normal}.wf-active .post h4 em{font-style:normal;font-weight:400}</style>
		<script src='https://r-login.wordpress.com/remote-login.php?action=js&amp;host=herbsutter.com&amp;id=3379246&amp;t=1542965316&amp;back=https%3A%2F%2Fherbsutter.com%2F2013%2F05%2F13%2Fgotw-2-solution-temporary-objects%2F' type="text/javascript"></script>
		<script type="text/javascript">
		/* <![CDATA[ */
			if ( 'function' === typeof WPRemoteLogin ) {
				document.cookie = "wordpress_test_cookie=test; path=/";
				if ( document.cookie.match( /(;|^)\s*wordpress_test_cookie\=/ ) ) {
					WPRemoteLogin();
				}
			}
		/* ]]> */
		</script>
		<link rel='dns-prefetch' href='//s2.wp.com' />
<link rel='dns-prefetch' href='//s0.wp.com' />
<link rel='dns-prefetch' href='//s1.wp.com' />
<link rel='dns-prefetch' href='//herbsutter.wordpress.com' />
<link rel="alternate" type="application/rss+xml" title="Sutter’s Mill &raquo; Feed" href="https://herbsutter.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="Sutter’s Mill &raquo; Comments Feed" href="https://herbsutter.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Sutter’s Mill &raquo; GotW #2 Solution: Temporary&nbsp;Objects Comments Feed" href="https://herbsutter.com/2013/05/13/gotw-2-solution-temporary-objects/feed/" />
	<script type="text/javascript">
		/* <![CDATA[ */
		function addLoadEvent(func) {
			var oldonload = window.onload;
			if (typeof window.onload != 'function') {
				window.onload = func;
			} else {
				window.onload = function () {
					oldonload();
					func();
				}
			}
		}
		/* ]]> */
	</script>
			<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s0.wp.com\/wp-content\/mu-plugins\/wpcom-smileys\/twemoji\/2\/72x72\/","ext":".png","svgUrl":"https:\/\/s0.wp.com\/wp-content\/mu-plugins\/wpcom-smileys\/twemoji\/2\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/s1.wp.com\/wp-includes\/js\/wp-emoji-release.min.js?m=1532082729h&ver=4.9.8"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56760,9792,65039],[55358,56760,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel='stylesheet' id='all-css-0-1' href='https://s2.wp.com/_static/??-eJyNkN1uwjAMhV9onsUG69W0Z0laE0zzp8QR6tvjUlUCwSpuonOS81knxkuGPkWhKBgaZN8cx4qeR6p4JsmmH+HmPvtaP/B1nOORI8uEcqKgYG4WA1eZfErjFtinQnofspE5EWhgQ15nRNnCQv5ZqVmetORmv0vWNFibC9UKegZuAZayT9wKuabWUnEwt0Tb2A9ofbotxBZTJpx/SE8DXi3hn+h9Rx4cSUVJGXKqqt5GaurZeGCNPJoFZoxJlsdVbE11lEB/aYRTfDBw9IbLFlpI9+NUOtTUnZ2hv/C7O+y/uu9uf+jOV8Xg7sY=?cssminify=yes' type='text/css' media='all' />
<link rel='stylesheet' id='print-css-1-1' href='https://s2.wp.com/wp-content/mu-plugins/global-print/global-print.css?m=1465851035h&cssminify=yes' type='text/css' media='print' />
<link rel='stylesheet' id='all-css-2-1' href='https://s0.wp.com/_static/??/wp-content/mu-plugins/actionbar/actionbar.css,/wp-content/themes/h4/global.css?m=1516985148j&cssminify=yes' type='text/css' media='all' />
<script type='text/javascript' src='https://s0.wp.com/_static/??-eJyFztEKwjAMBdAfsquTiXsRv6XWOFKXtDbphn69HeiDMBQCgdzDJXZOBtmP5QJiQ517gfx4rybIxv4ChnDITqEh5A/2kRVYF0vxjCOYIpDdUG+16BpXXIqiBCIVraTfLyFPCPNfFkCT8zeTQfC5tJ7o2Hb9Yde3+24bXjRNW9I='></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://herbsutter.wordpress.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://s1.wp.com/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='GotW #2: Temporary&nbsp;Objects' href='https://herbsutter.com/2013/05/09/gotw-2-temporary-objects-510/' />
<link rel='next' title='GotW #3: Using the Standard Library (or, Temporaries Revisited)&nbsp;(3/10)' href='https://herbsutter.com/2013/05/13/gotw-3-using-the-standard-library-or-temporaries-revisited-310/' />
<meta name="generator" content="WordPress.com" />
<link rel="canonical" href="https://herbsutter.com/2013/05/13/gotw-2-solution-temporary-objects/" />
<link rel='shortlink' href='https://wp.me/peb5Y-ue' />
<link rel="alternate" type="application/json+oembed" href="https://public-api.wordpress.com/oembed/?format=json&amp;url=https%3A%2F%2Fherbsutter.com%2F2013%2F05%2F13%2Fgotw-2-solution-temporary-objects%2F&amp;for=wpcom-auto-discovery" /><link rel="alternate" type="application/xml+oembed" href="https://public-api.wordpress.com/oembed/?format=xml&amp;url=https%3A%2F%2Fherbsutter.com%2F2013%2F05%2F13%2Fgotw-2-solution-temporary-objects%2F&amp;for=wpcom-auto-discovery" />
<!-- Jetpack Open Graph Tags -->
<meta property="og:type" content="article" />
<meta property="og:title" content="GotW #2 Solution: Temporary Objects" />
<meta property="og:url" content="https://herbsutter.com/2013/05/13/gotw-2-solution-temporary-objects/" />
<meta property="og:description" content="Unnecessary and/or temporary objects are frequent culprits that can throw all your hard work—and your program&#8217;s performance—right out the window. How can you spot them and avoid them?  Proble…" />
<meta property="article:published_time" content="2013-05-13T12:30:54+00:00" />
<meta property="article:modified_time" content="2013-05-20T19:30:37+00:00" />
<meta property="og:site_name" content="Sutter’s Mill" />
<meta property="og:image" content="https://secure.gravatar.com/blavatar/4554b8d24c7f200dc5e2e1b18db1893f?s=200&amp;ts=1542965316" />
<meta property="og:image:width" content="200" />
<meta property="og:image:height" content="200" />
<meta property="og:locale" content="en_US" />
<meta name="twitter:site" content="@wordpressdotcom" />
<meta name="twitter:text:title" content="GotW #2 Solution: Temporary&nbsp;Objects" />
<meta name="twitter:image" content="https://secure.gravatar.com/blavatar/4554b8d24c7f200dc5e2e1b18db1893f?s=240" />
<meta name="twitter:card" content="summary" />
<meta property="article:publisher" content="https://www.facebook.com/WordPresscom" />

<!-- End Jetpack Open Graph Tags -->
<link rel="shortcut icon" type="image/x-icon" href="https://secure.gravatar.com/blavatar/4554b8d24c7f200dc5e2e1b18db1893f?s=32" sizes="16x16" />
<link rel="icon" type="image/x-icon" href="https://secure.gravatar.com/blavatar/4554b8d24c7f200dc5e2e1b18db1893f?s=32" sizes="16x16" />
<link rel="apple-touch-icon-precomposed" href="https://secure.gravatar.com/blavatar/4554b8d24c7f200dc5e2e1b18db1893f?s=114" />
<link rel='openid.server' href='https://herbsutter.wordpress.com/?openidserver=1' />
<link rel='openid.delegate' href='https://herbsutter.wordpress.com/' />
<link rel="search" type="application/opensearchdescription+xml" href="https://herbsutter.com/osd.xml" title="Sutter’s Mill" />
<link rel="search" type="application/opensearchdescription+xml" href="https://s1.wp.com/opensearch.xml" title="WordPress.com" />
		<style id="wpcom-hotfix-masterbar-style">
			@media screen and (min-width: 783px) {
				#wpadminbar .quicklinks li#wp-admin-bar-my-account.with-avatar > a img {
					margin-top: 5px;
				}
			}
		</style>
		<script type="text/javascript" id="webfont-output">
  
  WebFontConfig = {"typekit":{"id":"cjs1oxc"}};
  (function() {
    var wf = document.createElement('script');
    wf.src = ('https:' == document.location.protocol ? 'https' : 'http') +
      '://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';
    wf.type = 'text/javascript';
    wf.async = 'true';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(wf, s);
	})();
</script><style type="text/css">
.widget_twitter li {
	word-wrap: break-word;
}
</style>
<meta name="application-name" content="Sutter’s Mill" /><meta name="msapplication-window" content="width=device-width;height=device-height" /><meta name="msapplication-tooltip" content="Herb Sutter on software development" /><meta name="msapplication-task" content="name=Subscribe;action-uri=https://herbsutter.com/feed/;icon-uri=https://secure.gravatar.com/blavatar/4554b8d24c7f200dc5e2e1b18db1893f?s=16" /><meta name="msapplication-task" content="name=Sign up for a free blog;action-uri=http://wordpress.com/signup/;icon-uri=https://s1.wp.com/i/favicon.ico" /><meta name="msapplication-task" content="name=WordPress.com Support;action-uri=http://support.wordpress.com/;icon-uri=https://s1.wp.com/i/favicon.ico" /><meta name="msapplication-task" content="name=WordPress.com Forums;action-uri=http://forums.wordpress.com/;icon-uri=https://s1.wp.com/i/favicon.ico" /><meta name="description" content="Unnecessary and/or temporary objects are frequent culprits that can throw all your hard work—and your program&#039;s performance—right out the window. How can you spot them and avoid them?  Problem JG Question 1. What is a temporary object? Guru Question 2. You are doing a code review. A programmer has written the following function, which uses&hellip;" />
<style type="text/css">
			#header h1 a,
		#header h2 {
			color: #265E15 !important;
		}
				#headerimage {
			background: url('https://herbsutter.files.wordpress.com/2011/10/cropped-blog-header.jpg') no-repeat;
			height: 200px;
		}
	</style>
<link rel="amphtml" href="https://herbsutter.com/2013/05/13/gotw-2-solution-temporary-objects/amp/"><style type="text/css" id="syntaxhighlighteranchor"></style>
		<link rel="stylesheet" id="custom-css-css" type="text/css" href="https://s2.wp.com/?custom-css=1&#038;csblog=eb5Y&#038;cscache=6&#038;csrev=60" />
		</head>
<body id="section-index" class="post-template-default single single-post postid-1874 single-format-standard mp6 customizer-styles-applied highlander-enabled highlander-light">


<div id="navigation" class="clearfix">
		<div class="menu">
		<ul>
			<li ><a href="https://herbsutter.com/" title="Home">Home</a></li>
			<li class="page_item page-item-912"><a href="https://herbsutter.com/welcome-to-the-jungle/">Welcome to the&nbsp;Jungle</a></li>
<li class="page_item page-item-864 page_item_has_children"><a href="https://herbsutter.com/gotw/">GotW</a></li>
<li class="page_item page-item-761"><a href="https://herbsutter.com/elements-of-modern-c-style/">Elements of Modern C++&nbsp;Style</a></li>
<li class="page_item page-item-2 page_item_has_children"><a href="https://herbsutter.com/about/">About</a></li>
									<li class="search"><form method="get" id="searchform" action="https://herbsutter.com"><input type="text" class="textbox" value="" name="s" id="s" /><input type="submit" id="searchsubmit" value="Search" /></form></li>
					</ul>
	</div>
</div><!-- end id:navigation -->

<div id="container">

<div id="header">
<h1><a href="https://herbsutter.com/" title="Sutter’s Mill">Sutter’s Mill</a></h1>
<h2>Herb Sutter on software development</h2>
</div><!-- end id:header -->


	
		<div id="feedarea">
	<dl>
		<dt><strong>Feeds:</strong></dt>

			<dd><a href="https://herbsutter.com/feed/">Posts</a></dd>
	
			<dd><a href="https://herbsutter.com/comments/feed/">Comments</a></dd>
		</dl>
	</div><!-- end id:feedarea -->
	
	<div id="headerimage">
</div><!-- end id:headerimage -->

<div id="content">
<div id="content-main">

		
									<div class="postnav">
				<div class="alignleft">&laquo; <a href="https://herbsutter.com/2013/05/09/gotw-2-temporary-objects-510/" rel="prev">GotW #2: Temporary&nbsp;Objects</a></div>
				<div class="alignright"><a href="https://herbsutter.com/2013/05/13/gotw-3-using-the-standard-library-or-temporaries-revisited-310/" rel="next">GotW #3: Using the Standard Library (or, Temporaries Revisited)&nbsp;(3/10)</a> &raquo;</div>
			</div>
			
			<div class="post-1874 post type-post status-publish format-standard hentry category-gotw" id="post-1874">
				<div class="posttitle">
					<h2>GotW #2 Solution: Temporary&nbsp;Objects</h2>
					<p class="post-info">2013-05-13 by <a href="https://herbsutter.com/author/herbsutter/" title="Posts by Herb Sutter">Herb Sutter</a>  </p>
				</div>

				<div class="entry">
					<p><span style="color:#5a5a5a;"><em>Unnecessary and/or temporary objects are frequent culprits that can throw all your hard work—and your program&#8217;s performance—right out the window. How can you spot them and avoid them?<br />
</em></span></p>
<p>
 </p>
<h1>Problem<br />
</h1>
<h2>JG Question<br />
</h2>
<p>1. What is a temporary object?
</p>
<h2>Guru Question<br />
</h2>
<p>2. You are doing a code review. A programmer has written the following function, which uses unnecessary temporary or extra objects in at least three places. How many can you identify, and how should the programmer fix them?
</p>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code>string find_addr( list&lt;employee&gt; emps, string name ) {<br />    for( auto i = begin(emps); i != end(emps); i++ ) {<br />        if( *i == name ) {<br />            return i-&gt;addr;<br />        }<br />    }<br />    return "";<br />}
</code></pre>
</p>
<p>Do not change the operational semantics of this function, even though they could be improved.
</p>
<p>
 </p>
<h1>Solution<br />
</h1>
<h2>1. What is a temporary object?<br />
</h2>
<p>Informally, a temporary object is an unnamed object that you can&#8217;t take the address of. A temporary is often created as an intermediate value during the evaluation of an expression, such as an object created by returning a value from a function, performing an implicit conversion, or throwing an exception. We usually call a temporary object an &#8220;rvalue,&#8221; so named because it can appear on the &#8220;r&#8221;ight hand side of an assignment. Here are some simple examples:
</p>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code><span style="background-color:yellow;">widget</span> f();            // f returns a temporary widget object<br /><br />auto a = 0, b = 1;<br />auto c = <span style="background-color:yellow;">a + b</span>;        // "a+b" creates a temporary int object
</code></pre>
</p>
<p>In contrast, in the same code we have objects like <span style="color:#2e74b5;">a</span> and <span style="color:#2e74b5;">c</span> that do each have a name and a memory address. Such an object is usually called an &#8220;lvalue,&#8221; because it can appear on the &#8220;l&#8221;eft hand side of an assignment.
</p>
<p>That&#8217;s a simplification of the truth, but it&#8217;s generally all you need to know. More precisely, C++ now has five categories of values, but distinguishing them is primarily useful for writing down the language specification, and you can mostly ignore them and just think about &#8220;rvalues&#8221; for temporary objects without names and whose addresses can&#8217;t be taken, and &#8220;lvalues&#8221; for non-temporary objects that have names and whose addresses can be taken.
</p>
<p>
 </p>
<h2>2. How many unnecessary temporary objects can you identify, and how should the programmer fix them?<br />
</h2>
<p>Believe it or not, this short function harbors three obvious cases of unnecessary temporaries or extra copies of objects, two subtler ones, and three red herrings.
</p>
<h3>The parameters are passed by value.<br />
</h3>
<p>The most obvious extra copies are buried in the function signature itself:
</p>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code>  string find_addr( list&lt;employee&gt; emps, string name )
</code></pre>
</p>
<p>The parameters should be passed by <span style="color:#2e74b5;">const&amp;</span>—that is, <span style="color:#2e74b5;">const list&lt;employee&gt;&amp;</span> and <span style="color:#2e74b5;">const string&amp;</span>, respectively—instead of by value. Pass-by-value forces the compiler to make complete copy of both objects, which can be expensive and, here, is completely unnecessary.
</p>
<blockquote>
<p><strong>Guideline:</strong> Prefer passing a read-only parameter by <strong>const&amp;</strong> if you are only going to read from it (not make a copy of it).
</p>
</blockquote>
<p>Pedantic note: Yes, with pass-by-value, if the caller passed a temporary <span style="color:#2e74b5;">list</span> or <span style="color:#2e74b5;">string</span> argument then it could be moved from rather than copied. But I&#8217;m deliberately saying &#8220;forces the compiler to make a complete copy&#8221; here because no caller is realistically going to be passing a temporary <span style="color:#2e74b5;">list</span> to <span style="color:#2e74b5;">find_addr</span>, except by mistake.
</p>
<h3>Non-issue: Initializing with &#8220;=&#8221;.<br />
</h3>
<p>Next we come to the first red herring, in the <span style="color:#2e74b5;">for</span> loop&#8217;s initialization:
</p>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code>    for( auto i = begin(emps); /*...*/ )
</code></pre>
</p>
<p>You might be tempted to say that this code should prefer to be spelled <span style="color:#2e74b5;">auto i(begin(emps))</span> rather than <span style="color:#2e74b5;">auto i = begin(emps)</span>, on the grounds that the <span style="color:#2e74b5;">=</span> syntax incurs an extra temporary object, even if it might be optimized away. After all, as we saw in GotW #1, usually that extra <span style="color:#2e74b5;">=</span> means the two-step &#8220;convert to a temporary then copy/move&#8221; of copy-initialization—but recall that doesn&#8217;t apply when using <span style="color:#2e74b5;">auto</span> like this. Why?
</p>
<p>Remember that <span style="color:#2e74b5;">auto</span> always deduces the exact type of the initializer expression, minus top-level <span style="color:#2e74b5;">const</span> and <span style="color:#2e74b5;">&amp;</span> which don&#8217;t matter for conversions, and so… presto! there cannot be any need for a conversion and we directly construct <span style="color:#2e74b5;">i</span>.
</p>
<p>So there is no difference between <span style="color:#2e74b5;">auto i(begin(emps))</span> and <span style="color:#2e74b5;">auto i = begin(emps)</span>. Which syntax you choose is up to you, but it depends only on taste, not on temporaries or any other performance or semantic difference.
</p>
<blockquote>
<p><strong>Guideline:</strong> Prefer declaring variables using <strong>auto</strong>. Among other reasons to do so, it naturally guarantees zero extra temporaries due to implicit conversions.
</p>
</blockquote>
<h3>The end of the range is recalculated on each loop iteration.<br />
</h3>
<p>Another potential avoidable temporary occurs in the <span style="color:#2e74b5;">for</span> loop&#8217;s termination condition:
</p>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code>  for( /*...*/ ; i != end(emps); /*...*/ )
</code></pre>
</p>
<p>For most containers, including <span style="color:#2e74b5;">list</span>, calling <span style="color:#2e74b5;">end()</span> returns a temporary object that must be constructed and destroyed, even though the value will not change.
</p>
<p>Normally when a value will not change, instead of recomputing it (and reconstructing and redestroying it) on every loop iteration, we would want to compute the value only once, store it in a local object, and reuse it.
</p>
<blockquote>
<p><strong>Guideline:</strong> Prefer precomputing values that won&#8217;t change, instead of recreating objects unnecessarily.
</p>
</blockquote>
<p>However, a caution is in order: In practice, for simple inline functions like <span style="color:#2e74b5;">list&lt;T&gt;::end()</span> in particular used in a loop, compilers routinely notice their values won&#8217;t change and hoist them out of the loop for you without you having to do it yourself. So I actually don&#8217;t recommend any change to hoist the <span style="color:#2e74b5;">end</span> calculation here, because that would make the code slightly more complex and the definition of premature optimization is making the code more complex in the name of efficiency without data that it&#8217;s actually needed. Clarity comes first:
</p>
<blockquote>
<p><strong><em>Definition</em>: Premature optimization</strong> is when you make code more complex in the name of efficiency without data that it&#8217;s actually needed.
</p>
</blockquote>
<blockquote>
<p><strong>Guideline:</strong> Write for clarity and correctness first. Don&#8217;t optimize prematurely, before you have profiler data proving the optimization is needed, especially in the case of calls to simple inline calls to short functions that compilers normally can handle for you.
</p>
</blockquote>
<h3>The iterator increment uses postincrement.<br />
</h3>
<p>Next, consider the way we increment <span style="color:#2e74b5;">i</span> in the for loop:
</p>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code>  for( /*...*/ ; i++ )
</code></pre>
</p>
<p>This temporary is more subtle, but it&#8217;s easy to understand once you remember how preincrement and postincrement differ. Postincrement is usually less efficient than preincrement because it has to remember and return its original value.
</p>
<p>Postincrement for a class <span style="color:#2e74b5;">T</span> should normally be implemented using the canonical form as follows:
</p>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code>T T::operator++(int)() {<br />    auto old = *this; // remember our original value<br />    ++*this;          // always implement postincr in terms of preincr<br />    return old;       // return our original value<br />}
</code></pre>
</p>
<p>Now it&#8217;s easy to see why postincrement is less efficient than preincrement: Postincrement has to do all the same work as preincrement, but in addition it also has to construct and return another object containing the original value.
</p>
<blockquote>
<p><strong>Guideline:</strong> For consistency, always implement postincrement in terms of preincrement, otherwise your users will get surprising (and often unpleasant) results.
</p>
</blockquote>
<p>In the problem&#8217;s code, the original value is never used, and so there&#8217;s no reason to use postincrement. Preincrement should be used instead. Although the difference is unlikely to matter for a built-in type or a simple iterator type, where the compiler can often optimize away the extra unneeded work for you, it&#8217;s still a good habit not to ask for more than you need.
</p>
<blockquote>
<p><strong>Guideline:</strong> Prefer preincrement. Only use postincrement if you&#8217;re going to use the original value.
</p>
</blockquote>
<p> &#8220;But wait, you&#8217;re being inconsistent!&#8221; I can just hear someone saying. &#8220;That&#8217;s premature optimization. You said that compilers can hoist the <span style="color:#2e74b5;">end()</span> call out of the loop, and it&#8217;s just as easy for a compiler to optimize away this postincrement temporary.&#8221;
</p>
<p>That&#8217;s true, but it doesn&#8217;t imply premature optimization. Preferring <span style="color:#2e74b5;">++i</span> does not mean writing more complex code in the name of performance before you can prove it&#8217;s needed—<span style="color:#2e74b5;">++i</span> is not more complex than <span style="color:#2e74b5;">i++</span>, so it&#8217;s not as if you need performance data to justify using it! Rather, preferring <span style="color:#2e74b5;">++i</span> is <em>avoiding premature pessimization</em>, which means avoiding writing equivalently complex code that needlessly asks for extra work that it&#8217;s just going to ignore anyway.
</p>
<blockquote>
<p><strong><em>Definition</em>: Premature pessimization</strong> is when you write code that is slower than it needs to be, usually by asking for unnecessary extra work, when equivalently complex code would be faster and should just naturally flow out of your fingers.
</p>
</blockquote>
<h3>The comparison might use an implicit conversion.<br />
</h3>
<p>Next, we come to this:
</p>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code>    if( *i == name )
</code></pre>
</p>
<p>The <span style="color:#2e74b5;">employee</span> class isn&#8217;t shown in the problem, but we can deduce a few things about it. For this code to work, <span style="color:#2e74b5;">employee</span> likely must either have a conversion to <span style="color:#2e74b5;">string</span> or a conversion constructor taking a <span style="color:#2e74b5;">string</span>. Both cases create a temporary object, invoking either <span style="color:#2e74b5;">operator==</span> for <span style="color:#2e74b5;">string</span>s or <span style="color:#2e74b5;">operator==</span> for <span style="color:#2e74b5;">employee</span>s. (Only if there does happen to be an <span style="color:#2e74b5;">operator==</span> that takes one of each, or <span style="color:#2e74b5;">employee</span> has a conversion to a reference, that is, <span style="color:#2e74b5;">string&amp;</span>, is a temporary not needed.)
</p>
<blockquote>
<p><strong>Guideline: </strong>Watch out for hidden temporaries created by implicit conversions. One good way to avoid this is to make constructors and conversion operators <strong>explicit</strong> by default unless implicit conversions are really desirable.
</p>
</blockquote>
<h3>Probably a non-issue: return &#8220;&#8221;.<br />
</h3>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code>    return "";
</code></pre>
</p>
<p>Here we unavoidably create a temporary (unless we change the return type, but we shouldn&#8217;t; see below), but the question is: Is there a better way?
</p>
<p>As written, <span style="color:#2e74b5;">return &#8220;&#8221;;</span> calls the <span style="color:#2e74b5;">string</span> constructor that takes a <span style="color:#2e74b5;">const char*</span>, and if the <span style="color:#2e74b5;">string</span> implementation you&#8217;re using either (a) is smart enough to check for the case where it&#8217;s being passed an empty string, or (b) uses the small string optimization (SSO) that stores strings up to a certain size directly within the string object instead of on the heap, no heap allocation will happen.
</p>
<p>Indeed, every <span style="color:#2e74b5;">string</span> implementation I checked is smart enough not to perform an allocation here, which is maximally efficient for <span style="color:#2e74b5;">string</span>, and so in practice there&#8217;s nothing to optimize. But what alternatives do we have? Let&#8217;s consider two.
</p>
<p>First, you might consider re-spelling this as <span style="color:#2e74b5;">return &#8220;&#8221;s;</span> which is new in C++14. That essentially relies on the same implementation smarts to check for empty strings or to use SSO, just in a different function—the literal <span style="color:#2e74b5;">operator&#8221;&#8221;</span>.
</p>
<p>Second, you might consider re-spelling this as <span style="color:#2e74b5;">return { };</span>. On implementations that are both non-smart <em>and</em> non-SSO, this might have a slight advantage over the others because it invokes the default constructor, and so even the most naïve implementation is likely not to do an allocation since clearly no value is needed.
</p>
<p>In summary, there&#8217;s no difference in practice among returning <span style="color:#2e74b5;">&#8220;&#8221;</span>, <span style="color:#2e74b5;">&#8220;&#8221;s</span>, or <span style="color:#2e74b5;">{ }</span>; use whichever you prefer for stylistic reasons. If your <span style="color:#2e74b5;">string</span> implementation is either smart or uses SSO, which covers all implementations I know of, there&#8217;s exactly zero allocation difference.
</p>
<p>Note: SSO is a wonderful optimization for avoiding allocation overhead and contention, and every modern <span style="color:#2e74b5;">string</span> ought to use it. If your <span style="color:#2e74b5;">string</span> implementation doesn&#8217;t use SSO (as of this writing, I&#8217;m looking at you, libstdc++), write to your standard library implementer—it really should.
</p>
<h3>Non-issue: Multiple returns.<br />
</h3>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code>    return i-&gt;addr;<br />    return "";
</code></pre>
</p>
<p>This was a second subtle red herring, designed to lure in errant disciples of the &#8220;single-entry/single-exit&#8221; (SE/SE) persuasion.
</p>
<p>I In the past, I&#8217;ve heard some people argue that it&#8217;s better to declare a local <span style="color:#2e74b5;">string</span> object to hold the return value and have a single <span style="color:#2e74b5;">return</span> statement that returns that <span style="color:#2e74b5;">string</span>, such as writing <span style="color:#2e74b5;">string ret; &#8230; ret = i-&gt;addr; break; &#8230; return ret;</span>. The idea, they say, is that this will assist the optimizer perform the &#8216;named return value optimization.&#8217;
</p>
<p>The truth is that whether single-return will improve or degrade performance can depend greatly on your actual code and compiler. In this case, the problem is that creating a single local <span style="color:#2e74b5;">string</span> object and then assigning it would mean calling string&#8217;s default constructor <em>and</em> then possibly its assignment  operator, instead of just a single constructor as in our original code. &#8220;But,&#8221; you ask, &#8220;how expensive could a plain old <span style="color:#2e74b5;">string</span> default constructor be?&#8221; Well, here&#8217;s how the &#8220;two-return&#8221; version performed on one popular compiler last time I tried it:
</p>
<ul>
<li>with optimizations disabled: two-return 5% faster than a &#8220;return value&#8221; <span style="color:#2e74b5;">string</span> object
</li>
<li>with aggressive optimizations: two-return 40% faster than a &#8220;return value&#8221; <span style="color:#2e74b5;">string</span> object
</li>
</ul>
<p>Note what this means: Not only did the single-return version generate slower code on this particular compiler on this particular day, but the slowdown was greater with optimizations turned on. In other words, a single-return version didn&#8217;t assist optimization, but actively interfered with it by making the code more complex.
</p>
<p>In general, note that SE/SE is an obsolete idea and has always been wrong. &#8220;Single entry,&#8221; or the idea that functions should always be entered in one place (at their start) and not with <span style="color:#2e74b5;">goto</span> jumps from the caller&#8217;s code directly to random places inside the function body, was and is an immensely valuable advance in computer science. It&#8217;s what made libraries possible, because it meant you could package up a function and reuse it and the function would always know its starting state, where it begins, regardless of the calling code. &#8220;Single exit,&#8221; on the other hand, got unfairly popular on the basis of optimization (&#8216;if there&#8217;s a single <span style="color:#2e74b5;">return</span> the compiler can perform return value optimization better&#8217;—see counterexample above) and symmetry (&#8216;if single entry is good, single exit must be good too&#8217;) but that is wrong because the reasons don&#8217;t hold in reverse—allowing a caller to jump in is bad because it&#8217;s not under the function&#8217;s control, but allowing the function itself to return early when it knows it&#8217;s done is perfectly fine and fully under the function&#8217;s control. To put the final nail in the coffin, note that &#8220;single exit&#8221; has always been a fiction in any language that has exceptions, because you can get an early exceptional return from any point where you call something that could throw an exception.
</p>
<h3>Non-issue: Return by value.<br />
</h3>
<p>Which brings us to the third red herring:
</p>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code>string find_addr( /*...*/ )
</code></pre>
</p>
<p>Because C++ naturally enables move semantics for returned values like this <span style="color:#2e74b5;">string</span> object, there&#8217;s usually little to be gained by trying to avoid the temporary when you return by value. For example, if the caller writes <span style="color:#2e74b5;">auto address = find_addr( mylist, &#8220;Marvin the Robot&#8221; );</span>, there will be at most a cheap move (not a deep copy) of the returned temporary into <span style="color:#2e74b5;">address</span>, and compilers are allowed to optimize away even that cheap move and construct the result into <span style="color:#2e74b5;">address</span> directly.
</p>
<p>But what if you did feel tempted to try to avoid a temporary in all return cases by returning a <span style="color:#2e74b5;">string&amp;</span> instead of <span style="color:#2e74b5;">string</span>? Here&#8217;s one way you might try doing it that avoids the pitfall of returning a dangling reference to a local or temporary object:
</p>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code>const string&amp; find_addr( /* ... */ ) {<br />    for( /* ... */ ) {<br />        if( /* found */ ) {<br />            return i-&gt;addr;<br />        }<br />    }<br />    static const string empty;<br />    return empty;<br />}
</code></pre>
</p>
<p>To demonstrate why this is brittle, here&#8217;s an extra question:
</p>
<p><strong>For the above function, write the documentation for how long the returned reference is valid.<br />
</strong></p>
<p>Go ahead, we&#8217;ll wait.
</p>
<p>Done? Okay, let&#8217;s consider: If the object is found, we are returning a reference to a <span style="color:#2e74b5;">string</span> inside an <span style="color:#2e74b5;">employee</span> object inside the <span style="color:#2e74b5;">list</span>, and so the reference itself is only valid for the lifetime of said <span style="color:#2e74b5;">employee</span> object inside the <span style="color:#2e74b5;">list</span>. So we might try something like this (assuming an empty address is not valid for any employee):
</p>
<blockquote>
<p>&#8220;If the returned string is nonempty, then the reference is valid until the next time you modify the employee object for which this is the address, including if you remove that employee from the list.&#8221;
</p>
</blockquote>
<p>Those are very brittle semantics, not least because the first (but far from only) problem that immediately arises is that the caller has no idea which employee that is—not only doesn&#8217;t he have a pointer or reference to the right <span style="color:#2e74b5;">employee</span> object, but he may not even be able to easily figure out which one it is if two employees could have the same address. Second, calling code can be notoriously forgetful and careless about the lifetimes of the returned reference, as in the following code which compiles just fine:
</p>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code>auto&amp; a = find_addr( emps, "John Doe" );  // yay, avoided temporary!<br />emps.clear();<br />cout &lt;&lt; a;                                // oops
</code></pre>
</p>
<p>When the calling code does something like this and uses a reference beyond its lifetime, the bug will typically be intermittent and very difficult to diagnose. Indeed, one of the most common mistakes programmers make with the standard library is to use iterators after they are no longer valid, which is pretty much the same thing as using a reference beyond its lifetime; see GotW #18 for details about the accidental use of invalid iterators.
</p>
<h2>Summary<br />
</h2>
<p>There are some other optimization opportunities. Ignoring these for now, here is one possible corrected version of <span style="color:#2e74b5;">find_addr</span> which fixes the unnecessary temporaries. To avoid a possible conversion in the <span style="color:#2e74b5;">employee</span>/<span style="color:#2e74b5;">string</span> comparison, we&#8217;ll assume there&#8217;s something like an <span style="color:#2e74b5;">employee::name()</span> function and that <span style="color:#2e74b5;">.name() == name</span> has equivalent semantics.
</p>
<p>Note another reason to prefer declaring local variables with <span style="color:#2e74b5;">auto</span>: Because the <span style="color:#2e74b5;">list&lt;employee&gt;</span> parameter is now <span style="color:#2e74b5;">const</span>, calling <span style="color:#2e74b5;">begin</span> and <span style="color:#2e74b5;">end</span> return a different type—not <span style="color:#2e74b5;">iterator</span>s but <span style="color:#2e74b5;">const_iterator</span>s—but <span style="color:#2e74b5;">auto</span> naturally deduces the right thing so you don&#8217;t have to remember to make that change in your code.
</p>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code>string find_addr( const list&lt;employee&gt;&amp; emps, const string&amp; name ) {<br />    for( auto i = begin(emps);  i != end(emps); ++i ) {<br />        if( i-&gt;name() == name ) {<br />            return i-&gt;addr;<br />        }<br />    }<br />    return "";<br />}
</code></pre>
</p>
<h2>Acknowledgments<br />
</h2>
<p>Thanks in particular to the following for their feedback to improve this article: &#8220;litb1,&#8221; Daan Nusman, &#8220;Adrian,&#8221; Michael Marcin, Ville Voutilainen, Rick Yorgason, &#8220;kkoehne,&#8221; and Olaf van der Spek.</p>
									</div>

				<p class="postmetadata">
					Posted in <a href="https://herbsutter.com/category/c/gotw/" rel="category tag">GotW</a> | 											59 Comments									</p>
				
<!-- You can start editing here. -->

<h3 id="comments">59 Responses</h3>

	<ol class="commentlist">
			<li class="comment even thread-even depth-1 highlander-comment" id="comment-13078">
		<div id="div-comment-13078">
		<div class="cmtinfo"><em> on <a href="#comment-13078" title="">2013-11-03 at 9:48 pm</a></em> <img alt='' src='https://i1.wp.com/lh4.googleusercontent.com/-aXHHxpXaEnY/AAAAAAAAAAI/AAAAAAAABp8/lLTeNXSames/photo.jpg?resize=48%2C48&#038;ssl=1' class='avatar avatar-48' height='48' width='48' /> <cite><a href='https://plus.google.com/101557590873105234449' rel='external nofollow' class='url'>Kenneth Ho</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_13078"></div><p>Hi Sutter,</p>
<p>I failed to find a more appropriate article to post this question, so here it goes.</p>
<p>Why doesn&#8217;t std::min/max take URefs? I imagine something along the lines of the following would be reasonable:</p>
<pre class="brush: plain; title: ; notranslate" title="">
  template &lt;typename T&gt; 
  T min(T&amp;&amp; v1, T&amp;&amp; v2) 
  { 
    return v1 &lt; v2 ? std::forward&lt;T&gt;(v1) : std::forward&lt;T&gt;(v2); 
  } 
</pre>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="pingback odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-12048">
		<div id="div-comment-12048">
		<div class="cmtinfo"><em> on <a href="#comment-12048" title="">2013-07-25 at 1:03 am</a></em> <img alt='' src='https://secure.gravatar.com/blavatar/2f62869fd50fe4feeece2c5e893e6ef3?s=48' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://bulldozer00.com/2013/07/25/the-bogus-sese-rule/' rel='external nofollow' class='url'>The Bogus SE/SE Rule | Bulldozer00&#039;s Blog</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_12048"></div><p>[&#8230;] Single Entry / Single Exit (SE/SE) &#8220;rule&#8221; of programming. I wish I had this eloquent Herb Sutter treatise on hand when it [&#8230;]</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 highlander-comment" id="comment-10388">
		<div id="div-comment-10388">
		<div class="cmtinfo"><em> on <a href="#comment-10388" title="">2013-05-23 at 8:56 pm</a></em> <img alt='' src='https://1.gravatar.com/avatar/7b4bb19457e88527e39d526111a764f4?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>GeoffW</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_10388"></div><p>@Herb Sutter: Thanks for your answer.  I had not considered locality.  Saying &#8220;a wash&#8221; makes It is easier to understand why libstdc++ may not have rushed into using it &#8211; of course the status with C++11 changes that.  I note also that consistent use of iterators over operator[] (one of the places where the extra test is potentially significant) would help even if the optimiser should miss it.  I&#8217;ve learned to be careful about assuming what optimisers may do.  I&#8217;m looking forward to a review of GotW#33 and discussing inline which has given me some grief lately (it&#8217;s often trying to do double duty, normal inline and macro/code replacement, the latter of which can be problematic in the face of optimiser choices).</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-herbsutter bypostauthor odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-10382">
		<div id="div-comment-10382">
		<div class="cmtinfo"><em> on <a href="#comment-10382" title="">2013-05-23 at 3:41 pm</a></em> <img alt='' src='https://0.gravatar.com/avatar/c0ba56bfd231f8f04feb057728975181?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://www.herbsutter.com' rel='external nofollow' class='url'>Herb Sutter</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_10382"></div><p>@GeoffW: I don&#8217;t know of SSO specific studies offhand, but it&#8217;s well known from studies that small strings dominate most applications, and that SSO optimizes two specific things that are well-known to be important: locality, and allocation (for allocation it&#8217;s both straight cost plus often poor scaling, though scaleable allocators are getting more common).</p>
<p>When Dinkumware switched from COW (which still had bugs) to SSO back around 2000, P.J. Plauger told me about performance measurements he had made that justified SSO, and also that when he made the switch he got no performance feedback from customers. You know that if there were any significant performance regressions in some code patterns then customers would report it. So this means switching from COW to SSO was &#8220;a wash&#8221; (his words) or better across a very broad set of customer code bases. (And of course switching away from COW put him in a good place because COW was made non-conforming in C++11.)</p>
<p>Finally, if you want a little more, remember that: (a) basic_string is a template which means all of its functions are inline; and (b) you usually perform more than just one operation on a string in a given function. So most of the time I would assume that optimizers routinely hoist/eliminate repeated code like isInternal ? useInternal : useExternal checks without even trying very hard. That&#8217;s low-hanging fruit for a modern optimizer.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 highlander-comment" id="comment-10378">
		<div id="div-comment-10378">
		<div class="cmtinfo"><em> on <a href="#comment-10378" title="">2013-05-23 at 2:04 pm</a></em> <img alt='' src='https://1.gravatar.com/avatar/7b4bb19457e88527e39d526111a764f4?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>GeoffW</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_10378"></div><p>The more I look at SSO the more I wonder just how effective it is &#8211; but I&#8217;m having trouble finding any discussion of actual testing.  It sounds great &#8211; no allocation overheads for some percentage of strings &#8211; but the cost is that almost every interaction with the string object comes prefixed with (isInternal ? useInternal : useExternal).  Yes this is very minor when taken alone, but when added to the extra cost of move, the extra space consumed by even empty strings (think vectors and lists of objects containing strings), it must add up over the life of the object and application.  Testing the difference between COW and non-COW was relatively simple, but testing the advantages of SSO is much less so (and may vary widely between applications).</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-10377">
		<div id="div-comment-10377">
		<div class="cmtinfo"><em> on <a href="#comment-10377" title="">2013-05-23 at 1:49 pm</a></em> <img alt='' src='https://1.gravatar.com/avatar/7b4bb19457e88527e39d526111a764f4?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>GeoffW</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_10377"></div><p>@Thomas Gahr: The single pointer implementation points to a structure that embeds the counter, size etc. in the allocated buffer &#8211; essentially just your typical pimpl pattern.  There are many examples of this &#8211; for an easy to read version see the test harness that went with the old GotW#45 (COW_AtomicInt2) &#8211; more realistic implementations optimise the empty string case.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 highlander-comment" id="comment-10363">
		<div id="div-comment-10363">
		<div class="cmtinfo"><em> on <a href="#comment-10363" title="">2013-05-23 at 7:04 am</a></em> <img alt='' src='https://1.gravatar.com/avatar/a9a2f9fdfe53a9d1bd96c38d64faf69e?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>Thomas Gahr</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_10363"></div><p>@GeoffW: FWIW: as far as I can see counter-COW argument boils down to exception safety since now any non-const access to the string (like operator[]) can throw std::bad_alloc as it mandates a deep copy of the data. I know your question was mainly about SSO, I just wanted to complete my last comment.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-10360">
		<div id="div-comment-10360">
		<div class="cmtinfo"><em> on <a href="#comment-10360" title="">2013-05-23 at 6:48 am</a></em> <img alt='' src='https://1.gravatar.com/avatar/a9a2f9fdfe53a9d1bd96c38d64faf69e?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>Thomas Gahr</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_10360"></div><p>@GeoffW: I don&#8217;t think sizeof(void*) std::string is doable no matter if you use SSO or COW &#8211; if we take COW, you&#8217;ll need one pointer for the data and one pointer for the reference count (or linked list, whichever you prefer) at least. You&#8217;ll also want to store the size of the string or you&#8217;re back to ::strlen for implementing .size(). If you take the &#8220;dumb&#8221; implementation of a string without any optimization &#8211; always allocate and memcpy data &#8211; you&#8217;ll need the data-pointer and the size member so you&#8217;re at 2*sizeof(void*) at least. Or am I wrong?<br />
Either way, I&#8217;d be interested in links to discussions about advantages/disadvantages of SSO and/or COW, too.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 highlander-comment" id="comment-10303">
		<div id="div-comment-10303">
		<div class="cmtinfo"><em> on <a href="#comment-10303" title="">2013-05-21 at 8:56 pm</a></em> <img alt='' src='https://1.gravatar.com/avatar/7b4bb19457e88527e39d526111a764f4?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>GeoffW</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_10303"></div><p>A question about the short string optimisation comments made in this article.  You say that &#8220;SSO is a wonderful optimization&#8221;, but offer no references in support of this.  Are there articles around that demonstrate the advantages of SSO in a realistic manner?  I mean SSO looks good in theory, but so does copy-on-write.  Is it proven to be worth blowing out the size of a string object from a single pointer to something that is some multiple of that just to implement SSO?  In particular I am wondering if the perceived advantages of SSO may be less as more code takes advantage of C++11 move semantics in their interfaces.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-10268">
		<div id="div-comment-10268">
		<div class="cmtinfo"><em> on <a href="#comment-10268" title="">2013-05-20 at 7:38 pm</a></em> <img alt='' src='https://1.gravatar.com/avatar/7b4bb19457e88527e39d526111a764f4?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>GeoffW</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_10268"></div><p>I think @Adrian makes some good points about single-exit.  It was never about optimisation, or structured programming rules (or not for me), it was about code clarity.  In short, simple functions I am happy to have multiple exits, it&#8217;s all there in front of you and your are unlikely to miss them when you come back to maintain the function.  In longer or more complex functions multiple-exit points can become a problem for maintenance &#8211; and any performance advantages in those situations are dubious and would have to be demonstrated.  (Of course we all avoid longer and more complex functions when we can, but they do still happen.)</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-herbsutter bypostauthor even thread-even depth-1 highlander-comment" id="comment-10225">
		<div id="div-comment-10225">
		<div class="cmtinfo"><em> on <a href="#comment-10225" title="">2013-05-19 at 8:14 am</a></em> <img alt='' src='https://0.gravatar.com/avatar/c0ba56bfd231f8f04feb057728975181?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://www.herbsutter.com' rel='external nofollow' class='url'>Herb Sutter</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_10225"></div><p>@Ahmed: I used to agree with you &#8212; the original GotW and Exceptional C++ said &#8220;hoist end()&#8221;. I switched to the current recommendation at Bjarne&#8217;s urging because compilers have for a long time routinely inlined the container.end() case in particular. Re (1), no you don&#8217;t need to inline both find_addr and end, just end &#8212; find_addr is its own function. Re (2), I agree one should write the clearest code first, so the extra variable for end is arguably less clear. But yes, range-for and std::find are the preferred answer anyway, see GotW #3.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-10222">
		<div id="div-comment-10222">
		<div class="cmtinfo"><em> on <a href="#comment-10222" title="">2013-05-19 at 3:05 am</a></em> <img alt='' src='https://2.gravatar.com/avatar/e487eb194f38fa558ee955b5603d798d?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>Ahmed Charles</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_10222"></div><p>I disagree with both points given which suggest that the end iterator being recomputed each loop should be preferred.</p>
<p>1) After seeing Chandler&#8217;s talk on Optimizations at C++Now, I&#8217;m significantly less likely to think that compilers will optimize this sort of code into &#8216;the right thing&#8217;. It would require inlining find_addr and end, while hoping that emps is a stack local in the caller.</p>
<p>2) Ignoring optimizations and compiler quality: For the same reasons that using algorithms is better than a normal for loop, because they are constrained and therefore provide more information to the reader, a for loop with the end calculated once provides more information to the reader, in that it guarantees that end isn&#8217;t changing (or if it is, that it&#8217;s likely to be a bug). I also don&#8217;t view this as a premature optimization, because it should simply be idiomatic to write code with the begin and end iterators assigned to variables in the for loop initializer, much like writing ++i is idiomatic. Granted, it should be idiomatic to write this as a range based for loop or std::foreach with a lambda, rather than a normal for loop. And with C++14, both of these are probably equivalent or less typing and they both cause end to be called only once.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-herbsutter bypostauthor even thread-even depth-1 highlander-comment" id="comment-10193">
		<div id="div-comment-10193">
		<div class="cmtinfo"><em> on <a href="#comment-10193" title="">2013-05-17 at 11:51 am</a></em> <img alt='' src='https://0.gravatar.com/avatar/c0ba56bfd231f8f04feb057728975181?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://www.herbsutter.com' rel='external nofollow' class='url'>Herb Sutter</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_10193"></div><p>@Robert: That&#8217;s not the same example as in the article. :) I agree your two lines are equivalent, and in both cases the calling code can easily see the bug locally in code review just by knowing the return type of the function (by value). What&#8217;s different to me in find_addr is that we&#8217;d be returning a reference that refers, not &#8220;directly within this here object I&#8217;m returning,&#8221; but &#8220;deep within some data structure plus I&#8217;m not going to tell you exactly which node it is either.&#8221; The article was doing the latter, and there&#8217;s no way to check the calling code&#8217;s correctness during code review without carefully reading the English documentation of find_addr to figure out if the reference was still valid. Doing the former, returning a reference directly into this visible object the caller knows about, is much less problematic IMO and does not require English documentation analysis to spot the bug.</p>
<p>@tivrfoa: I just compared using &#8220;no optimizations&#8221; vs. &#8220;max optimizations&#8221; compiler flags.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-10183">
		<div id="div-comment-10183">
		<div class="cmtinfo"><em> on <a href="#comment-10183" title="">2013-05-17 at 7:21 am</a></em> <img alt='' src='https://1.gravatar.com/avatar/1dddc4b6c57e369dab7ad1d2e262dab7?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://deepinanime.blogspot.com.br/' rel='external nofollow' class='url'>tivrfoa</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_10183"></div><p>Hello. &#8220;with aggressive optimizations&#8221;. How are these &#8220;aggressive optimizations&#8221;? Could someone show an example? Thank you.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 highlander-comment" id="comment-10175">
		<div id="div-comment-10175">
		<div class="cmtinfo"><em> on <a href="#comment-10175" title="">2013-05-17 at 1:14 am</a></em> <img alt='' src='https://i2.wp.com/graph.facebook.com/100004054812229/picture?q=type%3Dlarge%26_md5%3D9e5f827892523ff7a319a1687be4b4dd&#038;resize=48%2C48' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://www.facebook.com/profile.php?id=100004054812229' rel='external nofollow' class='url'>Róbert Dávid</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_10175"></div><p>@GregM: </p>
<pre class="brush: plain; title: ; notranslate" title="">std::get&lt;0&gt;()</pre>
<p> (blog ate my pointy braces) isn&#8217;t a member function of std::tuple, still isn&#8217;t returning by value..<br />
@Herb: Wait a minute. Are you saying that </p>
<pre class="brush: plain; title: ; notranslate" title="">auto&amp; x = function_that_creates_widget_and_returns_by_value().get_name();</pre>
<p> is &#8216;good&#8217;, but </p>
<pre class="brush: plain; title: ; notranslate" title="">auto&amp; x = get_widget_name(function_that_creates_widget_and_returns_by_value());</pre>
<p> isn&#8217;t? I so far failed to create any example where a get(xx) construct can have a dangling reference what is fixed just by replacing that call to a xx.get() construct, that&#8217;s why I think the two are equivalent, thus should use the same guidelines for return type.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-10161">
		<div id="div-comment-10161">
		<div class="cmtinfo"><em> on <a href="#comment-10161" title="">2013-05-16 at 6:32 pm</a></em> <img alt='' src='https://0.gravatar.com/avatar/3be7c20c4a0dc941dfc40f99784d8f1d?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://www.longbowgames.com' rel='external nofollow' class='url'>Rick Yorgason</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_10161"></div><p>@Herb But in practice, I&#8217;ve never seen it cause much of a problem. Any time a function is returning a &amp;, whether it&#8217;s a getter or a function like yours, the caller always knows one thing: the return value is valid if used immediately.</p>
<p>So if you&#8217;re returning a const&amp;, I know that both of these are safe:<br />
A) string s = find_addr(emps, &#8220;Rick&#8221;);<br />
B) if(find_addr( emps, &#8220;Rick&#8221; ).find( &#8220;Toronto&#8221; ) != string::npos) {}</p>
<p>But if you&#8217;re returning a value, one of those is less efficient.</p>
<p>I agree that hanging references/iterators is a very common problem, but every time I&#8217;ve encountered it, the caller made a conscious decision to store a reference rather than a value, including in the example you provided.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-herbsutter bypostauthor even thread-even depth-1 highlander-comment" id="comment-10116">
		<div id="div-comment-10116">
		<div class="cmtinfo"><em> on <a href="#comment-10116" title="">2013-05-16 at 6:15 am</a></em> <img alt='' src='https://0.gravatar.com/avatar/c0ba56bfd231f8f04feb057728975181?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://www.herbsutter.com' rel='external nofollow' class='url'>Herb Sutter</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_10116"></div><p>@kkoehne: Which ironically was the one Ville quoted. :) Thanks.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-10110">
		<div id="div-comment-10110">
		<div class="cmtinfo"><em> on <a href="#comment-10110" title="">2013-05-15 at 10:27 pm</a></em> <img alt='' src='https://1.gravatar.com/avatar/a25c143a231cb6800d00eab57ada38ac?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://gravatar.com/kkoehne' rel='external nofollow' class='url'>kkoehne</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_10110"></div><p>@Herb: You only fixed it in one place. Two paragraphs below there still is &#8220;So there is no difference between auto i{begin(emps)}&#8221;</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-herbsutter bypostauthor even thread-even depth-1 highlander-comment" id="comment-10105">
		<div id="div-comment-10105">
		<div class="cmtinfo"><em> on <a href="#comment-10105" title="">2013-05-15 at 1:04 pm</a></em> <img alt='' src='https://0.gravatar.com/avatar/c0ba56bfd231f8f04feb057728975181?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://www.herbsutter.com' rel='external nofollow' class='url'>Herb Sutter</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_10105"></div><p>@Ville: Good catch, I meant (). Fixed, thanks.</p>
<p>@Rick: &amp; parameters are much safer because they do fall into the structured lifetime bucket &#8212; as long as the caller holds a valid reference at the time he calls the function (and modulo aliasing) the reference is guaranteed to stay valid for the lifetime of the function. The same is not true when you return a pointer or reference, or store a pointer or reference on the heap or anywhere else non-local, because by definition that&#8217;s unstructured.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-herbsutter bypostauthor odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-10104">
		<div id="div-comment-10104">
		<div class="cmtinfo"><em> on <a href="#comment-10104" title="">2013-05-15 at 1:00 pm</a></em> <img alt='' src='https://0.gravatar.com/avatar/c0ba56bfd231f8f04feb057728975181?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://www.herbsutter.com' rel='external nofollow' class='url'>Herb Sutter</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_10104"></div><p>@Adrian, @Michael: OK, I&#8217;ve added that &#8220;helping optimization&#8221; was another motivation for single exit and added a bit more discussion about RVO and how the measurement I presented demonstrated that single-return actually harmed optimization.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-herbsutter bypostauthor even thread-even depth-1 highlander-comment" id="comment-10103">
		<div id="div-comment-10103">
		<div class="cmtinfo"><em> on <a href="#comment-10103" title="">2013-05-15 at 12:50 pm</a></em> <img alt='' src='https://0.gravatar.com/avatar/c0ba56bfd231f8f04feb057728975181?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://www.herbsutter.com' rel='external nofollow' class='url'>Herb Sutter</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_10103"></div><p>@Róbert Dávid: No, returning a &amp; can make sense. In the cases you mention, the lifetime issue is considerably simpler because you&#8217;re returning a reference guaranteed to be valid for the lifetime of the same object that is producing it, which is very different and much easier to reason about. In the case in the article, it&#8217;s a function returning a reference into an unknown node inside the list data structure; in the case of a getter like auto&amp; s = mywidget.get_name(), it&#8217;s a function returning a reference that is good for as long as the known named mywidget object is alive.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-10098">
		<div id="div-comment-10098">
		<div class="cmtinfo"><em> on <a href="#comment-10098" title="">2013-05-15 at 9:06 am</a></em> <img alt='' src='https://1.gravatar.com/avatar/db892012bc52cc6cbfd27db9d98acf8b?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>GregM</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_10098"></div><p>Robert,</p>
<p>&#8220;By that logic, no getter function should return a const reference, including vector::operator[], map::at(), std::get(), etc.! The fact that find_addr is free-standing doesn’t make a difference compared to the usual member getters&#8221;</p>
<p>I think it is much more obvious that [], at(), and get() member functions return data whose lifetime is defined by the container than it is that a standalone function returns data whose lifetime is defined by one of its parameters.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 highlander-comment" id="comment-10097">
		<div id="div-comment-10097">
		<div class="cmtinfo"><em> on <a href="#comment-10097" title="">2013-05-15 at 9:03 am</a></em> <img alt='' src='https://1.gravatar.com/avatar/db892012bc52cc6cbfd27db9d98acf8b?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>GregM</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_10097"></div><p>&#8220;Yes, checking !*p is the “check for empty string” I was talking about.&#8221;</p>
<p>Thanks.  I wasn&#8217;t sure whether it was &#8220;checking for !*p&#8221; or &#8220;checking for 0 == strlen(p)&#8221;.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-10081">
		<div id="div-comment-10081">
		<div class="cmtinfo"><em> on <a href="#comment-10081" title="">2013-05-14 at 4:55 pm</a></em> <img alt='' src='https://0.gravatar.com/avatar/3be7c20c4a0dc941dfc40f99784d8f1d?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://www.longbowgames.com' rel='external nofollow' class='url'>Rick Yorgason</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_10081"></div><p>I&#8217;m not sure it&#8217;s fair to demonize return by const&amp; while preferring const&amp; parameters. Both of these can lead to brittle code: in the former case, it&#8217;s because of hanging references, and in the latter case it&#8217;s because of aliasing. But often the brittleness is worthwhile, especially if you have large objects or if it&#8217;s likely that the return value will be chained or passed into another function.</p>
<p>However, it&#8217;s very rare that I use that static string technique. Usually if I&#8217;m returning by reference, it&#8217;s a caller error to ask for a reference that doesn&#8217;t exist, and I&#8217;ll throw an exception.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-herbsutter bypostauthor even thread-even depth-1 highlander-comment" id="comment-10080">
		<div id="div-comment-10080">
		<div class="cmtinfo"><em> on <a href="#comment-10080" title="">2013-05-14 at 2:47 pm</a></em> <img alt='' src='https://0.gravatar.com/avatar/c0ba56bfd231f8f04feb057728975181?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://www.herbsutter.com' rel='external nofollow' class='url'>Herb Sutter</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_10080"></div><p>@Daan: Yes, but part of the question was not to mess with the basic shape of the function. :) We&#8217;re focusing on temporary/extra objects in this one.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-10078">
		<div id="div-comment-10078">
		<div class="cmtinfo"><em> on <a href="#comment-10078" title="">2013-05-14 at 1:07 pm</a></em> <img alt='' src='https://0.gravatar.com/avatar/6bcbddbd9c7b31aaff8cf25a356bc96c?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>Gonzalo BG</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_10078"></div><p>&#8220;So I actually don’t recommend any change to hoist the end calculation here, because that would make the code slightly more complex [&#8230;]&#8221; </p>
<p>Does</p>
<pre class="brush: plain; title: ; notranslate" title="">
for(auto i = begin(emp), e = end(emp); i != e; ++i) {
  //...
}
</pre>
<p>make the code more complex? The list::end() iterator is never invalidated. I think that what you propose, i.e. calling the function end() at every loop iteration (and hoping for the compiler to optimize it), fits into your description of premature pessimization.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 highlander-comment" id="comment-10077">
		<div id="div-comment-10077">
		<div class="cmtinfo"><em> on <a href="#comment-10077" title="">2013-05-14 at 12:47 pm</a></em> <img alt='' src='https://1.gravatar.com/avatar/d360ec751eb90bc963c5b03544d88cf5?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>Ville Voutilainen</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_10077"></div><p>The blog ate the code. It will give you </p>
<pre class="brush: plain; title: ; notranslate" title="">initializer_list&lt;list&lt;employee&gt;::iterator&gt;</pre>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-10076">
		<div id="div-comment-10076">
		<div class="cmtinfo"><em> on <a href="#comment-10076" title="">2013-05-14 at 12:46 pm</a></em> <img alt='' src='https://1.gravatar.com/avatar/d360ec751eb90bc963c5b03544d88cf5?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>Ville Voutilainen</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_10076"></div><p>Oops, meant to say the former will give you an initializer_list. That it will do. :)</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 highlander-comment" id="comment-10075">
		<div id="div-comment-10075">
		<div class="cmtinfo"><em> on <a href="#comment-10075" title="">2013-05-14 at 12:45 pm</a></em> <img alt='' src='https://1.gravatar.com/avatar/d360ec751eb90bc963c5b03544d88cf5?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>Ville Voutilainen</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_10075"></div><p>Uh oh. &#8220;So there is no difference between auto i{begin(emps)} and auto i = begin(emps). &#8221;<br />
Sure there is &#8211; the latter will give you an initializer_list&lt;list::iterator&gt;&gt;. Which is probably not<br />
what you want.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-10058">
		<div id="div-comment-10058">
		<div class="cmtinfo"><em> on <a href="#comment-10058" title="">2013-05-14 at 12:51 am</a></em> <img alt='' src='https://2.gravatar.com/avatar/26230e55188637785a569c6ec8ca0f3f?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://xwis.net/' rel='external nofollow' class='url'>Olaf van der Spek</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_10058"></div><p>@Michael A safety belt does not affect your car&#8217;s performance, returning by value does.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 highlander-comment" id="comment-10056">
		<div id="div-comment-10056">
		<div class="cmtinfo"><em> on <a href="#comment-10056" title="">2013-05-14 at 12:15 am</a></em> <img alt='' src='https://2.gravatar.com/avatar/256c9d534302a138d5d1fe3ed833e217?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>Martin</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_10056"></div><p>I still prefer:</p>
<pre class="brush: plain; title: ; notranslate" title=""> for(auto i=begin(x), e=end(x); i!=e; ++i) </pre>
<p>It&#8217;s not so much about the optimization, it&#8217;s that the semantics now exactly match range based for.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="pingback odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-10051">
		<div id="div-comment-10051">
		<div class="cmtinfo"><em> on <a href="#comment-10051" title="">2013-05-13 at 6:21 pm</a></em>  <cite><a href='http://oraclechang.com/2013/05/14/rvalue-and-lvalue/' rel='external nofollow' class='url'>Rvalue and Lvalue | oraclechang</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_10051"></div><p>[&#8230;] GotW #2 Solution: Temporary Objects (herbsutter.com) [&#8230;]</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 highlander-comment" id="comment-10049">
		<div id="div-comment-10049">
		<div class="cmtinfo"><em> on <a href="#comment-10049" title="">2013-05-13 at 4:27 pm</a></em> <img alt='' src='https://0.gravatar.com/avatar/64abcdfeac5d480fd1f58a7901ad26ee?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>Michael Marcin</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_10049"></div><p>I&#8217;ve heard it&#8217;s harder/impossible for the compiler to do RVO with multiple exit functions, is this true?</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-10048">
		<div id="div-comment-10048">
		<div class="cmtinfo"><em> on <a href="#comment-10048" title="">2013-05-13 at 4:14 pm</a></em> <img alt='' src='https://i2.wp.com/graph.facebook.com/100004054812229/picture?q=type%3Dlarge&#038;resize=48%2C48' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://www.facebook.com/profile.php?id=100004054812229' rel='external nofollow' class='url'>Róbert Dávid</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_10048"></div><p>I disagree with the return type argument. By that logic, no getter function should return a const reference, including vector::operator[], map::at(), std::get(), etc.! The fact that find_addr is free-standing doesn&#8217;t make a difference compared to the usual member getters &#8211; it&#8217;s the same deal as with std::get().</p>
<pre class="brush: plain; title: ; notranslate" title="">auto&amp; a = find_addr( emps, &quot;John Doe&quot; );  // yay, avoided temporary!
emps.clear();
cout &lt;&lt; a;                                // oops</pre>
<p>is almost the same as</p>
<pre class="brush: plain; title: ; notranslate" title="">auto&amp; a = emps.front().addr;
emps.clear();
cout &lt;&lt; a;                                // oops</pre>
<p>and even,</p>
<pre class="brush: plain; title: ; notranslate" title="">vector&lt;int&gt; emps = { 0, 1, 2, 3 };
int&amp; a = emps[1];
emps.clear();
cout &lt;&lt; a;                                // oops</pre>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-herbsutter bypostauthor even thread-even depth-1 highlander-comment" id="comment-10043">
		<div id="div-comment-10043">
		<div class="cmtinfo"><em> on <a href="#comment-10043" title="">2013-05-13 at 1:51 pm</a></em> <img alt='' src='https://0.gravatar.com/avatar/c0ba56bfd231f8f04feb057728975181?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://www.herbsutter.com' rel='external nofollow' class='url'>Herb Sutter</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_10043"></div><p>@litb1: Good point, clarified. I was sure that somewhere over the years I already fixed that to say &#8220;temporary or extra objects&#8221; but perhaps it was in a different GotW. Thanks.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-herbsutter bypostauthor odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-10042">
		<div id="div-comment-10042">
		<div class="cmtinfo"><em> on <a href="#comment-10042" title="">2013-05-13 at 1:48 pm</a></em> <img alt='' src='https://0.gravatar.com/avatar/c0ba56bfd231f8f04feb057728975181?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://www.herbsutter.com' rel='external nofollow' class='url'>Herb Sutter</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_10042"></div><p>@GregM: Yes, checking !*p is the &#8220;check for empty string&#8221; I was talking about.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-herbsutter bypostauthor even thread-even depth-1 highlander-comment" id="comment-10041">
		<div id="div-comment-10041">
		<div class="cmtinfo"><em> on <a href="#comment-10041" title="">2013-05-13 at 1:46 pm</a></em> <img alt='' src='https://0.gravatar.com/avatar/c0ba56bfd231f8f04feb057728975181?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://www.herbsutter.com' rel='external nofollow' class='url'>Herb Sutter</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_10041"></div><p>@Thomas: Right, either check-for-empty or SSO is sufficient by itself, and all implementations I know of do at least one of those. It&#8217;s only if you don&#8217;t check for empty and you don&#8217;t do SSO that you can get an allocation with return &#8220;&#8221;;.</p>
<p>Having said that, since you&#8217;re looking into libstdc++&#8217;s basic_string, there&#8217;s actually something even worse in there &#8212; instead of SSO, when I tried it on the weekend it looked like gcc 4.8 libstdc++ was still doing COW (copy on write). COW has long been a bad idea and is now actively nonconforming to C++11, which deliberately made COW basic_string implementations nonconforming. So the fix you want should probably be phrased something like &#8220;please rip out brittle COW to conform to C++11 and replace it with modern SSO like everyone else did years ago.&#8221; :) I&#8217;ve been bellyaching about this for years, see 1999&#8217;s &#8220;Optimizations That Aren&#8217;t (in a Multithreaded World)&#8221; <a href="http://www.gotw.ca/publications/optimizations.htm" rel="nofollow">http://www.gotw.ca/publications/optimizations.htm</a> .</p>
<p>(Obligatory disclaimer: Yes, VC++ has way more conformance issues than GCC right now, and I&#8217;m pointing those out too. Just sayin&#8217; that this is also a decade-long overdue fix to libstdc++.)</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-10039">
		<div id="div-comment-10039">
		<div class="cmtinfo"><em> on <a href="#comment-10039" title="">2013-05-13 at 12:52 pm</a></em> <img alt='' src='https://0.gravatar.com/avatar/ca391c038b300a739462dae91c5e8cbc?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>Adrian</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_10039"></div><p>@Herb:  I shouldn&#8217;t have mentioned &#8220;structured programming&#8221; as that brings other debates into it.</p>
<p>My point was to contest your claim that single exit style exists only because of symmetry arguments with single entry.  This is simply not true, and, in fact, I&#8217;ve never heard the symmetry argument made before.</p>
<p>I argue that single exit remains a valuable, useful practice that is neither &#8220;errant&#8221; nor &#8220;obsolete.&#8221;  Single exit code is almost always easier to understand and reason about, and it provides a chokepoint to assert invariants and post conditions.  This has nothing to do with resource management or variable lifetimes&#8211;we all agree that RAII is the right thing to do.  Nor is the argument for single exit specific to languages like C.  The cases where early returns help, even in C++, are minimal, and in many, many cases, they introduce complexity and reduce robustness.</p>
<p>@Michael Gmelin:  Single-exit does not inherently lead to deep nesting, and multiple return code is generally more fragile when code must be modified to meet new requirements.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 highlander-comment" id="comment-10037">
		<div id="div-comment-10037">
		<div class="cmtinfo"><em> on <a href="#comment-10037" title="">2013-05-13 at 10:33 am</a></em> <img alt='' src='https://0.gravatar.com/avatar/3c2c7635f32d1d3717e49bda34c6e576?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://blog.grem.de' rel='external nofollow' class='url'>Michael Gmelin</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_10037"></div><p>@Herb: Couldn&#8217;t agree more. Single-exit tends to lead to deep nesting, hard to read and easy to break code. In C it&#8217;s common to use goto for proper clean up and reduce nesting (therefore doing what C++ does automatically explicitly and as a result of it have single exit). Been there, it doesn&#8217;t make sense in C++ at all &#8211; especially new/delete free C++14 code.</p>
<p>Maybe calling it &#8220;early return&#8221; isn&#8217;t helpful though, since that implies it&#8217;s something extraordinary. To me, returning as soon as a final result is available is quite common these days.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-herbsutter bypostauthor odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-10036">
		<div id="div-comment-10036">
		<div class="cmtinfo"><em> on <a href="#comment-10036" title="">2013-05-13 at 10:17 am</a></em> <img alt='' src='https://0.gravatar.com/avatar/c0ba56bfd231f8f04feb057728975181?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://www.herbsutter.com' rel='external nofollow' class='url'>Herb Sutter</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_10036"></div><p>@Adrian: Early return is not a violation of structured programming. This is exactly at the heart of the misconception that single entry (which is essential to structured programming) has anything at all to do with single exit (which is not). Structured means simply that lifetimes (such as of function calls and local variables) nest properly, like Russian dolls &#8212; which jumping into a function would violate, but returning early or throwing does not.</p>
<p>Having said that, &#8220;single exit&#8221; matters, but for different reasons(!), in languages like C where you don&#8217;t get stack lifetimes and automatic cleanup, and you typically have a cascade of goto labels and a single return at the end to make sure you got it right. For example, see <a href="http://www.c2.com/cgi/wiki?SingleFunctionExitPoint" rel="nofollow">http://www.c2.com/cgi/wiki?SingleFunctionExitPoint</a> . That&#8217;s a limitation of C specifically, not an inherent benefit of single exit or a generally symmetry with single entry which is important in all languages for entirely different reasons.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 highlander-comment" id="comment-10032">
		<div id="div-comment-10032">
		<div class="cmtinfo"><em> on <a href="#comment-10032" title="">2013-05-13 at 8:34 am</a></em> <img alt='' src='https://i1.wp.com/graph.facebook.com/626973053/picture?q=type%3Dlarge%26_md5%3D484e21091fd6de0678c1c9e3336ef570&#038;resize=48%2C48' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://www.facebook.com/ambarish.sridharanarayanan' rel='external nofollow' class='url'>Ambarish Sridharanarayanan</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_10032"></div><p>I&#8217;d always thought of something like SSO as a no-brainer, but Andrew Koenig&#8217;s tale has made me stop and think:</p>
<p><a href="http://www.drdobbs.com/cpp/is-optimization-immoral/240151916" rel="nofollow">http://www.drdobbs.com/cpp/is-optimization-immoral/240151916</a></p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-10031">
		<div id="div-comment-10031">
		<div class="cmtinfo"><em> on <a href="#comment-10031" title="">2013-05-13 at 8:06 am</a></em> <img alt='' src='https://2.gravatar.com/avatar/51d9c0f234a7029ac58358a6dc2053f5?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>Dave Harris</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_10031"></div><p>It seems to me that changing the argument from by-value to by-reference changes the operational semantics of this function. In the original, the function gets a local copy of the list, which cannot be affected by anything outside of the function. The by-reference list can be affected by other code. That is mostly likely if the code is multi-threaded, but it can also happen if the list is accessible from a static variable and some of the functions called modify it.</p>
<p>(It also makes it harder for the compiler to optimise things like end(). For example, if the (*i == name) line invokes code that the compiler can&#8217;t see, then it&#8217;s harder for the compiler to be sure that it does not modify the list through some alias.)</p>
<p>(I&#8217;d also hesitate to say emps is a temporary variable, given that it has a name and its address can be taken. Yes, it is an unnecessary copy that you would want to avoid, but it surely isn&#8217;t a temporary variable.)</p>
<p>The (*i == name) does not need a temporary if employee has an operator==() that accepts a string. I would have thought that were more common than being able to convert an employee to a string or vice versa.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 highlander-comment" id="comment-10029">
		<div id="div-comment-10029">
		<div class="cmtinfo"><em> on <a href="#comment-10029" title="">2013-05-13 at 7:53 am</a></em> <img alt='' src='https://0.gravatar.com/avatar/ca391c038b300a739462dae91c5e8cbc?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>Adrian</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_10029"></div><p>&#8220;“Single exit,” on the other hand, got unfairly popular on the basis of symmetry&#8221; [citation needed]</p>
<p>Single exit popular because it makes code easier to reason about.  It provides more places to assert your invariants, which helps in ensuring your code is correct.  Early returns (and other violations of structured programming) make invariant checking impossible.</p>
<p>Exceptions are exceptional&#8211;that is, they usually mean your invariant is violated anyway, so it makes sense to have those skip your invariant checking.  But early returns in non-exceptional cases create complexity by creating more paths that have to be analyzed and understood.</p>
<p>In the benchmark I just threw together, early returns provided only a 10% increase in speed with aggressive compiler optimizations, so I&#8217;d accept an early return as an optimization in performance-critical code.  I&#8217;d also except it in the rare case that it does clarify rather than confuse.  But in general, early returns are a premature optimization:  more complex code without data supporting a performance improvement.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-10028">
		<div id="div-comment-10028">
		<div class="cmtinfo"><em> on <a href="#comment-10028" title="">2013-05-13 at 7:41 am</a></em> <img alt='' src='https://2.gravatar.com/avatar/2385676760fc16f76a43f3319faaa843?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>litb1</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_10028"></div><p>I recommend to change </p>
<p>    &#8220;The most obvious temporaries are buried in the function signature itself:&#8221;</p>
<p>To avoid saying &#8220;temporaries&#8221;, or to clarify your definition of &#8220;temporary&#8221;. Both of these by-value parameters have a name, their lifetime last the entire functions activation, and their address can be taken. Or did I misunderstand your descriptions?</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 highlander-comment" id="comment-10027">
		<div id="div-comment-10027">
		<div class="cmtinfo"><em> on <a href="#comment-10027" title="">2013-05-13 at 7:20 am</a></em> <img alt='' src='https://1.gravatar.com/avatar/147786d6462ce08ef6cf11d9faa06841?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://www.re-lion.com' rel='external nofollow' class='url'>Daan Nusman</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_10027"></div><p>std::optional as return type might be useful here (this is a C++14 GotW after all).</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-10024">
		<div id="div-comment-10024">
		<div class="cmtinfo"><em> on <a href="#comment-10024" title="">2013-05-13 at 6:53 am</a></em> <img alt='' src='https://0.gravatar.com/avatar/f8110b0da33ac68a61c474cf2f73a904?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>Chris</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_10024"></div><p>@zahirtezcan, That&#8217;s exactly what I was thinking. I&#8217;d probably change the ending to use the ternary conditional operator, though.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 highlander-comment" id="comment-10023">
		<div id="div-comment-10023">
		<div class="cmtinfo"><em> on <a href="#comment-10023" title="">2013-05-13 at 6:52 am</a></em> <img alt='' src='https://2.gravatar.com/avatar/e6ca6db2bed3478aaef583b9cecf7f19?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>Albert</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_10023"></div><p>By the way, concerning the other advice &#8220;Guideline: Prefer preincrement. Only use postincrement if you’re going to use the original value. &#8220;, I always use preincrement. If I need post increment, I explicity do the copy and then call the preincrement : </p>
<pre class="brush: plain; title: ; notranslate" title="">
++v;
//or if post increment needed :
v1 = v;
++v;
</pre>
<p>I  think the intention is clear doing so and avoids a reviewer to wonder if a post increment has been wanted by the coder or is an inattention.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-10022">
		<div id="div-comment-10022">
		<div class="cmtinfo"><em> on <a href="#comment-10022" title="">2013-05-13 at 6:48 am</a></em> <img alt='' src='https://2.gravatar.com/avatar/e6ca6db2bed3478aaef583b9cecf7f19?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>Albert</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_10022"></div><p>Hello,<br />
Thank you for this new *modern* gotw source of thought and learning as usual.</p>
<p>It happend that this morning I also read the article from Andrew Koenig about *subtleties of Aliasing* (<a href="http://www.drdobbs.com/cpp/some-subtleties-of-aliasing/240154618" rel="nofollow">http://www.drdobbs.com/cpp/some-subtleties-of-aliasing/240154618</a>) which has a slightly different conclusion about the rule : &#8220;Guideline: Prefer passing read-only parameters by const&amp; instead of by value. &#8221;</p>
<p>For a long, I had the same conclusion as Mr Sutter about prefering const reference than value. But, since a time I changed my mind.<br />
I observed that my interfaces have more and more &#8216;light&#8217; objects as parameters (*). For instance, a function like find_addr would probably take an iterator pair (possibly wrapped in a range) rather than an explicit container.<br />
Even for the string parameter, I am higly tempted to pass a value. To my mind, it makes the function more loosely of what happen to the string outside the function which, I think, enforces the reliability of the find_addr function. const reference does only write in the contract that the supplyer does not change the value of the string but tells nothing about the customer. Yesterday, all multithread seemed so far away, now it looks as though they&#8217;re here to stay ;)<br />
(*) well, my remarks, of course, concern arguments that have a &#8216;value&#8217; semantic that it to say those that are mainly substituable by any instance with the same value. Classes providing a &#8216;reference&#8217; semantic (that is distinct only by their adress not by their internal state) are of course systematically passed by reference (and even more so that the semantics of reference is generally incompatible with the copy/move ones). In fact, potentially big (i.e. &#8216;costly&#8217;) value-typed object I manipulate tend to have helpers (like iterator) that are more light and are often better candidates for function since they isolate a facet of the object.</p>
<p>Regards,</p>
<p>Alb</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 highlander-comment" id="comment-10021">
		<div id="div-comment-10021">
		<div class="cmtinfo"><em> on <a href="#comment-10021" title="">2013-05-13 at 6:34 am</a></em> <img alt='' src='https://1.gravatar.com/avatar/a9a2f9fdfe53a9d1bd96c38d64faf69e?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>Thomas Gahr</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_10021"></div><p>Huh. You just sent me off reading through lilbstdc++&#8217;s string sources and indeed they don&#8217;t use sso (or I just didn&#8217;t understand the source code correctly), though some posts I found on the interwebs suggest they at least did so a few years ago [1].<br />
If anyone could point me to some post with a discussion about when/why they changed, I&#8217;d be very interested. I found [2] (pre-sso) where it is raised that a decent allocator can bring enough advantage to not require sso &#8211; though they&#8217;re using the default allocator in std::string &#8211; so no speedy small strings for g++ folks :(</p>
<p>However &#8211; and this is relevant for the problem posed here: they&#8217;re using the null object pattern for the empty string so return std::string() is not expensive.</p>
<p>[1] <a href="https://bugzilla.redhat.com/show_bug.cgi?id=197718#c30" rel="nofollow">https://bugzilla.redhat.com/show_bug.cgi?id=197718#c30</a><br />
[2] <a href="http://gcc.gnu.org/ml/libstdc++/2005-11/msg00013.html" rel="nofollow">http://gcc.gnu.org/ml/libstdc++/2005-11/msg00013.html</a></p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-10019">
		<div id="div-comment-10019">
		<div class="cmtinfo"><em> on <a href="#comment-10019" title="">2013-05-13 at 6:17 am</a></em> <img alt='' src='https://1.gravatar.com/avatar/db892012bc52cc6cbfd27db9d98acf8b?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>GregM</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_10019"></div><p>In summary, there’s no difference in practice among returning “”, “”s, or { }; use whichever you prefer for stylistic reasons. If your string implementation is either smart or uses SSO, which covers all implementations I know of, there’s exactly zero allocation difference.</p>
<p>What about performance difference?  Don&#8217;t the first two forms require a strlen call, or are there string implementations that check the first character for NUL and thus skip the strlen?</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 highlander-comment" id="comment-10017">
		<div id="div-comment-10017">
		<div class="cmtinfo"><em> on <a href="#comment-10017" title="">2013-05-13 at 5:24 am</a></em> <img alt='' src='https://0.gravatar.com/avatar/3c2c7635f32d1d3717e49bda34c6e576?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://blog.grem.de' rel='external nofollow' class='url'>Michael Gmelin</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_10017"></div><p>@minhingent: <a href="http://martinfowler.com/refactoring/catalog/replaceNestedConditionalWithGuardClauses.html" rel="nofollow">http://martinfowler.com/refactoring/catalog/replaceNestedConditionalWithGuardClauses.html</a></p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-10016">
		<div id="div-comment-10016">
		<div class="cmtinfo"><em> on <a href="#comment-10016" title="">2013-05-13 at 5:22 am</a></em> <img alt='' src='https://i0.wp.com/a0.twimg.com/profile_images/523734979/avatar_normal.jpg?resize=48%2C48' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://twitter.com/zahirtezcan' rel='external nofollow' class='url'>zahirtezcan (@zahirtezcan)</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_10016"></div><p>what about using polymorphic lambdas for find_if algorithm?</p>
<pre class="brush: plain; title: ; notranslate" title="">
auto endEmp = end(emps);
auto found = std::find_if(begin(emps), endEmp, [&amp;](auto&amp; emp) { return emp.name() == name; }); 
if(found != endEmp)
    return found-&gt;addr;
else
{
    /*return empty*/
}</pre>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 highlander-comment" id="comment-10015">
		<div id="div-comment-10015">
		<div class="cmtinfo"><em> on <a href="#comment-10015" title="">2013-05-13 at 5:20 am</a></em> <img alt='' src='https://0.gravatar.com/avatar/3c2c7635f32d1d3717e49bda34c6e576?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://blog.grem.de' rel='external nofollow' class='url'>Michael Gmelin</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_10015"></div><p>I would probably write</p>
<pre class="brush: plain; title: ; notranslate" title="">
for( const auto&amp; e : emps  )
</pre>
<p>too, since this is the &#8220;safe default&#8221; way of writing range based for loops.</p>
<p>But like you said, in such a short function I wouldn&#8217;t bring it up either (the signature and the code are right next to each other). In a longer function I would probably ask to change it to const to reduce the probably of maintenance disaster though.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-10014">
		<div id="div-comment-10014">
		<div class="cmtinfo"><em> on <a href="#comment-10014" title="">2013-05-13 at 5:19 am</a></em> <img alt='' src='https://2.gravatar.com/avatar/e63915f349eaa929b9e9b3d8fcfa9293?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>minhingent</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_10014"></div><p>Regarding single-entry/single-exit, what about using a break statement when the employee is found?</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-kjellkod even thread-even depth-1 highlander-comment" id="comment-10013">
		<div id="div-comment-10013">
		<div class="cmtinfo"><em> on <a href="#comment-10013" title="">2013-05-13 at 5:14 am</a></em> <img alt='' src='https://0.gravatar.com/avatar/0ba3dff2713f82030e7f0fcbd719325a?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://kjellkod.wordpress.com' rel='external nofollow' class='url'>kjellkod</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_10013"></div><p>@Michael. Good comment. It makes the for-loop much easier to read. </p>
<p>*nitpick warning*</p>
<pre class="brush: plain; title: ; notranslate" title=""> for( const auto&amp; e : emps  )</pre>
<p>Using explicit &#8220;const&#8221; in the loop is as you pointed is out not necessary but highlights even more that it is const without really affecting the readability. I would prefer that personally but would not bring it up as an issue at a code review.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-10011">
		<div id="div-comment-10011">
		<div class="cmtinfo"><em> on <a href="#comment-10011" title="">2013-05-13 at 5:07 am</a></em> <img alt='' src='https://0.gravatar.com/avatar/3c2c7635f32d1d3717e49bda34c6e576?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://blog.grem.de' rel='external nofollow' class='url'>Michael Gmelin</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_10011"></div><p>That&#8217;s like saying, that wearing a safety belt is premature pessimization. ;)</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 highlander-comment" id="comment-10010">
		<div id="div-comment-10010">
		<div class="cmtinfo"><em> on <a href="#comment-10010" title="">2013-05-13 at 4:57 am</a></em> <img alt='' src='https://2.gravatar.com/avatar/26230e55188637785a569c6ec8ca0f3f?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>Olaf van der Spek</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_10010"></div><p>Returning by value is premature pessimization. It also disallows a mutable reference or pointer to be returned. Ideally this function would be named find_employee and return a const employee*. That also avoids the problem of differentiating between employee not found and employee without address.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-10009">
		<div id="div-comment-10009">
		<div class="cmtinfo"><em> on <a href="#comment-10009" title="">2013-05-13 at 4:41 am</a></em> <img alt='' src='https://0.gravatar.com/avatar/3c2c7635f32d1d3717e49bda34c6e576?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://blog.grem.de' rel='external nofollow' class='url'>Michael Gmelin</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_10009"></div><p>-loop</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 highlander-comment" id="comment-10008">
		<div id="div-comment-10008">
		<div class="cmtinfo"><em> on <a href="#comment-10008" title="">2013-05-13 at 4:40 am</a></em> <img alt='' src='https://0.gravatar.com/avatar/3c2c7635f32d1d3717e49bda34c6e576?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://blog.grem.de' rel='external nofollow' class='url'>Michael Gmelin</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_10008"></div><p>Using C++11/14 I recommend my team to use a range based for loop whenever possible. </p>
<pre class="brush: plain; title: ; notranslate" title="">
string find_addr( const list&lt;employee&gt;&amp; emps, const string&amp; name ) {
    for( auto&amp; e : emps  ) {
        if( e.name() == name ) {
            return e.addr;
        }
    }
    return &quot;&quot;;
}
</pre>
<p>That way the implementer doesn&#8217;t have to think hard about optimizing away the end, pre- or post-increment etc. It should be safe to assume that the compiler knows how to optimize a range based for loop (note that const is not necessary, since the input is const already).</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
	</ol>

	<div class="navigation">
		<div class="alignleft"></div>
		<div class="alignright"></div>
	</div>
	<br />

  	<p class="nocomments">Comments are closed.</p>
  <div class="post-content">
<p>
</p>
</div>

			</div>

		
		<p align="center"></p>

	</div><!-- end id:content-main -->
<div id="sidebar">
<ul>
<li class="sidebox"><h2><label for="subscribe-field">Follow by email</label></h2>
				<form action="https://subscribe.wordpress.com" method="post" accept-charset="utf-8" id="subscribe-blog">
																	<p><input type="text" name="email" style="width: 95%; padding: 1px 2px" placeholder="Enter your email address" value="" id="subscribe-field"/></p>
					
					<p>
						<input type="hidden" name="action" value="subscribe"/>
						<input type="hidden" name="blog_id" value="3379246"/>
						<input type="hidden" name="source" value="https://herbsutter.com/2013/05/13/gotw-2-solution-temporary-objects/"/>
						<input type="hidden" name="sub-type" value="widget"/>
						<input type="hidden" name="redirect_fragment" value="blog_subscription-3" />
						<input type="hidden" id="_wpnonce" name="_wpnonce" value="4590924cc6" />						<input type="submit" value="Subscribe" />
					</p>
				</form>
			
</li><li class="sidebox"><h2><a href='http://twitter.com/herbsutter'>Tweets</a></h2><ul class='tweets'></ul><a href="http://twitter.com/herbsutter"  class='twitter-follow-button' data-show-count='false' data-link-color='#265e15' data-text-color='#333333'>Follow @herbsutter</a></li><li class="sidebox"><h2>Popular</h2><ul>				<li>
										<a href="https://herbsutter.com/2018/11/13/trip-report-fall-iso-c-standards-meeting-san-diego/" class="bump-view" data-bump-view="tp">
						Trip report: Fall ISO C++ standards meeting (San Diego)					</a>
										</li>
								<li>
										<a href="https://herbsutter.com/gotw/" class="bump-view" data-bump-view="tp">
						GotW					</a>
										</li>
								<li>
										<a href="https://herbsutter.com/2018/09/20/lifetime-profile-v1-0-posted/" class="bump-view" data-bump-view="tp">
						Lifetime profile v1.0 posted					</a>
										</li>
				</ul></li><li class="sidebox"><h2>Categories</h2>		<ul>
				<li class="cat-item cat-item-291"><a href="https://herbsutter.com/category/apple/" >Apple</a>
</li>
	<li class="cat-item cat-item-49277"><a href="https://herbsutter.com/category/c-net/" >C# / .NET</a>
</li>
	<li class="cat-item cat-item-2426"><a href="https://herbsutter.com/category/c/" >C++</a>
</li>
	<li class="cat-item cat-item-69816"><a href="https://herbsutter.com/category/cloud/" >Cloud</a>
</li>
	<li class="cat-item cat-item-214618"><a href="https://herbsutter.com/category/concurrency/" >Concurrency</a>
</li>
	<li class="cat-item cat-item-8259773"><a href="https://herbsutter.com/category/effective-concurrency/" >Effective Concurrency</a>
</li>
	<li class="cat-item cat-item-3696745"><a href="https://herbsutter.com/category/friday-thoughts/" >Friday Thoughts</a>
</li>
	<li class="cat-item cat-item-3867746"><a href="https://herbsutter.com/category/c/gotw/" >GotW</a>
</li>
	<li class="cat-item cat-item-79"><a href="https://herbsutter.com/category/hardware/" >Hardware</a>
</li>
	<li class="cat-item cat-item-1017"><a href="https://herbsutter.com/category/java/" >Java</a>
</li>
	<li class="cat-item cat-item-637"><a href="https://herbsutter.com/category/microsoft/" >Microsoft</a>
</li>
	<li class="cat-item cat-item-420845"><a href="https://herbsutter.com/category/opinion-editorial/" >Opinion &amp; Editorial</a>
</li>
	<li class="cat-item cat-item-1633077"><a href="https://herbsutter.com/category/reader-qa/" >Reader Q&amp;A</a>
</li>
	<li class="cat-item cat-item-2301"><a href="https://herbsutter.com/category/software-development/" >Software Development</a>
</li>
	<li class="cat-item cat-item-393523"><a href="https://herbsutter.com/category/talks-events/" >Talks &amp; Events</a>
</li>
	<li class="cat-item cat-item-1"><a href="https://herbsutter.com/category/uncategorized/" >Uncategorized</a>
</li>
	<li class="cat-item cat-item-151"><a href="https://herbsutter.com/category/web/" >Web</a>
</li>
		</ul>
			</li></ul>
</div><!-- end id:sidebar -->
</div><!-- end id:content -->
</div><!-- end id:container -->
<div id="footer">
	<div id="colophon">
		<p><a href="https://wordpress.com/?ref=footer_blog">Blog at WordPress.com.</a></p>
		<p>WPThemes.</p>
		<br class="clear" />
	</div><!-- end #colophon-->
</div><!-- end #footer-->
<!--  -->
<script type='text/javascript' src='//0.gravatar.com/js/gprofiles.js?ver=201847y'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var WPGroHo = {"my_hash":""};
/* ]]> */
</script>
<script type='text/javascript' src='https://s1.wp.com/wp-content/mu-plugins/gravatar-hovercards/wpgroho.js?m=1380573781h'></script>

	<script>
		//initialize and attach hovercards to all gravatars
		jQuery( document ).ready( function( $ ) {

			if (typeof Gravatar === "undefined"){
				return;
			}

			if ( typeof Gravatar.init !== "function" ) {
				return;
			}			

			Gravatar.profile_cb = function( hash, id ) {
				WPGroHo.syncProfileData( hash, id );
			};
			Gravatar.my_hash = WPGroHo.my_hash;
			Gravatar.init( 'body', '#wp-admin-bar-my-account' );
		});
	</script>

		<div style="display:none">
	<div class="grofile-hash-map-6c402d991578f081b5f57457b864f3b6">
	</div>
	<div class="grofile-hash-map-7b4bb19457e88527e39d526111a764f4">
	</div>
	<div class="grofile-hash-map-c0ba56bfd231f8f04feb057728975181">
	</div>
	<div class="grofile-hash-map-a9a2f9fdfe53a9d1bd96c38d64faf69e">
	</div>
	<div class="grofile-hash-map-e487eb194f38fa558ee955b5603d798d">
	</div>
	<div class="grofile-hash-map-1dddc4b6c57e369dab7ad1d2e262dab7">
	</div>
	<div class="grofile-hash-map-322cf2e150d5cd84275b131184731c0a">
	</div>
	<div class="grofile-hash-map-3be7c20c4a0dc941dfc40f99784d8f1d">
	</div>
	<div class="grofile-hash-map-a25c143a231cb6800d00eab57ada38ac">
	</div>
	<div class="grofile-hash-map-db892012bc52cc6cbfd27db9d98acf8b">
	</div>
	<div class="grofile-hash-map-6bcbddbd9c7b31aaff8cf25a356bc96c">
	</div>
	<div class="grofile-hash-map-d360ec751eb90bc963c5b03544d88cf5">
	</div>
	<div class="grofile-hash-map-26230e55188637785a569c6ec8ca0f3f">
	</div>
	<div class="grofile-hash-map-256c9d534302a138d5d1fe3ed833e217">
	</div>
	<div class="grofile-hash-map-64abcdfeac5d480fd1f58a7901ad26ee">
	</div>
	<div class="grofile-hash-map-ca391c038b300a739462dae91c5e8cbc">
	</div>
	<div class="grofile-hash-map-3c2c7635f32d1d3717e49bda34c6e576">
	</div>
	<div class="grofile-hash-map-e487d60098ccab80bf014ad524740612">
	</div>
	<div class="grofile-hash-map-51d9c0f234a7029ac58358a6dc2053f5">
	</div>
	<div class="grofile-hash-map-2385676760fc16f76a43f3319faaa843">
	</div>
	<div class="grofile-hash-map-147786d6462ce08ef6cf11d9faa06841">
	</div>
	<div class="grofile-hash-map-f8110b0da33ac68a61c474cf2f73a904">
	</div>
	<div class="grofile-hash-map-e6ca6db2bed3478aaef583b9cecf7f19">
	</div>
	<div class="grofile-hash-map-e5198f8a4049584b8c2c41e2d0086770">
	</div>
	<div class="grofile-hash-map-e63915f349eaa929b9e9b3d8fcfa9293">
	</div>
	<div class="grofile-hash-map-0ba3dff2713f82030e7f0fcbd719325a">
	</div>
	<div class="grofile-hash-map-26230e55188637785a569c6ec8ca0f3f">
	</div>
	</div>
<script type='text/javascript' charset='UTF-8' id='polldaddyRatings'><!--//--><![CDATA[//><!--
PDRTJS_settings_468178_comm_13078={"id":468178,"unique_id":"wp-comment-13078","title":"Hi%20Sutter%2CI%20failed%20to%20find%20a%20more%20appropriate%20article%20to%20post%20this%20question%2C%20so%20here%20it%20goes.Why%20doesn%26%23039%3Bt%20std%3A%3Amin%2Fmax%20take%20URefs%3F%20I%20imagine%20something%20along%20the%20lines%20of%20the%20following%20would%20be%20rea...","permalink":"https:\/\/herbsutter.com\/2013\/05\/13\/gotw-2-solution-temporary-objects\/#comment-13078","item_id":"_comm_13078"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_13078 == 'undefined' ){PDRTJS_468178_comm_13078 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_13078 );}}PDRTJS_settings_468178_comm_12048={"id":468178,"unique_id":"wp-comment-12048","title":"%26%23091%3B%26%238230%3B%26%23093%3B%20Single%20Entry%20%2F%20Single%20Exit%20%28SE%2FSE%29%20%26%238220%3Brule%26%238221%3B%20of%20programming.%20I%20wish%20I%20had%20this%20eloquent%20Herb%20Sutter%20treatise%20on%20hand%20when%20it%20%26%23091%3B%26%238230%3B%26%23093%3B...","permalink":"https:\/\/herbsutter.com\/2013\/05\/13\/gotw-2-solution-temporary-objects\/#comment-12048","item_id":"_comm_12048"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_12048 == 'undefined' ){PDRTJS_468178_comm_12048 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_12048 );}}PDRTJS_settings_468178_comm_10388={"id":468178,"unique_id":"wp-comment-10388","title":"%40Herb%20Sutter%3A%20Thanks%20for%20your%20answer.%20%20I%20had%20not%20considered%20locality.%20%20Saying%20%26quot%3Ba%20wash%26quot%3B%20makes%20It%20is%20easier%20to%20understand%20why%20libstdc%2B%2B%20may%20not%20have%20rushed%20into%20using%20it%20-%20of%20course%20the%20status%20with...","permalink":"https:\/\/herbsutter.com\/2013\/05\/13\/gotw-2-solution-temporary-objects\/#comment-10388","item_id":"_comm_10388"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_10388 == 'undefined' ){PDRTJS_468178_comm_10388 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_10388 );}}PDRTJS_settings_468178_comm_10382={"id":468178,"unique_id":"wp-comment-10382","title":"%40GeoffW%3A%20I%20don%26%23039%3Bt%20know%20of%20SSO%20specific%20studies%20offhand%2C%20but%20it%26%23039%3Bs%20well%20known%20from%20studies%20that%20small%20strings%20dominate%20most%20applications%2C%20and%20that%20SSO%20optimizes%20two%20specific%20things%20that%20are%20well-kno...","permalink":"https:\/\/herbsutter.com\/2013\/05\/13\/gotw-2-solution-temporary-objects\/#comment-10382","item_id":"_comm_10382"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_10382 == 'undefined' ){PDRTJS_468178_comm_10382 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_10382 );}}PDRTJS_settings_468178_comm_10378={"id":468178,"unique_id":"wp-comment-10378","title":"The%20more%20I%20look%20at%20SSO%20the%20more%20I%20wonder%20just%20how%20effective%20it%20is%20-%20but%20I%26%23039%3Bm%20having%20trouble%20finding%20any%20discussion%20of%20actual%20testing.%20%20It%20sounds%20great%20-%20no%20allocation%20overheads%20for%20some%20percentage...","permalink":"https:\/\/herbsutter.com\/2013\/05\/13\/gotw-2-solution-temporary-objects\/#comment-10378","item_id":"_comm_10378"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_10378 == 'undefined' ){PDRTJS_468178_comm_10378 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_10378 );}}PDRTJS_settings_468178_comm_10377={"id":468178,"unique_id":"wp-comment-10377","title":"%40Thomas%20Gahr%3A%20The%20single%20pointer%20implementation%20points%20to%20a%20structure%20that%20embeds%20the%20counter%2C%20size%20etc.%20in%20the%20allocated%20buffer%20-%20essentially%20just%20your%20typical%20pimpl%20pattern.%20%20There%20are%20many%20exa...","permalink":"https:\/\/herbsutter.com\/2013\/05\/13\/gotw-2-solution-temporary-objects\/#comment-10377","item_id":"_comm_10377"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_10377 == 'undefined' ){PDRTJS_468178_comm_10377 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_10377 );}}PDRTJS_settings_468178_comm_10363={"id":468178,"unique_id":"wp-comment-10363","title":"%40GeoffW%3A%20FWIW%3A%20as%20far%20as%20I%20can%20see%20counter-COW%20argument%20boils%20down%20to%20exception%20safety%20since%20now%20any%20non-const%20access%20to%20the%20string%20%28like%20operator%26%23091%3B%26%23093%3B%29%20can%20throw%20std%3A%3Abad_alloc%20as%20it%20mandates%20a%20dee...","permalink":"https:\/\/herbsutter.com\/2013\/05\/13\/gotw-2-solution-temporary-objects\/#comment-10363","item_id":"_comm_10363"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_10363 == 'undefined' ){PDRTJS_468178_comm_10363 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_10363 );}}PDRTJS_settings_468178_comm_10360={"id":468178,"unique_id":"wp-comment-10360","title":"%40GeoffW%3A%20I%20don%26%23039%3Bt%20think%20sizeof%28void%2A%29%20std%3A%3Astring%20is%20doable%20no%20matter%20if%20you%20use%20SSO%20or%20COW%20-%20if%20we%20take%20COW%2C%20you%26%23039%3Bll%20need%20one%20pointer%20for%20the%20data%20and%20one%20pointer%20for%20the%20reference%20count%20%28or%20linke...","permalink":"https:\/\/herbsutter.com\/2013\/05\/13\/gotw-2-solution-temporary-objects\/#comment-10360","item_id":"_comm_10360"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_10360 == 'undefined' ){PDRTJS_468178_comm_10360 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_10360 );}}PDRTJS_settings_468178_comm_10303={"id":468178,"unique_id":"wp-comment-10303","title":"A%20question%20about%20the%20short%20string%20optimisation%20comments%20made%20in%20this%20article.%20%20You%20say%20that%20%26quot%3BSSO%20is%20a%20wonderful%20optimization%26quot%3B%2C%20but%20offer%20no%20references%20in%20support%20of%20this.%20%20Are%20there%20articles%20arou...","permalink":"https:\/\/herbsutter.com\/2013\/05\/13\/gotw-2-solution-temporary-objects\/#comment-10303","item_id":"_comm_10303"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_10303 == 'undefined' ){PDRTJS_468178_comm_10303 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_10303 );}}PDRTJS_settings_468178_comm_10268={"id":468178,"unique_id":"wp-comment-10268","title":"I%20think%20%40Adrian%20makes%20some%20good%20points%20about%20single-exit.%20%20It%20was%20never%20about%20optimisation%2C%20or%20structured%20programming%20rules%20%28or%20not%20for%20me%29%2C%20it%20was%20about%20code%20clarity.%20%20In%20short%2C%20simple%20functions...","permalink":"https:\/\/herbsutter.com\/2013\/05\/13\/gotw-2-solution-temporary-objects\/#comment-10268","item_id":"_comm_10268"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_10268 == 'undefined' ){PDRTJS_468178_comm_10268 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_10268 );}}PDRTJS_settings_468178_comm_10225={"id":468178,"unique_id":"wp-comment-10225","title":"%40Ahmed%3A%20I%20used%20to%20agree%20with%20you%20--%20the%20original%20GotW%20and%20Exceptional%20C%2B%2B%20said%20%26quot%3Bhoist%20end%28%29%26quot%3B.%20I%20switched%20to%20the%20current%20recommendation%20at%20Bjarne%26%23039%3Bs%20urging%20because%20compilers%20have%20for%20a%20long%20time%20ro...","permalink":"https:\/\/herbsutter.com\/2013\/05\/13\/gotw-2-solution-temporary-objects\/#comment-10225","item_id":"_comm_10225"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_10225 == 'undefined' ){PDRTJS_468178_comm_10225 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_10225 );}}PDRTJS_settings_468178_comm_10222={"id":468178,"unique_id":"wp-comment-10222","title":"I%20disagree%20with%20both%20points%20given%20which%20suggest%20that%20the%20end%20iterator%20being%20recomputed%20each%20loop%20should%20be%20preferred.1%29%20After%20seeing%20Chandler%26%23039%3Bs%20talk%20on%20Optimizations%20at%20C%2B%2BNow%2C%20I%26%23039%3Bm%20significantly%20...","permalink":"https:\/\/herbsutter.com\/2013\/05\/13\/gotw-2-solution-temporary-objects\/#comment-10222","item_id":"_comm_10222"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_10222 == 'undefined' ){PDRTJS_468178_comm_10222 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_10222 );}}PDRTJS_settings_468178_comm_10193={"id":468178,"unique_id":"wp-comment-10193","title":"%40Robert%3A%20That%26%23039%3Bs%20not%20the%20same%20example%20as%20in%20the%20article.%20%3A%29%20I%20agree%20your%20two%20lines%20are%20equivalent%2C%20and%20in%20both%20cases%20the%20calling%20code%20can%20easily%20see%20the%20bug%20locally%20in%20code%20review%20just%20by%20knowing%20...","permalink":"https:\/\/herbsutter.com\/2013\/05\/13\/gotw-2-solution-temporary-objects\/#comment-10193","item_id":"_comm_10193"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_10193 == 'undefined' ){PDRTJS_468178_comm_10193 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_10193 );}}PDRTJS_settings_468178_comm_10183={"id":468178,"unique_id":"wp-comment-10183","title":"Hello.%20%26quot%3Bwith%20aggressive%20optimizations%26quot%3B.%20How%20are%20these%20%26quot%3Baggressive%20optimizations%26quot%3B%3F%20Could%20someone%20show%20an%20example%3F%20Thank%20you....","permalink":"https:\/\/herbsutter.com\/2013\/05\/13\/gotw-2-solution-temporary-objects\/#comment-10183","item_id":"_comm_10183"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_10183 == 'undefined' ){PDRTJS_468178_comm_10183 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_10183 );}}PDRTJS_settings_468178_comm_10175={"id":468178,"unique_id":"wp-comment-10175","title":"%40GregM%3A%20%26%23091%3Bcode%26%23093%3Bstd%3A%3Aget%26lt%3B0%26gt%3B%28%29%26%23091%3B%2Fcode%26%23093%3B%20%28blog%20ate%20my%20pointy%20braces%29%20isn%26%23039%3Bt%20a%20member%20function%20of%20std%3A%3Atuple%2C%20still%20isn%26%23039%3Bt%20returning%20by%20value..%40Herb%3A%20Wait%20a%20minute.%20Are%20you%20saying%20that%20%26%23091%3Bcode%26%23093%3Bauto%26amp%3Bam...","permalink":"https:\/\/herbsutter.com\/2013\/05\/13\/gotw-2-solution-temporary-objects\/#comment-10175","item_id":"_comm_10175"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_10175 == 'undefined' ){PDRTJS_468178_comm_10175 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_10175 );}}PDRTJS_settings_468178_comm_10161={"id":468178,"unique_id":"wp-comment-10161","title":"%40Herb%20But%20in%20practice%2C%20I%26%23039%3Bve%20never%20seen%20it%20cause%20much%20of%20a%20problem.%20Any%20time%20a%20function%20is%20returning%20a%20%26amp%3B%2C%20whether%20it%26%23039%3Bs%20a%20getter%20or%20a%20function%20like%20yours%2C%20the%20caller%20always%20knows%20one%20thing%3A%20the...","permalink":"https:\/\/herbsutter.com\/2013\/05\/13\/gotw-2-solution-temporary-objects\/#comment-10161","item_id":"_comm_10161"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_10161 == 'undefined' ){PDRTJS_468178_comm_10161 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_10161 );}}PDRTJS_settings_468178_comm_10116={"id":468178,"unique_id":"wp-comment-10116","title":"%40kkoehne%3A%20Which%20ironically%20was%20the%20one%20Ville%20quoted.%20%3A%29%20Thanks....","permalink":"https:\/\/herbsutter.com\/2013\/05\/13\/gotw-2-solution-temporary-objects\/#comment-10116","item_id":"_comm_10116"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_10116 == 'undefined' ){PDRTJS_468178_comm_10116 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_10116 );}}PDRTJS_settings_468178_comm_10110={"id":468178,"unique_id":"wp-comment-10110","title":"%40Herb%3A%20You%20only%20fixed%20it%20in%20one%20place.%20Two%20paragraphs%20below%20there%20still%20is%20%26quot%3BSo%20there%20is%20no%20difference%20between%20auto%20i%7Bbegin%28emps%29%7D%26quot%3B...","permalink":"https:\/\/herbsutter.com\/2013\/05\/13\/gotw-2-solution-temporary-objects\/#comment-10110","item_id":"_comm_10110"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_10110 == 'undefined' ){PDRTJS_468178_comm_10110 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_10110 );}}PDRTJS_settings_468178_comm_10105={"id":468178,"unique_id":"wp-comment-10105","title":"%40Ville%3A%20Good%20catch%2C%20I%20meant%20%28%29.%20Fixed%2C%20thanks.%40Rick%3A%20%26amp%3B%20parameters%20are%20much%20safer%20because%20they%20do%20fall%20into%20the%20structured%20lifetime%20bucket%20--%20as%20long%20as%20the%20caller%20holds%20a%20valid%20reference%20at%20t...","permalink":"https:\/\/herbsutter.com\/2013\/05\/13\/gotw-2-solution-temporary-objects\/#comment-10105","item_id":"_comm_10105"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_10105 == 'undefined' ){PDRTJS_468178_comm_10105 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_10105 );}}PDRTJS_settings_468178_comm_10104={"id":468178,"unique_id":"wp-comment-10104","title":"%40Adrian%2C%20%40Michael%3A%20OK%2C%20I%26%23039%3Bve%20added%20that%20%26quot%3Bhelping%20optimization%26quot%3B%20was%20another%20motivation%20for%20single%20exit%20and%20added%20a%20bit%20more%20discussion%20about%20RVO%20and%20how%20the%20measurement%20I%20presented%20demonstrated%20tha...","permalink":"https:\/\/herbsutter.com\/2013\/05\/13\/gotw-2-solution-temporary-objects\/#comment-10104","item_id":"_comm_10104"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_10104 == 'undefined' ){PDRTJS_468178_comm_10104 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_10104 );}}PDRTJS_settings_468178_comm_10103={"id":468178,"unique_id":"wp-comment-10103","title":"%40Rbert%20Dvid%3A%20No%2C%20returning%20a%20%26amp%3B%20can%20make%20sense.%20In%20the%20cases%20you%20mention%2C%20the%20lifetime%20issue%20is%20considerably%20simpler%20because%20you%26%23039%3Bre%20returning%20a%20reference%20guaranteed%20to%20be%20valid%20for%20the%20lifetim...","permalink":"https:\/\/herbsutter.com\/2013\/05\/13\/gotw-2-solution-temporary-objects\/#comment-10103","item_id":"_comm_10103"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_10103 == 'undefined' ){PDRTJS_468178_comm_10103 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_10103 );}}PDRTJS_settings_468178_comm_10098={"id":468178,"unique_id":"wp-comment-10098","title":"Robert%2C%26quot%3BBy%20that%20logic%2C%20no%20getter%20function%20should%20return%20a%20const%20reference%2C%20including%20vector%3A%3Aoperator%26%23091%3B%26%23093%3B%2C%20map%3A%3Aat%28%29%2C%20std%3A%3Aget%28%29%2C%20etc.%21%20The%20fact%20that%20find_addr%20is%20free-standing%20doesnt%20make%20a%20differ...","permalink":"https:\/\/herbsutter.com\/2013\/05\/13\/gotw-2-solution-temporary-objects\/#comment-10098","item_id":"_comm_10098"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_10098 == 'undefined' ){PDRTJS_468178_comm_10098 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_10098 );}}PDRTJS_settings_468178_comm_10097={"id":468178,"unique_id":"wp-comment-10097","title":"%26quot%3BYes%2C%20checking%20%21%2Ap%20is%20the%20check%20for%20empty%20string%20I%20was%20talking%20about.%26quot%3BThanks.%20%20I%20wasn%26%23039%3Bt%20sure%20whether%20it%20was%20%26quot%3Bchecking%20for%20%21%2Ap%26quot%3B%20or%20%26quot%3Bchecking%20for%200%20%3D%3D%20strlen%28p%29%26quot%3B....","permalink":"https:\/\/herbsutter.com\/2013\/05\/13\/gotw-2-solution-temporary-objects\/#comment-10097","item_id":"_comm_10097"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_10097 == 'undefined' ){PDRTJS_468178_comm_10097 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_10097 );}}PDRTJS_settings_468178_comm_10081={"id":468178,"unique_id":"wp-comment-10081","title":"I%26%23039%3Bm%20not%20sure%20it%26%23039%3Bs%20fair%20to%20demonize%20return%20by%20const%26amp%3B%20while%20preferring%20const%26amp%3B%20parameters.%20Both%20of%20these%20can%20lead%20to%20brittle%20code%3A%20in%20the%20former%20case%2C%20it%26%23039%3Bs%20because%20of%20hanging%20references%2C%20and...","permalink":"https:\/\/herbsutter.com\/2013\/05\/13\/gotw-2-solution-temporary-objects\/#comment-10081","item_id":"_comm_10081"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_10081 == 'undefined' ){PDRTJS_468178_comm_10081 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_10081 );}}PDRTJS_settings_468178_comm_10080={"id":468178,"unique_id":"wp-comment-10080","title":"%40Daan%3A%20Yes%2C%20but%20part%20of%20the%20question%20was%20not%20to%20mess%20with%20the%20basic%20shape%20of%20the%20function.%20%3A%29%20We%26%23039%3Bre%20focusing%20on%20temporary%2Fextra%20objects%20in%20this%20one....","permalink":"https:\/\/herbsutter.com\/2013\/05\/13\/gotw-2-solution-temporary-objects\/#comment-10080","item_id":"_comm_10080"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_10080 == 'undefined' ){PDRTJS_468178_comm_10080 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_10080 );}}PDRTJS_settings_468178_comm_10078={"id":468178,"unique_id":"wp-comment-10078","title":"%26quot%3BSo%20I%20actually%20dont%20recommend%20any%20change%20to%20hoist%20the%20end%20calculation%20here%2C%20because%20that%20would%20make%20the%20code%20slightly%20more%20complex%20%26%23091%3B...%26%23093%3B%26quot%3B%20Does%26%23091%3Bcode%26%23093%3Bfor%28auto%20i%20%3D%20begin%28emp%29%2C%20e%20%3D%20end%28emp%29%3B%20i%20%21%3D%20e%3B%20...","permalink":"https:\/\/herbsutter.com\/2013\/05\/13\/gotw-2-solution-temporary-objects\/#comment-10078","item_id":"_comm_10078"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_10078 == 'undefined' ){PDRTJS_468178_comm_10078 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_10078 );}}PDRTJS_settings_468178_comm_10077={"id":468178,"unique_id":"wp-comment-10077","title":"The%20blog%20ate%20the%20code.%20It%20will%20give%20you%20%26%23091%3Bcode%26%23093%3Binitializer_list%26lt%3Blist%26lt%3Bemployee%26gt%3B%3A%3Aiterator%26gt%3B%26%23091%3B%2Fcode%26%23093%3B...","permalink":"https:\/\/herbsutter.com\/2013\/05\/13\/gotw-2-solution-temporary-objects\/#comment-10077","item_id":"_comm_10077"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_10077 == 'undefined' ){PDRTJS_468178_comm_10077 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_10077 );}}PDRTJS_settings_468178_comm_10076={"id":468178,"unique_id":"wp-comment-10076","title":"Oops%2C%20meant%20to%20say%20the%20former%20will%20give%20you%20an%20initializer_list.%20That%20it%20will%20do.%20%3A%29...","permalink":"https:\/\/herbsutter.com\/2013\/05\/13\/gotw-2-solution-temporary-objects\/#comment-10076","item_id":"_comm_10076"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_10076 == 'undefined' ){PDRTJS_468178_comm_10076 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_10076 );}}PDRTJS_settings_468178_comm_10075={"id":468178,"unique_id":"wp-comment-10075","title":"Uh%20oh.%20%26quot%3BSo%20there%20is%20no%20difference%20between%20auto%20i%7Bbegin%28emps%29%7D%20and%20auto%20i%20%3D%20begin%28emps%29.%20%26quot%3BSure%20there%20is%20-%20the%20latter%20will%20give%20you%20an%20initializer_list%26lt%3Blist%3A%3Aiterator%26gt%3B%26gt%3B.%20Which%20is%20probably%20...","permalink":"https:\/\/herbsutter.com\/2013\/05\/13\/gotw-2-solution-temporary-objects\/#comment-10075","item_id":"_comm_10075"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_10075 == 'undefined' ){PDRTJS_468178_comm_10075 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_10075 );}}PDRTJS_settings_468178_comm_10058={"id":468178,"unique_id":"wp-comment-10058","title":"%40Michael%20A%20safety%20belt%20does%20not%20affect%20your%20car%26%23039%3Bs%20performance%2C%20returning%20by%20value%20does....","permalink":"https:\/\/herbsutter.com\/2013\/05\/13\/gotw-2-solution-temporary-objects\/#comment-10058","item_id":"_comm_10058"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_10058 == 'undefined' ){PDRTJS_468178_comm_10058 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_10058 );}}PDRTJS_settings_468178_comm_10056={"id":468178,"unique_id":"wp-comment-10056","title":"I%20still%20prefer%3A%26%23091%3Bcode%26%23093%3B%20for%28auto%20i%3Dbegin%28x%29%2C%20e%3Dend%28x%29%3B%20i%21%3De%3B%20%2B%2Bi%29%20%26%23091%3B%2Fcode%26%23093%3BIt%26%23039%3Bs%20not%20so%20much%20about%20the%20optimization%2C%20it%26%23039%3Bs%20that%20the%20semantics%20now%20exactly%20match%20range%20based%20for....","permalink":"https:\/\/herbsutter.com\/2013\/05\/13\/gotw-2-solution-temporary-objects\/#comment-10056","item_id":"_comm_10056"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_10056 == 'undefined' ){PDRTJS_468178_comm_10056 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_10056 );}}PDRTJS_settings_468178_comm_10051={"id":468178,"unique_id":"wp-comment-10051","title":"%26%23091%3B%26%238230%3B%26%23093%3B%20GotW%20%232%20Solution%3A%20Temporary%20Objects%20%28herbsutter.com%29%20%26%23091%3B%26%238230%3B%26%23093%3B...","permalink":"https:\/\/herbsutter.com\/2013\/05\/13\/gotw-2-solution-temporary-objects\/#comment-10051","item_id":"_comm_10051"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_10051 == 'undefined' ){PDRTJS_468178_comm_10051 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_10051 );}}PDRTJS_settings_468178_comm_10049={"id":468178,"unique_id":"wp-comment-10049","title":"I%26%23039%3Bve%20heard%20it%26%23039%3Bs%20harder%2Fimpossible%20for%20the%20compiler%20to%20do%20RVO%20with%20multiple%20exit%20functions%2C%20is%20this%20true%3F...","permalink":"https:\/\/herbsutter.com\/2013\/05\/13\/gotw-2-solution-temporary-objects\/#comment-10049","item_id":"_comm_10049"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_10049 == 'undefined' ){PDRTJS_468178_comm_10049 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_10049 );}}PDRTJS_settings_468178_comm_10048={"id":468178,"unique_id":"wp-comment-10048","title":"I%20disagree%20with%20the%20return%20type%20argument.%20By%20that%20logic%2C%20no%20getter%20function%20should%20return%20a%20const%20reference%2C%20including%20vector%3A%3Aoperator%26%23091%3B%26%23093%3B%2C%20map%3A%3Aat%28%29%2C%20std%3A%3Aget%28%29%2C%20etc.%21%20The%20fact%20that%20find_addr%20is%20...","permalink":"https:\/\/herbsutter.com\/2013\/05\/13\/gotw-2-solution-temporary-objects\/#comment-10048","item_id":"_comm_10048"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_10048 == 'undefined' ){PDRTJS_468178_comm_10048 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_10048 );}}PDRTJS_settings_468178_comm_10043={"id":468178,"unique_id":"wp-comment-10043","title":"%40litb1%3A%20Good%20point%2C%20clarified.%20I%20was%20sure%20that%20somewhere%20over%20the%20years%20I%20already%20fixed%20that%20to%20say%20%26quot%3Btemporary%20or%20extra%20objects%26quot%3B%20but%20perhaps%20it%20was%20in%20a%20different%20GotW.%20Thanks....","permalink":"https:\/\/herbsutter.com\/2013\/05\/13\/gotw-2-solution-temporary-objects\/#comment-10043","item_id":"_comm_10043"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_10043 == 'undefined' ){PDRTJS_468178_comm_10043 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_10043 );}}PDRTJS_settings_468178_comm_10042={"id":468178,"unique_id":"wp-comment-10042","title":"%40GregM%3A%20Yes%2C%20checking%20%21%2Ap%20is%20the%20%26quot%3Bcheck%20for%20empty%20string%26quot%3B%20I%20was%20talking%20about....","permalink":"https:\/\/herbsutter.com\/2013\/05\/13\/gotw-2-solution-temporary-objects\/#comment-10042","item_id":"_comm_10042"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_10042 == 'undefined' ){PDRTJS_468178_comm_10042 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_10042 );}}PDRTJS_settings_468178_comm_10041={"id":468178,"unique_id":"wp-comment-10041","title":"%40Thomas%3A%20Right%2C%20either%20check-for-empty%20or%20SSO%20is%20sufficient%20by%20itself%2C%20and%20all%20implementations%20I%20know%20of%20do%20at%20least%20one%20of%20those.%20It%26%23039%3Bs%20only%20if%20you%20don%26%23039%3Bt%20check%20for%20empty%20and%20you%20don%26%23039%3Bt%20do%20SSO%20that...","permalink":"https:\/\/herbsutter.com\/2013\/05\/13\/gotw-2-solution-temporary-objects\/#comment-10041","item_id":"_comm_10041"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_10041 == 'undefined' ){PDRTJS_468178_comm_10041 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_10041 );}}PDRTJS_settings_468178_comm_10039={"id":468178,"unique_id":"wp-comment-10039","title":"%40Herb%3A%20%20I%20shouldn%26%23039%3Bt%20have%20mentioned%20%26quot%3Bstructured%20programming%26quot%3B%20as%20that%20brings%20other%20debates%20into%20it.My%20point%20was%20to%20contest%20your%20claim%20that%20single%20exit%20style%20exists%20only%20because%20of%20symmetry%20argument...","permalink":"https:\/\/herbsutter.com\/2013\/05\/13\/gotw-2-solution-temporary-objects\/#comment-10039","item_id":"_comm_10039"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_10039 == 'undefined' ){PDRTJS_468178_comm_10039 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_10039 );}}PDRTJS_settings_468178_comm_10037={"id":468178,"unique_id":"wp-comment-10037","title":"%40Herb%3A%20Couldn%26%23039%3Bt%20agree%20more.%20Single-exit%20tends%20to%20lead%20to%20deep%20nesting%2C%20hard%20to%20read%20and%20easy%20to%20break%20code.%20In%20C%20it%26%23039%3Bs%20common%20to%20use%20goto%20for%20proper%20clean%20up%20and%20reduce%20nesting%20%28therefore%20doing%20wh...","permalink":"https:\/\/herbsutter.com\/2013\/05\/13\/gotw-2-solution-temporary-objects\/#comment-10037","item_id":"_comm_10037"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_10037 == 'undefined' ){PDRTJS_468178_comm_10037 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_10037 );}}PDRTJS_settings_468178_comm_10036={"id":468178,"unique_id":"wp-comment-10036","title":"%40Adrian%3A%20Early%20return%20is%20not%20a%20violation%20of%20structured%20programming.%20This%20is%20exactly%20at%20the%20heart%20of%20the%20misconception%20that%20single%20entry%20%28which%20is%20essential%20to%20structured%20programming%29%20has%20anything...","permalink":"https:\/\/herbsutter.com\/2013\/05\/13\/gotw-2-solution-temporary-objects\/#comment-10036","item_id":"_comm_10036"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_10036 == 'undefined' ){PDRTJS_468178_comm_10036 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_10036 );}}PDRTJS_settings_468178_comm_10032={"id":468178,"unique_id":"wp-comment-10032","title":"I%26%23039%3Bd%20always%20thought%20of%20something%20like%20SSO%20as%20a%20no-brainer%2C%20but%20Andrew%20Koenig%26%23039%3Bs%20tale%20has%20made%20me%20stop%20and%20think%3Ahttp%3A%2F%2Fwww.drdobbs.com%2Fcpp%2Fis-optimization-immoral%2F240151916...","permalink":"https:\/\/herbsutter.com\/2013\/05\/13\/gotw-2-solution-temporary-objects\/#comment-10032","item_id":"_comm_10032"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_10032 == 'undefined' ){PDRTJS_468178_comm_10032 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_10032 );}}PDRTJS_settings_468178_comm_10031={"id":468178,"unique_id":"wp-comment-10031","title":"It%20seems%20to%20me%20that%20changing%20the%20argument%20from%20by-value%20to%20by-reference%20changes%20the%20operational%20semantics%20of%20this%20function.%20In%20the%20original%2C%20the%20function%20gets%20a%20local%20copy%20of%20the%20list%2C%20which%20cann...","permalink":"https:\/\/herbsutter.com\/2013\/05\/13\/gotw-2-solution-temporary-objects\/#comment-10031","item_id":"_comm_10031"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_10031 == 'undefined' ){PDRTJS_468178_comm_10031 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_10031 );}}PDRTJS_settings_468178_comm_10029={"id":468178,"unique_id":"wp-comment-10029","title":"%26quot%3BSingle%20exit%2C%20on%20the%20other%20hand%2C%20got%20unfairly%20popular%20on%20the%20basis%20of%20symmetry%26quot%3B%20%26%23091%3Bcitation%20needed%26%23093%3BSingle%20exit%20popular%20because%20it%20makes%20code%20easier%20to%20reason%20about.%20%20It%20provides%20more%20places%20to%20asse...","permalink":"https:\/\/herbsutter.com\/2013\/05\/13\/gotw-2-solution-temporary-objects\/#comment-10029","item_id":"_comm_10029"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_10029 == 'undefined' ){PDRTJS_468178_comm_10029 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_10029 );}}PDRTJS_settings_468178_comm_10028={"id":468178,"unique_id":"wp-comment-10028","title":"I%20recommend%20to%20change%20%20%20%20%20%26quot%3BThe%20most%20obvious%20temporaries%20are%20buried%20in%20the%20function%20signature%20itself%3A%26quot%3BTo%20avoid%20saying%20%26quot%3Btemporaries%26quot%3B%2C%20or%20to%20clarify%20your%20definition%20of%20%26quot%3Btemporary%26quot%3B.%20Both%20of%20these%20by-...","permalink":"https:\/\/herbsutter.com\/2013\/05\/13\/gotw-2-solution-temporary-objects\/#comment-10028","item_id":"_comm_10028"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_10028 == 'undefined' ){PDRTJS_468178_comm_10028 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_10028 );}}PDRTJS_settings_468178_comm_10027={"id":468178,"unique_id":"wp-comment-10027","title":"std%3A%3Aoptional%20as%20return%20type%20might%20be%20useful%20here%20%28this%20is%20a%20C%2B%2B14%20GotW%20after%20all%29....","permalink":"https:\/\/herbsutter.com\/2013\/05\/13\/gotw-2-solution-temporary-objects\/#comment-10027","item_id":"_comm_10027"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_10027 == 'undefined' ){PDRTJS_468178_comm_10027 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_10027 );}}PDRTJS_settings_468178_comm_10024={"id":468178,"unique_id":"wp-comment-10024","title":"%40zahirtezcan%2C%20That%26%23039%3Bs%20exactly%20what%20I%20was%20thinking.%20I%26%23039%3Bd%20probably%20change%20the%20ending%20to%20use%20the%20ternary%20conditional%20operator%2C%20though....","permalink":"https:\/\/herbsutter.com\/2013\/05\/13\/gotw-2-solution-temporary-objects\/#comment-10024","item_id":"_comm_10024"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_10024 == 'undefined' ){PDRTJS_468178_comm_10024 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_10024 );}}PDRTJS_settings_468178_comm_10023={"id":468178,"unique_id":"wp-comment-10023","title":"By%20the%20way%2C%20concerning%20the%20other%20advice%20%26quot%3BGuideline%3A%20Prefer%20preincrement.%20Only%20use%20postincrement%20if%20youre%20going%20to%20use%20the%20original%20value.%20%26quot%3B%2C%20I%20always%20use%20preincrement.%20If%20I%20need%20post%20increment%2C%20I...","permalink":"https:\/\/herbsutter.com\/2013\/05\/13\/gotw-2-solution-temporary-objects\/#comment-10023","item_id":"_comm_10023"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_10023 == 'undefined' ){PDRTJS_468178_comm_10023 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_10023 );}}PDRTJS_settings_468178_comm_10022={"id":468178,"unique_id":"wp-comment-10022","title":"Hello%2CThank%20you%20for%20this%20new%20%2Amodern%2A%20gotw%20source%20of%20thought%20and%20learning%20as%20usual.It%20happend%20that%20this%20morning%20I%20also%20read%20the%20article%20from%20Andrew%20Koenig%20about%20%2Asubtleties%20of%20Aliasing%2A%20%28http%3A%2F%2Fw...","permalink":"https:\/\/herbsutter.com\/2013\/05\/13\/gotw-2-solution-temporary-objects\/#comment-10022","item_id":"_comm_10022"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_10022 == 'undefined' ){PDRTJS_468178_comm_10022 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_10022 );}}PDRTJS_settings_468178_comm_10021={"id":468178,"unique_id":"wp-comment-10021","title":"Huh.%20You%20just%20sent%20me%20off%20reading%20through%20lilbstdc%2B%2B%26%23039%3Bs%20string%20sources%20and%20indeed%20they%20don%26%23039%3Bt%20use%20sso%20%28or%20I%20just%20didn%26%23039%3Bt%20understand%20the%20source%20code%20correctly%29%2C%20though%20some%20posts%20I%20found%20on%20the%20inter...","permalink":"https:\/\/herbsutter.com\/2013\/05\/13\/gotw-2-solution-temporary-objects\/#comment-10021","item_id":"_comm_10021"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_10021 == 'undefined' ){PDRTJS_468178_comm_10021 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_10021 );}}PDRTJS_settings_468178_comm_10019={"id":468178,"unique_id":"wp-comment-10019","title":"In%20summary%2C%20theres%20no%20difference%20in%20practice%20among%20returning%20%2C%20s%2C%20or%20%7B%20%7D%3B%20use%20whichever%20you%20prefer%20for%20stylistic%20reasons.%20If%20your%20string%20implementation%20is%20either%20smart%20or%20uses%20SSO%2C%20which%20covers%20a...","permalink":"https:\/\/herbsutter.com\/2013\/05\/13\/gotw-2-solution-temporary-objects\/#comment-10019","item_id":"_comm_10019"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_10019 == 'undefined' ){PDRTJS_468178_comm_10019 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_10019 );}}PDRTJS_settings_468178_comm_10017={"id":468178,"unique_id":"wp-comment-10017","title":"%40minhingent%3A%20http%3A%2F%2Fmartinfowler.com%2Frefactoring%2Fcatalog%2FreplaceNestedConditionalWithGuardClauses.html...","permalink":"https:\/\/herbsutter.com\/2013\/05\/13\/gotw-2-solution-temporary-objects\/#comment-10017","item_id":"_comm_10017"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_10017 == 'undefined' ){PDRTJS_468178_comm_10017 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_10017 );}}PDRTJS_settings_468178_comm_10016={"id":468178,"unique_id":"wp-comment-10016","title":"what%20about%20using%20polymorphic%20lambdas%20for%20find_if%20algorithm%3F%26%23091%3Bcode%26%23093%3Bauto%20endEmp%20%3D%20end%28emps%29%3Bauto%20found%20%3D%20std%3A%3Afind_if%28begin%28emps%29%2C%20endEmp%2C%20%26%23091%3B%26amp%3B%26%23093%3B%28auto%26amp%3B%20emp%29%20%7B%20return%20emp.name%28%29%20%3D%3D%20name%3B%20%7D%29%3B%20if%28...","permalink":"https:\/\/herbsutter.com\/2013\/05\/13\/gotw-2-solution-temporary-objects\/#comment-10016","item_id":"_comm_10016"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_10016 == 'undefined' ){PDRTJS_468178_comm_10016 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_10016 );}}PDRTJS_settings_468178_comm_10015={"id":468178,"unique_id":"wp-comment-10015","title":"I%20would%20probably%20write%26%23091%3Bcode%26%23093%3Bfor%28%20const%20auto%26amp%3B%20e%20%3A%20emps%20%29%26%23091%3B%2Fcode%26%23093%3Btoo%2C%20since%20this%20is%20the%20%26quot%3Bsafe%20default%26quot%3B%20way%20of%20writing%20range%20based%20for%20loops.But%20like%20you%20said%2C%20in%20such%20a%20short%20function%20I%20wouldn%26%23039%3Bt...","permalink":"https:\/\/herbsutter.com\/2013\/05\/13\/gotw-2-solution-temporary-objects\/#comment-10015","item_id":"_comm_10015"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_10015 == 'undefined' ){PDRTJS_468178_comm_10015 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_10015 );}}PDRTJS_settings_468178_comm_10014={"id":468178,"unique_id":"wp-comment-10014","title":"Regarding%20single-entry%2Fsingle-exit%2C%20what%20about%20using%20a%20break%20statement%20when%20the%20employee%20is%20found%3F...","permalink":"https:\/\/herbsutter.com\/2013\/05\/13\/gotw-2-solution-temporary-objects\/#comment-10014","item_id":"_comm_10014"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_10014 == 'undefined' ){PDRTJS_468178_comm_10014 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_10014 );}}PDRTJS_settings_468178_comm_10013={"id":468178,"unique_id":"wp-comment-10013","title":"%40Michael.%20Good%20comment.%20It%20makes%20the%20for-loop%20much%20easier%20to%20read.%20%2Anitpick%20warning%2A%26%23091%3Bcode%26%23093%3B%20for%28%20const%20auto%26amp%3B%20e%20%3A%20emps%20%20%29%26%23091%3B%2Fcode%26%23093%3BUsing%20explicit%20%26quot%3Bconst%26quot%3B%20in%20the%20loop%20is%20as%20you%20pointed%20is%20out%20not%20n...","permalink":"https:\/\/herbsutter.com\/2013\/05\/13\/gotw-2-solution-temporary-objects\/#comment-10013","item_id":"_comm_10013"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_10013 == 'undefined' ){PDRTJS_468178_comm_10013 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_10013 );}}PDRTJS_settings_468178_comm_10011={"id":468178,"unique_id":"wp-comment-10011","title":"That%26%23039%3Bs%20like%20saying%2C%20that%20wearing%20a%20safety%20belt%20is%20premature%20pessimization.%20%3B%29...","permalink":"https:\/\/herbsutter.com\/2013\/05\/13\/gotw-2-solution-temporary-objects\/#comment-10011","item_id":"_comm_10011"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_10011 == 'undefined' ){PDRTJS_468178_comm_10011 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_10011 );}}PDRTJS_settings_468178_comm_10010={"id":468178,"unique_id":"wp-comment-10010","title":"Returning%20by%20value%20is%20premature%20pessimization.%20It%20also%20disallows%20a%20mutable%20reference%20or%20pointer%20to%20be%20returned.%20Ideally%20this%20function%20would%20be%20named%20find_employee%20and%20return%20a%20const%20employee%2A.%20Th...","permalink":"https:\/\/herbsutter.com\/2013\/05\/13\/gotw-2-solution-temporary-objects\/#comment-10010","item_id":"_comm_10010"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_10010 == 'undefined' ){PDRTJS_468178_comm_10010 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_10010 );}}PDRTJS_settings_468178_comm_10009={"id":468178,"unique_id":"wp-comment-10009","title":"-loop...","permalink":"https:\/\/herbsutter.com\/2013\/05\/13\/gotw-2-solution-temporary-objects\/#comment-10009","item_id":"_comm_10009"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_10009 == 'undefined' ){PDRTJS_468178_comm_10009 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_10009 );}}PDRTJS_settings_468178_comm_10008={"id":468178,"unique_id":"wp-comment-10008","title":"Using%20C%2B%2B11%2F14%20I%20recommend%20my%20team%20to%20use%20a%20range%20based%20for%20loop%20whenever%20possible.%20%26%23091%3Bcode%26%23093%3Bstring%20find_addr%28%20const%20list%26lt%3Bemployee%26gt%3B%26amp%3B%20emps%2C%20const%20string%26amp%3B%20name%20%29%20%7B%20%20%20%20for%28%20auto%26amp%3B%20e%20%3A%20...","permalink":"https:\/\/herbsutter.com\/2013\/05\/13\/gotw-2-solution-temporary-objects\/#comment-10008","item_id":"_comm_10008"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_10008 == 'undefined' ){PDRTJS_468178_comm_10008 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_10008 );}}
//--><!]]></script><script type='text/javascript' charset='UTF-8' src='https://polldaddy.com/js/rating/rating.js'></script><script type='text/javascript' src='https://platform.twitter.com/widgets.js?ver=20111117'></script>
<script type='text/javascript' src='https://s1.wp.com/_static/??-eJzTLy/QTc7PK0nNK9EvyClNz8wr1i+uzCtJrMjITM/IAeKS1CJMEWP94uSizIISoOIM5/yiVL2sYh19yo1yKiotzgjISczMAxpon2traGJkZGxiZGhskgUAFHlAaw=='></script>
<script type='text/javascript'>
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "https://s1.wp.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.9b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "https://s2.wp.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?m=1363304414h&amp;ver=3.0.9b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.defaults['toolbar'] = false;
	SyntaxHighlighter.all();

	// Infinite scroll support
	if ( typeof( jQuery ) !== 'undefined' ) {
		jQuery( function( $ ) {
			$( document.body ).on( 'post-load', function() {
				SyntaxHighlighter.highlight();
			} );
		} );
	}
</script>
<script type='text/javascript'>
/* <![CDATA[ */
var actionbardata = {"siteID":"3379246","siteName":"Sutter\u2019s Mill","siteURL":"https:\/\/herbsutter.com","icon":"<img alt='' src='https:\/\/secure.gravatar.com\/blavatar\/4554b8d24c7f200dc5e2e1b18db1893f?s=50&d=https%3A%2F%2Fs2.wp.com%2Fi%2Flogo%2Fwpcom-gray-white.png' class='avatar avatar-50' height='50' width='50' \/>","canManageOptions":"","canCustomizeSite":"","isFollowing":"","themeSlug":"pub\/mistylook","signupURL":"https:\/\/wordpress.com\/start\/","loginURL":"https:\/\/herbsutter.wordpress.com\/wp-login.php?redirect_to=https%3A%2F%2Fherbsutter.com%2F2013%2F05%2F13%2Fgotw-2-solution-temporary-objects%2F","themeURL":"","xhrURL":"https:\/\/herbsutter.com\/wp-admin\/admin-ajax.php","nonce":"8fb9818ae2","isSingular":"1","isFolded":"","isLoggedIn":"","isMobile":"","subscribeNonce":"<input type=\"hidden\" id=\"_wpnonce\" name=\"_wpnonce\" value=\"4590924cc6\" \/>","referer":"https:\/\/herbsutter.com\/2013\/05\/13\/gotw-2-solution-temporary-objects\/","canFollow":"1","feedID":"171936","statusMessage":"","customizeLink":"https:\/\/herbsutter.wordpress.com\/wp-admin\/customize.php?url=https%3A%2F%2Fherbsutter.wordpress.com%2F2013%2F05%2F13%2Fgotw-2-solution-temporary-objects%2F","postID":"1874","shortlink":"https:\/\/wp.me\/peb5Y-ue","canEditPost":"","editLink":"https:\/\/wordpress.com\/post\/herbsutter.com\/1874","statsLink":"https:\/\/wordpress.com\/stats\/post\/1874\/herbsutter.com","i18n":{"view":"View site","follow":"Follow","following":"Following","edit":"Edit","login":"Log in","signup":"Sign up","customize":"Customize","report":"Report this content","themeInfo":"Get theme: MistyLook","shortlink":"Copy shortlink","copied":"Copied","followedText":"New posts from this site will now appear in your <a href=\"https:\/\/wordpress.com\/\">Reader<\/a>","foldBar":"Collapse this bar","unfoldBar":"Expand this bar","editSubs":"Manage subscriptions","viewReader":"View site in Reader","viewReadPost":"View post in Reader","subscribe":"Sign me up","enterEmail":"Enter your email address","followers":"Join 19,532 other followers","alreadyUser":"Already have a WordPress.com account? <a href=\"https:\/\/herbsutter.wordpress.com\/wp-login.php?redirect_to=https%3A%2F%2Fherbsutter.com%2F2013%2F05%2F13%2Fgotw-2-solution-temporary-objects%2F\">Log in now.<\/a>","stats":"Stats"}};
/* ]]> */
</script>
<script type='text/javascript' src='https://s0.wp.com/_static/??-eJyVjcEOgjAQRH/IuoIYT8Zvqe2GLrQLdlvAv7ceJEYTEg+bTGbe7MA8KjNwQk7QCVicyOC47DvZwUcUshp9bokFPPUocM+Y0Wm2HuM3/CblwUkvjlrnyyWMv87GjraBWN10hKCloEWpYcIYyZb91fvzQ4ra9LJVMokGfpVWVehruFSnujo0x+Zcd0+y+3Rn'></script>
<script type="text/javascript">
// <![CDATA[
(function() {
try{
  if ( window.external &&'msIsSiteMode' in window.external) {
    if (window.external.msIsSiteMode()) {
      var jl = document.createElement('script');
      jl.type='text/javascript';
      jl.async=true;
      jl.src='/wp-content/plugins/ie-sitemode/custom-jumplist.php';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(jl, s);
    }
  }
}catch(e){}
})();
// ]]>
</script><script src="//stats.wp.com/w.js?56" type="text/javascript" async defer></script>
<script type="text/javascript">
_tkq = window._tkq || [];
_stq = window._stq || [];
_tkq.push(['storeContext', {'blog_id':'3379246','blog_tz':'-8','user_lang':'en','blog_lang':'en','user_id':'0'}]);
_stq.push(['view', {'blog':'3379246','v':'wpcom','tz':'-8','user_id':'0','post':'1874','subd':'herbsutter'}]);
_stq.push(['extra', {'crypt':'UE40eW5QN0p8M2Y/RE1TaVhzUzFMbjdWNHpwZGhTayxPSUFCMGNrd29+Smw0TDhnZmRTK0hlRi9QSGh6bi9GXVhBJWIlZlR5U1JMLU8/MkNtblkvY1d1TjBELytHc0k/MXdHUVQyK2IyUVA5SjU1bj9VX3ExLHYsREFpcnlfNHYtXV1HSUIsLkJrcnp0eS5sQiZdZzRdeTl3OERpNWt3bCYsZ0dCaDdRaVNuVzNYcnlyQlh3ZGpPdmkvRkVJRkNZTS5OXUtaMjQzci09fk0uNkROMTJSSEhCM011bXc2JXpwVXx4amw2cXJvNWQxeWdmLnxNZVl5WkFdZT0mcHR2Rks3TGV+WG9pXUVSU3E/NEtTb0lnciVTOVdfLi5PM2V1SnV8TX5HfEhjMmU9TWpIWD9CRk1tQSVoRU84L0M1QkUrbFtGU1BULVJxTlNhZkk/MzJMRz95SQ=='}]);
_stq.push([ 'clickTrackerInit', '3379246', '1874' ]);
	</script>
<noscript><img src="https://pixel.wp.com/b.gif?v=noscript" style="height:0px;width:0px;overflow:hidden" alt="" /></noscript>
<script>
if ( 'object' === typeof wpcom_mobile_user_agent_info ) {

	wpcom_mobile_user_agent_info.init();
	var mobileStatsQueryString = "";
	
	if( false !== wpcom_mobile_user_agent_info.matchedPlatformName )
		mobileStatsQueryString += "&x_" + 'mobile_platforms' + '=' + wpcom_mobile_user_agent_info.matchedPlatformName;
	
	if( false !== wpcom_mobile_user_agent_info.matchedUserAgentName )
		mobileStatsQueryString += "&x_" + 'mobile_devices' + '=' + wpcom_mobile_user_agent_info.matchedUserAgentName;
	
	if( wpcom_mobile_user_agent_info.isIPad() )
		mobileStatsQueryString += "&x_" + 'ipad_views' + '=' + 'views';

	if( "" != mobileStatsQueryString ) {
		new Image().src = document.location.protocol + '//pixel.wp.com/g.gif?v=wpcom-no-pv' + mobileStatsQueryString + '&baba=' + Math.random();
	}
	
}
</script></body>
</html>