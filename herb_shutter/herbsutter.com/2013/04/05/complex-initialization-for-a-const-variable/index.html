<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Complex initialization for a const variable | Sutter’s Mill</title>
<link rel="pingback" href="https://herbsutter.com/xmlrpc.php" />
<script type="text/javascript">
  WebFontConfig = {"typekit":{"id":"eyo0tqd"}};
  (function() {
    var wf = document.createElement('script');
    wf.src = 'https://s0.wp.com/wp-content/plugins/custom-fonts/js/webfont.js';
    wf.type = 'text/javascript';
    wf.async = 'true';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(wf, s);
	})();
</script><style id="jetpack-custom-fonts-css">.wf-active #header h1{font-size:2.12em;font-family:"ff-dagny-web-pro-1","ff-dagny-web-pro-2",sans-serif;font-style:normal;font-weight:400}.wf-active body{font-size:89.7%;font-family:"ff-basic-gothic-web-pro-1","ff-basic-gothic-web-pro-2",sans-serif}.wf-active #navigation{font-family:"ff-basic-gothic-web-pro-1","ff-basic-gothic-web-pro-2",sans-serif}.wf-active #navigation ul li.search{font-size:1.06em}.wf-active #navigation ul li.search input#searchsubmit{font-size:1.06em}.wf-active #content .post-info, .wf-active #content .postmetadata{font-size:1.06em}.wf-active #sidebar{font-size:1.06em}.wf-active #footer p.right{font-size:1.06em}.wf-active .commentnum{font-size:1.77em}.wf-active .commentlist li .cmtinfo{font-size:1.18em}.wf-active .commentlist li .cmtinfo em{font-size:1.06em}.wf-active #respond label{font-size:11.8px}.wf-active #respond .required{font-size:11.8px}.wf-active #respond .subscribe-label{font-size:14.2px}.wf-active #respond .comment-notes{font-size:13px}.wf-active .wp-caption p.wp-caption-text{font-size:13px}.wf-active #content h1, .wf-active h2, .wf-active h3, .wf-active h4, .wf-active h5, .wf-active h6{font-family:"ff-dagny-web-pro-1","ff-dagny-web-pro-2",sans-serif;font-style:normal;font-weight:400}.wf-active #header h2{font-size:1.18em;font-weight:400;font-family:"ff-dagny-web-pro-1","ff-dagny-web-pro-2",sans-serif;font-style:normal}.wf-active #content h3{font-size:1.65em;font-weight:400;font-style:normal}.wf-active #content h4{font-size:1.3em;font-style:normal;font-weight:400}.wf-active #content h5{font-size:1.18em;font-style:normal;font-weight:400}.wf-active #content .post h2{font-size:1.65em;font-weight:400;font-style:normal}.wf-active li.sidebox h2{font-weight:400;font-size:1.89em;font-style:normal}.wf-active .post h4{font-size:1.18em;font-weight:400;font-family:"ff-dagny-web-pro-1","ff-dagny-web-pro-2",sans-serif;font-style:normal}.wf-active .post h4 em{font-style:normal;font-weight:400}</style>
		<script src='https://r-login.wordpress.com/remote-login.php?action=js&amp;host=herbsutter.com&amp;id=3379246&amp;t=1542965580&amp;back=https%3A%2F%2Fherbsutter.com%2F2013%2F04%2F05%2Fcomplex-initialization-for-a-const-variable%2F' type="text/javascript"></script>
		<script type="text/javascript">
		/* <![CDATA[ */
			if ( 'function' === typeof WPRemoteLogin ) {
				document.cookie = "wordpress_test_cookie=test; path=/";
				if ( document.cookie.match( /(;|^)\s*wordpress_test_cookie\=/ ) ) {
					WPRemoteLogin();
				}
			}
		/* ]]> */
		</script>
		<link rel='dns-prefetch' href='//s2.wp.com' />
<link rel='dns-prefetch' href='//s0.wp.com' />
<link rel='dns-prefetch' href='//s1.wp.com' />
<link rel='dns-prefetch' href='//herbsutter.wordpress.com' />
<link rel="alternate" type="application/rss+xml" title="Sutter’s Mill &raquo; Feed" href="https://herbsutter.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="Sutter’s Mill &raquo; Comments Feed" href="https://herbsutter.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Sutter’s Mill &raquo; Complex initialization for a const&nbsp;variable Comments Feed" href="https://herbsutter.com/2013/04/05/complex-initialization-for-a-const-variable/feed/" />
	<script type="text/javascript">
		/* <![CDATA[ */
		function addLoadEvent(func) {
			var oldonload = window.onload;
			if (typeof window.onload != 'function') {
				window.onload = func;
			} else {
				window.onload = function () {
					oldonload();
					func();
				}
			}
		}
		/* ]]> */
	</script>
			<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s0.wp.com\/wp-content\/mu-plugins\/wpcom-smileys\/twemoji\/2\/72x72\/","ext":".png","svgUrl":"https:\/\/s0.wp.com\/wp-content\/mu-plugins\/wpcom-smileys\/twemoji\/2\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/s1.wp.com\/wp-includes\/js\/wp-emoji-release.min.js?m=1532082729h&ver=4.9.8"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56760,9792,65039],[55358,56760,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel='stylesheet' id='all-css-0-1' href='https://s2.wp.com/_static/??-eJyNkN1uwjAMhV9onsUG69W0Z0laE0zzp8QR6tvjUlUCwSpuonOS81knxkuGPkWhKBgaZN8cx4qeR6p4JsmmH+HmPvtaP/B1nOORI8uEcqKgYG4WA1eZfErjFtinQnofspE5EWhgQ15nRNnCQv5ZqVmetORmv0vWNFibC9UKegZuAZayT9wKuabWUnEwt0Tb2A9ofbotxBZTJpx/SE8DXi3hn+h9Rx4cSUVJGXKqqt5GaurZeGCNPJoFZoxJlsdVbE11lEB/aYRTfDBw9IbLFlpI9+NUOtTUnZ2hv/C7O+y/uu9uf+jOV8Xg7sY=?cssminify=yes' type='text/css' media='all' />
<link rel='stylesheet' id='print-css-1-1' href='https://s2.wp.com/wp-content/mu-plugins/global-print/global-print.css?m=1465851035h&cssminify=yes' type='text/css' media='print' />
<link rel='stylesheet' id='all-css-2-1' href='https://s0.wp.com/_static/??/wp-content/mu-plugins/actionbar/actionbar.css,/wp-content/themes/h4/global.css?m=1516985148j&cssminify=yes' type='text/css' media='all' />
<script type='text/javascript' src='https://s0.wp.com/_static/??-eJyFztEKwjAMBdAfsquTiXsRv6XWOFKXtDbphn69HeiDMBQCgdzDJXZOBtmP5QJiQ517gfx4rybIxv4ChnDITqEh5A/2kRVYF0vxjCOYIpDdUG+16BpXXIqiBCIVraTfLyFPCPNfFkCT8zeTQfC5tJ7o2Hb9Yde3+24bXjRNW9I='></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://herbsutter.wordpress.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://s1.wp.com/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Words of wisdom: Bjarne&nbsp;Stroustrup' href='https://herbsutter.com/2013/03/14/words-of-wisdom-bjarne-stroustrup/' />
<link rel='next' title='Trip Report: ISO C++ Spring 2013&nbsp;Meeting' href='https://herbsutter.com/2013/04/20/trip-report-iso-c-spring-2013-meeting/' />
<meta name="generator" content="WordPress.com" />
<link rel="canonical" href="https://herbsutter.com/2013/04/05/complex-initialization-for-a-const-variable/" />
<link rel='shortlink' href='https://wp.me/peb5Y-sU' />
<link rel="alternate" type="application/json+oembed" href="https://public-api.wordpress.com/oembed/?format=json&amp;url=https%3A%2F%2Fherbsutter.com%2F2013%2F04%2F05%2Fcomplex-initialization-for-a-const-variable%2F&amp;for=wpcom-auto-discovery" /><link rel="alternate" type="application/xml+oembed" href="https://public-api.wordpress.com/oembed/?format=xml&amp;url=https%3A%2F%2Fherbsutter.com%2F2013%2F04%2F05%2Fcomplex-initialization-for-a-const-variable%2F&amp;for=wpcom-auto-discovery" />
<!-- Jetpack Open Graph Tags -->
<meta property="og:type" content="article" />
<meta property="og:title" content="Complex initialization for a const variable" />
<meta property="og:url" content="https://herbsutter.com/2013/04/05/complex-initialization-for-a-const-variable/" />
<meta property="og:description" content="On std-discussion, Shakti Misra asked: I have seen in a lot of places code like int i; if(someConditionIstrue) { Do some operations and calculate the value of i; i = some calculated value; } use i;…" />
<meta property="article:published_time" content="2013-04-05T18:12:28+00:00" />
<meta property="article:modified_time" content="2013-04-05T18:12:29+00:00" />
<meta property="og:site_name" content="Sutter’s Mill" />
<meta property="og:image" content="https://secure.gravatar.com/blavatar/4554b8d24c7f200dc5e2e1b18db1893f?s=200&amp;ts=1542965580" />
<meta property="og:image:width" content="200" />
<meta property="og:image:height" content="200" />
<meta property="og:locale" content="en_US" />
<meta name="twitter:site" content="@wordpressdotcom" />
<meta name="twitter:text:title" content="Complex initialization for a const&nbsp;variable" />
<meta name="twitter:image" content="https://secure.gravatar.com/blavatar/4554b8d24c7f200dc5e2e1b18db1893f?s=240" />
<meta name="twitter:card" content="summary" />
<meta property="article:publisher" content="https://www.facebook.com/WordPresscom" />

<!-- End Jetpack Open Graph Tags -->
<link rel="shortcut icon" type="image/x-icon" href="https://secure.gravatar.com/blavatar/4554b8d24c7f200dc5e2e1b18db1893f?s=32" sizes="16x16" />
<link rel="icon" type="image/x-icon" href="https://secure.gravatar.com/blavatar/4554b8d24c7f200dc5e2e1b18db1893f?s=32" sizes="16x16" />
<link rel="apple-touch-icon-precomposed" href="https://secure.gravatar.com/blavatar/4554b8d24c7f200dc5e2e1b18db1893f?s=114" />
<link rel='openid.server' href='https://herbsutter.wordpress.com/?openidserver=1' />
<link rel='openid.delegate' href='https://herbsutter.wordpress.com/' />
<link rel="search" type="application/opensearchdescription+xml" href="https://herbsutter.com/osd.xml" title="Sutter’s Mill" />
<link rel="search" type="application/opensearchdescription+xml" href="https://s1.wp.com/opensearch.xml" title="WordPress.com" />
		<style id="wpcom-hotfix-masterbar-style">
			@media screen and (min-width: 783px) {
				#wpadminbar .quicklinks li#wp-admin-bar-my-account.with-avatar > a img {
					margin-top: 5px;
				}
			}
		</style>
		<script type="text/javascript" id="webfont-output">
  
  WebFontConfig = {"typekit":{"id":"cjs1oxc"}};
  (function() {
    var wf = document.createElement('script');
    wf.src = ('https:' == document.location.protocol ? 'https' : 'http') +
      '://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';
    wf.type = 'text/javascript';
    wf.async = 'true';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(wf, s);
	})();
</script><style type="text/css">
.widget_twitter li {
	word-wrap: break-word;
}
</style>
<meta name="application-name" content="Sutter’s Mill" /><meta name="msapplication-window" content="width=device-width;height=device-height" /><meta name="msapplication-tooltip" content="Herb Sutter on software development" /><meta name="msapplication-task" content="name=Subscribe;action-uri=https://herbsutter.com/feed/;icon-uri=https://secure.gravatar.com/blavatar/4554b8d24c7f200dc5e2e1b18db1893f?s=16" /><meta name="msapplication-task" content="name=Sign up for a free blog;action-uri=http://wordpress.com/signup/;icon-uri=https://s1.wp.com/i/favicon.ico" /><meta name="msapplication-task" content="name=WordPress.com Support;action-uri=http://support.wordpress.com/;icon-uri=https://s1.wp.com/i/favicon.ico" /><meta name="msapplication-task" content="name=WordPress.com Forums;action-uri=http://forums.wordpress.com/;icon-uri=https://s1.wp.com/i/favicon.ico" /><meta name="description" content="On std-discussion, Shakti Misra asked: I have seen in a lot of places code like int i; if(someConditionIstrue) { Do some operations and calculate the value of i; i = some calculated value; } use i; //Note this value is only used not changed. It should not be changed. But unfortunately in this case there&hellip;" />
<style type="text/css">
			#header h1 a,
		#header h2 {
			color: #265E15 !important;
		}
				#headerimage {
			background: url('https://herbsutter.files.wordpress.com/2011/10/cropped-blog-header.jpg') no-repeat;
			height: 200px;
		}
	</style>
<link rel="amphtml" href="https://herbsutter.com/2013/04/05/complex-initialization-for-a-const-variable/amp/"><style type="text/css" id="syntaxhighlighteranchor"></style>
		<link rel="stylesheet" id="custom-css-css" type="text/css" href="https://s2.wp.com/?custom-css=1&#038;csblog=eb5Y&#038;cscache=6&#038;csrev=60" />
		</head>
<body id="section-index" class="post-template-default single single-post postid-1792 single-format-standard mp6 customizer-styles-applied highlander-enabled highlander-light">


<div id="navigation" class="clearfix">
		<div class="menu">
		<ul>
			<li ><a href="https://herbsutter.com/" title="Home">Home</a></li>
			<li class="page_item page-item-912"><a href="https://herbsutter.com/welcome-to-the-jungle/">Welcome to the&nbsp;Jungle</a></li>
<li class="page_item page-item-864 page_item_has_children"><a href="https://herbsutter.com/gotw/">GotW</a></li>
<li class="page_item page-item-761"><a href="https://herbsutter.com/elements-of-modern-c-style/">Elements of Modern C++&nbsp;Style</a></li>
<li class="page_item page-item-2 page_item_has_children"><a href="https://herbsutter.com/about/">About</a></li>
									<li class="search"><form method="get" id="searchform" action="https://herbsutter.com"><input type="text" class="textbox" value="" name="s" id="s" /><input type="submit" id="searchsubmit" value="Search" /></form></li>
					</ul>
	</div>
</div><!-- end id:navigation -->

<div id="container">

<div id="header">
<h1><a href="https://herbsutter.com/" title="Sutter’s Mill">Sutter’s Mill</a></h1>
<h2>Herb Sutter on software development</h2>
</div><!-- end id:header -->


	
		<div id="feedarea">
	<dl>
		<dt><strong>Feeds:</strong></dt>

			<dd><a href="https://herbsutter.com/feed/">Posts</a></dd>
	
			<dd><a href="https://herbsutter.com/comments/feed/">Comments</a></dd>
		</dl>
	</div><!-- end id:feedarea -->
	
	<div id="headerimage">
</div><!-- end id:headerimage -->

<div id="content">
<div id="content-main">

		
									<div class="postnav">
				<div class="alignleft">&laquo; <a href="https://herbsutter.com/2013/03/14/words-of-wisdom-bjarne-stroustrup/" rel="prev">Words of wisdom: Bjarne&nbsp;Stroustrup</a></div>
				<div class="alignright"><a href="https://herbsutter.com/2013/04/20/trip-report-iso-c-spring-2013-meeting/" rel="next">Trip Report: ISO C++ Spring 2013&nbsp;Meeting</a> &raquo;</div>
			</div>
			
			<div class="post-1792 post type-post status-publish format-standard hentry category-c" id="post-1792">
				<div class="posttitle">
					<h2>Complex initialization for a const&nbsp;variable</h2>
					<p class="post-info">2013-04-05 by <a href="https://herbsutter.com/author/herbsutter/" title="Posts by Herb Sutter">Herb Sutter</a>  </p>
				</div>

				<div class="entry">
					<p>On std-discussion, <a href="https://groups.google.com/a/isocpp.org/d/msg/std-discussion/FBjcR4WJlkU/wL1a28jWeeoJ">Shakti Misra asked</a>:</p>
<blockquote>
<p>I have seen in a lot of places code like     <br />int i;      <br />if(someConditionIstrue)      <br />{      <br />Do some operations and calculate the value of i;      <br />i = some calculated value;      <br />}      <br />use i; //Note this value is only used not changed. It should not be changed.      <br />But unfortunately in this case there is no way to guarantee it.      <br />so now if some one comes and does</p>
<p>i = 10;// This is valid</p>
<p>What i was thinking: is there a way to tell that &quot;i&quot; can be set only once?     <br />After that it will be a constant. Something like </p>
<p>const once int i;     <br />if(someConditionIstrue)      <br />{      <br />Do some operations and calculate the value of i;      <br />i = calculated value;      <br />}      <br />use i; //Note this value is only used not changed.      <br />i = 10;// Compiler error</p>
</blockquote>
<p>Olaf van der Spek replied:</p>
<blockquote>
<p>A lambda?</p>
</blockquote>
<p><a href="https://groups.google.com/a/isocpp.org/d/msg/std-discussion/FBjcR4WJlkU/nQnsSOziq04J">I answered</a> as follows:</p>
<p>Bingo. Olaf nailed it: The way to do it is with a lambda. This is one of the examples I give in my talk <em>Lambdas, Lambdas Everywhere</em> (here are the <u><a href="http://sdrv.ms/XtXofx">slides</a></u> from <em>C++ &amp; Beyond</em> 2010).</p>
<p>In your example, do this:</p>
<p>&#160;</p>
<p><strong>const</strong> int i = [&amp;]{</p>
<p>&#160;&#160;&#160; int i = some_default_value;</p>
<p>&#160;&#160;&#160; if(someConditionIstrue)   <br />&#160;&#160;&#160; {    <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; Do some operations and calculate the value of i;    <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; i = some calculated value;    <br />&#160;&#160;&#160; }</p>
<p>&#160;&#160;&#160; return i;</p>
<p>} <strong>()</strong>; // note: () invokes the lambda!</p>
<p>&#160;</p>
<p>That&#8217;s the C++11 idiom for this. It&#8217;s still being absorbed though – not everyone knows about it yet as we&#8217;re still all learning C++11 styles together.</p>
									</div>

				<p class="postmetadata">
					Posted in <a href="https://herbsutter.com/category/c/" rel="category tag">C++</a> | 											45 Comments									</p>
				
<!-- You can start editing here. -->

<h3 id="comments">45 Responses</h3>

	<ol class="commentlist">
			<li class="comment byuser comment-author-vvolkgang even thread-even depth-1 highlander-comment" id="comment-9822">
		<div id="div-comment-9822">
		<div class="cmtinfo"><em> on <a href="#comment-9822" title="">2013-05-04 at 6:53 pm</a></em> <img alt='' src='https://2.gravatar.com/avatar/5b9c77c615dd73a0147551a602dd04e9?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://dementedvice.wordpress.com' rel='external nofollow' class='url'>nosila00</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_9822"></div><p>Wouldn&#8217;t it be easier to just introduce the &#8220;final&#8221; C# keyword in C++?</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-9649">
		<div id="div-comment-9649">
		<div class="cmtinfo"><em> on <a href="#comment-9649" title="">2013-04-26 at 10:39 am</a></em> <img alt='' src='https://0.gravatar.com/avatar/94be0564577cafb528191cdb811759a0?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://sagar.org' rel='external nofollow' class='url'>ukdiveboy</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_9649"></div><p>Yes, as sdeetee pointed out, this is very similar to a construct used in Javascript to create an object, immediately call it and use the return value from it.  in javascript it is often used as a constructor, or factory pattern, but this is also another neat way to use it.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-garciat even thread-even depth-1 highlander-comment" id="comment-9405">
		<div id="div-comment-9405">
		<div class="cmtinfo"><em> on <a href="#comment-9405" title="">2013-04-20 at 11:26 am</a></em> <img alt='' src='https://2.gravatar.com/avatar/8df2c9fb8dc016dcdce04b633ba9a6b4?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>Garciat</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_9405"></div><p>C++11 lambdas give one the opportunity to think more JavaScript-y. Now, it&#8217;s up to you whether that&#8217;s actually good or bad.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="pingback odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-9169">
		<div id="div-comment-9169">
		<div class="cmtinfo"><em> on <a href="#comment-9169" title="">2013-04-12 at 4:26 am</a></em>  <cite><a href='http://musingstudio.com/2013/04/12/herb-sutter-complex-initialisation-for-a-const-variable/' rel='external nofollow' class='url'>Herb Sutter &#8211; complex initialisation for a const variable | musingstudio</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_9169"></div><p>[&#8230;] Sutter provided this handy use of lambdas to initialise a const variable that needs some [&#8230;]</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 highlander-comment" id="comment-9146">
		<div id="div-comment-9146">
		<div class="cmtinfo"><em> on <a href="#comment-9146" title="">2013-04-11 at 10:06 am</a></em> <img alt='' src='https://0.gravatar.com/avatar/3487ce6ed9ec277bac79a838537b46a8?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://gravatar.com/seharris' rel='external nofollow' class='url'>Steven Harris</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_9146"></div><p>As you mentioned Scala, I was going to point out in my original post that Java also accommodates this (which may be what makes it possible for Scala&#8217;s compiler back end) with its &#8220;final&#8221; keyword. Qualifying a variable as final—like using &#8220;val&#8221; rather than &#8220;var&#8221; in Scala—means that the variable must be assigned exactly once before use, not that it needs to be bound at its point of declaration.</p>
<p>Given that, one can write:</p>
<p>final String host;<br />
final int port;<br />
if (something) {<br />
  host = “alpha”;<br />
  port = 119;<br />
} else {<br />
  host = “omega”;<br />
  port = 563;<br />
}</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-herbsutter bypostauthor odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-9145">
		<div id="div-comment-9145">
		<div class="cmtinfo"><em> on <a href="#comment-9145" title="">2013-04-11 at 10:06 am</a></em> <img alt='' src='https://0.gravatar.com/avatar/c0ba56bfd231f8f04feb057728975181?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://www.herbsutter.com' rel='external nofollow' class='url'>Herb Sutter</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_9145"></div><p>@Kaylyn: Hmm, which reminds me that you can always use a tuple:</p>
<p>const tuple xy = [&amp;]{ /* initialize and return a tuple */ }();</p>
<p>or a struct:</p>
<p>const struct xy_ { int x; std::string y; } xy = [&amp;]{ /* initialize and return an xy_ */ }();</p>
<p>Hmm&#8230; one argument in favor of these options is that if those local variables are so related that they&#8217;re initialized together, they probably ought to benefit from being grouped together anyway.</p>
<p>In fact, in the case of host and port, the answer seems clear that the normal term we use for &#8220;initialize multiple variables that should be initialized together and probably share an invariants&#8221; is &#8220;constructor.&#8221; In the host+port example above, I sense that there&#8217;s a class or struct abstraction missing anyway to group these together, and once you have that you&#8217;re back in the simple single-variable case.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 highlander-comment" id="comment-9143">
		<div id="div-comment-9143">
		<div class="cmtinfo"><em> on <a href="#comment-9143" title="">2013-04-11 at 9:33 am</a></em> <img alt='' src='https://2.gravatar.com/avatar/880ead04f1404959e6b36539e701a830?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://kaylynbogle.com' rel='external nofollow' class='url'>Kaylyn Bogle</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_9143"></div><p>@Steven Harris:</p>
<p>If they don&#8217;t have to be const you can unpack using std::tie:</p>
<p>int x;<br />
std::string y;</p>
<p>std::tie(x, y) = SomeFunction(); // That returns std::tuple</p>
<p>I don&#8217;t think it&#8217;s possible in C++, without some sort of profound language change wrt variable definition, to easily unpack and initialize multiple consts from a function :(</p>
<p>Scala handles situations like this really well:</p>
<p>val (a, b) = if (someConditionIstrue) {<br />
    // Do calculations here<br />
    (calculatedValue, someOtherCalculation)<br />
} else (5, 5)  // Some default values</p>
<p>This creates two constants `a`, and `b`, unpacked from the tuple returned by `if`</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="pingback odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-9139">
		<div id="div-comment-9139">
		<div class="cmtinfo"><em> on <a href="#comment-9139" title="">2013-04-11 at 8:38 am</a></em>  <cite><a href='http://blog.artlogic.com/2013/04/11/some-future-concurrency-in-c14/' rel='external nofollow' class='url'>Some Future Concurrency in C++14 | Art &amp; Logic Blog</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_9139"></div><p>[&#8230;] over adding keywords. Herb Sutter has described C++14 as an incremental update to C++11 as &#8220;the delta from 11 is pretty small but with a number of convenient fit-and-finish tidy-ups&amp;#82&#8230;, so maybe that indicates sweeping changes like this won&#8217;t get far in [&#8230;]</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 highlander-comment" id="comment-9096">
		<div id="div-comment-9096">
		<div class="cmtinfo"><em> on <a href="#comment-9096" title="">2013-04-10 at 10:02 am</a></em> <img alt='' src='https://0.gravatar.com/avatar/9391e103ae101e1b5a93da735c0fd0f7?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>Arne Mertz</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_9096"></div><p>@Herb I don&#8217;t want to change anything, just was wondering about the line in your code:</p>
<p>the_instance = call_once( create, /* initialization, most conveniently with a lambda */ );</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-herbsutter bypostauthor odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-9095">
		<div id="div-comment-9095">
		<div class="cmtinfo"><em> on <a href="#comment-9095" title="">2013-04-10 at 10:01 am</a></em> <img alt='' src='https://0.gravatar.com/avatar/c0ba56bfd231f8f04feb057728975181?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://www.herbsutter.com' rel='external nofollow' class='url'>Herb Sutter</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_9095"></div><p>PS &#8211; I never understood the comments that asked for a terser notation. It&#8217;s seven (7) characters: [&amp;]{ followed by }() .</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-herbsutter bypostauthor even thread-even depth-1 highlander-comment" id="comment-9093">
		<div id="div-comment-9093">
		<div class="cmtinfo"><em> on <a href="#comment-9093" title="">2013-04-10 at 9:57 am</a></em> <img alt='' src='https://0.gravatar.com/avatar/c0ba56bfd231f8f04feb057728975181?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://www.herbsutter.com' rel='external nofollow' class='url'>Herb Sutter</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_9093"></div><p>@Arne: What would you like to change? That signature accepts call_once( flag, []{ &#8230;my lambda&#8230; } ); right? std::async is the same.</p>
<p>@Jon: It can be made fast. Certainly you can do DCL, which is an atomic load (generally cheap). And before thread-safe init for function local statics was adopted, Google showed the committee a cool algorithm to do it cheaply on the fast path and promised to make the algorithm freely available for this purpose, which is what convinced the committee to adopt it as I recall. I can hunt it up in the papers but don&#8217;t have a link offhand.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-9071">
		<div id="div-comment-9071">
		<div class="cmtinfo"><em> on <a href="#comment-9071" title="">2013-04-09 at 5:53 pm</a></em> <img alt='' src='https://2.gravatar.com/avatar/2f91e7ffad34f35c3d035838acf156ac?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>Jon</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_9071"></div><p>@Herb, Does the first singleton example you posted imply a memory barrier? If instance() is performance-critical for subsequent calls, would an alternative be to ensure the calculation is done at startup instead of on-demand?</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 highlander-comment" id="comment-9066">
		<div id="div-comment-9066">
		<div class="cmtinfo"><em> on <a href="#comment-9066" title="">2013-04-09 at 8:28 am</a></em> <img alt='' src='https://0.gravatar.com/avatar/9391e103ae101e1b5a93da735c0fd0f7?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>Arne Mertz</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_9066"></div><p>Thanks for the enlightenment about thread safety &#8211; one question to the call_once, though: As far as I can see in N3337, there is only void call_once(once_flag&amp;, Callable, Args&amp;&amp;&#8230;) &#8211; is that going to change?</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-herbsutter bypostauthor odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-9042">
		<div id="div-comment-9042">
		<div class="cmtinfo"><em> on <a href="#comment-9042" title="">2013-04-08 at 10:39 am</a></em> <img alt='' src='https://0.gravatar.com/avatar/c0ba56bfd231f8f04feb057728975181?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://www.herbsutter.com' rel='external nofollow' class='url'>Herb Sutter</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_9042"></div><p>@Arne: No, that doesn&#8217;t work. You only get automatically thread-safe initialization for *function local* statics, not for all statics because that would incur expense on a lot of code that doesn&#8217;t need it. This is described in 3.6.2/2 for those following along in the standard. The standard way to write thread-safe initialization of statics or lazy initialization, if you&#8217;re not using function local statics, is to use once_flag and call_once.</p>
<p>So for example you can do a singleton as:</p>
<p>// preferred unless you need fanciness like a phoenix singleton<br />
singleton&amp; singleton::instance() {<br />
    static singleton the_instance = /* arbitrarily complex init, most conveniently in a lambda */;<br />
    return the_instance;<br />
}</p>
<p>or as:</p>
<p>// good but usually a verbose way to accomplish the same as the above<br />
singleton { static once_flag create; static instance* the_instance; &#8230; };<br />
singleton&amp; singleton::instance() {<br />
    the_instance = call_once( create, /* initialization, most conveniently with a lambda */ );<br />
    return *the_instance;<br />
}</p>
<p>or using Double-Checked Locking using a mutex and an atomic but that&#8217;s sort of the old-school way once_flag and call_once are designed to replace.</p>
<p>Or another way but those are the three common variants.</p>
<p>Herb</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 highlander-comment" id="comment-9039">
		<div id="div-comment-9039">
		<div class="cmtinfo"><em> on <a href="#comment-9039" title="">2013-04-08 at 5:22 am</a></em> <img alt='' src='https://0.gravatar.com/avatar/987a361bbae718463026e16198112d5c?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>Umar Nizamani</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_9039"></div><p>What i tend to do to avoid such problems is keep such values of i under limited scope.. so basically:</p>
<p>{<br />
  int i;<br />
  if(someConditionIstrue)<br />
  {<br />
    Do some operations and calculate the value of i;<br />
    i = some calculated value;<br />
  } </p>
<p>  // Do what ever you want to do with i<br />
} // Close scope, and forget about i</p>
<p>Obviously not the ideal solution, but helps keep code clean, and variables managed..</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-9035">
		<div id="div-comment-9035">
		<div class="cmtinfo"><em> on <a href="#comment-9035" title="">2013-04-08 at 2:57 am</a></em> <img alt='' src='https://0.gravatar.com/avatar/cac80a1bc8cad14105906965b75da2d3?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>Simon A Watts</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_9035"></div><p>This expensive-lazy-initialisation is quite frequent in the legacy code bases I&#8217;ve dealt with (a slight improvement over repeated-initialisation &#8211; obviously there to absorb excess processing capacity).</p>
<p>Where the thing to be initialised is a global computed constant, as opposed, say, a constant for an object instance, I usually extract it to a static with an initialising function, such as:</p>
<p>namespace { // anonymous<br />
    int once_calculate_i_ () { /* &#8230; */ }<br />
} </p>
<p>void foo ()<br />
{<br />
    static const int i= once_calculate_i_ ();<br />
    // &#8230;<br />
}</p>
<p>I don&#8217;t see an advantage in using a lambda here (and we&#8217;re unlikely to see C++11 compilers adopted for 10 years if past record is maintained &#8211; there are reasons for this in my domain).</p>
<p>I would still want to see the intent of the calculation documented, which is better handled when it is expressed as a separate function.  Without documentation of intent, we have to infer intent from the implementation, which is not necessarily the same thing&#8230; Poor documentation is a bane of maintaining long-term code bases, and I prefer to leave my future incarnates something more manageable.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 highlander-comment" id="comment-9034">
		<div id="div-comment-9034">
		<div class="cmtinfo"><em> on <a href="#comment-9034" title="">2013-04-08 at 12:58 am</a></em> <img alt='' src='https://1.gravatar.com/avatar/4a59f4cd03434f47f75e395536eda686?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>Philip</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_9034"></div><p>I love it!</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-9032">
		<div id="div-comment-9032">
		<div class="cmtinfo"><em> on <a href="#comment-9032" title="">2013-04-07 at 11:22 pm</a></em> <img alt='' src='https://2.gravatar.com/avatar/2f91e7ffad34f35c3d035838acf156ac?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>Jon</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_9032"></div><p>@Lachlan: I should clarify that a single instance of LazyInitialize may be shared by zero or many clients of the object. expensive_calculation() should only be called when the first client needs it.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 highlander-comment" id="comment-9031">
		<div id="div-comment-9031">
		<div class="cmtinfo"><em> on <a href="#comment-9031" title="">2013-04-07 at 11:16 pm</a></em> <img alt='' src='https://i0.wp.com/graph.facebook.com/100000473926926/picture?q=type%3Dlarge%26_md5%3D6c0aefa657dd45f654ea1d90d2867686&#038;resize=48%2C48' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://www.facebook.com/lachlan.easton' rel='external nofollow' class='url'>Lachlan Brad Easton</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_9031"></div><p>@Jon: In cases where it doesn&#8217;t make sense for value to be static then you could call expensive_calculation in LazyInitialize&#8217;s constructor.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-9024">
		<div id="div-comment-9024">
		<div class="cmtinfo"><em> on <a href="#comment-9024" title="">2013-04-07 at 5:38 pm</a></em> <img alt='' src='https://2.gravatar.com/avatar/2f91e7ffad34f35c3d035838acf156ac?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>Jon</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_9024"></div><p>How can we solve something like this?</p>
<p>class LazyInitialize<br />
{<br />
public:<br />
	int get_value() {if (value not calculated yet) {value = expensive_calculation();} return value;}<br />
private:<br />
	const_once int value;<br />
};</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="pingback even thread-even depth-1 highlander-comment" id="comment-9016">
		<div id="div-comment-9016">
		<div class="cmtinfo"><em> on <a href="#comment-9016" title="">2013-04-07 at 6:39 am</a></em>  <cite><a href='http://sysdev.me/constant-variable-initialisation/' rel='external nofollow' class='url'>Инициализация константных переменных | System Development</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_9016"></div><p>[&#8230;] P.S. подсмотренно у Саттера. [&#8230;]</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-9015">
		<div id="div-comment-9015">
		<div class="cmtinfo"><em> on <a href="#comment-9015" title="">2013-04-07 at 6:26 am</a></em> <img alt='' src='https://0.gravatar.com/avatar/ca391c038b300a739462dae91c5e8cbc?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>Adrian</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_9015"></div><p>The lambda solution seems appropriate for some situations, but it&#8217;s not clear that it addresses the original question.</p>
<p>The original question didn&#8217;t have a default value and only conditionally initializes the variable.  The lambda solution doesn&#8217;t do the same thing, since it always initializes the variable regardless of the condition.</p>
<p>When I first read the question, I wondered if the intent was that i was actually a member variable (or at least persistent beyond the scope suggested), and the intent was to initialize it the first time SomeCondition was true and then never to change it again after that.  In that case, the idea of &#8220;const once&#8221; seems useful.</p>
<p>For example, if i was a function static, the intent might be to initialize i the first time the function is called and the condition is true, and never to change i again after that.  (And also to let i remain uninitialized until that first call with the condition being true.)</p>
<p>Otherwise, you could just write:</p>
<p>const int i = (someCondition) ? calc() : default_value;</p>
<p>This is going to be recognized by all C and C++ programmers, even those not versed in lambdas.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 highlander-comment" id="comment-9009">
		<div id="div-comment-9009">
		<div class="cmtinfo"><em> on <a href="#comment-9009" title="">2013-04-07 at 1:20 am</a></em> <img alt='' src='https://0.gravatar.com/avatar/9391e103ae101e1b5a93da735c0fd0f7?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>Arne Mertz</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_9009"></div><p>@Herb: I think what Bruno means with statics is something like this:<br />
//header<br />
struct C {<br />
  static int i;<br />
};<br />
//source<br />
int C::i = [](){ return (std::time(nullptr) % 2) ? 42 : 4711; }();</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-9007">
		<div id="div-comment-9007">
		<div class="cmtinfo"><em> on <a href="#comment-9007" title="">2013-04-06 at 11:48 pm</a></em> <img alt='' src='https://1.gravatar.com/avatar/107fafc1be9639d836e67e2e73366afa?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>petke</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_9007"></div><p>I known about it, but don&#8217;t end up using it. Its still too verbose.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="pingback even thread-even depth-1 highlander-comment" id="comment-9006">
		<div id="div-comment-9006">
		<div class="cmtinfo"><em> on <a href="#comment-9006" title="">2013-04-06 at 11:08 pm</a></em> <img alt='' src='https://okpanico.files.wordpress.com/2018/08/okp.png?w=48' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://okpanico.wordpress.com/2013/04/07/visto-nel-web-73/' rel='external nofollow' class='url'>Visto nel Web &#8211; 73 | Ok, panico</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_9006"></div><p>[&#8230;] Complex initialization for a const variable ::: Sutter&#8217;s Mill [&#8230;]</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-herbsutter bypostauthor odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-9000">
		<div id="div-comment-9000">
		<div class="cmtinfo"><em> on <a href="#comment-9000" title="">2013-04-06 at 4:32 pm</a></em> <img alt='' src='https://0.gravatar.com/avatar/c0ba56bfd231f8f04feb057728975181?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://www.herbsutter.com' rel='external nofollow' class='url'>Herb Sutter</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_9000"></div><p>I agree with the reasons given why this is better than extracting a named helper function that is only used here: the lambda has better locality, is arguably more readable, and lets you use other locals directly without passing references to an artificially outlined function. I also agree that it&#8217;s better than &#8220;const int&amp; i = temp_i;&#8221; which is less direct and also has the drawback that temp_i stays in scope.</p>
<p>@Bruno: How does this help with statics?</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-herbsutter bypostauthor even thread-even depth-1 highlander-comment" id="comment-8996">
		<div id="div-comment-8996">
		<div class="cmtinfo"><em> on <a href="#comment-8996" title="">2013-04-06 at 1:43 pm</a></em> <img alt='' src='https://0.gravatar.com/avatar/c0ba56bfd231f8f04feb057728975181?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://www.herbsutter.com' rel='external nofollow' class='url'>Herb Sutter</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_8996"></div><p>@Andrzej: Right, but I&#8217;ll let it stand. The committee has already pretty much agreed that this should be allowed (which is why our compiler also already supports it, and with GCC and Clang that would make it de facto portable), and this extension is likely to be voted into the C++ working paper soon (this month, or September). I&#8217;ll go out on a limb and say that if anything is a slam dunk for C++14, it would seem that this is. And it truly should just work.</p>
<p>Incidentally, this is one reason why I think I&#8217;ll write Exceptional C++14&#8230; 14 is so close to done (we hope to technically finalize it in September of this year), and the delta from 11 is pretty small but with a number of convenient fit-and-finish tidy-ups like this one.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-8994">
		<div id="div-comment-8994">
		<div class="cmtinfo"><em> on <a href="#comment-8994" title="">2013-04-06 at 10:41 am</a></em> <img alt='' src='https://i1.wp.com/graph.facebook.com/774020553/picture?q=type%3Dlarge%26_md5%3D67bba65b53485b5b0f318c033ca29454&#038;resize=48%2C48' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://www.facebook.com/bruno.uy' rel='external nofollow' class='url'>Bruno Martínez</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_8994"></div><p>The same trick lets you declare static vars so that the initialization is done only once and thread safely.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-akrzemi1 even thread-even depth-1 highlander-comment" id="comment-8990">
		<div id="div-comment-8990">
		<div class="cmtinfo"><em> on <a href="#comment-8990" title="">2013-04-06 at 5:51 am</a></em> <img alt='' src='https://0.gravatar.com/avatar/c3baf4aa5bebf6d1407ed4e3b0981864?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://akrzemi1.wordpress.com' rel='external nofollow' class='url'>Andrzej Krzemieński</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_8990"></div><p>@Herb: While your example compiles in g++4.7, 4.8 and Clang 3.2, I believe it is not a valid C++11 code. According to sect 5.1.2 para 4, when the body of the lambda is not a simple return statement its deduced return type is void. While the expectation that this example would work is logical, and likely acceptable in C++14, C++11 seems to refuse it.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-8981">
		<div id="div-comment-8981">
		<div class="cmtinfo"><em> on <a href="#comment-8981" title="">2013-04-06 at 3:19 am</a></em> <img alt='' src='https://2.gravatar.com/avatar/2b172b8b387b433389493ef8d24a2cff?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>Cedric</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_8981"></div><p>constexpr keyword has been added for this purpose isn&#8217;t it? Using a named constexpr function is a good way to achieve the result.<br />
Even if it adds a name in the symbol space, it could (it should in fact) be a private function within the class we&#8217;re working in.</p>
<p>Though, I admit that the lambda solution is a nice one I too.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 highlander-comment" id="comment-8980">
		<div id="div-comment-8980">
		<div class="cmtinfo"><em> on <a href="#comment-8980" title="">2013-04-06 at 2:52 am</a></em> <img alt='' src='https://0.gravatar.com/avatar/cf496f25743da44837cd0e7824aaa20f?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://blog.csdn.net/justme0' rel='external nofollow' class='url'>Gang Jiang</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_8980"></div><p>The function is similar to the reserved word &#8220;readonly&#8221; in C#? We can reference .NET to achieve it.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-8979">
		<div id="div-comment-8979">
		<div class="cmtinfo"><em> on <a href="#comment-8979" title="">2013-04-06 at 2:40 am</a></em> <img alt='' src='https://0.gravatar.com/avatar/9391e103ae101e1b5a93da735c0fd0f7?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>Arne Mertz</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_8979"></div><p>While technically the lambda is a good solution and may have its applications for initializations, in this case I&#8217;d as well recommend using a separate function. When the main task of a function is to *use* i, then the SRP demands separating the calculation of the initial value of i from the function. That way the main logic of the function is not interrupted and cluttered with a multiline lambda containing the lower level logic of the constant&#8217;s calculation.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-mjklaim even thread-even depth-1 highlander-comment" id="comment-8978">
		<div id="div-comment-8978">
		<div class="cmtinfo"><em> on <a href="#comment-8978" title="">2013-04-06 at 12:30 am</a></em> <img alt='' src='https://1.gravatar.com/avatar/18c4b79a7fd7e606866246ff5991c7eb?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>mjklaim</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_8978"></div><p>@Arthur Langereis</p>
<p>You are hiding the verbosity of the lambda in the ellipse.<br />
If you need a lambda in this context, you will certainly do at least some kind of branching, which mean for clarity your lambda will not be a one-liner. You can use terse if syntax but then there is no need for a lambda.</p>
<p>With a named function, if your code looks like it&#8217;s noise in the middle of the code which use the constant, at least the code is out of the scope.<br />
Which is a problem as you pointed, which is why I think a lambda is still better even if it looks like noise at first.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-8969">
		<div id="div-comment-8969">
		<div class="cmtinfo"><em> on <a href="#comment-8969" title="">2013-04-05 at 11:47 pm</a></em> <img alt='' src='https://2.gravatar.com/avatar/e7bb87ac95a4978a35574ffc122886c7?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>Ternary</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_8969"></div><p>Or, in this simple case, you could just use the ternary operator:<br />
    const int i = someCondition ? calculatedValue : defaultValue;</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 highlander-comment" id="comment-8967">
		<div id="div-comment-8967">
		<div class="cmtinfo"><em> on <a href="#comment-8967" title="">2013-04-05 at 9:45 pm</a></em> <img alt='' src='https://0.gravatar.com/avatar/356f224f8064560453632cf205b98d26?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://www.cogitolearning.co.uk' rel='external nofollow' class='url'>Cogito</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_8967"></div><p>@bsivko I like that solution. It was the one that immediately came to my mind as well. The only downside is that init_i is not scoped.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-8966">
		<div id="div-comment-8966">
		<div class="cmtinfo"><em> on <a href="#comment-8966" title="">2013-04-05 at 7:57 pm</a></em> <img alt='' src='https://0.gravatar.com/avatar/3df85ade91aada27414d76949dd19edf?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://gravatar.com/bsivko' rel='external nofollow' class='url'>bsivko</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_8966"></div><p>One more way:</p>
<p>	int init_i;<br />
	if(someConditionIstrue)<br />
	{<br />
		Do some operations and calculate the value of i;<br />
		init_i = some calculated value;<br />
	}<br />
	const int &amp; i = init_i;</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 highlander-comment" id="comment-8960">
		<div id="div-comment-8960">
		<div class="cmtinfo"><em> on <a href="#comment-8960" title="">2013-04-05 at 5:23 pm</a></em> <img alt='' src='https://1.gravatar.com/avatar/d68c3f3a71f3a8f913861d98776e3528?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>sdeetee</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_8960"></div><p>Hey, I just learned about these things called &#8220;immediately-invoked function expressions&#8221; in JavaScript last week :).</p>
<p><a href="http://en.m.wikipedia.org/wiki/Immediately-invoked_function_expression" rel="nofollow">http://en.m.wikipedia.org/wiki/Immediately-invoked_function_expression</a></p>
<p>It&#8217;s neat that they have different but overlapping uses in C++. C++ doesn&#8217;t quite have the scoping issues as JavaScript, but they can be used for some similar scenarios to those mentioned in the Wikipedia page above.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-tatourian odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-8959">
		<div id="div-comment-8959">
		<div class="cmtinfo"><em> on <a href="#comment-8959" title="">2013-04-05 at 3:27 pm</a></em> <img alt='' src='https://1.gravatar.com/avatar/d744a420a38a8426a670ce072f42313b?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://tatourian.wordpress.com' rel='external nofollow' class='url'>Alan Tatourian</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_8959"></div><p>Would it not be better to encapsulate i into an immutable object?</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 highlander-comment" id="comment-8957">
		<div id="div-comment-8957">
		<div class="cmtinfo"><em> on <a href="#comment-8957" title="">2013-04-05 at 2:29 pm</a></em> <img alt='' src='https://1.gravatar.com/avatar/d1dce1a560e7377db5e1ede628df8ffd?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>Arthur Langereis</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_8957"></div><p>To mjklaim, why do you feel:</p>
<p>const int i = [&amp;]{ … }();</p>
<p>is more verbose than something like:</p>
<p>static int calcI() { … }<br />
…<br />
const int i = calcI();</p>
<p>To Johannes, In addition to not needing a name and being unique as mjklaim points out, a lambda can use scoped variables and is defined and used at the site where it is needed, making a lambda a superior choice to a non-member function in this case. Given the syntactic and semantic needs of C++, I think the current lambda notation is quite compact and the upcoming upgrades for it will only make it more seamless.</p>
<p>A statement like</p>
<p>const int i = [&amp;] …expression…;</p>
<p>is more terse but if you only have a single expression it won&#8217;t make sense to use a lambda in this case. How would you like to see the the construction formed? (Using wished-for C++ language changes, if necessary)</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-8956">
		<div id="div-comment-8956">
		<div class="cmtinfo"><em> on <a href="#comment-8956" title="">2013-04-05 at 2:28 pm</a></em> <img alt='' src='https://0.gravatar.com/avatar/3487ce6ed9ec277bac79a838537b46a8?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://gravatar.com/seharris' rel='external nofollow' class='url'>Steven Harris</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_8956"></div><p>The one that always troubles me is initializing two or more variables that I&#8217;d like to all be const, where their values depend on some condition that I&#8217;d prefer to only evaluate once.</p>
<p>std::string/* const */ host;<br />
unsigned int/* const*/ port;<br />
if (something) {<br />
  host = &#8220;alpha&#8221;;<br />
  port = 119;<br />
} else {<br />
  host = &#8220;omega&#8221;;<br />
  port = 563;<br />
}</p>
<p>The only solution I know is to wrap the related variables up in struct and write a helper function that returns an instance with the proper values base on the condition.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-mjklaim even thread-even depth-1 highlander-comment" id="comment-8954">
		<div id="div-comment-8954">
		<div class="cmtinfo"><em> on <a href="#comment-8954" title="">2013-04-05 at 12:39 pm</a></em> <img alt='' src='https://1.gravatar.com/avatar/18c4b79a7fd7e606866246ff5991c7eb?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>mjklaim</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_8954"></div><p>The problem with named functions is that they have a name, so they can be used more than once.<br />
When it is not the intention, it is a problem. Using a lambda makes it clear that there should be only one unique specifically located use.</p>
<p>Unfortunately it&#8217;s more verbose than using a named function, which can be fixed with a simpler notation.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-8953">
		<div id="div-comment-8953">
		<div class="cmtinfo"><em> on <a href="#comment-8953" title="">2013-04-05 at 11:26 am</a></em> <img alt='' src='https://0.gravatar.com/avatar/02ef2a1efc25a8c5cdfb0b0a68b89997?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>Johannes Ohlemacher</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_8953"></div><p>Whats wrong with a simple helper function?<br />
I think, in most cases a named function is a more readable solution to the problem (especially in respect of self documenting code). </p>
<p>int calculateValue() { //choose a more descriptive name<br />
  if (!someCondition)<br />
    return default_value;</p>
<p>  //Do some operations and calculate the value<br />
  return value;<br />
}</p>
<p>&#8230;.</p>
<p>const int i = calculateValue();<br />
use i;</p>
<p>things might get messy if the helper function need lots of arguments&#8230;</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 highlander-comment" id="comment-8952">
		<div id="div-comment-8952">
		<div class="cmtinfo"><em> on <a href="#comment-8952" title="">2013-04-05 at 11:12 am</a></em> <img alt='' src='https://0.gravatar.com/avatar/096bda3427f9b6be5ce34eb8232618b2?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>Concerned C++ Programmer</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_8952"></div><p>I&#8217;m sure all these things will become clear once Ambassador Soval gets around to finishing off his next edition.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-8951">
		<div id="div-comment-8951">
		<div class="cmtinfo"><em> on <a href="#comment-8951" title="">2013-04-05 at 11:05 am</a></em> <img alt='' src='https://0.gravatar.com/avatar/94ba2f0bb02c92d0d5c4dbeb5e7ef1f4?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://gravatar.com/rtisumant' rel='external nofollow' class='url'>Sumant Tambe</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_8951"></div><p>I get the point but I seriously doubt if it is an advantage. It is not much different from calling a named function. If the complex calculation has a name I would a create a function with that name and call it with the necessary parameters. It is more explicit, well-understood, reusable, and more portable. You could also use the ternery operator: const int i = (condition) ? complex_func(args) : some_default_value; With a lambda, you are saving creating a function and jumping to that part of the code. It is not modular, however. With a function, you can use that same logic in more places if you need to. I would not copy-paste the lambda. Any day, I would prefer to reduce the number braces I&#8217;ve to keep track of. lambdas add braces and a sneaky pair of parenthesis at the end.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-mjklaim even thread-even depth-1 highlander-comment" id="comment-8950">
		<div id="div-comment-8950">
		<div class="cmtinfo"><em> on <a href="#comment-8950" title="">2013-04-05 at 10:24 am</a></em> <img alt='' src='https://1.gravatar.com/avatar/18c4b79a7fd7e606866246ff5991c7eb?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>mjklaim</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_8950"></div><p>I&#8217;ve used this idiom from the beginning and it is indeed powerful.<br />
However, it&#8217;s still verbose compared to the initial code, so I hope more terse notations (and automatic generalization) will get in the standard ASAP.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
	</ol>

	<div class="navigation">
		<div class="alignleft"></div>
		<div class="alignright"></div>
	</div>
	<br />

  	<p class="nocomments">Comments are closed.</p>
  <div class="post-content">
<p>
</p>
</div>

			</div>

		
		<p align="center"></p>

	</div><!-- end id:content-main -->
<div id="sidebar">
<ul>
<li class="sidebox"><h2><label for="subscribe-field">Follow by email</label></h2>
				<form action="https://subscribe.wordpress.com" method="post" accept-charset="utf-8" id="subscribe-blog">
																	<p><input type="text" name="email" style="width: 95%; padding: 1px 2px" placeholder="Enter your email address" value="" id="subscribe-field"/></p>
					
					<p>
						<input type="hidden" name="action" value="subscribe"/>
						<input type="hidden" name="blog_id" value="3379246"/>
						<input type="hidden" name="source" value="https://herbsutter.com/2013/04/05/complex-initialization-for-a-const-variable/"/>
						<input type="hidden" name="sub-type" value="widget"/>
						<input type="hidden" name="redirect_fragment" value="blog_subscription-3" />
						<input type="hidden" id="_wpnonce" name="_wpnonce" value="4590924cc6" />						<input type="submit" value="Subscribe" />
					</p>
				</form>
			
</li><li class="sidebox"><h2><a href='http://twitter.com/herbsutter'>Tweets</a></h2><ul class='tweets'></ul><a href="http://twitter.com/herbsutter"  class='twitter-follow-button' data-show-count='false' data-link-color='#265e15' data-text-color='#333333'>Follow @herbsutter</a></li><li class="sidebox"><h2>Popular</h2><ul>				<li>
										<a href="https://herbsutter.com/2018/11/13/trip-report-fall-iso-c-standards-meeting-san-diego/" class="bump-view" data-bump-view="tp">
						Trip report: Fall ISO C++ standards meeting (San Diego)					</a>
										</li>
								<li>
										<a href="https://herbsutter.com/gotw/" class="bump-view" data-bump-view="tp">
						GotW					</a>
										</li>
								<li>
										<a href="https://herbsutter.com/2018/09/20/lifetime-profile-v1-0-posted/" class="bump-view" data-bump-view="tp">
						Lifetime profile v1.0 posted					</a>
										</li>
				</ul></li><li class="sidebox"><h2>Categories</h2>		<ul>
				<li class="cat-item cat-item-291"><a href="https://herbsutter.com/category/apple/" >Apple</a>
</li>
	<li class="cat-item cat-item-49277"><a href="https://herbsutter.com/category/c-net/" >C# / .NET</a>
</li>
	<li class="cat-item cat-item-2426"><a href="https://herbsutter.com/category/c/" >C++</a>
</li>
	<li class="cat-item cat-item-69816"><a href="https://herbsutter.com/category/cloud/" >Cloud</a>
</li>
	<li class="cat-item cat-item-214618"><a href="https://herbsutter.com/category/concurrency/" >Concurrency</a>
</li>
	<li class="cat-item cat-item-8259773"><a href="https://herbsutter.com/category/effective-concurrency/" >Effective Concurrency</a>
</li>
	<li class="cat-item cat-item-3696745"><a href="https://herbsutter.com/category/friday-thoughts/" >Friday Thoughts</a>
</li>
	<li class="cat-item cat-item-3867746"><a href="https://herbsutter.com/category/c/gotw/" >GotW</a>
</li>
	<li class="cat-item cat-item-79"><a href="https://herbsutter.com/category/hardware/" >Hardware</a>
</li>
	<li class="cat-item cat-item-1017"><a href="https://herbsutter.com/category/java/" >Java</a>
</li>
	<li class="cat-item cat-item-637"><a href="https://herbsutter.com/category/microsoft/" >Microsoft</a>
</li>
	<li class="cat-item cat-item-420845"><a href="https://herbsutter.com/category/opinion-editorial/" >Opinion &amp; Editorial</a>
</li>
	<li class="cat-item cat-item-1633077"><a href="https://herbsutter.com/category/reader-qa/" >Reader Q&amp;A</a>
</li>
	<li class="cat-item cat-item-2301"><a href="https://herbsutter.com/category/software-development/" >Software Development</a>
</li>
	<li class="cat-item cat-item-393523"><a href="https://herbsutter.com/category/talks-events/" >Talks &amp; Events</a>
</li>
	<li class="cat-item cat-item-1"><a href="https://herbsutter.com/category/uncategorized/" >Uncategorized</a>
</li>
	<li class="cat-item cat-item-151"><a href="https://herbsutter.com/category/web/" >Web</a>
</li>
		</ul>
			</li></ul>
</div><!-- end id:sidebar -->
</div><!-- end id:content -->
</div><!-- end id:container -->
<div id="footer">
	<div id="colophon">
		<p><a href="https://wordpress.com/?ref=footer_blog">Blog at WordPress.com.</a></p>
		<p>WPThemes.</p>
		<br class="clear" />
	</div><!-- end #colophon-->
</div><!-- end #footer-->
<!--  -->
<script type='text/javascript' src='//0.gravatar.com/js/gprofiles.js?ver=201847y'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var WPGroHo = {"my_hash":""};
/* ]]> */
</script>
<script type='text/javascript' src='https://s1.wp.com/wp-content/mu-plugins/gravatar-hovercards/wpgroho.js?m=1380573781h'></script>

	<script>
		//initialize and attach hovercards to all gravatars
		jQuery( document ).ready( function( $ ) {

			if (typeof Gravatar === "undefined"){
				return;
			}

			if ( typeof Gravatar.init !== "function" ) {
				return;
			}			

			Gravatar.profile_cb = function( hash, id ) {
				WPGroHo.syncProfileData( hash, id );
			};
			Gravatar.my_hash = WPGroHo.my_hash;
			Gravatar.init( 'body', '#wp-admin-bar-my-account' );
		});
	</script>

		<div style="display:none">
	<div class="grofile-hash-map-5b9c77c615dd73a0147551a602dd04e9">
	</div>
	<div class="grofile-hash-map-94be0564577cafb528191cdb811759a0">
	</div>
	<div class="grofile-hash-map-8df2c9fb8dc016dcdce04b633ba9a6b4">
	</div>
	<div class="grofile-hash-map-3487ce6ed9ec277bac79a838537b46a8">
	</div>
	<div class="grofile-hash-map-c0ba56bfd231f8f04feb057728975181">
	</div>
	<div class="grofile-hash-map-880ead04f1404959e6b36539e701a830">
	</div>
	<div class="grofile-hash-map-9391e103ae101e1b5a93da735c0fd0f7">
	</div>
	<div class="grofile-hash-map-2f91e7ffad34f35c3d035838acf156ac">
	</div>
	<div class="grofile-hash-map-987a361bbae718463026e16198112d5c">
	</div>
	<div class="grofile-hash-map-cac80a1bc8cad14105906965b75da2d3">
	</div>
	<div class="grofile-hash-map-4a59f4cd03434f47f75e395536eda686">
	</div>
	<div class="grofile-hash-map-80ef658c3b540a9c26fed414c89a9b06">
	</div>
	<div class="grofile-hash-map-ca391c038b300a739462dae91c5e8cbc">
	</div>
	<div class="grofile-hash-map-107fafc1be9639d836e67e2e73366afa">
	</div>
	<div class="grofile-hash-map-d50725477c532d3a972760f317cc169f">
	</div>
	<div class="grofile-hash-map-c3baf4aa5bebf6d1407ed4e3b0981864">
	</div>
	<div class="grofile-hash-map-2b172b8b387b433389493ef8d24a2cff">
	</div>
	<div class="grofile-hash-map-cf496f25743da44837cd0e7824aaa20f">
	</div>
	<div class="grofile-hash-map-18c4b79a7fd7e606866246ff5991c7eb">
	</div>
	<div class="grofile-hash-map-e7bb87ac95a4978a35574ffc122886c7">
	</div>
	<div class="grofile-hash-map-356f224f8064560453632cf205b98d26">
	</div>
	<div class="grofile-hash-map-3df85ade91aada27414d76949dd19edf">
	</div>
	<div class="grofile-hash-map-d68c3f3a71f3a8f913861d98776e3528">
	</div>
	<div class="grofile-hash-map-d744a420a38a8426a670ce072f42313b">
	</div>
	<div class="grofile-hash-map-d1dce1a560e7377db5e1ede628df8ffd">
	</div>
	<div class="grofile-hash-map-02ef2a1efc25a8c5cdfb0b0a68b89997">
	</div>
	<div class="grofile-hash-map-096bda3427f9b6be5ce34eb8232618b2">
	</div>
	<div class="grofile-hash-map-94ba2f0bb02c92d0d5c4dbeb5e7ef1f4">
	</div>
	</div>
<script type='text/javascript' charset='UTF-8' id='polldaddyRatings'><!--//--><![CDATA[//><!--
PDRTJS_settings_468178_comm_9822={"id":468178,"unique_id":"wp-comment-9822","title":"Wouldn%26%23039%3Bt%20it%20be%20easier%20to%20just%20introduce%20the%20%26quot%3Bfinal%26quot%3B%20C%23%20keyword%20in%20C%2B%2B%3F...","permalink":"https:\/\/herbsutter.com\/2013\/04\/05\/complex-initialization-for-a-const-variable\/#comment-9822","item_id":"_comm_9822"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_9822 == 'undefined' ){PDRTJS_468178_comm_9822 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_9822 );}}PDRTJS_settings_468178_comm_9649={"id":468178,"unique_id":"wp-comment-9649","title":"Yes%2C%20as%20sdeetee%20pointed%20out%2C%20this%20is%20very%20similar%20to%20a%20construct%20used%20in%20Javascript%20to%20create%20an%20object%2C%20immediately%20call%20it%20and%20use%20the%20return%20value%20from%20it.%20%20in%20javascript%20it%20is%20often%20used%20as%20a...","permalink":"https:\/\/herbsutter.com\/2013\/04\/05\/complex-initialization-for-a-const-variable\/#comment-9649","item_id":"_comm_9649"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_9649 == 'undefined' ){PDRTJS_468178_comm_9649 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_9649 );}}PDRTJS_settings_468178_comm_9405={"id":468178,"unique_id":"wp-comment-9405","title":"C%2B%2B11%20lambdas%20give%20one%20the%20opportunity%20to%20think%20more%20JavaScript-y.%20Now%2C%20it%26%23039%3Bs%20up%20to%20you%20whether%20that%26%23039%3Bs%20actually%20good%20or%20bad....","permalink":"https:\/\/herbsutter.com\/2013\/04\/05\/complex-initialization-for-a-const-variable\/#comment-9405","item_id":"_comm_9405"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_9405 == 'undefined' ){PDRTJS_468178_comm_9405 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_9405 );}}PDRTJS_settings_468178_comm_9169={"id":468178,"unique_id":"wp-comment-9169","title":"%26%23091%3B...%26%23093%3B%20Sutter%20provided%20this%20handy%20use%20of%20lambdas%20to%20initialise%20a%20const%20variable%20that%20needs%20some%20%26%23091%3B...%26%23093%3B...","permalink":"https:\/\/herbsutter.com\/2013\/04\/05\/complex-initialization-for-a-const-variable\/#comment-9169","item_id":"_comm_9169"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_9169 == 'undefined' ){PDRTJS_468178_comm_9169 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_9169 );}}PDRTJS_settings_468178_comm_9146={"id":468178,"unique_id":"wp-comment-9146","title":"As%20you%20mentioned%20Scala%2C%20I%20was%20going%20to%20point%20out%20in%20my%20original%20post%20that%20Java%20also%20accommodates%20this%20%28which%20may%20be%20what%20makes%20it%20possible%20for%20Scala%26%23039%3Bs%20compiler%20back%20end%29%20with%20its%20%26quot%3Bfinal%26quot%3B%20keyword....","permalink":"https:\/\/herbsutter.com\/2013\/04\/05\/complex-initialization-for-a-const-variable\/#comment-9146","item_id":"_comm_9146"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_9146 == 'undefined' ){PDRTJS_468178_comm_9146 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_9146 );}}PDRTJS_settings_468178_comm_9145={"id":468178,"unique_id":"wp-comment-9145","title":"%40Kaylyn%3A%20Hmm%2C%20which%20reminds%20me%20that%20you%20can%20always%20use%20a%20tuple%3Aconst%20tuple%20xy%20%3D%20%26%23091%3B%26amp%3B%26%23093%3B%7B%20%2F%2A%20initialize%20and%20return%20a%20tuple%20%2A%2F%20%7D%28%29%3Bor%20a%20struct%3Aconst%20struct%20xy_%20%7B%20int%20x%3B%20std%3A%3Astring%20y%3B%20%7D%20xy%20%3D%20%26%23091%3B%26amp%3B...","permalink":"https:\/\/herbsutter.com\/2013\/04\/05\/complex-initialization-for-a-const-variable\/#comment-9145","item_id":"_comm_9145"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_9145 == 'undefined' ){PDRTJS_468178_comm_9145 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_9145 );}}PDRTJS_settings_468178_comm_9143={"id":468178,"unique_id":"wp-comment-9143","title":"%40Steven%20Harris%3AIf%20they%20don%26%23039%3Bt%20have%20to%20be%20const%20you%20can%20unpack%20using%20std%3A%3Atie%3Aint%20x%3Bstd%3A%3Astring%20y%3Bstd%3A%3Atie%28x%2C%20y%29%20%3D%20SomeFunction%28%29%3B%20%2F%2F%20That%20returns%20std%3A%3AtupleI%20don%26%23039%3Bt%20think%20it%26%23039%3Bs%20possible%20in%20C%2B%2B%2C%20with...","permalink":"https:\/\/herbsutter.com\/2013\/04\/05\/complex-initialization-for-a-const-variable\/#comment-9143","item_id":"_comm_9143"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_9143 == 'undefined' ){PDRTJS_468178_comm_9143 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_9143 );}}PDRTJS_settings_468178_comm_9139={"id":468178,"unique_id":"wp-comment-9139","title":"%26%23091%3B...%26%23093%3B%20over%20adding%20keywords.%20Herb%20Sutter%20has%20described%20C%2B%2B14%20as%20an%20incremental%20update%20to%20C%2B%2B11%20as%20%26%238220%3Bthe%20delta%20from%2011%20is%20pretty%20small%20but%20with%20a%20number%20of%20convenient%20fit-and-finish%20tidy-ups%26amp%3Ba...","permalink":"https:\/\/herbsutter.com\/2013\/04\/05\/complex-initialization-for-a-const-variable\/#comment-9139","item_id":"_comm_9139"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_9139 == 'undefined' ){PDRTJS_468178_comm_9139 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_9139 );}}PDRTJS_settings_468178_comm_9096={"id":468178,"unique_id":"wp-comment-9096","title":"%40Herb%20I%20don%26%23039%3Bt%20want%20to%20change%20anything%2C%20just%20was%20wondering%20about%20the%20line%20in%20your%20code%3Athe_instance%20%3D%20call_once%28%20create%2C%20%2F%2A%20initialization%2C%20most%20conveniently%20with%20a%20lambda%20%2A%2F%20%29%3B...","permalink":"https:\/\/herbsutter.com\/2013\/04\/05\/complex-initialization-for-a-const-variable\/#comment-9096","item_id":"_comm_9096"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_9096 == 'undefined' ){PDRTJS_468178_comm_9096 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_9096 );}}PDRTJS_settings_468178_comm_9095={"id":468178,"unique_id":"wp-comment-9095","title":"PS%20-%20I%20never%20understood%20the%20comments%20that%20asked%20for%20a%20terser%20notation.%20It%26%23039%3Bs%20seven%20%287%29%20characters%3A%20%26%23091%3B%26amp%3B%26%23093%3B%7B%20followed%20by%20%7D%28%29%20....","permalink":"https:\/\/herbsutter.com\/2013\/04\/05\/complex-initialization-for-a-const-variable\/#comment-9095","item_id":"_comm_9095"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_9095 == 'undefined' ){PDRTJS_468178_comm_9095 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_9095 );}}PDRTJS_settings_468178_comm_9093={"id":468178,"unique_id":"wp-comment-9093","title":"%40Arne%3A%20What%20would%20you%20like%20to%20change%3F%20That%20signature%20accepts%20call_once%28%20flag%2C%20%26%23091%3B%26%23093%3B%7B%20...my%20lambda...%20%7D%20%29%3B%20right%3F%20std%3A%3Aasync%20is%20the%20same.%40Jon%3A%20It%20can%20be%20made%20fast.%20Certainly%20you%20can%20do%20DCL%2C%20which%20is%20...","permalink":"https:\/\/herbsutter.com\/2013\/04\/05\/complex-initialization-for-a-const-variable\/#comment-9093","item_id":"_comm_9093"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_9093 == 'undefined' ){PDRTJS_468178_comm_9093 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_9093 );}}PDRTJS_settings_468178_comm_9071={"id":468178,"unique_id":"wp-comment-9071","title":"%40Herb%2C%20Does%20the%20first%20singleton%20example%20you%20posted%20imply%20a%20memory%20barrier%3F%20If%20instance%28%29%20is%20performance-critical%20for%20subsequent%20calls%2C%20would%20an%20alternative%20be%20to%20ensure%20the%20calculation%20is%20done%20at...","permalink":"https:\/\/herbsutter.com\/2013\/04\/05\/complex-initialization-for-a-const-variable\/#comment-9071","item_id":"_comm_9071"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_9071 == 'undefined' ){PDRTJS_468178_comm_9071 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_9071 );}}PDRTJS_settings_468178_comm_9066={"id":468178,"unique_id":"wp-comment-9066","title":"Thanks%20for%20the%20enlightenment%20about%20thread%20safety%20-%20one%20question%20to%20the%20call_once%2C%20though%3A%20As%20far%20as%20I%20can%20see%20in%20N3337%2C%20there%20is%20only%20void%20call_once%28once_flag%26amp%3B%2C%20Callable%2C%20Args%26amp%3B%26amp%3B...%29%20-...","permalink":"https:\/\/herbsutter.com\/2013\/04\/05\/complex-initialization-for-a-const-variable\/#comment-9066","item_id":"_comm_9066"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_9066 == 'undefined' ){PDRTJS_468178_comm_9066 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_9066 );}}PDRTJS_settings_468178_comm_9042={"id":468178,"unique_id":"wp-comment-9042","title":"%40Arne%3A%20No%2C%20that%20doesn%26%23039%3Bt%20work.%20You%20only%20get%20automatically%20thread-safe%20initialization%20for%20%2Afunction%20local%2A%20statics%2C%20not%20for%20all%20statics%20because%20that%20would%20incur%20expense%20on%20a%20lot%20of%20code%20that%20doesn%26%23039%3B...","permalink":"https:\/\/herbsutter.com\/2013\/04\/05\/complex-initialization-for-a-const-variable\/#comment-9042","item_id":"_comm_9042"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_9042 == 'undefined' ){PDRTJS_468178_comm_9042 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_9042 );}}PDRTJS_settings_468178_comm_9039={"id":468178,"unique_id":"wp-comment-9039","title":"What%20i%20tend%20to%20do%20to%20avoid%20such%20problems%20is%20keep%20such%20values%20of%20i%20under%20limited%20scope..%20so%20basically%3A%7B%20%20int%20i%3B%20%20%20if%28someConditionIstrue%29%20%20%20%7B%20%20%20%20%20Do%20some%20operations%20and%20calculate%20the%20value%20of%20i%3B%20%20...","permalink":"https:\/\/herbsutter.com\/2013\/04\/05\/complex-initialization-for-a-const-variable\/#comment-9039","item_id":"_comm_9039"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_9039 == 'undefined' ){PDRTJS_468178_comm_9039 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_9039 );}}PDRTJS_settings_468178_comm_9035={"id":468178,"unique_id":"wp-comment-9035","title":"This%20expensive-lazy-initialisation%20is%20quite%20frequent%20in%20the%20legacy%20code%20bases%20I%26%23039%3Bve%20dealt%20with%20%28a%20slight%20improvement%20over%20repeated-initialisation%20-%20obviously%20there%20to%20absorb%20excess%20processing%20capa...","permalink":"https:\/\/herbsutter.com\/2013\/04\/05\/complex-initialization-for-a-const-variable\/#comment-9035","item_id":"_comm_9035"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_9035 == 'undefined' ){PDRTJS_468178_comm_9035 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_9035 );}}PDRTJS_settings_468178_comm_9034={"id":468178,"unique_id":"wp-comment-9034","title":"I%20love%20it%21...","permalink":"https:\/\/herbsutter.com\/2013\/04\/05\/complex-initialization-for-a-const-variable\/#comment-9034","item_id":"_comm_9034"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_9034 == 'undefined' ){PDRTJS_468178_comm_9034 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_9034 );}}PDRTJS_settings_468178_comm_9032={"id":468178,"unique_id":"wp-comment-9032","title":"%40Lachlan%3A%20I%20should%20clarify%20that%20a%20single%20instance%20of%20LazyInitialize%20may%20be%20shared%20by%20zero%20or%20many%20clients%20of%20the%20object.%20expensive_calculation%28%29%20should%20only%20be%20called%20when%20the%20first%20client%20needs%20...","permalink":"https:\/\/herbsutter.com\/2013\/04\/05\/complex-initialization-for-a-const-variable\/#comment-9032","item_id":"_comm_9032"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_9032 == 'undefined' ){PDRTJS_468178_comm_9032 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_9032 );}}PDRTJS_settings_468178_comm_9031={"id":468178,"unique_id":"wp-comment-9031","title":"%40Jon%3A%20In%20cases%20where%20it%20doesn%26%23039%3Bt%20make%20sense%20for%20value%20to%20be%20static%20then%20you%20could%20call%20expensive_calculation%20in%20LazyInitialize%26%23039%3Bs%20constructor....","permalink":"https:\/\/herbsutter.com\/2013\/04\/05\/complex-initialization-for-a-const-variable\/#comment-9031","item_id":"_comm_9031"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_9031 == 'undefined' ){PDRTJS_468178_comm_9031 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_9031 );}}PDRTJS_settings_468178_comm_9024={"id":468178,"unique_id":"wp-comment-9024","title":"How%20can%20we%20solve%20something%20like%20this%3Fclass%20LazyInitialize%7Bpublic%3Aint%20get_value%28%29%20%7Bif%20%28value%20not%20calculated%20yet%29%20%7Bvalue%20%3D%20expensive_calculation%28%29%3B%7D%20return%20value%3B%7Dprivate%3Aconst_once%20int%20value%3B%7D%3B...","permalink":"https:\/\/herbsutter.com\/2013\/04\/05\/complex-initialization-for-a-const-variable\/#comment-9024","item_id":"_comm_9024"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_9024 == 'undefined' ){PDRTJS_468178_comm_9024 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_9024 );}}PDRTJS_settings_468178_comm_9016={"id":468178,"unique_id":"wp-comment-9016","title":"%26%23091%3B...%26%23093%3B%20P.S.%20%20%20.%20%26%23091%3B...%26%23093%3B...","permalink":"https:\/\/herbsutter.com\/2013\/04\/05\/complex-initialization-for-a-const-variable\/#comment-9016","item_id":"_comm_9016"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_9016 == 'undefined' ){PDRTJS_468178_comm_9016 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_9016 );}}PDRTJS_settings_468178_comm_9015={"id":468178,"unique_id":"wp-comment-9015","title":"The%20lambda%20solution%20seems%20appropriate%20for%20some%20situations%2C%20but%20it%26%23039%3Bs%20not%20clear%20that%20it%20addresses%20the%20original%20question.The%20original%20question%20didn%26%23039%3Bt%20have%20a%20default%20value%20and%20only%20conditionally%20init...","permalink":"https:\/\/herbsutter.com\/2013\/04\/05\/complex-initialization-for-a-const-variable\/#comment-9015","item_id":"_comm_9015"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_9015 == 'undefined' ){PDRTJS_468178_comm_9015 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_9015 );}}PDRTJS_settings_468178_comm_9009={"id":468178,"unique_id":"wp-comment-9009","title":"%40Herb%3A%20I%20think%20what%20Bruno%20means%20with%20statics%20is%20something%20like%20this%3A%20%2F%2Fheaderstruct%20C%20%7B%20%20static%20int%20i%3B%20%20%7D%3B%2F%2Fsourceint%20C%3A%3Ai%20%3D%20%26%23091%3B%26%23093%3B%28%29%7B%20return%20%28std%3A%3Atime%28nullptr%29%20%25%202%29%20%3F%2042%20%3A%204711%3B%20%7D%28%29%3B...","permalink":"https:\/\/herbsutter.com\/2013\/04\/05\/complex-initialization-for-a-const-variable\/#comment-9009","item_id":"_comm_9009"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_9009 == 'undefined' ){PDRTJS_468178_comm_9009 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_9009 );}}PDRTJS_settings_468178_comm_9007={"id":468178,"unique_id":"wp-comment-9007","title":"I%20known%20about%20it%2C%20but%20don%26%23039%3Bt%20end%20up%20using%20it.%20Its%20still%20too%20verbose....","permalink":"https:\/\/herbsutter.com\/2013\/04\/05\/complex-initialization-for-a-const-variable\/#comment-9007","item_id":"_comm_9007"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_9007 == 'undefined' ){PDRTJS_468178_comm_9007 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_9007 );}}PDRTJS_settings_468178_comm_9006={"id":468178,"unique_id":"wp-comment-9006","title":"%26%23091%3B...%26%23093%3B%20Complex%20initialization%20for%20a%20const%20variable%20%3A%3A%3A%20Sutter%26%238217%3Bs%20Mill%20%26%23091%3B...%26%23093%3B...","permalink":"https:\/\/herbsutter.com\/2013\/04\/05\/complex-initialization-for-a-const-variable\/#comment-9006","item_id":"_comm_9006"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_9006 == 'undefined' ){PDRTJS_468178_comm_9006 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_9006 );}}PDRTJS_settings_468178_comm_9000={"id":468178,"unique_id":"wp-comment-9000","title":"I%20agree%20with%20the%20reasons%20given%20why%20this%20is%20better%20than%20extracting%20a%20named%20helper%20function%20that%20is%20only%20used%20here%3A%20the%20lambda%20has%20better%20locality%2C%20is%20arguably%20more%20readable%2C%20and%20lets%20you%20use%20other...","permalink":"https:\/\/herbsutter.com\/2013\/04\/05\/complex-initialization-for-a-const-variable\/#comment-9000","item_id":"_comm_9000"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_9000 == 'undefined' ){PDRTJS_468178_comm_9000 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_9000 );}}PDRTJS_settings_468178_comm_8996={"id":468178,"unique_id":"wp-comment-8996","title":"%40Andrzej%3A%20Right%2C%20but%20I%26%23039%3Bll%20let%20it%20stand.%20The%20committee%20has%20already%20pretty%20much%20agreed%20that%20this%20should%20be%20allowed%20%28which%20is%20why%20our%20compiler%20also%20already%20supports%20it%2C%20and%20with%20GCC%20and%20Clang%20that%20w...","permalink":"https:\/\/herbsutter.com\/2013\/04\/05\/complex-initialization-for-a-const-variable\/#comment-8996","item_id":"_comm_8996"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_8996 == 'undefined' ){PDRTJS_468178_comm_8996 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_8996 );}}PDRTJS_settings_468178_comm_8994={"id":468178,"unique_id":"wp-comment-8994","title":"The%20same%20trick%20lets%20you%20declare%20static%20vars%20so%20that%20the%20initialization%20is%20done%20only%20once%20and%20thread%20safely....","permalink":"https:\/\/herbsutter.com\/2013\/04\/05\/complex-initialization-for-a-const-variable\/#comment-8994","item_id":"_comm_8994"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_8994 == 'undefined' ){PDRTJS_468178_comm_8994 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_8994 );}}PDRTJS_settings_468178_comm_8990={"id":468178,"unique_id":"wp-comment-8990","title":"%40Herb%3A%20While%20your%20example%20compiles%20in%20g%2B%2B4.7%2C%204.8%20and%20Clang%203.2%2C%20I%20believe%20it%20is%20not%20a%20valid%20C%2B%2B11%20code.%20According%20to%20sect%205.1.2%20para%204%2C%20when%20the%20body%20of%20the%20lambda%20is%20not%20a%20simple%20return%20stateme...","permalink":"https:\/\/herbsutter.com\/2013\/04\/05\/complex-initialization-for-a-const-variable\/#comment-8990","item_id":"_comm_8990"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_8990 == 'undefined' ){PDRTJS_468178_comm_8990 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_8990 );}}PDRTJS_settings_468178_comm_8981={"id":468178,"unique_id":"wp-comment-8981","title":"constexpr%20keyword%20has%20been%20added%20for%20this%20purpose%20isn%26%23039%3Bt%20it%3F%20Using%20a%20named%20constexpr%20function%20is%20a%20good%20way%20to%20achieve%20the%20result.%20Even%20if%20it%20adds%20a%20name%20in%20the%20symbol%20space%2C%20it%20could%20%28it%20should%20i...","permalink":"https:\/\/herbsutter.com\/2013\/04\/05\/complex-initialization-for-a-const-variable\/#comment-8981","item_id":"_comm_8981"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_8981 == 'undefined' ){PDRTJS_468178_comm_8981 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_8981 );}}PDRTJS_settings_468178_comm_8980={"id":468178,"unique_id":"wp-comment-8980","title":"The%20function%20is%20similar%20to%20the%20reserved%20word%20%26quot%3Breadonly%26quot%3B%20in%20C%23%3F%20We%20can%20reference%20.NET%20to%20achieve%20it....","permalink":"https:\/\/herbsutter.com\/2013\/04\/05\/complex-initialization-for-a-const-variable\/#comment-8980","item_id":"_comm_8980"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_8980 == 'undefined' ){PDRTJS_468178_comm_8980 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_8980 );}}PDRTJS_settings_468178_comm_8979={"id":468178,"unique_id":"wp-comment-8979","title":"While%20technically%20the%20lambda%20is%20a%20good%20solution%20and%20may%20have%20its%20applications%20for%20initializations%2C%20in%20this%20case%20I%26%23039%3Bd%20as%20well%20recommend%20using%20a%20separate%20function.%20When%20the%20main%20task%20of%20a%20function%20i...","permalink":"https:\/\/herbsutter.com\/2013\/04\/05\/complex-initialization-for-a-const-variable\/#comment-8979","item_id":"_comm_8979"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_8979 == 'undefined' ){PDRTJS_468178_comm_8979 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_8979 );}}PDRTJS_settings_468178_comm_8978={"id":468178,"unique_id":"wp-comment-8978","title":"%40Arthur%20LangereisYou%20are%20hiding%20the%20verbosity%20of%20the%20lambda%20in%20the%20ellipse.If%20you%20need%20a%20lambda%20in%20this%20context%2C%20you%20will%20certainly%20do%20at%20least%20some%20kind%20of%20branching%2C%20which%20mean%20for%20clarity%20your...","permalink":"https:\/\/herbsutter.com\/2013\/04\/05\/complex-initialization-for-a-const-variable\/#comment-8978","item_id":"_comm_8978"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_8978 == 'undefined' ){PDRTJS_468178_comm_8978 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_8978 );}}PDRTJS_settings_468178_comm_8969={"id":468178,"unique_id":"wp-comment-8969","title":"Or%2C%20in%20this%20simple%20case%2C%20you%20could%20just%20use%20the%20ternary%20operator%3A%20%20%20%20const%20int%20i%20%3D%20someCondition%20%3F%20calculatedValue%20%3A%20defaultValue%3B...","permalink":"https:\/\/herbsutter.com\/2013\/04\/05\/complex-initialization-for-a-const-variable\/#comment-8969","item_id":"_comm_8969"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_8969 == 'undefined' ){PDRTJS_468178_comm_8969 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_8969 );}}PDRTJS_settings_468178_comm_8967={"id":468178,"unique_id":"wp-comment-8967","title":"%40bsivko%20I%20like%20that%20solution.%20It%20was%20the%20one%20that%20immediately%20came%20to%20my%20mind%20as%20well.%20The%20only%20downside%20is%20that%20init_i%20is%20not%20scoped....","permalink":"https:\/\/herbsutter.com\/2013\/04\/05\/complex-initialization-for-a-const-variable\/#comment-8967","item_id":"_comm_8967"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_8967 == 'undefined' ){PDRTJS_468178_comm_8967 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_8967 );}}PDRTJS_settings_468178_comm_8966={"id":468178,"unique_id":"wp-comment-8966","title":"One%20more%20way%3Aint%20init_i%3B%20if%28someConditionIstrue%29%20%7B%20Do%20some%20operations%20and%20calculate%20the%20value%20of%20i%3B%20init_i%20%3D%20some%20calculated%20value%3B%20%7D%20const%20int%20%26amp%3B%20i%20%3D%20init_i%3B...","permalink":"https:\/\/herbsutter.com\/2013\/04\/05\/complex-initialization-for-a-const-variable\/#comment-8966","item_id":"_comm_8966"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_8966 == 'undefined' ){PDRTJS_468178_comm_8966 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_8966 );}}PDRTJS_settings_468178_comm_8960={"id":468178,"unique_id":"wp-comment-8960","title":"Hey%2C%20I%20just%20learned%20about%20these%20things%20called%20%26quot%3Bimmediately-invoked%20function%20expressions%26quot%3B%20in%20JavaScript%20last%20week%20%3A%29.http%3A%2F%2Fen.m.wikipedia.org%2Fwiki%2FImmediately-invoked_function_expressionIt%26%23039%3Bs%20neat...","permalink":"https:\/\/herbsutter.com\/2013\/04\/05\/complex-initialization-for-a-const-variable\/#comment-8960","item_id":"_comm_8960"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_8960 == 'undefined' ){PDRTJS_468178_comm_8960 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_8960 );}}PDRTJS_settings_468178_comm_8959={"id":468178,"unique_id":"wp-comment-8959","title":"Would%20it%20not%20be%20better%20to%20encapsulate%20i%20into%20an%20immutable%20object%3F...","permalink":"https:\/\/herbsutter.com\/2013\/04\/05\/complex-initialization-for-a-const-variable\/#comment-8959","item_id":"_comm_8959"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_8959 == 'undefined' ){PDRTJS_468178_comm_8959 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_8959 );}}PDRTJS_settings_468178_comm_8957={"id":468178,"unique_id":"wp-comment-8957","title":"To%20mjklaim%2C%20why%20do%20you%20feel%3Aconst%20int%20i%20%3D%20%26%23091%3B%26amp%3B%26%23093%3B%7B%20%7D%28%29%3Bis%20more%20verbose%20than%20something%20like%3Astatic%20int%20calcI%28%29%20%7B%20%20%7Dconst%20int%20i%20%3D%20calcI%28%29%3BTo%20Johannes%2C%20In%20addition%20to%20not%20needing%20a%20name%20and%20being%20un...","permalink":"https:\/\/herbsutter.com\/2013\/04\/05\/complex-initialization-for-a-const-variable\/#comment-8957","item_id":"_comm_8957"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_8957 == 'undefined' ){PDRTJS_468178_comm_8957 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_8957 );}}PDRTJS_settings_468178_comm_8956={"id":468178,"unique_id":"wp-comment-8956","title":"The%20one%20that%20always%20troubles%20me%20is%20initializing%20two%20or%20more%20variables%20that%20I%26%23039%3Bd%20like%20to%20all%20be%20const%2C%20where%20their%20values%20depend%20on%20some%20condition%20that%20I%26%23039%3Bd%20prefer%20to%20only%20evaluate%20once.std%3A%3Astring%2F...","permalink":"https:\/\/herbsutter.com\/2013\/04\/05\/complex-initialization-for-a-const-variable\/#comment-8956","item_id":"_comm_8956"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_8956 == 'undefined' ){PDRTJS_468178_comm_8956 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_8956 );}}PDRTJS_settings_468178_comm_8954={"id":468178,"unique_id":"wp-comment-8954","title":"The%20problem%20with%20named%20functions%20is%20that%20they%20have%20a%20name%2C%20so%20they%20can%20be%20used%20more%20than%20once.When%20it%20is%20not%20the%20intention%2C%20it%20is%20a%20problem.%20Using%20a%20lambda%20makes%20it%20clear%20that%20there%20should%20be%20onl...","permalink":"https:\/\/herbsutter.com\/2013\/04\/05\/complex-initialization-for-a-const-variable\/#comment-8954","item_id":"_comm_8954"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_8954 == 'undefined' ){PDRTJS_468178_comm_8954 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_8954 );}}PDRTJS_settings_468178_comm_8953={"id":468178,"unique_id":"wp-comment-8953","title":"Whats%20wrong%20with%20a%20simple%20helper%20function%3FI%20think%2C%20in%20most%20cases%20a%20named%20function%20is%20a%20more%20readable%20solution%20to%20the%20problem%20%28especially%20in%20respect%20of%20self%20documenting%20code%29.%20int%20calculateValue%28%29...","permalink":"https:\/\/herbsutter.com\/2013\/04\/05\/complex-initialization-for-a-const-variable\/#comment-8953","item_id":"_comm_8953"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_8953 == 'undefined' ){PDRTJS_468178_comm_8953 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_8953 );}}PDRTJS_settings_468178_comm_8952={"id":468178,"unique_id":"wp-comment-8952","title":"I%26%23039%3Bm%20sure%20all%20these%20things%20will%20become%20clear%20once%20Ambassador%20Soval%20gets%20around%20to%20finishing%20off%20his%20next%20edition....","permalink":"https:\/\/herbsutter.com\/2013\/04\/05\/complex-initialization-for-a-const-variable\/#comment-8952","item_id":"_comm_8952"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_8952 == 'undefined' ){PDRTJS_468178_comm_8952 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_8952 );}}PDRTJS_settings_468178_comm_8951={"id":468178,"unique_id":"wp-comment-8951","title":"I%20get%20the%20point%20but%20I%20seriously%20doubt%20if%20it%20is%20an%20advantage.%20It%20is%20not%20much%20different%20from%20calling%20a%20named%20function.%20If%20the%20complex%20calculation%20has%20a%20name%20I%20would%20a%20create%20a%20function%20with%20that%20na...","permalink":"https:\/\/herbsutter.com\/2013\/04\/05\/complex-initialization-for-a-const-variable\/#comment-8951","item_id":"_comm_8951"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_8951 == 'undefined' ){PDRTJS_468178_comm_8951 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_8951 );}}PDRTJS_settings_468178_comm_8950={"id":468178,"unique_id":"wp-comment-8950","title":"I%26%23039%3Bve%20used%20this%20idiom%20from%20the%20beginning%20and%20it%20is%20indeed%20powerful.However%2C%20it%26%23039%3Bs%20still%20verbose%20compared%20to%20the%20initial%20code%2C%20so%20I%20hope%20more%20terse%20notations%20%28and%20automatic%20generalization%29%20will%20get%20...","permalink":"https:\/\/herbsutter.com\/2013\/04\/05\/complex-initialization-for-a-const-variable\/#comment-8950","item_id":"_comm_8950"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_8950 == 'undefined' ){PDRTJS_468178_comm_8950 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_8950 );}}
//--><!]]></script><script type='text/javascript' charset='UTF-8' src='https://polldaddy.com/js/rating/rating.js'></script><script type='text/javascript' src='https://platform.twitter.com/widgets.js?ver=20111117'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var actionbardata = {"siteID":"3379246","siteName":"Sutter\u2019s Mill","siteURL":"https:\/\/herbsutter.com","icon":"<img alt='' src='https:\/\/secure.gravatar.com\/blavatar\/4554b8d24c7f200dc5e2e1b18db1893f?s=50&d=https%3A%2F%2Fs2.wp.com%2Fi%2Flogo%2Fwpcom-gray-white.png' class='avatar avatar-50' height='50' width='50' \/>","canManageOptions":"","canCustomizeSite":"","isFollowing":"","themeSlug":"pub\/mistylook","signupURL":"https:\/\/wordpress.com\/start\/","loginURL":"https:\/\/herbsutter.wordpress.com\/wp-login.php?redirect_to=https%3A%2F%2Fherbsutter.com%2F2013%2F04%2F05%2Fcomplex-initialization-for-a-const-variable%2F","themeURL":"","xhrURL":"https:\/\/herbsutter.com\/wp-admin\/admin-ajax.php","nonce":"8fb9818ae2","isSingular":"1","isFolded":"","isLoggedIn":"","isMobile":"","subscribeNonce":"<input type=\"hidden\" id=\"_wpnonce\" name=\"_wpnonce\" value=\"4590924cc6\" \/>","referer":"https:\/\/herbsutter.com\/2013\/04\/05\/complex-initialization-for-a-const-variable\/","canFollow":"1","feedID":"171936","statusMessage":"","customizeLink":"https:\/\/herbsutter.wordpress.com\/wp-admin\/customize.php?url=https%3A%2F%2Fherbsutter.wordpress.com%2F2013%2F04%2F05%2Fcomplex-initialization-for-a-const-variable%2F","postID":"1792","shortlink":"https:\/\/wp.me\/peb5Y-sU","canEditPost":"","editLink":"https:\/\/wordpress.com\/post\/herbsutter.com\/1792","statsLink":"https:\/\/wordpress.com\/stats\/post\/1792\/herbsutter.com","i18n":{"view":"View site","follow":"Follow","following":"Following","edit":"Edit","login":"Log in","signup":"Sign up","customize":"Customize","report":"Report this content","themeInfo":"Get theme: MistyLook","shortlink":"Copy shortlink","copied":"Copied","followedText":"New posts from this site will now appear in your <a href=\"https:\/\/wordpress.com\/\">Reader<\/a>","foldBar":"Collapse this bar","unfoldBar":"Expand this bar","editSubs":"Manage subscriptions","viewReader":"View site in Reader","viewReadPost":"View post in Reader","subscribe":"Sign me up","enterEmail":"Enter your email address","followers":"Join 19,532 other followers","alreadyUser":"Already have a WordPress.com account? <a href=\"https:\/\/herbsutter.wordpress.com\/wp-login.php?redirect_to=https%3A%2F%2Fherbsutter.com%2F2013%2F04%2F05%2Fcomplex-initialization-for-a-const-variable%2F\">Log in now.<\/a>","stats":"Stats"}};
/* ]]> */
</script>
<script type='text/javascript' src='https://s0.wp.com/_static/??-eJyVjcEOgjAQRH/IuoIYT8Zvqe2GLrQLdlvAv7ceJEYTEg+bTGbe7MA8KjNwQk7QCVicyOC47DvZwUcUshp9bokFPPUocM+Y0Wm2HuM3/CblwUkvjlrnyyWMv87GjraBWN10hKCloEWpYcIYyZb91fvzQ4ra9LJVMokGfpVWVehruFSnujo0x+Zcd0+y+3Rn'></script>
<script type="text/javascript">
// <![CDATA[
(function() {
try{
  if ( window.external &&'msIsSiteMode' in window.external) {
    if (window.external.msIsSiteMode()) {
      var jl = document.createElement('script');
      jl.type='text/javascript';
      jl.async=true;
      jl.src='/wp-content/plugins/ie-sitemode/custom-jumplist.php';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(jl, s);
    }
  }
}catch(e){}
})();
// ]]>
</script><script src="//stats.wp.com/w.js?56" type="text/javascript" async defer></script>
<script type="text/javascript">
_tkq = window._tkq || [];
_stq = window._stq || [];
_tkq.push(['storeContext', {'blog_id':'3379246','blog_tz':'-8','user_lang':'en','blog_lang':'en','user_id':'0'}]);
_stq.push(['view', {'blog':'3379246','v':'wpcom','tz':'-8','user_id':'0','post':'1792','subd':'herbsutter'}]);
_stq.push(['extra', {'crypt':'UE40eW5QN0p8M2Y/RE1TaVhzUzFMbjdWNHpwZGhTayxPSUFCMGNrd29+Smw0TDhnZmRTK0hlRi9QSGh6bi9GXVhBJWIlZlR5U1JMLU8/MkNtblkvY1d1TjBELytHc0k/MXdHUVQyK2IyUVA5SjU1bj9VX3ExLHYsREFpcnlfNHYtXV1HSUIsLkJrcnp0eS5sNFVNP1tNMWklPS9ULkEwekMwRTFUNm8vbSs1Yz1iMyZ4dnxMYi4uRFF2amVVZT9wK2FsLTFdeHI2LFpMM1FlWy9fVSx8cGVNd3ZQVD09PWJXTlUlZTElRzJRZXFiQ0ZbdVhCNW5YN3JzSltfakVdblVWOEhrUnZUaWp8Qk56MGxWcz91aEFddkhJUGFKfkVqYWVHL2ZVQ25FfnUyK1lGQ2JNUHZCMjBmSkZyNz9IVmppenJZaWdpN2I/Ryt0cjFYUWxXXUw5Ng=='}]);
_stq.push([ 'clickTrackerInit', '3379246', '1792' ]);
	</script>
<noscript><img src="https://pixel.wp.com/b.gif?v=noscript" style="height:0px;width:0px;overflow:hidden" alt="" /></noscript>
<script>
if ( 'object' === typeof wpcom_mobile_user_agent_info ) {

	wpcom_mobile_user_agent_info.init();
	var mobileStatsQueryString = "";
	
	if( false !== wpcom_mobile_user_agent_info.matchedPlatformName )
		mobileStatsQueryString += "&x_" + 'mobile_platforms' + '=' + wpcom_mobile_user_agent_info.matchedPlatformName;
	
	if( false !== wpcom_mobile_user_agent_info.matchedUserAgentName )
		mobileStatsQueryString += "&x_" + 'mobile_devices' + '=' + wpcom_mobile_user_agent_info.matchedUserAgentName;
	
	if( wpcom_mobile_user_agent_info.isIPad() )
		mobileStatsQueryString += "&x_" + 'ipad_views' + '=' + 'views';

	if( "" != mobileStatsQueryString ) {
		new Image().src = document.location.protocol + '//pixel.wp.com/g.gif?v=wpcom-no-pv' + mobileStatsQueryString + '&baba=' + Math.random();
	}
	
}
</script></body>
</html>