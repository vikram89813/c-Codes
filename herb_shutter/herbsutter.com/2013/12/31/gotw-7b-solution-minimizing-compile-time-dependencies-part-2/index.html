<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>GotW #7b Solution: Minimizing Compile-Time Dependencies, Part 2 | Sutter’s Mill</title>
<link rel="pingback" href="https://herbsutter.com/xmlrpc.php" />
<script type="text/javascript">
  WebFontConfig = {"typekit":{"id":"eyo0tqd"}};
  (function() {
    var wf = document.createElement('script');
    wf.src = 'https://s0.wp.com/wp-content/plugins/custom-fonts/js/webfont.js';
    wf.type = 'text/javascript';
    wf.async = 'true';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(wf, s);
	})();
</script><style id="jetpack-custom-fonts-css">.wf-active #header h1{font-size:2.12em;font-family:"ff-dagny-web-pro-1","ff-dagny-web-pro-2",sans-serif;font-style:normal;font-weight:400}.wf-active body{font-size:89.7%;font-family:"ff-basic-gothic-web-pro-1","ff-basic-gothic-web-pro-2",sans-serif}.wf-active #navigation{font-family:"ff-basic-gothic-web-pro-1","ff-basic-gothic-web-pro-2",sans-serif}.wf-active #navigation ul li.search{font-size:1.06em}.wf-active #navigation ul li.search input#searchsubmit{font-size:1.06em}.wf-active #content .post-info, .wf-active #content .postmetadata{font-size:1.06em}.wf-active #sidebar{font-size:1.06em}.wf-active #footer p.right{font-size:1.06em}.wf-active .commentnum{font-size:1.77em}.wf-active .commentlist li .cmtinfo{font-size:1.18em}.wf-active .commentlist li .cmtinfo em{font-size:1.06em}.wf-active #respond label{font-size:11.8px}.wf-active #respond .required{font-size:11.8px}.wf-active #respond .subscribe-label{font-size:14.2px}.wf-active #respond .comment-notes{font-size:13px}.wf-active .wp-caption p.wp-caption-text{font-size:13px}.wf-active #content h1, .wf-active h2, .wf-active h3, .wf-active h4, .wf-active h5, .wf-active h6{font-family:"ff-dagny-web-pro-1","ff-dagny-web-pro-2",sans-serif;font-style:normal;font-weight:400}.wf-active #header h2{font-size:1.18em;font-weight:400;font-family:"ff-dagny-web-pro-1","ff-dagny-web-pro-2",sans-serif;font-style:normal}.wf-active #content h3{font-size:1.65em;font-weight:400;font-style:normal}.wf-active #content h4{font-size:1.3em;font-style:normal;font-weight:400}.wf-active #content h5{font-size:1.18em;font-style:normal;font-weight:400}.wf-active #content .post h2{font-size:1.65em;font-weight:400;font-style:normal}.wf-active li.sidebox h2{font-weight:400;font-size:1.89em;font-style:normal}.wf-active .post h4{font-size:1.18em;font-weight:400;font-family:"ff-dagny-web-pro-1","ff-dagny-web-pro-2",sans-serif;font-style:normal}.wf-active .post h4 em{font-style:normal;font-weight:400}</style>
		<script src='https://r-login.wordpress.com/remote-login.php?action=js&amp;host=herbsutter.com&amp;id=3379246&amp;t=1542965310&amp;back=https%3A%2F%2Fherbsutter.com%2F2013%2F12%2F31%2Fgotw-7b-solution-minimizing-compile-time-dependencies-part-2%2F' type="text/javascript"></script>
		<script type="text/javascript">
		/* <![CDATA[ */
			if ( 'function' === typeof WPRemoteLogin ) {
				document.cookie = "wordpress_test_cookie=test; path=/";
				if ( document.cookie.match( /(;|^)\s*wordpress_test_cookie\=/ ) ) {
					WPRemoteLogin();
				}
			}
		/* ]]> */
		</script>
		<link rel='dns-prefetch' href='//s2.wp.com' />
<link rel='dns-prefetch' href='//s0.wp.com' />
<link rel='dns-prefetch' href='//s1.wp.com' />
<link rel='dns-prefetch' href='//herbsutter.wordpress.com' />
<link rel="alternate" type="application/rss+xml" title="Sutter’s Mill &raquo; Feed" href="https://herbsutter.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="Sutter’s Mill &raquo; Comments Feed" href="https://herbsutter.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Sutter’s Mill &raquo; GotW #7b Solution: Minimizing Compile-Time Dependencies, Part&nbsp;2 Comments Feed" href="https://herbsutter.com/2013/12/31/gotw-7b-solution-minimizing-compile-time-dependencies-part-2/feed/" />
	<script type="text/javascript">
		/* <![CDATA[ */
		function addLoadEvent(func) {
			var oldonload = window.onload;
			if (typeof window.onload != 'function') {
				window.onload = func;
			} else {
				window.onload = function () {
					oldonload();
					func();
				}
			}
		}
		/* ]]> */
	</script>
			<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s0.wp.com\/wp-content\/mu-plugins\/wpcom-smileys\/twemoji\/2\/72x72\/","ext":".png","svgUrl":"https:\/\/s0.wp.com\/wp-content\/mu-plugins\/wpcom-smileys\/twemoji\/2\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/s1.wp.com\/wp-includes\/js\/wp-emoji-release.min.js?m=1532082729h&ver=4.9.8"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56760,9792,65039],[55358,56760,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel='stylesheet' id='all-css-0-1' href='https://s2.wp.com/_static/??-eJyNkN1uwjAMhV9onsUG69W0Z0laE0zzp8QR6tvjUlUCwSpuonOS81knxkuGPkWhKBgaZN8cx4qeR6p4JsmmH+HmPvtaP/B1nOORI8uEcqKgYG4WA1eZfErjFtinQnofspE5EWhgQ15nRNnCQv5ZqVmetORmv0vWNFibC9UKegZuAZayT9wKuabWUnEwt0Tb2A9ofbotxBZTJpx/SE8DXi3hn+h9Rx4cSUVJGXKqqt5GaurZeGCNPJoFZoxJlsdVbE11lEB/aYRTfDBw9IbLFlpI9+NUOtTUnZ2hv/C7O+y/uu9uf+jOV8Xg7sY=?cssminify=yes' type='text/css' media='all' />
<link rel='stylesheet' id='print-css-1-1' href='https://s2.wp.com/wp-content/mu-plugins/global-print/global-print.css?m=1465851035h&cssminify=yes' type='text/css' media='print' />
<link rel='stylesheet' id='all-css-2-1' href='https://s0.wp.com/_static/??/wp-content/mu-plugins/actionbar/actionbar.css,/wp-content/themes/h4/global.css?m=1516985148j&cssminify=yes' type='text/css' media='all' />
<script type='text/javascript' src='https://s0.wp.com/_static/??-eJyFztEKwjAMBdAfsquTiXsRv6XWOFKXtDbphn69HeiDMBQCgdzDJXZOBtmP5QJiQ517gfx4rybIxv4ChnDITqEh5A/2kRVYF0vxjCOYIpDdUG+16BpXXIqiBCIVraTfLyFPCPNfFkCT8zeTQfC5tJ7o2Hb9Yde3+24bXjRNW9I='></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://herbsutter.wordpress.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://s1.wp.com/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Grace Hopper on Letterman,&nbsp;1986' href='https://herbsutter.com/2013/12/09/grace-hopper-on-letterman-1986/' />
<link rel='next' title='GotW #7c: Minimizing Compile-Time Dependencies, Part&nbsp;3' href='https://herbsutter.com/2013/12/31/gotw-7c-minimizing-compile-time-dependencies-part-3/' />
<meta name="generator" content="WordPress.com" />
<link rel="canonical" href="https://herbsutter.com/2013/12/31/gotw-7b-solution-minimizing-compile-time-dependencies-part-2/" />
<link rel='shortlink' href='https://wp.me/peb5Y-Cs' />
<link rel="alternate" type="application/json+oembed" href="https://public-api.wordpress.com/oembed/?format=json&amp;url=https%3A%2F%2Fherbsutter.com%2F2013%2F12%2F31%2Fgotw-7b-solution-minimizing-compile-time-dependencies-part-2%2F&amp;for=wpcom-auto-discovery" /><link rel="alternate" type="application/xml+oembed" href="https://public-api.wordpress.com/oembed/?format=xml&amp;url=https%3A%2F%2Fherbsutter.com%2F2013%2F12%2F31%2Fgotw-7b-solution-minimizing-compile-time-dependencies-part-2%2F&amp;for=wpcom-auto-discovery" />
<!-- Jetpack Open Graph Tags -->
<meta property="og:type" content="article" />
<meta property="og:title" content="GotW #7b Solution: Minimizing Compile-Time Dependencies, Part 2" />
<meta property="og:url" content="https://herbsutter.com/2013/12/31/gotw-7b-solution-minimizing-compile-time-dependencies-part-2/" />
<meta property="og:description" content="Now that the unnecessary headers have been removed, it&#8217;s time for Phase 2: How can you limit dependencies on the internals of a class?  Problem JG Questions 1. What does private mean for a cl…" />
<meta property="article:published_time" content="2013-12-31T20:24:37+00:00" />
<meta property="article:modified_time" content="2014-01-03T17:46:25+00:00" />
<meta property="og:site_name" content="Sutter’s Mill" />
<meta property="og:image" content="https://secure.gravatar.com/blavatar/4554b8d24c7f200dc5e2e1b18db1893f?s=200&amp;ts=1542965310" />
<meta property="og:image:width" content="200" />
<meta property="og:image:height" content="200" />
<meta property="og:locale" content="en_US" />
<meta name="twitter:site" content="@wordpressdotcom" />
<meta name="twitter:text:title" content="GotW #7b Solution: Minimizing Compile-Time Dependencies, Part&nbsp;2" />
<meta name="twitter:image" content="https://secure.gravatar.com/blavatar/4554b8d24c7f200dc5e2e1b18db1893f?s=240" />
<meta name="twitter:card" content="summary" />
<meta property="article:publisher" content="https://www.facebook.com/WordPresscom" />

<!-- End Jetpack Open Graph Tags -->
<link rel="shortcut icon" type="image/x-icon" href="https://secure.gravatar.com/blavatar/4554b8d24c7f200dc5e2e1b18db1893f?s=32" sizes="16x16" />
<link rel="icon" type="image/x-icon" href="https://secure.gravatar.com/blavatar/4554b8d24c7f200dc5e2e1b18db1893f?s=32" sizes="16x16" />
<link rel="apple-touch-icon-precomposed" href="https://secure.gravatar.com/blavatar/4554b8d24c7f200dc5e2e1b18db1893f?s=114" />
<link rel='openid.server' href='https://herbsutter.wordpress.com/?openidserver=1' />
<link rel='openid.delegate' href='https://herbsutter.wordpress.com/' />
<link rel="search" type="application/opensearchdescription+xml" href="https://herbsutter.com/osd.xml" title="Sutter’s Mill" />
<link rel="search" type="application/opensearchdescription+xml" href="https://s1.wp.com/opensearch.xml" title="WordPress.com" />
		<style id="wpcom-hotfix-masterbar-style">
			@media screen and (min-width: 783px) {
				#wpadminbar .quicklinks li#wp-admin-bar-my-account.with-avatar > a img {
					margin-top: 5px;
				}
			}
		</style>
		<script type="text/javascript" id="webfont-output">
  
  WebFontConfig = {"typekit":{"id":"cjs1oxc"}};
  (function() {
    var wf = document.createElement('script');
    wf.src = ('https:' == document.location.protocol ? 'https' : 'http') +
      '://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';
    wf.type = 'text/javascript';
    wf.async = 'true';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(wf, s);
	})();
</script><style type="text/css">
.widget_twitter li {
	word-wrap: break-word;
}
</style>
<meta name="application-name" content="Sutter’s Mill" /><meta name="msapplication-window" content="width=device-width;height=device-height" /><meta name="msapplication-tooltip" content="Herb Sutter on software development" /><meta name="msapplication-task" content="name=Subscribe;action-uri=https://herbsutter.com/feed/;icon-uri=https://secure.gravatar.com/blavatar/4554b8d24c7f200dc5e2e1b18db1893f?s=16" /><meta name="msapplication-task" content="name=Sign up for a free blog;action-uri=http://wordpress.com/signup/;icon-uri=https://s1.wp.com/i/favicon.ico" /><meta name="msapplication-task" content="name=WordPress.com Support;action-uri=http://support.wordpress.com/;icon-uri=https://s1.wp.com/i/favicon.ico" /><meta name="msapplication-task" content="name=WordPress.com Forums;action-uri=http://forums.wordpress.com/;icon-uri=https://s1.wp.com/i/favicon.ico" /><meta name="description" content="Now that the unnecessary headers have been removed, it&#039;s time for Phase 2: How can you limit dependencies on the internals of a class?  Problem JG Questions 1. What does private mean for a class member in C++? 2. Why does changing the private members of a type cause a recompilation? Guru Question 3. Below&hellip;" />
<style type="text/css">
			#header h1 a,
		#header h2 {
			color: #265E15 !important;
		}
				#headerimage {
			background: url('https://herbsutter.files.wordpress.com/2011/10/cropped-blog-header.jpg') no-repeat;
			height: 200px;
		}
	</style>
<link rel="amphtml" href="https://herbsutter.com/2013/12/31/gotw-7b-solution-minimizing-compile-time-dependencies-part-2/amp/"><style type="text/css" id="syntaxhighlighteranchor"></style>
		<link rel="stylesheet" id="custom-css-css" type="text/css" href="https://s2.wp.com/?custom-css=1&#038;csblog=eb5Y&#038;cscache=6&#038;csrev=60" />
		</head>
<body id="section-index" class="post-template-default single single-post postid-2384 single-format-standard mp6 customizer-styles-applied highlander-enabled highlander-light">


<div id="navigation" class="clearfix">
		<div class="menu">
		<ul>
			<li ><a href="https://herbsutter.com/" title="Home">Home</a></li>
			<li class="page_item page-item-912"><a href="https://herbsutter.com/welcome-to-the-jungle/">Welcome to the&nbsp;Jungle</a></li>
<li class="page_item page-item-864 page_item_has_children"><a href="https://herbsutter.com/gotw/">GotW</a></li>
<li class="page_item page-item-761"><a href="https://herbsutter.com/elements-of-modern-c-style/">Elements of Modern C++&nbsp;Style</a></li>
<li class="page_item page-item-2 page_item_has_children"><a href="https://herbsutter.com/about/">About</a></li>
									<li class="search"><form method="get" id="searchform" action="https://herbsutter.com"><input type="text" class="textbox" value="" name="s" id="s" /><input type="submit" id="searchsubmit" value="Search" /></form></li>
					</ul>
	</div>
</div><!-- end id:navigation -->

<div id="container">

<div id="header">
<h1><a href="https://herbsutter.com/" title="Sutter’s Mill">Sutter’s Mill</a></h1>
<h2>Herb Sutter on software development</h2>
</div><!-- end id:header -->


	
		<div id="feedarea">
	<dl>
		<dt><strong>Feeds:</strong></dt>

			<dd><a href="https://herbsutter.com/feed/">Posts</a></dd>
	
			<dd><a href="https://herbsutter.com/comments/feed/">Comments</a></dd>
		</dl>
	</div><!-- end id:feedarea -->
	
	<div id="headerimage">
</div><!-- end id:headerimage -->

<div id="content">
<div id="content-main">

		
									<div class="postnav">
				<div class="alignleft">&laquo; <a href="https://herbsutter.com/2013/12/09/grace-hopper-on-letterman-1986/" rel="prev">Grace Hopper on Letterman,&nbsp;1986</a></div>
				<div class="alignright"><a href="https://herbsutter.com/2013/12/31/gotw-7c-minimizing-compile-time-dependencies-part-3/" rel="next">GotW #7c: Minimizing Compile-Time Dependencies, Part&nbsp;3</a> &raquo;</div>
			</div>
			
			<div class="post-2384 post type-post status-publish format-standard hentry category-gotw" id="post-2384">
				<div class="posttitle">
					<h2>GotW #7b Solution: Minimizing Compile-Time Dependencies, Part&nbsp;2</h2>
					<p class="post-info">2013-12-31 by <a href="https://herbsutter.com/author/herbsutter/" title="Posts by Herb Sutter">Herb Sutter</a>  </p>
				</div>

				<div class="entry">
					<p><span style="color:#5a5a5a;"><em>Now that the unnecessary headers have been removed, it&#8217;s time for Phase 2: How can you limit dependencies on the internals of a class?<br />
</em></span></p>
<p>
 </p>
<h1>Problem<br />
</h1>
<h2>JG Questions<br />
</h2>
<p>1. What does <span style="color:#2e74b5;">private</span> mean for a class member in C++?
</p>
<p>2. Why does changing the private members of a type cause a recompilation?
</p>
<h2>Guru Question<br />
</h2>
<p>3. Below is how the header from the previous Item looks after the initial cleanup pass. What further <span style="color:#2e74b5;">#include</span>s could be removed if we made some suitable changes, and how?
</p>
<p>This time, you may make changes to <span style="color:#2e74b5;">X</span> as long as <span style="color:#2e74b5;">X</span>&#8216;s base classes and its public interface remain unchanged; any current code that already uses <span style="color:#2e74b5;">X</span> should not be affected beyond requiring a simple recompilation.
</p>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code>//  x.h: sans gratuitous headers<br />//<br />#include &lt;iosfwd&gt;<br />#include &lt;list&gt;<br /><br />// None of A, B, C, or D are templates.<br />// Only A and C have virtual functions.<br />#include "a.h"  // class A<br />#include "b.h"  // class B<br />#include "c.h"  // class C<br />#include "d.h"  // class D<br />class E;<br /><br />class X : public A, private B {<br />public:<br />       X( const C&amp; );<br />    B  f( int, char* );<br />    C  f( int, C );<br />    C&amp; g( B );<br />    E  h( E );<br />    virtual std::ostream&amp; print( std::ostream&amp; ) const;<br /><br />  private:<br />    std::list&lt;C&gt; clist;<br />    D            d;<br />};<br /><br />std::ostream&amp; operator&lt;&lt;( std::ostream&amp; os, const X&amp; x ) {<br />    return x.print(os);<br />}
</code></pre>
</p>
<p>
 </p>
<h1>Solution<br />
</h1>
<h2>1. What does private mean for a class member in C++?<br />
</h2>
<p>It means that outside code cannot access that member. Specifically, it cannot name it or call it.
</p>
<p>For example, given this class:
</p>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code>class widget {<br />public:<br />    void f() { }<br />private:<br />    void f(int) { }<br />    int i;<br />};
</code></pre>
</p>
<p>Outside code cannot use the name of the <span style="color:#2e74b5;">private</span> members:
</p>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code> int main() {<br />    auto w = widget{};<br />    w.f();               // ok<br />    w.f(42);             // error, cannot access name "f(int)"<br />    w.i = 42;            // error, cannot access name "i"<br />}
</code></pre>
</p>
<p>
 </p>
<h2>2. Why does changing the private members of a type cause a recompilation?<br />
</h2>
<p>Because private data members can change the size of the object, and private member functions participate in overload resolution.
</p>
<p>Note that accessibility is still safely enforced: <em>Calling code</em> still doesn&#8217;t get to use the private parts of the class. However, <em>the compiler</em> gets to know all about them at all times, including as it compiles the calling code. This does increase build coupling, but it&#8217;s for a deliberate reason: C++ has always been designed for efficiency, and a little-appreciated cornerstone of that is that C++ is designed to by default expose a type&#8217;s full implementation to the compiler in order to make aggressive optimization easier. It&#8217;s one of the fundamental reasons C++ is an efficient language.
</p>
<p>
 </p>
<h2>3. What further #includes could be removed if we made some suitable changes, and how? … any current code that already uses X should not be affected beyond requiring a simple recompilation.<br />
</h2>
<p>There are a few things we weren&#8217;t able to do in the previous problem:
</p>
<ul>
<li>We had to leave <span style="color:#2e74b5;">a.h</span> and <span style="color:#2e74b5;">b.h</span>. We couldn&#8217;t get rid of these because <span style="color:#2e74b5;">X</span> inherits from both <span style="color:#2e74b5;">A</span> and <span style="color:#2e74b5;">B</span>, and you always have to have full definitions for base classes so that the compiler can determine <span style="color:#2e74b5;">X</span>&#8216;s object size, virtual functions, and other fundamentals. (Can you anticipate how to remove one of these? Think about it: Which one can you remove, and why/how? The answer will come shortly.)
</li>
<li>We had to leave <span style="color:#2e74b5;">list</span>, <span style="color:#2e74b5;">c.h</span> and <span style="color:#2e74b5;">d.h</span>. We couldn&#8217;t get rid of these right away because a <span style="color:#2e74b5;">list&lt;C&gt;</span> and a <span style="color:#2e74b5;">D</span> appear as private data members of <span style="color:#2e74b5;">X</span>. Although <span style="color:#2e74b5;">C</span> appears as neither a base class nor a member, it is being used to instantiate the <span style="color:#2e74b5;">list</span> member, and some have compilers required that when you instantiate <span style="color:#2e74b5;">list&lt;C&gt;</span> you be able to see the definition of <span style="color:#2e74b5;">C</span>. (The standard doesn&#8217;t require a definition here, though, so even if the compiler you are currently using has this restriction, you can expect the restriction to go away over time.)
</li>
</ul>
<p>Now let&#8217;s talk about the beauty of Pimpls.
</p>
<p>
 </p>
<h3>The Pimpl Idiom<br />
</h3>
<p>C++ lets us easily encapsulate the private parts of a class from unauthorized access. Unfortunately, because of the header file approach inherited from C, it can take a little more work to encapsulate dependencies on a class&#8217; privates.
</p>
<p>&#8220;But,&#8221; you say, &#8220;the whole point of encapsulation is that the client code shouldn&#8217;t have to know or care about a class&#8217; private implementation details, right?&#8221; Right, and in C++ the client code doesn&#8217;t need to know or care about access to a class&#8217; privates (because unless it&#8217;s a friend it isn&#8217;t allowed any), but because the privates are visible in the header the client code does have to depend upon any types they mention. This coupling between the caller and the class&#8217;s internal details creates dependencies on both (re)compilation and binary layout.
</p>
<p>How can we better insulate clients from a class&#8217; private implementation details? One good way is to use a special form of the handle/body idiom, popularly called the Pimpl Idiom because of the intentionally pronounceable <span style="color:#2e74b5;">pimpl</span> pointer, as a compilation firewall.
</p>
<p>A Pimpl is just an opaque pointer (a pointer to a forward-declared, but undefined, helper class) used to hide the private members of a class. That is, instead of writing this:
</p>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code>// file widget.h<br />//<br />class widget {<br />    // public and protected members<br />private:<br />    // private members; whenever these change,<br />    // all client code must be recompiled<br />};
</code></pre>
</p>
<p>We write instead:
</p>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code>// file widget.h<br />//<br />#include &lt;memory&gt;<br /><br />class widget {<br />public:<br />    widget();<br />    ~widget();<br />    // public and protected members<br />private:<br />    struct impl;<br />    std::unique_ptr&lt;impl&gt; pimpl;   // ptr to a forward-declared class<br />};<br /><br />// file widget.cpp<br />//<br />#include "widget.h"<br /><br />struct widget::impl {<br />    // private members; fully hidden, can be<br />    // changed at will without recompiling clients<br />};<br /><br />widget::widget() : pimpl{ make_unique&lt;widget::impl&gt;(/*...*/) } { }<br />widget::~widget() =default;
</code></pre>
</p>
<p>Every <span style="color:#2e74b5;">widget</span> object dynamically allocates its <span style="color:#2e74b5;">impl</span> object. If you think of an object as a physical block, we&#8217;ve essentially lopped off a large chunk of the block and in its place left only &#8220;a little bump on the side&#8221;—the opaque pointer, or Pimpl. If copy and move are appropriate for your type, write those four operations to perform a deep copy that clones the <span style="color:#2e74b5;">impl</span> state.
</p>
<p>The major advantages of this idiom come from the fact that it breaks the caller&#8217;s dependency on the private details, including breaking both compile-time dependencies and binary dependencies:
</p>
<ul>
<li>Types mentioned only in a class&#8217; implementation need no longer be defined for client code, which can eliminate extra <span style="color:#2e74b5;">#include</span>s and improve compile speeds.
</li>
<li>A class&#8217; implementation can be changed—that is, private members can be freely added or removed—without recompiling client code. This is a useful technique for providing ABI-safety or binary compatibility, so that the client code is not dependent on the exact layout of the object.
</li>
</ul>
<p>The major costs of this idiom are in performance:
</p>
<ul>
<li>Each construction/destruction must allocate/deallocate memory.
</li>
<li>Each access of a hidden member can require at least one extra indirection. (If the hidden member being accessed itself uses a back pointer to call a function in the visible class, there will be multiple indirections, but is usually easy to avoid needing a back pointer.)
</li>
</ul>
<p>And of course we&#8217;re replacing any removed headers with the <span style="color:#2e74b5;">&lt;memory&gt;</span> header.
</p>
<p>We&#8217;ll come back to these and other Pimpl issues in GotW #24. For now, in our example, there were three headers whose definitions were needed simply because they appeared as private members of <span style="color:#2e74b5;">X</span>. If we instead restructure <span style="color:#2e74b5;">X</span> to use a Pimpl, we can immediately make several further simplifications:
</p>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code>#include &lt;list&gt;<br />#include "c.h"  // class C<br />#include "d.h"  // class D
</code></pre>
</p>
<p>One of these headers (<span style="color:#2e74b5;">c.h</span>) can be replaced with a forward declaration because <span style="color:#2e74b5;">C</span> is still being mentioned elsewhere as a parameter or return type, and the other two (<span style="color:#2e74b5;">list</span> and <span style="color:#2e74b5;">d.h</span>) can disappear completely.
</p>
<blockquote>
<p><strong>Guideline:</strong> For widely-included classes whose implementations may change, or to provide ABI-safety or binary compatibility, consider using the compiler-firewall idiom (Pimpl Idiom) to hide implementation details. Use an opaque pointer (a pointer to a declared but undefined class) declared as <strong>struct impl; std::unique_ptr&lt;impl&gt; pimpl;</strong> to store private nonvirtual members.
</p>
</blockquote>
<p>
 </p>
<p>Note: We can&#8217;t tell from the original code by itself whether or not <span style="color:#2e74b5;">X</span> had (default) copy or move operations. If it did, then to preserve that we would need to write them again ourselves since the move-only <span style="color:#2e74b5;">unique_ptr</span> member suppresses the implicit generation of copy construction and copy assignment, and the user-declared destructor suppresses the implicit generation of move construction and move assignment. If we do need to write them by hand, the move constructor and move assignment can be <span style="color:#2e74b5;">=default</span>ed, and the copy constructor and copy assignment will need to copy the Pimpl object.
</p>
<p>After making that additional change, the header looks like this:
</p>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code>//  x.h: after converting to use a Pimpl<br />//<br />#include &lt;iosfwd&gt;<br />#include &lt;memory&gt;<br />#include "a.h"  // class A (has virtual functions)<br />#include "b.h"  // class B (has no virtual functions)<br />class C;<br />class E;<br /><br />class X : public A, private B {<br />public:<br />    ~X();                          // defined out of line<br />    // and copy/move operations if X had them before<br /><br />       X( const C&amp; );<br />    B  f( int, char* );<br />    C  f( int, C );<br />    C&amp; g( B );<br />    E  h( E );<br />    virtual std::ostream&amp; print( std::ostream&amp; ) const;<br /><br />private:<br />    struct impl;<br />    std::unique_ptr&lt;impl&gt; pimpl;   // ptr to a forward-declared class<br />};<br /><br />std::ostream&amp; operator&lt;&lt;( std::ostream&amp; os, const X&amp; x ) {<br />    return x.print(os);<br />}
</code></pre>
</p>
<p>Without more extensive changes, we still need the definitions for <span style="color:#2e74b5;">A</span> and <span style="color:#2e74b5;">B</span> because they are base classes, and we have to know at least their sizes in order to define the derived class <span style="color:#2e74b5;">X</span>.
</p>
<p>The private details go into <span style="color:#2e74b5;">X</span>&#8216;s implementation file where client code never sees them and therefore never depends upon them:
</p>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code>//  Implementation file x.cpp<br />//<br />#include &lt;list&gt;<br />#include "c.h"  // class C<br />#include "d.h"  // class D<br />using namespace std;<br /><br />struct X::impl {<br />    list&lt;C&gt; clist;<br />    D       d;<br />};<br /><br />X::X() : pimpl{ make_unique&lt;X::impl&gt;(/*...*/) } { }<br />X::~X() =default;
</code></pre>
</p>
<p>That brings us down to including only four headers, which is a great improvement—but it turns out that there is still a little more we could do, if only we were allowed to change the structure of <span style="color:#2e74b5;">X</span> more extensively. This leads us nicely into Part 3…
</p>
<p>
 </p>
<h2>Acknowledgments<br />
</h2>
<p>Thanks to the following for their feedback to improve this article: John Humphrey, thokra, Motti Lanzkron, Marcelo Pinto.</p>
									</div>

				<p class="postmetadata">
					Posted in <a href="https://herbsutter.com/category/c/gotw/" rel="category tag">GotW</a> | 											14 Comments									</p>
				
<!-- You can start editing here. -->

<h3 id="comments">14 Responses</h3>

	<ol class="commentlist">
			<li class="comment even thread-even depth-1 highlander-comment" id="comment-14112">
		<div id="div-comment-14112">
		<div class="cmtinfo"><em> on <a href="#comment-14112" title="">2014-01-14 at 5:04 am</a></em> <img alt='' src='https://2.gravatar.com/avatar/29d03a96b1718886fb44fb10d94f2378?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>Rob Stewart</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_14112"></div><p>@mttpd</p>
<p>I regularly do what you argue against. I wish there was a file-scope using directive so I could make the header consistent with the implementation file. I do find the need to be explicit, in headers, frustrating, because I&#8217;d much rather use shorter names when there&#8217;s no ambiguity.</p>
<p>I use typedefs in headers (mostly in class definitions), namespace aliases, and using declarations along with using directives, so you&#8217;d probably dislike my code as a result. Despite all of that, however, I don&#8217;t see that this approach increases complexity. I&#8217;ll grant that one must examine context to know, with certainly, which vector some code means when it isn&#8217;t scope resolved, and I do find myself forgetting to switch to fully qualified names in headers when I copy a type from the implementation file. Nevertheless, I&#8217;d hate to encourage or, worse still, require full qualification in all or most contexts. After all, namespaces are given long names, in many cases, specifically to reduce conflicts and because there are tools to obviate the line noise.</p>
<p>Speaking of line noise, you noted that code is read more than written, so one shouldn&#8217;t be concerned with typing extra characters. That isn&#8217;t my reason for avoiding the fully qualified names. The extra characters on a line are usually not needed to increase code clarity. Indeed, I find that they normally detract from readability. You invoked Boost as disclaiming Herb&#8217;s assertion that &#8220;people just won’t put up with&#8221; the long names. The problem is that Boost must use fully qualified names in its headers, but in no way does that impose the same on Boost users. (I use many Boost libraries and use all of the tools at my disposal to shorten names when possible.)</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="pingback odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-14056">
		<div id="div-comment-14056">
		<div class="cmtinfo"><em> on <a href="#comment-14056" title="">2014-01-06 at 9:21 am</a></em>  <cite><a href='http://guillaumebelz.wordpress.com/2014/01/06/guru-of-the-week-7/' rel='external nofollow' class='url'>Guru of the week 7 | C++, Qt, OpenGL, CUDA</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_14056"></div><p>[&#8230;] GotW #7b Solution: Minimizing Compile-Time Dependencies, Part 2 [&#8230;]</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 highlander-comment" id="comment-14038">
		<div id="div-comment-14038">
		<div class="cmtinfo"><em> on <a href="#comment-14038" title="">2014-01-06 at 3:54 am</a></em> <img alt='' src='https://0.gravatar.com/avatar/0400152746a64b153a4bc543bf3cf76c?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>Ralph Tandetzky</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_14038"></div><p>@mttpd In most of my production code I don&#8217;t use <code>using namespace</code>. However, sometimes I do and I find my code more readable because of it. Examples are <code>using namespace std::chrono</code> or some Boost namespaces which are tedious to spell out all the time. Sometimes it is idiomatic to write </p>
<pre class="brush: plain; title: ; notranslate" title="">
using namespace std;
swap( x, y );
</pre>
<p>or similar code as you already noted yourself. Name clashes can be avoided because it&#8217;s YOUR code and you can change it if it becomes necessary. I don&#8217;t believe it makes sense to produce another guideline to avoid <code>using namespace</code> in cpp files. Sometimes it is better to do so, sometimes it is not. Use your programmer gut feeling and don&#8217;t sweat the small stuff. After all it&#8217;s a matter of taste.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-mttpd odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-14024">
		<div id="div-comment-14024">
		<div class="cmtinfo"><em> on <a href="#comment-14024" title="">2014-01-04 at 1:30 am</a></em> <img alt='' src='https://1.gravatar.com/avatar/1cc4a77a8256c3049728728c6c45625b?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://mttpd.wordpress.com' rel='external nofollow' class='url'>mttpd</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_14024"></div><p>@Herb: regarding the using-directive &#8212; unless we&#8217;re talking about strictly scoped uses (e.g., within a function scope; but not within (still dangerous) namespace level), with time I&#8217;m becoming less and less inclined to agree with this. If anything, nowadays I find myself more inclined toward using-declaration &#8212; and even that only under extremely limited, specific circumstances (i.e., strictly for the idiomatic ADL pull-in technique: as in std::swap, std::begin, std::end, etc.).</p>
<p>I&#8217;m talking here not solely from the legalistic perspective (&#8220;what is legal&#8221; / allowed by the standard &#8212; sure, no problems here), but also from the good software engineering principles perspective (what is right/maintainable/extensible &#8212; and I do see some problems here; let me know what you think about these).</p>
<p>For instance, we all agree that it has no place in the header files. However, if we do, then this itself has implications that (IMHO) go further:</p>
<p>1. Readability &#8212; this may vary depending on a domain, etc., I&#8217;m a heavy user of Boost libraries, which use the same naming convention as the C++ Standard Library. In practice, symbol named &#8220;vector&#8221; may correspond to around dozen different names (and it&#8217;s not unusual at all to use standard C++ vector, Boost.MPL vector and, say, Boost.uBLAS vector, in one codebase). A single misplaced using-directive will make name clashes unavoidable and not always trivial to track down (diagnostic messages for this can be &#8220;funny&#8221; at times).</p>
<p>Yes, I&#8217;m very careful about coming up with distinct, maximally self-explanatory variable (and typedefs!) names (some would perhaps say to the point of being obsessive about it), yes, the context helps, no, I don&#8217;t think that&#8217;s enough (especially given that programming is primarily a social activity and we have to take into account that other team members coming from different domains may find different contexts &#8220;obvious&#8221; &#8212; and other &#8220;arcane&#8221;).</p>
<p>If taken to extreme, this may imply having to define (sub)library-specific prefixed names, as in pre-namespaces Qt (e.g., QVector) &#8212; isn&#8217;t that a problem that namespaces are precisely aiming to solve?</p>
<p>2. Complexity &#8212; effectively, encouraging using-directive for implementation files amounts to encouraging to have two different naming conventions for cpp and hpp/ipp files &#8212; multiple naming conventions raise overall coding style complexity, while one naming convention brings the advantage of a consistent, uniform style that can be used throughout the entire team/organization (independently of member/team-specific domains).</p>
<p>3. Maintenance &amp; refactoring &#8212; again, maintaining different naming conventions for cpp and hpp/ipp files means having to change (rename) the unqualified names each time we&#8217;re moving code from implementation (or specific application) to the interface (or general library); this makes the code less refactoring-friendly (again, YMMV, but another reason I may be biased here is that I routinely see &#8220;write a reusable library&#8221; as the preferred way to solve programming problems; anything that distracts from this ultimately does more harm than good).</p>
<p>I do recall Item 59 stating &#8220;which would be onerous, and frankly people just won&#8217;t put up with it.&#8221; However, it seems that (mostly) header-only libraries, like Boost, have empirically demonstrated that people do put up with it after all. Yes, it is a few extra keystrokes, but personally I find the using-directive readability, complexity, maintenance, and refactoring costs to be more onerous. Given that most code is read/maintained more often that it&#8217;s written from the scratch, isn&#8217;t optimizing the no. of keystrokes a classic case of premature optimization (on the suboptimal metric at that)?</p>
<p>Let me know if I&#8217;m wrong, perhaps I am missing something?</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 highlander-comment" id="comment-14010">
		<div id="div-comment-14010">
		<div class="cmtinfo"><em> on <a href="#comment-14010" title="">2014-01-02 at 9:53 am</a></em> <img alt='' src='https://0.gravatar.com/avatar/0400152746a64b153a4bc543bf3cf76c?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>Ralph Tandetzky</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_14010"></div><p>@Mike: For polymorphic classes your approach is an alternative. But for value classes (types being copyable and movable) a base class could introduce slicing problems. Instead of copying you would have to clone your value type. Hence normal copy semantics are impossible because of this implementation detail. The idea is to preserve the semantics of the class and only touch the internals in the private section of the class. Even in the case of a class hierarchy pimpling is sometimes preferred since it&#8217;s less code to write. Think about it: You have to create an interface class and mirror the functions there in the implementation class. This is not necessary when pimpling and only those functions are virtual which really need to be virtual giving the reader of your code an idea of intent.  He or she can then know which functions may be customized.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-14008">
		<div id="div-comment-14008">
		<div class="cmtinfo"><em> on <a href="#comment-14008" title="">2014-01-02 at 8:12 am</a></em> <img alt='' src='https://1.gravatar.com/avatar/d431d3a90df3cddef1d4f0254f63da50?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>Mike Capp</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_14008"></div><p>Given that pimpl introduces an allocation anyway, I&#8217;ve never really seen what benefits it offers that couldn&#8217;t be provided more cleanly and flexibly by a factory returning a unique_ptr to a (probably abstract) base class. Pimpl trades vtable indirection for data-access indirection, which isn&#8217;t an obvious win, and makes subclassing a good deal uglier since you need to subclass both handle and body types.</p>
<p>Could you expand on where you see the relative merits here?</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-nosenseetal even thread-even depth-1 highlander-comment" id="comment-14000">
		<div id="div-comment-14000">
		<div class="cmtinfo"><em> on <a href="#comment-14000" title="">2014-01-01 at 11:52 pm</a></em> <img alt='' src='https://0.gravatar.com/avatar/6aea6e2f57f2a7b1cd6870375fbdc42f?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>nosenseetal</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_14000"></div><p>@herb:<br />
&#8220;Note that not only does the move-only unique_ptr member disable compiler-generated copying by default, but the explicitly user-declared destructor also disables compiler-generated move by default. Thanks for the note!&#8221;<br />
I had no idea about this, if you dont consider it way tooo basic for gotw maybe you could write about that. also since it is 2014 if i could have one wish it is gotw on emplace_back vs push_back(for vector, i guess same conclusions apply to the other containers)</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-herbsutter bypostauthor odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-13995">
		<div id="div-comment-13995">
		<div class="cmtinfo"><em> on <a href="#comment-13995" title="">2014-01-01 at 3:12 pm</a></em> <img alt='' src='https://0.gravatar.com/avatar/c0ba56bfd231f8f04feb057728975181?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://www.herbsutter.com' rel='external nofollow' class='url'>Herb Sutter</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_13995"></div><p>@Marcelo: using namespace std; is perfectly fine (and should be encouraged) in an implementation file after all #includes. See C++ Coding Standards Item 59: &#8220;Don&#8217;t write namespace usings in a header file or before an #include.&#8221;</p>
<p>However, you&#8217;re right that saying &#8220;std::&#8221; in front of the list member is now redundant. Removed, with credit. Thanks!</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 highlander-comment" id="comment-13994">
		<div id="div-comment-13994">
		<div class="cmtinfo"><em> on <a href="#comment-13994" title="">2014-01-01 at 2:29 pm</a></em> <img alt='' src='https://0.gravatar.com/avatar/c630a01bbffd68435fb0ea2e7e8e62a7?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='https://plus.google.com/115208070332440137335' rel='external nofollow' class='url'>Marcelo Pinto</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_13994"></div><p>Shouldn&#8217;t the standard headers come after our own header to avoid hiding some including errors in our own headers?</p>
<p>And in the last code snippet you have &#8220;using namespace std&#8221; (that I don&#8217;t like very much) and then you have &#8220;std::list&#8230;&#8221;. Don&#8217;t you think you should avoid &#8220;using namespace std&#8221; in such a short code?</p>
<p>Best regards</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-13991">
		<div id="div-comment-13991">
		<div class="cmtinfo"><em> on <a href="#comment-13991" title="">2014-01-01 at 2:08 pm</a></em> <img alt='' src='https://0.gravatar.com/avatar/0400152746a64b153a4bc543bf3cf76c?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>Ralph Tandetzky</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_13991"></div><p>I just looked at the next question and figured out that it asks for what I already noticed. Sorry, I should have read on first. But here&#8217;s one more note: If both <code>A</code> and <code>B</code> inherit virtually from a common base (directly or indirectly) then the above change might not be as trivial. However, this is highly unlikely since <code>B</code> doesn&#8217;t have any virtual functions.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 highlander-comment" id="comment-13990">
		<div id="div-comment-13990">
		<div class="cmtinfo"><em> on <a href="#comment-13990" title="">2014-01-01 at 1:51 pm</a></em> <img alt='' src='https://0.gravatar.com/avatar/0400152746a64b153a4bc543bf3cf76c?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>Ralph Tandetzky</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_13990"></div><p>You can still remove one more header which is <code> b.h </code>. Just let the pimpl class <code> X::impl </code> inherit publicly from <code> B </code> and remove <code> B </code> as a private base of <code> X </code>. This would even work perfectly fine, if <code> B </code> had virtual functions which is excluded in the exercise.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-herbsutter bypostauthor odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-13987">
		<div id="div-comment-13987">
		<div class="cmtinfo"><em> on <a href="#comment-13987" title="">2014-01-01 at 7:20 am</a></em> <img alt='' src='https://0.gravatar.com/avatar/c0ba56bfd231f8f04feb057728975181?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://www.herbsutter.com' rel='external nofollow' class='url'>Herb Sutter</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_13987"></div><p>@Motti: I did mention earlier in the article that &#8220;If copy and move are appropriate for your type, write those four operations to perform a deep copy that clones the impl state.&#8221; but I agree it bears repeating. I&#8217;ve added an extra paragraph and an extra comment line in the code. Note that not only does the move-only unique_ptr member disable compiler-generated copying by default, but the explicitly user-declared destructor also disables compiler-generated move by default. Thanks for the note!</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-lanzkron even thread-even depth-1 highlander-comment" id="comment-13984">
		<div id="div-comment-13984">
		<div class="cmtinfo"><em> on <a href="#comment-13984" title="">2014-01-01 at 4:10 am</a></em> <img alt='' src='https://0.gravatar.com/avatar/6183c6f9d621a125cd3aa0f7ae324285?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://lanzkron.wordpress.com' rel='external nofollow' class='url'>Motti Lanzkron</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_13984"></div><p>In the requirements for #3 you say:<br />
* any current code that already uses X should not be affected beyond requiring a simple recompilation.</p>
<p>However introducing a <code>unique_ptr</code> into <code>X</code> means that <code>X</code> no longer has value semantics, its copy constructor (as well as <code>operator=</code>) are disabled, this may affect <i>current code that uses X</i></p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-13982">
		<div id="div-comment-13982">
		<div class="cmtinfo"><em> on <a href="#comment-13982" title="">2013-12-31 at 9:27 pm</a></em> <img alt='' src='https://0.gravatar.com/avatar/6aea6e2f57f2a7b1cd6870375fbdc42f?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://gravatar.com/nosenseetal' rel='external nofollow' class='url'>nosenseetal</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_13982"></div><p>Herb I guess you dont take wishlist requirements since you are not Santa, but it would be nice if VC++ compiler would support pimpl switch so people dont need to rewrite their code for daily hackery :)  but still get the productivity boost and still get the perf in release mode without pimpling :) .</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
	</ol>

	<div class="navigation">
		<div class="alignleft"></div>
		<div class="alignright"></div>
	</div>
	<br />

  	<p class="nocomments">Comments are closed.</p>
  <div class="post-content">
<p>
</p>
</div>

			</div>

		
		<p align="center"></p>

	</div><!-- end id:content-main -->
<div id="sidebar">
<ul>
<li class="sidebox"><h2><label for="subscribe-field">Follow by email</label></h2>
				<form action="https://subscribe.wordpress.com" method="post" accept-charset="utf-8" id="subscribe-blog">
																	<p><input type="text" name="email" style="width: 95%; padding: 1px 2px" placeholder="Enter your email address" value="" id="subscribe-field"/></p>
					
					<p>
						<input type="hidden" name="action" value="subscribe"/>
						<input type="hidden" name="blog_id" value="3379246"/>
						<input type="hidden" name="source" value="https://herbsutter.com/2013/12/31/gotw-7b-solution-minimizing-compile-time-dependencies-part-2/"/>
						<input type="hidden" name="sub-type" value="widget"/>
						<input type="hidden" name="redirect_fragment" value="blog_subscription-3" />
						<input type="hidden" id="_wpnonce" name="_wpnonce" value="4590924cc6" />						<input type="submit" value="Subscribe" />
					</p>
				</form>
			
</li><li class="sidebox"><h2><a href='http://twitter.com/herbsutter'>Tweets</a></h2><ul class='tweets'></ul><a href="http://twitter.com/herbsutter"  class='twitter-follow-button' data-show-count='false' data-link-color='#265e15' data-text-color='#333333'>Follow @herbsutter</a></li><li class="sidebox"><h2>Popular</h2><ul>				<li>
										<a href="https://herbsutter.com/2018/11/13/trip-report-fall-iso-c-standards-meeting-san-diego/" class="bump-view" data-bump-view="tp">
						Trip report: Fall ISO C++ standards meeting (San Diego)					</a>
										</li>
								<li>
										<a href="https://herbsutter.com/gotw/" class="bump-view" data-bump-view="tp">
						GotW					</a>
										</li>
								<li>
										<a href="https://herbsutter.com/2018/09/20/lifetime-profile-v1-0-posted/" class="bump-view" data-bump-view="tp">
						Lifetime profile v1.0 posted					</a>
										</li>
				</ul></li><li class="sidebox"><h2>Categories</h2>		<ul>
				<li class="cat-item cat-item-291"><a href="https://herbsutter.com/category/apple/" >Apple</a>
</li>
	<li class="cat-item cat-item-49277"><a href="https://herbsutter.com/category/c-net/" >C# / .NET</a>
</li>
	<li class="cat-item cat-item-2426"><a href="https://herbsutter.com/category/c/" >C++</a>
</li>
	<li class="cat-item cat-item-69816"><a href="https://herbsutter.com/category/cloud/" >Cloud</a>
</li>
	<li class="cat-item cat-item-214618"><a href="https://herbsutter.com/category/concurrency/" >Concurrency</a>
</li>
	<li class="cat-item cat-item-8259773"><a href="https://herbsutter.com/category/effective-concurrency/" >Effective Concurrency</a>
</li>
	<li class="cat-item cat-item-3696745"><a href="https://herbsutter.com/category/friday-thoughts/" >Friday Thoughts</a>
</li>
	<li class="cat-item cat-item-3867746"><a href="https://herbsutter.com/category/c/gotw/" >GotW</a>
</li>
	<li class="cat-item cat-item-79"><a href="https://herbsutter.com/category/hardware/" >Hardware</a>
</li>
	<li class="cat-item cat-item-1017"><a href="https://herbsutter.com/category/java/" >Java</a>
</li>
	<li class="cat-item cat-item-637"><a href="https://herbsutter.com/category/microsoft/" >Microsoft</a>
</li>
	<li class="cat-item cat-item-420845"><a href="https://herbsutter.com/category/opinion-editorial/" >Opinion &amp; Editorial</a>
</li>
	<li class="cat-item cat-item-1633077"><a href="https://herbsutter.com/category/reader-qa/" >Reader Q&amp;A</a>
</li>
	<li class="cat-item cat-item-2301"><a href="https://herbsutter.com/category/software-development/" >Software Development</a>
</li>
	<li class="cat-item cat-item-393523"><a href="https://herbsutter.com/category/talks-events/" >Talks &amp; Events</a>
</li>
	<li class="cat-item cat-item-1"><a href="https://herbsutter.com/category/uncategorized/" >Uncategorized</a>
</li>
	<li class="cat-item cat-item-151"><a href="https://herbsutter.com/category/web/" >Web</a>
</li>
		</ul>
			</li></ul>
</div><!-- end id:sidebar -->
</div><!-- end id:content -->
</div><!-- end id:container -->
<div id="footer">
	<div id="colophon">
		<p><a href="https://wordpress.com/?ref=footer_blog">Blog at WordPress.com.</a></p>
		<p>WPThemes.</p>
		<br class="clear" />
	</div><!-- end #colophon-->
</div><!-- end #footer-->
<!--  -->
<script type='text/javascript' src='//0.gravatar.com/js/gprofiles.js?ver=201847y'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var WPGroHo = {"my_hash":""};
/* ]]> */
</script>
<script type='text/javascript' src='https://s1.wp.com/wp-content/mu-plugins/gravatar-hovercards/wpgroho.js?m=1380573781h'></script>

	<script>
		//initialize and attach hovercards to all gravatars
		jQuery( document ).ready( function( $ ) {

			if (typeof Gravatar === "undefined"){
				return;
			}

			if ( typeof Gravatar.init !== "function" ) {
				return;
			}			

			Gravatar.profile_cb = function( hash, id ) {
				WPGroHo.syncProfileData( hash, id );
			};
			Gravatar.my_hash = WPGroHo.my_hash;
			Gravatar.init( 'body', '#wp-admin-bar-my-account' );
		});
	</script>

		<div style="display:none">
	<div class="grofile-hash-map-29d03a96b1718886fb44fb10d94f2378">
	</div>
	<div class="grofile-hash-map-0400152746a64b153a4bc543bf3cf76c">
	</div>
	<div class="grofile-hash-map-1cc4a77a8256c3049728728c6c45625b">
	</div>
	<div class="grofile-hash-map-d431d3a90df3cddef1d4f0254f63da50">
	</div>
	<div class="grofile-hash-map-6aea6e2f57f2a7b1cd6870375fbdc42f">
	</div>
	<div class="grofile-hash-map-c0ba56bfd231f8f04feb057728975181">
	</div>
	<div class="grofile-hash-map-c630a01bbffd68435fb0ea2e7e8e62a7">
	</div>
	<div class="grofile-hash-map-6183c6f9d621a125cd3aa0f7ae324285">
	</div>
	<div class="grofile-hash-map-6aea6e2f57f2a7b1cd6870375fbdc42f">
	</div>
	</div>
<script type='text/javascript' charset='UTF-8' id='polldaddyRatings'><!--//--><![CDATA[//><!--
PDRTJS_settings_468178_comm_14112={"id":468178,"unique_id":"wp-comment-14112","title":"%40mttpdI%20regularly%20do%20what%20you%20argue%20against.%20I%20wish%20there%20was%20a%20file-scope%20using%20directive%20so%20I%20could%20make%20the%20header%20consistent%20with%20the%20implementation%20file.%20I%20do%20find%20the%20need%20to%20be%20explicit%2C%20i...","permalink":"https:\/\/herbsutter.com\/2013\/12\/31\/gotw-7b-solution-minimizing-compile-time-dependencies-part-2\/#comment-14112","item_id":"_comm_14112"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_14112 == 'undefined' ){PDRTJS_468178_comm_14112 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_14112 );}}PDRTJS_settings_468178_comm_14056={"id":468178,"unique_id":"wp-comment-14056","title":"%26%23091%3B%26%238230%3B%26%23093%3B%20GotW%20%237b%20Solution%3A%20Minimizing%20Compile-Time%20Dependencies%2C%20Part%202%20%26%23091%3B%26%238230%3B%26%23093%3B...","permalink":"https:\/\/herbsutter.com\/2013\/12\/31\/gotw-7b-solution-minimizing-compile-time-dependencies-part-2\/#comment-14056","item_id":"_comm_14056"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_14056 == 'undefined' ){PDRTJS_468178_comm_14056 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_14056 );}}PDRTJS_settings_468178_comm_14038={"id":468178,"unique_id":"wp-comment-14038","title":"%40mttpd%20In%20most%20of%20my%20production%20code%20I%20don%26%23039%3Bt%20use%20%26lt%3Bcode%26gt%3Busing%20namespace%26lt%3B%2Fcode%26gt%3B.%20However%2C%20sometimes%20I%20do%20and%20I%20find%20my%20code%20more%20readable%20because%20of%20it.%20Examples%20are%20%26lt%3Bcode%26gt%3Busing%20namespace%20std%3A%3Achro...","permalink":"https:\/\/herbsutter.com\/2013\/12\/31\/gotw-7b-solution-minimizing-compile-time-dependencies-part-2\/#comment-14038","item_id":"_comm_14038"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_14038 == 'undefined' ){PDRTJS_468178_comm_14038 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_14038 );}}PDRTJS_settings_468178_comm_14024={"id":468178,"unique_id":"wp-comment-14024","title":"%40Herb%3A%20regarding%20the%20using-directive%20--%20unless%20we%26%23039%3Bre%20talking%20about%20strictly%20scoped%20uses%20%28e.g.%2C%20within%20a%20function%20scope%3B%20but%20not%20within%20%28still%20dangerous%29%20namespace%20level%29%2C%20with%20time%20I%26%23039%3Bm%20becoming%20l...","permalink":"https:\/\/herbsutter.com\/2013\/12\/31\/gotw-7b-solution-minimizing-compile-time-dependencies-part-2\/#comment-14024","item_id":"_comm_14024"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_14024 == 'undefined' ){PDRTJS_468178_comm_14024 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_14024 );}}PDRTJS_settings_468178_comm_14010={"id":468178,"unique_id":"wp-comment-14010","title":"%40Mike%3A%20For%20polymorphic%20classes%20your%20approach%20is%20an%20alternative.%20But%20for%20value%20classes%20%28types%20being%20copyable%20and%20movable%29%20a%20base%20class%20could%20introduce%20slicing%20problems.%20Instead%20of%20copying%20you%20woul...","permalink":"https:\/\/herbsutter.com\/2013\/12\/31\/gotw-7b-solution-minimizing-compile-time-dependencies-part-2\/#comment-14010","item_id":"_comm_14010"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_14010 == 'undefined' ){PDRTJS_468178_comm_14010 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_14010 );}}PDRTJS_settings_468178_comm_14008={"id":468178,"unique_id":"wp-comment-14008","title":"Given%20that%20pimpl%20introduces%20an%20allocation%20anyway%2C%20I%26%23039%3Bve%20never%20really%20seen%20what%20benefits%20it%20offers%20that%20couldn%26%23039%3Bt%20be%20provided%20more%20cleanly%20and%20flexibly%20by%20a%20factory%20returning%20a%20unique_ptr%20to%20a%20%28prob...","permalink":"https:\/\/herbsutter.com\/2013\/12\/31\/gotw-7b-solution-minimizing-compile-time-dependencies-part-2\/#comment-14008","item_id":"_comm_14008"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_14008 == 'undefined' ){PDRTJS_468178_comm_14008 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_14008 );}}PDRTJS_settings_468178_comm_14000={"id":468178,"unique_id":"wp-comment-14000","title":"%40herb%3A%26quot%3BNote%20that%20not%20only%20does%20the%20move-only%20unique_ptr%20member%20disable%20compiler-generated%20copying%20by%20default%2C%20but%20the%20explicitly%20user-declared%20destructor%20also%20disables%20compiler-generated%20move%20by%20...","permalink":"https:\/\/herbsutter.com\/2013\/12\/31\/gotw-7b-solution-minimizing-compile-time-dependencies-part-2\/#comment-14000","item_id":"_comm_14000"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_14000 == 'undefined' ){PDRTJS_468178_comm_14000 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_14000 );}}PDRTJS_settings_468178_comm_13995={"id":468178,"unique_id":"wp-comment-13995","title":"%40Marcelo%3A%20using%20namespace%20std%3B%20is%20perfectly%20fine%20%28and%20should%20be%20encouraged%29%20in%20an%20implementation%20file%20after%20all%20%23includes.%20See%20C%2B%2B%20Coding%20Standards%20Item%2059%3A%20%26quot%3BDon%26%23039%3Bt%20write%20namespace%20usings%20in%20a%20hea...","permalink":"https:\/\/herbsutter.com\/2013\/12\/31\/gotw-7b-solution-minimizing-compile-time-dependencies-part-2\/#comment-13995","item_id":"_comm_13995"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_13995 == 'undefined' ){PDRTJS_468178_comm_13995 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_13995 );}}PDRTJS_settings_468178_comm_13994={"id":468178,"unique_id":"wp-comment-13994","title":"Shouldn%26%23039%3Bt%20the%20standard%20headers%20come%20after%20our%20own%20header%20to%20avoid%20hiding%20some%20including%20errors%20in%20our%20own%20headers%3FAnd%20in%20the%20last%20code%20snippet%20you%20have%20%26quot%3Busing%20namespace%20std%26quot%3B%20%28that%20I%20don%26%23039%3Bt%20like%20ve...","permalink":"https:\/\/herbsutter.com\/2013\/12\/31\/gotw-7b-solution-minimizing-compile-time-dependencies-part-2\/#comment-13994","item_id":"_comm_13994"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_13994 == 'undefined' ){PDRTJS_468178_comm_13994 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_13994 );}}PDRTJS_settings_468178_comm_13991={"id":468178,"unique_id":"wp-comment-13991","title":"I%20just%20looked%20at%20the%20next%20question%20and%20figured%20out%20that%20it%20asks%20for%20what%20I%20already%20noticed.%20Sorry%2C%20I%20should%20have%20read%20on%20first.%20But%20here%26%23039%3Bs%20one%20more%20note%3A%20If%20both%20%26lt%3Bcode%26gt%3BA%26lt%3B%2Fcode%26gt%3B%20and%20%26lt%3Bcode%26gt%3BB%26lt%3B%2Fcode%26gt%3B...","permalink":"https:\/\/herbsutter.com\/2013\/12\/31\/gotw-7b-solution-minimizing-compile-time-dependencies-part-2\/#comment-13991","item_id":"_comm_13991"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_13991 == 'undefined' ){PDRTJS_468178_comm_13991 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_13991 );}}PDRTJS_settings_468178_comm_13990={"id":468178,"unique_id":"wp-comment-13990","title":"You%20can%20still%20remove%20one%20more%20header%20which%20is%20%26lt%3Bcode%26gt%3B%20b.h%20%26lt%3B%2Fcode%26gt%3B.%20Just%20let%20the%20pimpl%20class%20%26lt%3Bcode%26gt%3B%20X%3A%3Aimpl%20%26lt%3B%2Fcode%26gt%3B%20inherit%20publicly%20from%20%26lt%3Bcode%26gt%3B%20B%20%26lt%3B%2Fcode%26gt%3B%20and%20remove%20%26lt%3Bcode%26gt%3B%20B%20%26lt%3B%2Fcode%26gt%3B%20as%20a%20private%20b...","permalink":"https:\/\/herbsutter.com\/2013\/12\/31\/gotw-7b-solution-minimizing-compile-time-dependencies-part-2\/#comment-13990","item_id":"_comm_13990"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_13990 == 'undefined' ){PDRTJS_468178_comm_13990 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_13990 );}}PDRTJS_settings_468178_comm_13987={"id":468178,"unique_id":"wp-comment-13987","title":"%40Motti%3A%20I%20did%20mention%20earlier%20in%20the%20article%20that%20%26quot%3BIf%20copy%20and%20move%20are%20appropriate%20for%20your%20type%2C%20write%20those%20four%20operations%20to%20perform%20a%20deep%20copy%20that%20clones%20the%20impl%20state.%26quot%3B%20but%20I%20agree%20it%20b...","permalink":"https:\/\/herbsutter.com\/2013\/12\/31\/gotw-7b-solution-minimizing-compile-time-dependencies-part-2\/#comment-13987","item_id":"_comm_13987"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_13987 == 'undefined' ){PDRTJS_468178_comm_13987 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_13987 );}}PDRTJS_settings_468178_comm_13984={"id":468178,"unique_id":"wp-comment-13984","title":"In%20the%20requirements%20for%20%233%20you%20say%3A%2A%20any%20current%20code%20that%20already%20uses%20X%20should%20not%20be%20affected%20beyond%20requiring%20a%20simple%20recompilation.However%20introducing%20a%20%26lt%3Bcode%26gt%3Bunique_ptr%26lt%3B%2Fcode%26gt%3B%20into%20%26lt%3Bcode%26gt%3BX...","permalink":"https:\/\/herbsutter.com\/2013\/12\/31\/gotw-7b-solution-minimizing-compile-time-dependencies-part-2\/#comment-13984","item_id":"_comm_13984"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_13984 == 'undefined' ){PDRTJS_468178_comm_13984 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_13984 );}}PDRTJS_settings_468178_comm_13982={"id":468178,"unique_id":"wp-comment-13982","title":"Herb%20I%20guess%20you%20dont%20take%20wishlist%20requirements%20since%20you%20are%20not%20Santa%2C%20but%20it%20would%20be%20nice%20if%20VC%2B%2B%20compiler%20would%20support%20pimpl%20switch%20so%20people%20dont%20need%20to%20rewrite%20their%20code%20for%20daily%20hack...","permalink":"https:\/\/herbsutter.com\/2013\/12\/31\/gotw-7b-solution-minimizing-compile-time-dependencies-part-2\/#comment-13982","item_id":"_comm_13982"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_13982 == 'undefined' ){PDRTJS_468178_comm_13982 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_13982 );}}
//--><!]]></script><script type='text/javascript' charset='UTF-8' src='https://polldaddy.com/js/rating/rating.js'></script><script type='text/javascript' src='https://platform.twitter.com/widgets.js?ver=20111117'></script>
<script type='text/javascript' src='https://s1.wp.com/_static/??-eJzTLy/QTc7PK0nNK9EvyClNz8wr1i+uzCtJrMjITM/IAeKS1CJMEWP94uSizIISoOIM5/yiVL2sYh19yo1yKiotzgjISczMAxpon2traGJkZGxiZGhskgUAFHlAaw=='></script>
<script type='text/javascript'>
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "https://s1.wp.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.9b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "https://s2.wp.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?m=1363304414h&amp;ver=3.0.9b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.defaults['toolbar'] = false;
	SyntaxHighlighter.all();

	// Infinite scroll support
	if ( typeof( jQuery ) !== 'undefined' ) {
		jQuery( function( $ ) {
			$( document.body ).on( 'post-load', function() {
				SyntaxHighlighter.highlight();
			} );
		} );
	}
</script>
<script type='text/javascript'>
/* <![CDATA[ */
var actionbardata = {"siteID":"3379246","siteName":"Sutter\u2019s Mill","siteURL":"https:\/\/herbsutter.com","icon":"<img alt='' src='https:\/\/secure.gravatar.com\/blavatar\/4554b8d24c7f200dc5e2e1b18db1893f?s=50&d=https%3A%2F%2Fs2.wp.com%2Fi%2Flogo%2Fwpcom-gray-white.png' class='avatar avatar-50' height='50' width='50' \/>","canManageOptions":"","canCustomizeSite":"","isFollowing":"","themeSlug":"pub\/mistylook","signupURL":"https:\/\/wordpress.com\/start\/","loginURL":"https:\/\/herbsutter.wordpress.com\/wp-login.php?redirect_to=https%3A%2F%2Fherbsutter.com%2F2013%2F12%2F31%2Fgotw-7b-solution-minimizing-compile-time-dependencies-part-2%2F","themeURL":"","xhrURL":"https:\/\/herbsutter.com\/wp-admin\/admin-ajax.php","nonce":"8fb9818ae2","isSingular":"1","isFolded":"","isLoggedIn":"","isMobile":"","subscribeNonce":"<input type=\"hidden\" id=\"_wpnonce\" name=\"_wpnonce\" value=\"4590924cc6\" \/>","referer":"https:\/\/herbsutter.com\/2013\/12\/31\/gotw-7b-solution-minimizing-compile-time-dependencies-part-2\/","canFollow":"1","feedID":"171936","statusMessage":"","customizeLink":"https:\/\/herbsutter.wordpress.com\/wp-admin\/customize.php?url=https%3A%2F%2Fherbsutter.wordpress.com%2F2013%2F12%2F31%2Fgotw-7b-solution-minimizing-compile-time-dependencies-part-2%2F","postID":"2384","shortlink":"https:\/\/wp.me\/peb5Y-Cs","canEditPost":"","editLink":"https:\/\/wordpress.com\/post\/herbsutter.com\/2384","statsLink":"https:\/\/wordpress.com\/stats\/post\/2384\/herbsutter.com","i18n":{"view":"View site","follow":"Follow","following":"Following","edit":"Edit","login":"Log in","signup":"Sign up","customize":"Customize","report":"Report this content","themeInfo":"Get theme: MistyLook","shortlink":"Copy shortlink","copied":"Copied","followedText":"New posts from this site will now appear in your <a href=\"https:\/\/wordpress.com\/\">Reader<\/a>","foldBar":"Collapse this bar","unfoldBar":"Expand this bar","editSubs":"Manage subscriptions","viewReader":"View site in Reader","viewReadPost":"View post in Reader","subscribe":"Sign me up","enterEmail":"Enter your email address","followers":"Join 19,532 other followers","alreadyUser":"Already have a WordPress.com account? <a href=\"https:\/\/herbsutter.wordpress.com\/wp-login.php?redirect_to=https%3A%2F%2Fherbsutter.com%2F2013%2F12%2F31%2Fgotw-7b-solution-minimizing-compile-time-dependencies-part-2%2F\">Log in now.<\/a>","stats":"Stats"}};
/* ]]> */
</script>
<script type='text/javascript' src='https://s0.wp.com/_static/??-eJyVjcEOgjAQRH/IuoIYT8Zvqe2GLrQLdlvAv7ceJEYTEg+bTGbe7MA8KjNwQk7QCVicyOC47DvZwUcUshp9bokFPPUocM+Y0Wm2HuM3/CblwUkvjlrnyyWMv87GjraBWN10hKCloEWpYcIYyZb91fvzQ4ra9LJVMokGfpVWVehruFSnujo0x+Zcd0+y+3Rn'></script>
<script type="text/javascript">
// <![CDATA[
(function() {
try{
  if ( window.external &&'msIsSiteMode' in window.external) {
    if (window.external.msIsSiteMode()) {
      var jl = document.createElement('script');
      jl.type='text/javascript';
      jl.async=true;
      jl.src='/wp-content/plugins/ie-sitemode/custom-jumplist.php';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(jl, s);
    }
  }
}catch(e){}
})();
// ]]>
</script><script src="//stats.wp.com/w.js?56" type="text/javascript" async defer></script>
<script type="text/javascript">
_tkq = window._tkq || [];
_stq = window._stq || [];
_tkq.push(['storeContext', {'blog_id':'3379246','blog_tz':'-8','user_lang':'en','blog_lang':'en','user_id':'0'}]);
_stq.push(['view', {'blog':'3379246','v':'wpcom','tz':'-8','user_id':'0','post':'2384','subd':'herbsutter'}]);
_stq.push(['extra', {'crypt':'UE40eW5QN0p8M2Y/RE1TaVhzUzFMbjdWNHpwZGhTayxPSUFCMGNrd29+Smw0TDhnZmRTK0hlRi9QSGh6bi9GXVhBJWIlZlR5U1JMLU8/MkNtblkvY1d1TjBELytHc0k/MXdHUVQyK2IyUVA5SjU1bj9VX3ExLHYsREFpcnlfNHYtXV1HSUIsLkJrcnp0eS5sNDZ3U1M5X0RockJaSDI2ZFhrSD8rM1orK29nTzhfNmJMWkM0fG5qXV1tSEpsLjFuWlB8c1JWNjBrfjd4NDdFMkJYJkFORnBRJVZlQmZ3NmxQQ3l+Z1gwVXdCbmJJbEo0Z0NRbi5OKyxCTyVDdWdvRWRvQXAwRzladldOOUdiLCYtL05Gaz0rc2NiT1BuNEp0dDUmb3dLUlAuWzVoWmV1S1VRWVY3Zjh+NWEyaTFXbVdRZGhPN3RaOSZJYm9qOExZc0NscTRTZg=='}]);
_stq.push([ 'clickTrackerInit', '3379246', '2384' ]);
	</script>
<noscript><img src="https://pixel.wp.com/b.gif?v=noscript" style="height:0px;width:0px;overflow:hidden" alt="" /></noscript>
<script>
if ( 'object' === typeof wpcom_mobile_user_agent_info ) {

	wpcom_mobile_user_agent_info.init();
	var mobileStatsQueryString = "";
	
	if( false !== wpcom_mobile_user_agent_info.matchedPlatformName )
		mobileStatsQueryString += "&x_" + 'mobile_platforms' + '=' + wpcom_mobile_user_agent_info.matchedPlatformName;
	
	if( false !== wpcom_mobile_user_agent_info.matchedUserAgentName )
		mobileStatsQueryString += "&x_" + 'mobile_devices' + '=' + wpcom_mobile_user_agent_info.matchedUserAgentName;
	
	if( wpcom_mobile_user_agent_info.isIPad() )
		mobileStatsQueryString += "&x_" + 'ipad_views' + '=' + 'views';

	if( "" != mobileStatsQueryString ) {
		new Image().src = document.location.protocol + '//pixel.wp.com/g.gif?v=wpcom-no-pv' + mobileStatsQueryString + '&baba=' + Math.random();
	}
	
}
</script></body>
</html>