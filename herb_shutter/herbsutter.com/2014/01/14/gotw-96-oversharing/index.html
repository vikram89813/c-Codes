<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>GotW #96: Oversharing | Sutter’s Mill</title>
<link rel="pingback" href="https://herbsutter.com/xmlrpc.php" />
<script type="text/javascript">
  WebFontConfig = {"typekit":{"id":"eyo0tqd"}};
  (function() {
    var wf = document.createElement('script');
    wf.src = 'https://s0.wp.com/wp-content/plugins/custom-fonts/js/webfont.js';
    wf.type = 'text/javascript';
    wf.async = 'true';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(wf, s);
	})();
</script><style id="jetpack-custom-fonts-css">.wf-active #header h1{font-size:2.12em;font-family:"ff-dagny-web-pro-1","ff-dagny-web-pro-2",sans-serif;font-style:normal;font-weight:400}.wf-active body{font-size:89.7%;font-family:"ff-basic-gothic-web-pro-1","ff-basic-gothic-web-pro-2",sans-serif}.wf-active #navigation{font-family:"ff-basic-gothic-web-pro-1","ff-basic-gothic-web-pro-2",sans-serif}.wf-active #navigation ul li.search{font-size:1.06em}.wf-active #navigation ul li.search input#searchsubmit{font-size:1.06em}.wf-active #content .post-info, .wf-active #content .postmetadata{font-size:1.06em}.wf-active #sidebar{font-size:1.06em}.wf-active #footer p.right{font-size:1.06em}.wf-active .commentnum{font-size:1.77em}.wf-active .commentlist li .cmtinfo{font-size:1.18em}.wf-active .commentlist li .cmtinfo em{font-size:1.06em}.wf-active #respond label{font-size:11.8px}.wf-active #respond .required{font-size:11.8px}.wf-active #respond .subscribe-label{font-size:14.2px}.wf-active #respond .comment-notes{font-size:13px}.wf-active .wp-caption p.wp-caption-text{font-size:13px}.wf-active #content h1, .wf-active h2, .wf-active h3, .wf-active h4, .wf-active h5, .wf-active h6{font-family:"ff-dagny-web-pro-1","ff-dagny-web-pro-2",sans-serif;font-style:normal;font-weight:400}.wf-active #header h2{font-size:1.18em;font-weight:400;font-family:"ff-dagny-web-pro-1","ff-dagny-web-pro-2",sans-serif;font-style:normal}.wf-active #content h3{font-size:1.65em;font-weight:400;font-style:normal}.wf-active #content h4{font-size:1.3em;font-style:normal;font-weight:400}.wf-active #content h5{font-size:1.18em;font-style:normal;font-weight:400}.wf-active #content .post h2{font-size:1.65em;font-weight:400;font-style:normal}.wf-active li.sidebox h2{font-weight:400;font-size:1.89em;font-style:normal}.wf-active .post h4{font-size:1.18em;font-weight:400;font-family:"ff-dagny-web-pro-1","ff-dagny-web-pro-2",sans-serif;font-style:normal}.wf-active .post h4 em{font-style:normal;font-weight:400}</style>
		<script src='https://r-login.wordpress.com/remote-login.php?action=js&amp;host=herbsutter.com&amp;id=3379246&amp;t=1542965502&amp;back=https%3A%2F%2Fherbsutter.com%2F2014%2F01%2F14%2Fgotw-96-oversharing%2F' type="text/javascript"></script>
		<script type="text/javascript">
		/* <![CDATA[ */
			if ( 'function' === typeof WPRemoteLogin ) {
				document.cookie = "wordpress_test_cookie=test; path=/";
				if ( document.cookie.match( /(;|^)\s*wordpress_test_cookie\=/ ) ) {
					WPRemoteLogin();
				}
			}
		/* ]]> */
		</script>
		<link rel='dns-prefetch' href='//s2.wp.com' />
<link rel='dns-prefetch' href='//s0.wp.com' />
<link rel='dns-prefetch' href='//s1.wp.com' />
<link rel='dns-prefetch' href='//herbsutter.wordpress.com' />
<link rel="alternate" type="application/rss+xml" title="Sutter’s Mill &raquo; Feed" href="https://herbsutter.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="Sutter’s Mill &raquo; Comments Feed" href="https://herbsutter.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Sutter’s Mill &raquo; GotW #96: Oversharing Comments Feed" href="https://herbsutter.com/2014/01/14/gotw-96-oversharing/feed/" />
	<script type="text/javascript">
		/* <![CDATA[ */
		function addLoadEvent(func) {
			var oldonload = window.onload;
			if (typeof window.onload != 'function') {
				window.onload = func;
			} else {
				window.onload = function () {
					oldonload();
					func();
				}
			}
		}
		/* ]]> */
	</script>
			<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s0.wp.com\/wp-content\/mu-plugins\/wpcom-smileys\/twemoji\/2\/72x72\/","ext":".png","svgUrl":"https:\/\/s0.wp.com\/wp-content\/mu-plugins\/wpcom-smileys\/twemoji\/2\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/s1.wp.com\/wp-includes\/js\/wp-emoji-release.min.js?m=1532082729h&ver=4.9.8"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56760,9792,65039],[55358,56760,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel='stylesheet' id='all-css-0-1' href='https://s2.wp.com/_static/??-eJyNkN1uwjAMhV9onsUG69W0Z0laE0zzp8QR6tvjUlUCwSpuonOS81knxkuGPkWhKBgaZN8cx4qeR6p4JsmmH+HmPvtaP/B1nOORI8uEcqKgYG4WA1eZfErjFtinQnofspE5EWhgQ15nRNnCQv5ZqVmetORmv0vWNFibC9UKegZuAZayT9wKuabWUnEwt0Tb2A9ofbotxBZTJpx/SE8DXi3hn+h9Rx4cSUVJGXKqqt5GaurZeGCNPJoFZoxJlsdVbE11lEB/aYRTfDBw9IbLFlpI9+NUOtTUnZ2hv/C7O+y/uu9uf+jOV8Xg7sY=?cssminify=yes' type='text/css' media='all' />
<link rel='stylesheet' id='print-css-1-1' href='https://s2.wp.com/wp-content/mu-plugins/global-print/global-print.css?m=1465851035h&cssminify=yes' type='text/css' media='print' />
<link rel='stylesheet' id='all-css-2-1' href='https://s0.wp.com/_static/??/wp-content/mu-plugins/actionbar/actionbar.css,/wp-content/themes/h4/global.css?m=1516985148j&cssminify=yes' type='text/css' media='all' />
<script type='text/javascript' src='https://s0.wp.com/_static/??-eJyFztEKwjAMBdAfsquTiXsRv6XWOFKXtDbphn69HeiDMBQCgdzDJXZOBtmP5QJiQ517gfx4rybIxv4ChnDITqEh5A/2kRVYF0vxjCOYIpDdUG+16BpXXIqiBCIVraTfLyFPCPNfFkCT8zeTQfC5tJ7o2Hb9Yde3+24bXjRNW9I='></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://herbsutter.wordpress.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://s1.wp.com/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='GotW #95 Solution: Thread Safety and&nbsp;Synchronization' href='https://herbsutter.com/2014/01/13/gotw-95-solution-thread-safety-and-synchronization/' />
<link rel='next' title='Trip report: Winter ISO C++&nbsp;meeting' href='https://herbsutter.com/2014/02/17/trip-report-winter-iso-c-meeting/' />
<meta name="generator" content="WordPress.com" />
<link rel="canonical" href="https://herbsutter.com/2014/01/14/gotw-96-oversharing/" />
<link rel='shortlink' href='https://wp.me/peb5Y-CW' />
<link rel="alternate" type="application/json+oembed" href="https://public-api.wordpress.com/oembed/?format=json&amp;url=https%3A%2F%2Fherbsutter.com%2F2014%2F01%2F14%2Fgotw-96-oversharing%2F&amp;for=wpcom-auto-discovery" /><link rel="alternate" type="application/xml+oembed" href="https://public-api.wordpress.com/oembed/?format=xml&amp;url=https%3A%2F%2Fherbsutter.com%2F2014%2F01%2F14%2Fgotw-96-oversharing%2F&amp;for=wpcom-auto-discovery" />
<!-- Jetpack Open Graph Tags -->
<meta property="og:type" content="article" />
<meta property="og:title" content="GotW #96: Oversharing" />
<meta property="og:url" content="https://herbsutter.com/2014/01/14/gotw-96-oversharing/" />
<meta property="og:description" content="Following on from #95, let&#8217;s consider reasons and methods to avoid mutable sharing in the first place…  Problem Consider the following code from GotW #95&#8217;s solution, where some_obj is a…" />
<meta property="article:published_time" content="2014-01-14T16:55:10+00:00" />
<meta property="article:modified_time" content="2014-01-14T16:55:10+00:00" />
<meta property="og:site_name" content="Sutter’s Mill" />
<meta property="og:image" content="https://secure.gravatar.com/blavatar/4554b8d24c7f200dc5e2e1b18db1893f?s=200&amp;ts=1542965502" />
<meta property="og:image:width" content="200" />
<meta property="og:image:height" content="200" />
<meta property="og:locale" content="en_US" />
<meta name="twitter:site" content="@wordpressdotcom" />
<meta name="twitter:text:title" content="GotW #96: Oversharing" />
<meta name="twitter:image" content="https://secure.gravatar.com/blavatar/4554b8d24c7f200dc5e2e1b18db1893f?s=240" />
<meta name="twitter:card" content="summary" />
<meta property="article:publisher" content="https://www.facebook.com/WordPresscom" />

<!-- End Jetpack Open Graph Tags -->
<link rel="shortcut icon" type="image/x-icon" href="https://secure.gravatar.com/blavatar/4554b8d24c7f200dc5e2e1b18db1893f?s=32" sizes="16x16" />
<link rel="icon" type="image/x-icon" href="https://secure.gravatar.com/blavatar/4554b8d24c7f200dc5e2e1b18db1893f?s=32" sizes="16x16" />
<link rel="apple-touch-icon-precomposed" href="https://secure.gravatar.com/blavatar/4554b8d24c7f200dc5e2e1b18db1893f?s=114" />
<link rel='openid.server' href='https://herbsutter.wordpress.com/?openidserver=1' />
<link rel='openid.delegate' href='https://herbsutter.wordpress.com/' />
<link rel="search" type="application/opensearchdescription+xml" href="https://herbsutter.com/osd.xml" title="Sutter’s Mill" />
<link rel="search" type="application/opensearchdescription+xml" href="https://s1.wp.com/opensearch.xml" title="WordPress.com" />
		<style id="wpcom-hotfix-masterbar-style">
			@media screen and (min-width: 783px) {
				#wpadminbar .quicklinks li#wp-admin-bar-my-account.with-avatar > a img {
					margin-top: 5px;
				}
			}
		</style>
		<script type="text/javascript" id="webfont-output">
  
  WebFontConfig = {"typekit":{"id":"cjs1oxc"}};
  (function() {
    var wf = document.createElement('script');
    wf.src = ('https:' == document.location.protocol ? 'https' : 'http') +
      '://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';
    wf.type = 'text/javascript';
    wf.async = 'true';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(wf, s);
	})();
</script><style type="text/css">
.widget_twitter li {
	word-wrap: break-word;
}
</style>
<meta name="application-name" content="Sutter’s Mill" /><meta name="msapplication-window" content="width=device-width;height=device-height" /><meta name="msapplication-tooltip" content="Herb Sutter on software development" /><meta name="msapplication-task" content="name=Subscribe;action-uri=https://herbsutter.com/feed/;icon-uri=https://secure.gravatar.com/blavatar/4554b8d24c7f200dc5e2e1b18db1893f?s=16" /><meta name="msapplication-task" content="name=Sign up for a free blog;action-uri=http://wordpress.com/signup/;icon-uri=https://s1.wp.com/i/favicon.ico" /><meta name="msapplication-task" content="name=WordPress.com Support;action-uri=http://support.wordpress.com/;icon-uri=https://s1.wp.com/i/favicon.ico" /><meta name="msapplication-task" content="name=WordPress.com Forums;action-uri=http://forums.wordpress.com/;icon-uri=https://s1.wp.com/i/favicon.ico" /><meta name="description" content="Following on from #95, let&#039;s consider reasons and methods to avoid mutable sharing in the first place…  Problem Consider the following code from GotW #95&#039;s solution, where some_obj is a shared variable visible to multiple threads which then synchronize access to it. // thread 1{ lock_guard hold(mut_some_obj); // acquire lock code_that_reads_from( some_obj ); // passes&hellip;" />
<style type="text/css">
			#header h1 a,
		#header h2 {
			color: #265E15 !important;
		}
				#headerimage {
			background: url('https://herbsutter.files.wordpress.com/2011/10/cropped-blog-header.jpg') no-repeat;
			height: 200px;
		}
	</style>
<link rel="amphtml" href="https://herbsutter.com/2014/01/14/gotw-96-oversharing/amp/"><style type="text/css" id="syntaxhighlighteranchor"></style>
		<link rel="stylesheet" id="custom-css-css" type="text/css" href="https://s2.wp.com/?custom-css=1&#038;csblog=eb5Y&#038;cscache=6&#038;csrev=60" />
		</head>
<body id="section-index" class="post-template-default single single-post postid-2414 single-format-standard mp6 customizer-styles-applied highlander-enabled highlander-light">


<div id="navigation" class="clearfix">
		<div class="menu">
		<ul>
			<li ><a href="https://herbsutter.com/" title="Home">Home</a></li>
			<li class="page_item page-item-912"><a href="https://herbsutter.com/welcome-to-the-jungle/">Welcome to the&nbsp;Jungle</a></li>
<li class="page_item page-item-864 page_item_has_children"><a href="https://herbsutter.com/gotw/">GotW</a></li>
<li class="page_item page-item-761"><a href="https://herbsutter.com/elements-of-modern-c-style/">Elements of Modern C++&nbsp;Style</a></li>
<li class="page_item page-item-2 page_item_has_children"><a href="https://herbsutter.com/about/">About</a></li>
									<li class="search"><form method="get" id="searchform" action="https://herbsutter.com"><input type="text" class="textbox" value="" name="s" id="s" /><input type="submit" id="searchsubmit" value="Search" /></form></li>
					</ul>
	</div>
</div><!-- end id:navigation -->

<div id="container">

<div id="header">
<h1><a href="https://herbsutter.com/" title="Sutter’s Mill">Sutter’s Mill</a></h1>
<h2>Herb Sutter on software development</h2>
</div><!-- end id:header -->


	
		<div id="feedarea">
	<dl>
		<dt><strong>Feeds:</strong></dt>

			<dd><a href="https://herbsutter.com/feed/">Posts</a></dd>
	
			<dd><a href="https://herbsutter.com/comments/feed/">Comments</a></dd>
		</dl>
	</div><!-- end id:feedarea -->
	
	<div id="headerimage">
</div><!-- end id:headerimage -->

<div id="content">
<div id="content-main">

		
									<div class="postnav">
				<div class="alignleft">&laquo; <a href="https://herbsutter.com/2014/01/13/gotw-95-solution-thread-safety-and-synchronization/" rel="prev">GotW #95 Solution: Thread Safety and&nbsp;Synchronization</a></div>
				<div class="alignright"><a href="https://herbsutter.com/2014/02/17/trip-report-winter-iso-c-meeting/" rel="next">Trip report: Winter ISO C++&nbsp;meeting</a> &raquo;</div>
			</div>
			
			<div class="post-2414 post type-post status-publish format-standard hentry category-gotw" id="post-2414">
				<div class="posttitle">
					<h2>GotW #96: Oversharing</h2>
					<p class="post-info">2014-01-14 by <a href="https://herbsutter.com/author/herbsutter/" title="Posts by Herb Sutter">Herb Sutter</a>  </p>
				</div>

				<div class="entry">
					<p><span style="color:#5a5a5a;"><em>Following on from #95, let&#8217;s consider reasons and methods to avoid mutable sharing in the first place…<br />
</em></span></p>
<p>
 </p>
<h1>Problem<br />
</h1>
<p>Consider the following code from GotW #95&#8217;s solution, where <span style="color:#2e74b5;">some_obj</span> is a shared variable visible to multiple threads which then synchronize access to it.
</p>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code>// thread 1<br />{<br />    lock_guard hold(mut_some_obj);     // acquire lock<br />    code_that_reads_from( some_obj );  // passes some_obj by const &amp;<br />}<br /><br />// thread 2<br />{<br />    lock_guard hold(mut_some_obj);     // acquire lock<br />    code_that_modifies( some_obj );    // passes some_obj by non-const &amp;<br />}
</code></pre>
</p>
<p>
 </p>
<h2>JG Questions<br />
</h2>
<p>1. Why do mutable shared variables like <span style="color:#2e74b5;">some_obj</span> make your code:
</p>
<p style="margin-left:36pt;">(a) more complex?
</p>
<p style="margin-left:36pt;">(b) more brittle?
</p>
<p style="margin-left:36pt;">(c) less scalable?
</p>
<p>
 </p>
<h2>Guru Questions<br />
</h2>
<p>2. Give an example of how the code that uses a mutable shared variable like <span style="color:#2e74b5;">some_obj</span> can be changed so that the variable is:
</p>
<p style="margin-left:36pt;">(a) <em>not shared</em>.
</p>
<p style="margin-left:36pt;">(b) <em>not mutable</em>.
</p>
<p>3. Let&#8217;s say we&#8217;re in a situation where we can&#8217;t apply the techniques from the answers to #2, so that the variable itself must remain shared and apparently mutable. Is there any way that the <em>internal implementation</em> of the variable can make the variable be <em>physically </em>not shared and/or not mutable, so that the calling code can treat it as a logically shared-and-mutable object yet not need to perform external synchronization? If so, explain. If not, why not?</p>
									</div>

				<p class="postmetadata">
					Posted in <a href="https://herbsutter.com/category/c/gotw/" rel="category tag">GotW</a> | 											16 Comments									</p>
				
<!-- You can start editing here. -->

<h3 id="comments">16 Responses</h3>

	<ol class="commentlist">
			<li class="comment even thread-even depth-1 highlander-comment" id="comment-15025">
		<div id="div-comment-15025">
		<div class="cmtinfo"><em> on <a href="#comment-15025" title="">2014-02-13 at 1:18 am</a></em> <img alt='' src='https://1.gravatar.com/avatar/1e38308230a4be228501f90ede4ad61a?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://gravatar.com/xiongzou' rel='external nofollow' class='url'>xiongzou</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_15025"></div><p>if we assume that Herb only wants thread 1 reads and thread 2 writes. we can make the variable itself an active object that when write, it will duplicate its latest state and enqueue it into a threading safe queue, when read, dequeue from the queue and process the copy of the latest state.</p>
<p>To have a better simulation of the synchronous read/write locks between two threads, make sure reading thread only process latest state if there are multiple states in the queue. Maybe a stack with sequence number in each duplicated states can help to speed up the performance.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-14165">
		<div id="div-comment-14165">
		<div class="cmtinfo"><em> on <a href="#comment-14165" title="">2014-01-20 at 8:27 am</a></em> <img alt='' src='https://1.gravatar.com/avatar/18afd5485cf7f169a22cb51d64531c54?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>Michael Golub</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_14165"></div><p>1. a. Increased ratio between boilerplate code and actual logic makes code more complex.<br />
1. b. If boilerplate code is forgotten problem is not seen immediately. Such buggy code will compile and pass unit tests.<br />
1. c. With example as-is we can not have multiple readers simultaneously. If shared object is overly large (bad design anyway) with independently modifiable members we have sub-optimal lock granularity.<br />
2. It requires a change in algorithm that uses shared object. If algorithm relies on sharing and modification to work data should be physically shared and modifiable. Or algorithm that works on once shared data must be changed.<br />
3. Make shared object internally synchronized. Mark methods that modify shared data as const. Thanks to knowledge of internal structure may be more efficient. Can be hard to implement in practice.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-duhonedd even thread-even depth-1 highlander-comment" id="comment-14149">
		<div id="div-comment-14149">
		<div class="cmtinfo"><em> on <a href="#comment-14149" title="">2014-01-17 at 10:06 am</a></em> <img alt='' src='https://1.gravatar.com/avatar/18d0bf49bbdc669688b8d3f79dd5a914?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://duhoneblog.wordpress.com' rel='external nofollow' class='url'>duhonedd</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_14149"></div><p>1) The primary problem is that it is too easy for a  user of some_obj to forget, or not even realize that synchronization is required. Especially as a program gets very large. some_obj will be relying on a comment that programmers won&#8217;t read to inform them that synchronization is needed. On the plus side, by not embedding synchronization into some_obj&#8217;s class, you wont have to pay for it if you don&#8217;t need it on some_obj2.</p>
<p>2, 3) The main goal is to make sure users can&#8217;t accidently use a shared object without synchronization, and hopefully to at the same time not require it if another instance is used strictly internally somewhere that is already internally synchronized. It would also be nice if the maintainer of the class of some_obj didn&#8217;t have to think about synchronization, keep concerns separated. For this I like the handle body idiom. No classes provide synchronization directly, instead a family of thread safe handles can be used to wrap an instance in, when needed. We can also make use of this handle to cleanly synchronize when we need to make multiple calls to some_obj atomicly. Code is below.</p>
<pre>
<code>
template&amp;lttypename T&amp;gt
class Shared
{
public:
    void Lock(std::function&amp;ltvoid (T&amp; _instance)&amp;gt _work)
    {
        std::lock_guard&amp;ltstd::mutex7gt lock(m_mutex);
        _work(m_instance);
    }
private:
    std::mutex m_mutex;
    T m_instance;
};

Shared&amp;ltFoo&amp;gt some_obj;
some_obj.Lock([](auto _instance){
    _instance.foo1();
    _instance.foo2();
});
</code>
</pre>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-bartoszmilewski odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-14145">
		<div id="div-comment-14145">
		<div class="cmtinfo"><em> on <a href="#comment-14145" title="">2014-01-16 at 2:17 pm</a></em> <img alt='' src='https://0.gravatar.com/avatar/c018f213204496b4bbf481e7c8e6c15c?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://www.relisoft.com' rel='external nofollow' class='url'>Bartosz Milewski</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_14145"></div><p>Question 3. If the variable is not physically shared, then threads won&#8217;t be able to see each other&#8217;s writes. But if that&#8217;s okay, then you can give each thread its own private copy to read and modify and then, at a later time, collect the results and merge them, a la map/reduce. Is that what you had in mind?</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-bartoszmilewski even thread-even depth-1 highlander-comment" id="comment-14144">
		<div id="div-comment-14144">
		<div class="cmtinfo"><em> on <a href="#comment-14144" title="">2014-01-16 at 12:50 pm</a></em> <img alt='' src='https://0.gravatar.com/avatar/c018f213204496b4bbf481e7c8e6c15c?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://www.relisoft.com' rel='external nofollow' class='url'>Bartosz Milewski</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_14144"></div><p>Question 2. Except for trivial cases, data has to be passed between threads. There are many ways to do it and some of them don&#8217;t require additional synchronization. I&#8217;m saying &#8220;additional&#8221; because there are two synchronization points in the life of every thread: its creation and its destruction. </p>
<p>So you can create data before you pass it to the thread constructor and, if you can guarantee that you won&#8217;t access it afterwards, the thread is free to use it without synchronization. Similarly, a thread may create and manipulate data before it returns it (e.g., through a future) to the caller. The best guarantee of non-access is provided by move semantics. When you move your data to the constructor of the thread, or move it back from the thread, you are guaranteed that there is only one thread at a time that can access it. </p>
<p>Another way to avoid synchronization is to use immutable data. In that case many threads may access the same data concurrently without synchronization. You have to make sure though that the data was created before the threads were started (or there is some other &#8220;happens before&#8221; edge between creation and use), because data creation almost always involves mutation.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-sbohmann odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-14138">
		<div id="div-comment-14138">
		<div class="cmtinfo"><em> on <a href="#comment-14138" title="">2014-01-15 at 4:35 pm</a></em> <img alt='' src='https://2.gravatar.com/avatar/294f0812e844d56ae17adb9b025dba39?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>sbohmann</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_14138"></div><p>@Bartosz true :) but what is in my opinion often underrated is that even in the absence of any kind of threads, shared mutable values can break a human mind&#8217;s limits of understanding the consequences of possible interference quite easily&#8230;</p>
<p>Coroutines are just a classic example, but they are also not a precondition for creating mind-boggling complexity.</p>
<p>Even in the simplest of purely procedural single-threaded programs without event loops driving coroutines etc. can you do that by modifying global variables.</p>
<p>And shared mutable state has a lot in common with non-const global variables.</p>
<p>The only basic difference is that you know for sure that such globals are visible and writable from everywhere, whereas in the case of shared mutable state, in the general case you must assume that they are visible and writable from anywhere, which isn&#8217;t much of a difference.</p>
<p>But luckily, shared mutable state at least allows you to encapsulate it in a business logic that defines clear and concise rules for modification, thus artificially limiting your system&#8217;s complexity, which most of developing non-trivial systems is about after all :)</p>
<p>Btw., @Herb, thanks for these wonderful questions, and I&#8217;m really looking forward to your answer! :)</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-bartoszmilewski even thread-even depth-1 highlander-comment" id="comment-14137">
		<div id="div-comment-14137">
		<div class="cmtinfo"><em> on <a href="#comment-14137" title="">2014-01-15 at 10:34 am</a></em> <img alt='' src='https://0.gravatar.com/avatar/c018f213204496b4bbf481e7c8e6c15c?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://www.relisoft.com' rel='external nofollow' class='url'>Bartosz Milewski</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_14137"></div><p>These are good questions with some obvious and non-obvious answers. Obviously, having to worry about one more thing adds complexity and fragility to your code. But what is it specifically about mutable shared variables that makes them hard to manage? Two things come to mind: non-locality and non-determinism. Just like gotos, mutable variables introduce dependencies between remote parts of code. When you&#8217;re reading a shared variable you are seeing the result of a write that happened in any of the threads that have access to it. And the threads can interleave differently every time you run your program. That makes both reasoning and testing of concurrent programs orders of magnitude harder. When we write code, we usually have one or two scenarios of execution in mind; with concurrent code that number is just not realistic. I&#8217;ve seen people arguing that a certain combination of event cannot happen only because they eliminated the few scenarios of execution that came to their minds. But there were other (often rare) disastrous scenarios that didn&#8217;t cross their mind. In concurrent programming the scenario generator in our minds just cannot keep up.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-cartec69 odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-14128">
		<div id="div-comment-14128">
		<div class="cmtinfo"><em> on <a href="#comment-14128" title="">2014-01-14 at 2:32 pm</a></em> <img alt='' src='https://1.gravatar.com/avatar/d6c7f4772c32ca36a4d4835ceea1816c?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>cartec69</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_14128"></div><p>3. If the shared variable can be completely internally synchronized in a lock-free manner, then it can neither contribute to data races nor introduce potential deadlock.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 highlander-comment" id="comment-14127">
		<div id="div-comment-14127">
		<div class="cmtinfo"><em> on <a href="#comment-14127" title="">2014-01-14 at 1:54 pm</a></em> <img alt='' src='https://2.gravatar.com/avatar/294f0812e844d56ae17adb9b025dba39?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://gravatar.com/sbohmann' rel='external nofollow' class='url'>Sebastian Bohmann</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_14127"></div><p>ad 3. in case a mutable datum is required that may be changed from different parts of a system, be it within the same thread or across multiple threads, opposed to just safely sharing values, which is easily done by choosing an appropriate technique as described above, it really gets more interesting :)</p>
<p>Such a capability demands a core requirement of your project for becoming a necessity.</p>
<p>And implementing it demands thinking about to what end it shall be implemented first. Software transactional memory is oft cited as a technological approach but that does not cover the complexities inherent to the situation from which the need usually emerges in the first place.</p>
<p>When there is a centrally stored value that requires manipulation from various places, various threads, and various sub-domains of a projects aim, it is usually not independent from other parts of a common business logic :)</p>
<p>Therefore, this case is in my honest opinion the hardest to phrase a general technological approach for and thus a bit out of reach of a discussion on a somewhat language- and platform-centric discussion ;)</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-14126">
		<div id="div-comment-14126">
		<div class="cmtinfo"><em> on <a href="#comment-14126" title="">2014-01-14 at 1:38 pm</a></em> <img alt='' src='https://0.gravatar.com/avatar/0400152746a64b153a4bc543bf3cf76c?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>Ralph Tandetzky</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_14126"></div><p>Without looking at previous answers:</p>
<p>1. Why do mutable shared variables like some_obj make your code:<br />
	(a) more complex?</p>
<p>Because it means that in almost all cases there must be a mutex associated with the variable. Often other invariants need to be established in order to reason about the behaviour of some code. Different implementations of concurrent queues are classic examples of this. </p>
<p>	(b) more brittle?</p>
<p>It is hard to reason about shared state because it implies interdependencies of different parts of a program. Therefore, the code and logic of the application is usually not found in one place which makes the code harder to reason about. Often, when extending the functionality of a component more state needs to be added and it must be decided whether to protect the new state with the same mutex as well. </p>
<p>	(c) less scalable?</p>
<p>Sharing is the root of contention. When many different threads are fighting for one mutex then this may easily lead to a performance bottleneck. If a thread is holding a mutex half of the time in a tight loop, then having multiple threads trying to do the same thing will at most double the performance. But multithreading might even worsen performance. Therefore, mutexes should be held only during very short actions which make some work take effect. For example such a short action might be changing a pointer or incrementing or decrementing a counter, etc. </p>
<p>When programming for the strong exception guarantee the technique of the red line of often employed, where the actual work is done on the side (without side effects) in a first phase and in a second phase that work is committed by performing some non-throwing mutating operations which are usually cheap to perform (like a swap or a move). Often multithreaded code uses the same technique with the difference that the mutex is held during the commit phase. Designing the code that way can be a hard task. We get scalability at the price of brittleness and complexity. </p>
<p>2. Give an example of how the code that uses a mutable shared variable like some_obj can be changed so that the variable is:<br />
(a) not shared.<br />
(b) not mutable.</p>
<p>Simple. Make a copy. Since the concurrency revolution it is often better to avoid contention via references or pointers to shared objects but instead make copies. The function <code>code_that_modifies()</code> can be changed to have the signature</p>
<pre class="brush: plain; title: ; notranslate" title="">
	some_type code_that_modifies( some_type some_obj );
</pre>
<p>That way an object can be moved into the function which might be cheaper and exception-safer. That very same object can also be moved out of the function as a return value. In an ideal case the function will have approximately the same performance as the original, if not even better. Better, I say? &#8212; Yes, because there&#8217;s less indirection!</p>
<p>A second technique on top of that is to replace a variable of <code>some_type</code> by a <code>shared_ptr</code> to a <code>const some_type</code>. The pointee is immutable, but the pointer can be changed in a commit action while holding a mutex as mentioned above. This shortens the time the mutex is held. If the <code>shared_ptr</code> is the only variable protected by the mutex, then we might even be tempted to use atomic operations on shared_ptr as provided by the standard library and go without mutex. </p>
<p>These techniques might not always be practical, because copying and moving might be expensive or impossible. </p>
<p>3. Let’s say we’re in a situation where we can’t apply the techniques from the answers to #2, so that the variable itself must remain shared and apparently mutable. Is there any way that the internal implementation of the variable can make the variable be physically not shared and/or not mutable, so that the calling code can treat it as a logically shared-and-mutable object yet not need to perform external synchronization? If so, explain. If not, why not?</p>
<p>Sorry, Herb, I don&#8217;t understand what you have in mind with this question. What do you mean by *physically*? I&#8217;m thinking of thread-local storage in order to get variables that are physically not shared yet behave like one object (in object oriented design I have not found thread-local storage very helpful though). Alternatively, I&#8217;m thinking of a copy-on-write template class which makes sure that the data is immutable unless there is only one unique reference to it. </p>
<p>Otherwise, I would say, it&#8217;s not possible because I&#8217;m out of ideas. ;)</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-sbohmann even thread-even depth-1 highlander-comment" id="comment-14125">
		<div id="div-comment-14125">
		<div class="cmtinfo"><em> on <a href="#comment-14125" title="">2014-01-14 at 1:10 pm</a></em> <img alt='' src='https://2.gravatar.com/avatar/294f0812e844d56ae17adb9b025dba39?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>sbohmann</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_14125"></div><p>P.S. please forgive my orthography &#8211; it makes me cringe to read my posts but I&#8217;m writing on my iPad with autocorrect turned off because turning it off looked like a a smart idea at some point ;)</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-sbohmann odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-14124">
		<div id="div-comment-14124">
		<div class="cmtinfo"><em> on <a href="#comment-14124" title="">2014-01-14 at 1:01 pm</a></em> <img alt='' src='https://2.gravatar.com/avatar/294f0812e844d56ae17adb9b025dba39?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>sbohmann</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_14124"></div><p>ad my response to 3.: such a mutable, but thread-safe and internally immutable and internally ref counted data wrapper can very easily be made immutable by making it const, e.g. for holding it in a persistent collection. it&#8217;s possible because its mutability is VERY shallow :)</p>
<p>Deeper mutability would in almost all cases be a show stopper here.</p>
<p>About std::string: when the part of a persisten collection that holds a string instance is modified (i.e. replaced) in the course of a persistent update (i.e. creation of an updated instance), the string will be copied.</p>
<p>therefore, if strings tends to be large in such a scenario, it may make sense to wrap it as in my response to 3., especially if mutability is NOT required &#8211; the wrapped string then behaves somewhat like a Java or C# string, i.e., its value is immutable (the embedded reference only if const), and copying it is practically free, which is just what persistent collections crave when it comes to their elemt types :)</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 highlander-comment" id="comment-14122">
		<div id="div-comment-14122">
		<div class="cmtinfo"><em> on <a href="#comment-14122" title="">2014-01-14 at 12:27 pm</a></em> <img alt='' src='https://2.gravatar.com/avatar/294f0812e844d56ae17adb9b025dba39?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://gravatar.com/sbohmann' rel='external nofollow' class='url'>Sebastian Bohmann</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_14122"></div><p>3. if the variable is of a class type, not a pointer, the internal representation may be a reference counted smart pointer to an immutable value or persistent collection. Plus, the reference counted smart pointer should either be thread-safe, else it must be guarded in the assignment op + copy c&#8217;tor.</p>
<p>Just another variant on the pimpl idiom with a ref counting smart pointer :)</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-14120">
		<div id="div-comment-14120">
		<div class="cmtinfo"><em> on <a href="#comment-14120" title="">2014-01-14 at 11:43 am</a></em> <img alt='' src='https://0.gravatar.com/avatar/37aa3ec65ec47c5a3f9e2a80534837f3?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://gravatar.com/stackedcrooked' rel='external nofollow' class='url'>StackedCrooked</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_14120"></div><pre class="brush: plain; title: ; notranslate" title="">
1a. - the logic is polluted with mutexes and locks. this reduces readability.

1b. - possible to forget to lock leading to data races

    - possible deadlocks. for example:
        - high-level code calls low-level code while holding the lock
        - low level code invokes callback to high-level function which tries to lock
    - possibility of lifetime bugs (object which is destroyed in one thread
      while another thread is reading from it)    
      
1c. - locking prevents parallelism

2a. - writer thread owns the object and reader receives copies.
    - if your application has  a message loop then a thread can run in the
      background and send updated copies to the main thread via &quot;post&quot; events
      (concurrent_queues can be used to for a more general solution)
      
2b. - using techniques from (pure) functional programming languages where you
      never change the object but always pass updated copies back and forth.        
      
3b. I'm not sure what you have in mind. But here a few wild guesses:
    - maybe using software transactional memory? (not sure if transactions count
      as external synchronization)
    - perhaps a proxy type which stores a private copy of the real object? (state
      changes could be communicated to other proxies using some kind of
      messaging system.)
</pre>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 highlander-comment" id="comment-14118">
		<div id="div-comment-14118">
		<div class="cmtinfo"><em> on <a href="#comment-14118" title="">2014-01-14 at 9:30 am</a></em> <img alt='' src='https://2.gravatar.com/avatar/294f0812e844d56ae17adb9b025dba39?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://gravatar.com/sbohmann' rel='external nofollow' class='url'>sbohmann</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_14118"></div><p>1.a. because interdependencies between otherwise independent parts of the code arise &#8211; not only in the face of multiple threads but also in the face of &#8211; at first glance more innocent &#8211; coroutines.</p>
<p>1.b. because these interdependencies may manifest as side-effects of entirely unrelated things happening in other parts of code. Plus, these are often hard to find and almost always hard to debug when they emerge. Race conditions are but one popular example&#8230;</p>
<p>1.c. because wait states emerge that take up more and more time with increasing lock contention. Making data that is shared between vast parts of a project a source of lock contention can easily lead to a huge amount thereof. Throwing a vast number of threads at the problem won&#8217;t work because they always consume space (for their stacks, plus indirectly on the heap (yes, &#8220;free store&#8221; in C++)) and time because of the great price of context switches. Plus, making more threads wait all the time for the same resources wouldn&#8217;t help much in any case.</p>
<p>2.a. make copies. Defensive copying is not the brightest idea in most cases but may actually help if there are more or less outlandish reasons that make them the only feasible approach (like an existing code base that just can&#8217;t be adapted, or, in the worst case, political reasons).</p>
<p>2.b. use persistent collections plus immutable data objects, like custom classes, or const std::string etc. Immutable data is friendly to reference counting, and reference counting is well compatible with most of these non-circular tree-based persistent (i.e. immutable with low-cost copying) data structures. I really hope they will pop up in the STL as soon as possible so I can replace my home-brewn implementations (because the STL is ALWAYS more thoroughly tested :D)</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="pingback odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-14117">
		<div id="div-comment-14117">
		<div class="cmtinfo"><em> on <a href="#comment-14117" title="">2014-01-14 at 9:24 am</a></em>  <cite><a href='http://guillaumebelz.wordpress.com/2014/01/14/guru-of-the-week-95-thread-safety-and-synchronization/' rel='external nofollow' class='url'>Guru of the Week 95 : Thread Safety and Synchronization | C++, Qt, OpenGL, CUDA</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_14117"></div><p>[&#8230;] Il a également posté les questions du prochain GotW : GotW #96: Oversharing. [&#8230;]</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
	</ol>

	<div class="navigation">
		<div class="alignleft"></div>
		<div class="alignright"></div>
	</div>
	<br />

  	<p class="nocomments">Comments are closed.</p>
  <div class="post-content">
<p>
</p>
</div>

			</div>

		
		<p align="center"></p>

	</div><!-- end id:content-main -->
<div id="sidebar">
<ul>
<li class="sidebox"><h2><label for="subscribe-field">Follow by email</label></h2>
				<form action="https://subscribe.wordpress.com" method="post" accept-charset="utf-8" id="subscribe-blog">
																	<p><input type="text" name="email" style="width: 95%; padding: 1px 2px" placeholder="Enter your email address" value="" id="subscribe-field"/></p>
					
					<p>
						<input type="hidden" name="action" value="subscribe"/>
						<input type="hidden" name="blog_id" value="3379246"/>
						<input type="hidden" name="source" value="https://herbsutter.com/2014/01/14/gotw-96-oversharing/"/>
						<input type="hidden" name="sub-type" value="widget"/>
						<input type="hidden" name="redirect_fragment" value="blog_subscription-3" />
						<input type="hidden" id="_wpnonce" name="_wpnonce" value="4590924cc6" />						<input type="submit" value="Subscribe" />
					</p>
				</form>
			
</li><li class="sidebox"><h2><a href='http://twitter.com/herbsutter'>Tweets</a></h2><ul class='tweets'></ul><a href="http://twitter.com/herbsutter"  class='twitter-follow-button' data-show-count='false' data-link-color='#265e15' data-text-color='#333333'>Follow @herbsutter</a></li><li class="sidebox"><h2>Popular</h2><ul>				<li>
										<a href="https://herbsutter.com/2018/11/13/trip-report-fall-iso-c-standards-meeting-san-diego/" class="bump-view" data-bump-view="tp">
						Trip report: Fall ISO C++ standards meeting (San Diego)					</a>
										</li>
								<li>
										<a href="https://herbsutter.com/gotw/" class="bump-view" data-bump-view="tp">
						GotW					</a>
										</li>
								<li>
										<a href="https://herbsutter.com/2018/09/20/lifetime-profile-v1-0-posted/" class="bump-view" data-bump-view="tp">
						Lifetime profile v1.0 posted					</a>
										</li>
				</ul></li><li class="sidebox"><h2>Categories</h2>		<ul>
				<li class="cat-item cat-item-291"><a href="https://herbsutter.com/category/apple/" >Apple</a>
</li>
	<li class="cat-item cat-item-49277"><a href="https://herbsutter.com/category/c-net/" >C# / .NET</a>
</li>
	<li class="cat-item cat-item-2426"><a href="https://herbsutter.com/category/c/" >C++</a>
</li>
	<li class="cat-item cat-item-69816"><a href="https://herbsutter.com/category/cloud/" >Cloud</a>
</li>
	<li class="cat-item cat-item-214618"><a href="https://herbsutter.com/category/concurrency/" >Concurrency</a>
</li>
	<li class="cat-item cat-item-8259773"><a href="https://herbsutter.com/category/effective-concurrency/" >Effective Concurrency</a>
</li>
	<li class="cat-item cat-item-3696745"><a href="https://herbsutter.com/category/friday-thoughts/" >Friday Thoughts</a>
</li>
	<li class="cat-item cat-item-3867746"><a href="https://herbsutter.com/category/c/gotw/" >GotW</a>
</li>
	<li class="cat-item cat-item-79"><a href="https://herbsutter.com/category/hardware/" >Hardware</a>
</li>
	<li class="cat-item cat-item-1017"><a href="https://herbsutter.com/category/java/" >Java</a>
</li>
	<li class="cat-item cat-item-637"><a href="https://herbsutter.com/category/microsoft/" >Microsoft</a>
</li>
	<li class="cat-item cat-item-420845"><a href="https://herbsutter.com/category/opinion-editorial/" >Opinion &amp; Editorial</a>
</li>
	<li class="cat-item cat-item-1633077"><a href="https://herbsutter.com/category/reader-qa/" >Reader Q&amp;A</a>
</li>
	<li class="cat-item cat-item-2301"><a href="https://herbsutter.com/category/software-development/" >Software Development</a>
</li>
	<li class="cat-item cat-item-393523"><a href="https://herbsutter.com/category/talks-events/" >Talks &amp; Events</a>
</li>
	<li class="cat-item cat-item-1"><a href="https://herbsutter.com/category/uncategorized/" >Uncategorized</a>
</li>
	<li class="cat-item cat-item-151"><a href="https://herbsutter.com/category/web/" >Web</a>
</li>
		</ul>
			</li></ul>
</div><!-- end id:sidebar -->
</div><!-- end id:content -->
</div><!-- end id:container -->
<div id="footer">
	<div id="colophon">
		<p><a href="https://wordpress.com/?ref=footer_blog">Blog at WordPress.com.</a></p>
		<p>WPThemes.</p>
		<br class="clear" />
	</div><!-- end #colophon-->
</div><!-- end #footer-->
<!--  -->
<script type='text/javascript' src='//0.gravatar.com/js/gprofiles.js?ver=201847y'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var WPGroHo = {"my_hash":""};
/* ]]> */
</script>
<script type='text/javascript' src='https://s1.wp.com/wp-content/mu-plugins/gravatar-hovercards/wpgroho.js?m=1380573781h'></script>

	<script>
		//initialize and attach hovercards to all gravatars
		jQuery( document ).ready( function( $ ) {

			if (typeof Gravatar === "undefined"){
				return;
			}

			if ( typeof Gravatar.init !== "function" ) {
				return;
			}			

			Gravatar.profile_cb = function( hash, id ) {
				WPGroHo.syncProfileData( hash, id );
			};
			Gravatar.my_hash = WPGroHo.my_hash;
			Gravatar.init( 'body', '#wp-admin-bar-my-account' );
		});
	</script>

		<div style="display:none">
	<div class="grofile-hash-map-1e38308230a4be228501f90ede4ad61a">
	</div>
	<div class="grofile-hash-map-18afd5485cf7f169a22cb51d64531c54">
	</div>
	<div class="grofile-hash-map-18d0bf49bbdc669688b8d3f79dd5a914">
	</div>
	<div class="grofile-hash-map-c018f213204496b4bbf481e7c8e6c15c">
	</div>
	<div class="grofile-hash-map-294f0812e844d56ae17adb9b025dba39">
	</div>
	<div class="grofile-hash-map-d6c7f4772c32ca36a4d4835ceea1816c">
	</div>
	<div class="grofile-hash-map-294f0812e844d56ae17adb9b025dba39">
	</div>
	<div class="grofile-hash-map-0400152746a64b153a4bc543bf3cf76c">
	</div>
	<div class="grofile-hash-map-37aa3ec65ec47c5a3f9e2a80534837f3">
	</div>
	</div>
<script type='text/javascript' charset='UTF-8' id='polldaddyRatings'><!--//--><![CDATA[//><!--
PDRTJS_settings_468178_comm_15025={"id":468178,"unique_id":"wp-comment-15025","title":"if%20we%20assume%20that%20Herb%20only%20wants%20thread%201%20reads%20and%20thread%202%20writes.%20we%20can%20make%20the%20variable%20itself%20an%20active%20object%20that%20when%20write%2C%20it%20will%20duplicate%20its%20latest%20state%20and%20enqueue%20it%20into%20a%20th...","permalink":"https:\/\/herbsutter.com\/2014\/01\/14\/gotw-96-oversharing\/#comment-15025","item_id":"_comm_15025"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_15025 == 'undefined' ){PDRTJS_468178_comm_15025 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_15025 );}}PDRTJS_settings_468178_comm_14165={"id":468178,"unique_id":"wp-comment-14165","title":"1.%20a.%20Increased%20ratio%20between%20boilerplate%20code%20and%20actual%20logic%20makes%20code%20more%20complex.1.%20b.%20If%20boilerplate%20code%20is%20forgotten%20problem%20is%20not%20seen%20immediately.%20Such%20buggy%20code%20will%20compile%20and%20pa...","permalink":"https:\/\/herbsutter.com\/2014\/01\/14\/gotw-96-oversharing\/#comment-14165","item_id":"_comm_14165"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_14165 == 'undefined' ){PDRTJS_468178_comm_14165 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_14165 );}}PDRTJS_settings_468178_comm_14149={"id":468178,"unique_id":"wp-comment-14149","title":"1%29%20The%20primary%20problem%20is%20that%20it%20is%20too%20easy%20for%20a%20%20user%20of%20some_obj%20to%20forget%2C%20or%20not%20even%20realize%20that%20synchronization%20is%20required.%20Especially%20as%20a%20program%20gets%20very%20large.%20some_obj%20will%20be%20re...","permalink":"https:\/\/herbsutter.com\/2014\/01\/14\/gotw-96-oversharing\/#comment-14149","item_id":"_comm_14149"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_14149 == 'undefined' ){PDRTJS_468178_comm_14149 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_14149 );}}PDRTJS_settings_468178_comm_14145={"id":468178,"unique_id":"wp-comment-14145","title":"Question%203.%20If%20the%20variable%20is%20not%20physically%20shared%2C%20then%20threads%20won%26%23039%3Bt%20be%20able%20to%20see%20each%20other%26%23039%3Bs%20writes.%20But%20if%20that%26%23039%3Bs%20okay%2C%20then%20you%20can%20give%20each%20thread%20its%20own%20private%20copy%20to%20read%20and%20mod...","permalink":"https:\/\/herbsutter.com\/2014\/01\/14\/gotw-96-oversharing\/#comment-14145","item_id":"_comm_14145"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_14145 == 'undefined' ){PDRTJS_468178_comm_14145 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_14145 );}}PDRTJS_settings_468178_comm_14144={"id":468178,"unique_id":"wp-comment-14144","title":"Question%202.%20Except%20for%20trivial%20cases%2C%20data%20has%20to%20be%20passed%20between%20threads.%20There%20are%20many%20ways%20to%20do%20it%20and%20some%20of%20them%20don%26%23039%3Bt%20require%20additional%20synchronization.%20I%26%23039%3Bm%20saying%20%26quot%3Badditional%26quot%3B%20becaus...","permalink":"https:\/\/herbsutter.com\/2014\/01\/14\/gotw-96-oversharing\/#comment-14144","item_id":"_comm_14144"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_14144 == 'undefined' ){PDRTJS_468178_comm_14144 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_14144 );}}PDRTJS_settings_468178_comm_14138={"id":468178,"unique_id":"wp-comment-14138","title":"%40Bartosz%20true%20%3A%29%20but%20what%20is%20in%20my%20opinion%20often%20underrated%20is%20that%20even%20in%20the%20absence%20of%20any%20kind%20of%20threads%2C%20shared%20mutable%20values%20can%20break%20a%20human%20mind%26%23039%3Bs%20limits%20of%20understanding%20the%20conseque...","permalink":"https:\/\/herbsutter.com\/2014\/01\/14\/gotw-96-oversharing\/#comment-14138","item_id":"_comm_14138"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_14138 == 'undefined' ){PDRTJS_468178_comm_14138 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_14138 );}}PDRTJS_settings_468178_comm_14137={"id":468178,"unique_id":"wp-comment-14137","title":"These%20are%20good%20questions%20with%20some%20obvious%20and%20non-obvious%20answers.%20Obviously%2C%20having%20to%20worry%20about%20one%20more%20thing%20adds%20complexity%20and%20fragility%20to%20your%20code.%20But%20what%20is%20it%20specifically%20about%20m...","permalink":"https:\/\/herbsutter.com\/2014\/01\/14\/gotw-96-oversharing\/#comment-14137","item_id":"_comm_14137"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_14137 == 'undefined' ){PDRTJS_468178_comm_14137 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_14137 );}}PDRTJS_settings_468178_comm_14128={"id":468178,"unique_id":"wp-comment-14128","title":"3.%20If%20the%20shared%20variable%20can%20be%20completely%20internally%20synchronized%20in%20a%20lock-free%20manner%2C%20then%20it%20can%20neither%20contribute%20to%20data%20races%20nor%20introduce%20potential%20deadlock....","permalink":"https:\/\/herbsutter.com\/2014\/01\/14\/gotw-96-oversharing\/#comment-14128","item_id":"_comm_14128"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_14128 == 'undefined' ){PDRTJS_468178_comm_14128 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_14128 );}}PDRTJS_settings_468178_comm_14127={"id":468178,"unique_id":"wp-comment-14127","title":"ad%203.%20in%20case%20a%20mutable%20datum%20is%20required%20that%20may%20be%20changed%20from%20different%20parts%20of%20a%20system%2C%20be%20it%20within%20the%20same%20thread%20or%20across%20multiple%20threads%2C%20opposed%20to%20just%20safely%20sharing%20values%2C%20whi...","permalink":"https:\/\/herbsutter.com\/2014\/01\/14\/gotw-96-oversharing\/#comment-14127","item_id":"_comm_14127"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_14127 == 'undefined' ){PDRTJS_468178_comm_14127 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_14127 );}}PDRTJS_settings_468178_comm_14126={"id":468178,"unique_id":"wp-comment-14126","title":"Without%20looking%20at%20previous%20answers%3A1.%20Why%20do%20mutable%20shared%20variables%20like%20some_obj%20make%20your%20code%3A%28a%29%20more%20complex%3FBecause%20it%20means%20that%20in%20almost%20all%20cases%20there%20must%20be%20a%20mutex%20associated%20wit...","permalink":"https:\/\/herbsutter.com\/2014\/01\/14\/gotw-96-oversharing\/#comment-14126","item_id":"_comm_14126"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_14126 == 'undefined' ){PDRTJS_468178_comm_14126 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_14126 );}}PDRTJS_settings_468178_comm_14125={"id":468178,"unique_id":"wp-comment-14125","title":"P.S.%20please%20forgive%20my%20orthography%20-%20it%20makes%20me%20cringe%20to%20read%20my%20posts%20but%20I%26%23039%3Bm%20writing%20on%20my%20iPad%20with%20autocorrect%20turned%20off%20because%20turning%20it%20off%20looked%20like%20a%20a%20smart%20idea%20at%20some%20point%20%3B%29...","permalink":"https:\/\/herbsutter.com\/2014\/01\/14\/gotw-96-oversharing\/#comment-14125","item_id":"_comm_14125"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_14125 == 'undefined' ){PDRTJS_468178_comm_14125 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_14125 );}}PDRTJS_settings_468178_comm_14124={"id":468178,"unique_id":"wp-comment-14124","title":"ad%20my%20response%20to%203.%3A%20such%20a%20mutable%2C%20but%20thread-safe%20and%20internally%20immutable%20and%20internally%20ref%20counted%20data%20wrapper%20can%20very%20easily%20be%20made%20immutable%20by%20making%20it%20const%2C%20e.g.%20for%20holding%20it%20in...","permalink":"https:\/\/herbsutter.com\/2014\/01\/14\/gotw-96-oversharing\/#comment-14124","item_id":"_comm_14124"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_14124 == 'undefined' ){PDRTJS_468178_comm_14124 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_14124 );}}PDRTJS_settings_468178_comm_14122={"id":468178,"unique_id":"wp-comment-14122","title":"3.%20if%20the%20variable%20is%20of%20a%20class%20type%2C%20not%20a%20pointer%2C%20the%20internal%20representation%20may%20be%20a%20reference%20counted%20smart%20pointer%20to%20an%20immutable%20value%20or%20persistent%20collection.%20Plus%2C%20the%20reference%20coun...","permalink":"https:\/\/herbsutter.com\/2014\/01\/14\/gotw-96-oversharing\/#comment-14122","item_id":"_comm_14122"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_14122 == 'undefined' ){PDRTJS_468178_comm_14122 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_14122 );}}PDRTJS_settings_468178_comm_14120={"id":468178,"unique_id":"wp-comment-14120","title":"%26%23091%3Bcode%26%23093%3B1a.%20-%20the%20logic%20is%20polluted%20with%20mutexes%20and%20locks.%20this%20reduces%20readability.1b.%20-%20possible%20to%20forget%20to%20lock%20leading%20to%20data%20races%20%20%20%20-%20possible%20deadlocks.%20for%20example%3A%20%20%20%20%20%20%20%20-%20high-level...","permalink":"https:\/\/herbsutter.com\/2014\/01\/14\/gotw-96-oversharing\/#comment-14120","item_id":"_comm_14120"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_14120 == 'undefined' ){PDRTJS_468178_comm_14120 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_14120 );}}PDRTJS_settings_468178_comm_14118={"id":468178,"unique_id":"wp-comment-14118","title":"1.a.%20because%20interdependencies%20between%20otherwise%20independent%20parts%20of%20the%20code%20arise%20-%20not%20only%20in%20the%20face%20of%20multiple%20threads%20but%20also%20in%20the%20face%20of%20-%20at%20first%20glance%20more%20innocent%20-%20coroutine...","permalink":"https:\/\/herbsutter.com\/2014\/01\/14\/gotw-96-oversharing\/#comment-14118","item_id":"_comm_14118"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_14118 == 'undefined' ){PDRTJS_468178_comm_14118 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_14118 );}}PDRTJS_settings_468178_comm_14117={"id":468178,"unique_id":"wp-comment-14117","title":"%26%23091%3B%26%238230%3B%26%23093%3B%20Il%20a%20galement%20post%20les%20questions%20du%20prochain%20GotW%20%3AGotW%20%2396%3A%20Oversharing.%20%26%23091%3B%26%238230%3B%26%23093%3B...","permalink":"https:\/\/herbsutter.com\/2014\/01\/14\/gotw-96-oversharing\/#comment-14117","item_id":"_comm_14117"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_14117 == 'undefined' ){PDRTJS_468178_comm_14117 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_14117 );}}
//--><!]]></script><script type='text/javascript' charset='UTF-8' src='https://polldaddy.com/js/rating/rating.js'></script><script type='text/javascript' src='https://platform.twitter.com/widgets.js?ver=20111117'></script>
<script type='text/javascript' src='https://s1.wp.com/_static/??-eJzTLy/QTc7PK0nNK9EvyClNz8wr1i+uzCtJrMjITM/IAeKS1CJMEWP94uSizIISoOIM5/yiVL2sYh19yo1yKiotzgjISczMAxpon2traGJkZGxiZGhskgUAFHlAaw=='></script>
<script type='text/javascript'>
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "https://s1.wp.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.9b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "https://s2.wp.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?m=1363304414h&amp;ver=3.0.9b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.defaults['toolbar'] = false;
	SyntaxHighlighter.all();

	// Infinite scroll support
	if ( typeof( jQuery ) !== 'undefined' ) {
		jQuery( function( $ ) {
			$( document.body ).on( 'post-load', function() {
				SyntaxHighlighter.highlight();
			} );
		} );
	}
</script>
<script type='text/javascript'>
/* <![CDATA[ */
var actionbardata = {"siteID":"3379246","siteName":"Sutter\u2019s Mill","siteURL":"https:\/\/herbsutter.com","icon":"<img alt='' src='https:\/\/secure.gravatar.com\/blavatar\/4554b8d24c7f200dc5e2e1b18db1893f?s=50&d=https%3A%2F%2Fs2.wp.com%2Fi%2Flogo%2Fwpcom-gray-white.png' class='avatar avatar-50' height='50' width='50' \/>","canManageOptions":"","canCustomizeSite":"","isFollowing":"","themeSlug":"pub\/mistylook","signupURL":"https:\/\/wordpress.com\/start\/","loginURL":"https:\/\/herbsutter.wordpress.com\/wp-login.php?redirect_to=https%3A%2F%2Fherbsutter.com%2F2014%2F01%2F14%2Fgotw-96-oversharing%2F","themeURL":"","xhrURL":"https:\/\/herbsutter.com\/wp-admin\/admin-ajax.php","nonce":"8fb9818ae2","isSingular":"1","isFolded":"","isLoggedIn":"","isMobile":"","subscribeNonce":"<input type=\"hidden\" id=\"_wpnonce\" name=\"_wpnonce\" value=\"4590924cc6\" \/>","referer":"https:\/\/herbsutter.com\/2014\/01\/14\/gotw-96-oversharing\/","canFollow":"1","feedID":"171936","statusMessage":"","customizeLink":"https:\/\/herbsutter.wordpress.com\/wp-admin\/customize.php?url=https%3A%2F%2Fherbsutter.wordpress.com%2F2014%2F01%2F14%2Fgotw-96-oversharing%2F","postID":"2414","shortlink":"https:\/\/wp.me\/peb5Y-CW","canEditPost":"","editLink":"https:\/\/wordpress.com\/post\/herbsutter.com\/2414","statsLink":"https:\/\/wordpress.com\/stats\/post\/2414\/herbsutter.com","i18n":{"view":"View site","follow":"Follow","following":"Following","edit":"Edit","login":"Log in","signup":"Sign up","customize":"Customize","report":"Report this content","themeInfo":"Get theme: MistyLook","shortlink":"Copy shortlink","copied":"Copied","followedText":"New posts from this site will now appear in your <a href=\"https:\/\/wordpress.com\/\">Reader<\/a>","foldBar":"Collapse this bar","unfoldBar":"Expand this bar","editSubs":"Manage subscriptions","viewReader":"View site in Reader","viewReadPost":"View post in Reader","subscribe":"Sign me up","enterEmail":"Enter your email address","followers":"Join 19,532 other followers","alreadyUser":"Already have a WordPress.com account? <a href=\"https:\/\/herbsutter.wordpress.com\/wp-login.php?redirect_to=https%3A%2F%2Fherbsutter.com%2F2014%2F01%2F14%2Fgotw-96-oversharing%2F\">Log in now.<\/a>","stats":"Stats"}};
/* ]]> */
</script>
<script type='text/javascript' src='https://s0.wp.com/_static/??-eJyVjcEOgjAQRH/IuoIYT8Zvqe2GLrQLdlvAv7ceJEYTEg+bTGbe7MA8KjNwQk7QCVicyOC47DvZwUcUshp9bokFPPUocM+Y0Wm2HuM3/CblwUkvjlrnyyWMv87GjraBWN10hKCloEWpYcIYyZb91fvzQ4ra9LJVMokGfpVWVehruFSnujo0x+Zcd0+y+3Rn'></script>
<script type="text/javascript">
// <![CDATA[
(function() {
try{
  if ( window.external &&'msIsSiteMode' in window.external) {
    if (window.external.msIsSiteMode()) {
      var jl = document.createElement('script');
      jl.type='text/javascript';
      jl.async=true;
      jl.src='/wp-content/plugins/ie-sitemode/custom-jumplist.php';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(jl, s);
    }
  }
}catch(e){}
})();
// ]]>
</script><script src="//stats.wp.com/w.js?56" type="text/javascript" async defer></script>
<script type="text/javascript">
_tkq = window._tkq || [];
_stq = window._stq || [];
_tkq.push(['storeContext', {'blog_id':'3379246','blog_tz':'-8','user_lang':'en','blog_lang':'en','user_id':'0'}]);
_stq.push(['view', {'blog':'3379246','v':'wpcom','tz':'-8','user_id':'0','post':'2414','subd':'herbsutter'}]);
_stq.push(['extra', {'crypt':'UE40eW5QN0p8M2Y/RE1TaVhzUzFMbjdWNHpwZGhTayxPSUFCMGNrd29+Smw0TDhnZmRTK0hlRi9QSGh6bi9GXVhBJWIlZlR5U1JMLU8/MkNtblkvY1d1TjBELytHc0k/MXdHUVQyK2IyUVA5SjU1bj9VX3ExLHYsREFpcnlfNHYtXV1HSUIsLkJrcnp0eS5sQmtFdTJWSXY4eHZWRXg0Umw4al9dZlFCN1pwSkxVeHEyTXpbUld0Wm05LmcxV3lIXXQmUyZpPXgsa11+ay1qM3Z8XzR5RWMrNi9ILXI4M1hFUnE9SHpmJmZddFVsX1k2ZXlpY3Qmdj0rLjhHWVktSEl2dzUlYlpWc3V5N19DJWRUaXo1PWZRLWp6V3RZJUZlV09OVDN5ZGFhZll3XUZlPzErRS92OD0lSEUsb3lQWnVTUjZ0Vi5Ec0sxMVpZQTY0NTMubWw9ag=='}]);
_stq.push([ 'clickTrackerInit', '3379246', '2414' ]);
	</script>
<noscript><img src="https://pixel.wp.com/b.gif?v=noscript" style="height:0px;width:0px;overflow:hidden" alt="" /></noscript>
<script>
if ( 'object' === typeof wpcom_mobile_user_agent_info ) {

	wpcom_mobile_user_agent_info.init();
	var mobileStatsQueryString = "";
	
	if( false !== wpcom_mobile_user_agent_info.matchedPlatformName )
		mobileStatsQueryString += "&x_" + 'mobile_platforms' + '=' + wpcom_mobile_user_agent_info.matchedPlatformName;
	
	if( false !== wpcom_mobile_user_agent_info.matchedUserAgentName )
		mobileStatsQueryString += "&x_" + 'mobile_devices' + '=' + wpcom_mobile_user_agent_info.matchedUserAgentName;
	
	if( wpcom_mobile_user_agent_info.isIPad() )
		mobileStatsQueryString += "&x_" + 'ipad_views' + '=' + 'views';

	if( "" != mobileStatsQueryString ) {
		new Image().src = document.location.protocol + '//pixel.wp.com/g.gif?v=wpcom-no-pv' + mobileStatsQueryString + '&baba=' + Math.random();
	}
	
}
</script></body>
</html>
<!--
	generated in 0.150 seconds
	70975 bytes batcached for 300 seconds
-->
