<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>GotW #95: Thread Safety and Synchronization | Sutter’s Mill</title>
<link rel="pingback" href="https://herbsutter.com/xmlrpc.php" />
<script type="text/javascript">
  WebFontConfig = {"typekit":{"id":"eyo0tqd"}};
  (function() {
    var wf = document.createElement('script');
    wf.src = 'https://s0.wp.com/wp-content/plugins/custom-fonts/js/webfont.js';
    wf.type = 'text/javascript';
    wf.async = 'true';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(wf, s);
	})();
</script><style id="jetpack-custom-fonts-css">.wf-active #header h1{font-size:2.12em;font-family:"ff-dagny-web-pro-1","ff-dagny-web-pro-2",sans-serif;font-style:normal;font-weight:400}.wf-active body{font-size:89.7%;font-family:"ff-basic-gothic-web-pro-1","ff-basic-gothic-web-pro-2",sans-serif}.wf-active #navigation{font-family:"ff-basic-gothic-web-pro-1","ff-basic-gothic-web-pro-2",sans-serif}.wf-active #navigation ul li.search{font-size:1.06em}.wf-active #navigation ul li.search input#searchsubmit{font-size:1.06em}.wf-active #content .post-info, .wf-active #content .postmetadata{font-size:1.06em}.wf-active #sidebar{font-size:1.06em}.wf-active #footer p.right{font-size:1.06em}.wf-active .commentnum{font-size:1.77em}.wf-active .commentlist li .cmtinfo{font-size:1.18em}.wf-active .commentlist li .cmtinfo em{font-size:1.06em}.wf-active #respond label{font-size:11.8px}.wf-active #respond .required{font-size:11.8px}.wf-active #respond .subscribe-label{font-size:14.2px}.wf-active #respond .comment-notes{font-size:13px}.wf-active .wp-caption p.wp-caption-text{font-size:13px}.wf-active #content h1, .wf-active h2, .wf-active h3, .wf-active h4, .wf-active h5, .wf-active h6{font-family:"ff-dagny-web-pro-1","ff-dagny-web-pro-2",sans-serif;font-style:normal;font-weight:400}.wf-active #header h2{font-size:1.18em;font-weight:400;font-family:"ff-dagny-web-pro-1","ff-dagny-web-pro-2",sans-serif;font-style:normal}.wf-active #content h3{font-size:1.65em;font-weight:400;font-style:normal}.wf-active #content h4{font-size:1.3em;font-style:normal;font-weight:400}.wf-active #content h5{font-size:1.18em;font-style:normal;font-weight:400}.wf-active #content .post h2{font-size:1.65em;font-weight:400;font-style:normal}.wf-active li.sidebox h2{font-weight:400;font-size:1.89em;font-style:normal}.wf-active .post h4{font-size:1.18em;font-weight:400;font-family:"ff-dagny-web-pro-1","ff-dagny-web-pro-2",sans-serif;font-style:normal}.wf-active .post h4 em{font-style:normal;font-weight:400}</style>
		<script src='https://r-login.wordpress.com/remote-login.php?action=js&amp;host=herbsutter.com&amp;id=3379246&amp;t=1542965386&amp;back=https%3A%2F%2Fherbsutter.com%2F2014%2F01%2F06%2Fgotw-95-thread-safety-and-synchronization%2F' type="text/javascript"></script>
		<script type="text/javascript">
		/* <![CDATA[ */
			if ( 'function' === typeof WPRemoteLogin ) {
				document.cookie = "wordpress_test_cookie=test; path=/";
				if ( document.cookie.match( /(;|^)\s*wordpress_test_cookie\=/ ) ) {
					WPRemoteLogin();
				}
			}
		/* ]]> */
		</script>
		<link rel='dns-prefetch' href='//s2.wp.com' />
<link rel='dns-prefetch' href='//s0.wp.com' />
<link rel='dns-prefetch' href='//s1.wp.com' />
<link rel='dns-prefetch' href='//herbsutter.wordpress.com' />
<link rel="alternate" type="application/rss+xml" title="Sutter’s Mill &raquo; Feed" href="https://herbsutter.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="Sutter’s Mill &raquo; Comments Feed" href="https://herbsutter.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Sutter’s Mill &raquo; GotW #95: Thread Safety and&nbsp;Synchronization Comments Feed" href="https://herbsutter.com/2014/01/06/gotw-95-thread-safety-and-synchronization/feed/" />
	<script type="text/javascript">
		/* <![CDATA[ */
		function addLoadEvent(func) {
			var oldonload = window.onload;
			if (typeof window.onload != 'function') {
				window.onload = func;
			} else {
				window.onload = function () {
					oldonload();
					func();
				}
			}
		}
		/* ]]> */
	</script>
			<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s0.wp.com\/wp-content\/mu-plugins\/wpcom-smileys\/twemoji\/2\/72x72\/","ext":".png","svgUrl":"https:\/\/s0.wp.com\/wp-content\/mu-plugins\/wpcom-smileys\/twemoji\/2\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/s1.wp.com\/wp-includes\/js\/wp-emoji-release.min.js?m=1532082729h&ver=4.9.8"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56760,9792,65039],[55358,56760,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel='stylesheet' id='all-css-0-1' href='https://s2.wp.com/_static/??-eJyNkN1uwjAMhV9onsUG69W0Z0laE0zzp8QR6tvjUlUCwSpuonOS81knxkuGPkWhKBgaZN8cx4qeR6p4JsmmH+HmPvtaP/B1nOORI8uEcqKgYG4WA1eZfErjFtinQnofspE5EWhgQ15nRNnCQv5ZqVmetORmv0vWNFibC9UKegZuAZayT9wKuabWUnEwt0Tb2A9ofbotxBZTJpx/SE8DXi3hn+h9Rx4cSUVJGXKqqt5GaurZeGCNPJoFZoxJlsdVbE11lEB/aYRTfDBw9IbLFlpI9+NUOtTUnZ2hv/C7O+y/uu9uf+jOV8Xg7sY=?cssminify=yes' type='text/css' media='all' />
<link rel='stylesheet' id='print-css-1-1' href='https://s2.wp.com/wp-content/mu-plugins/global-print/global-print.css?m=1465851035h&cssminify=yes' type='text/css' media='print' />
<link rel='stylesheet' id='all-css-2-1' href='https://s0.wp.com/_static/??/wp-content/mu-plugins/actionbar/actionbar.css,/wp-content/themes/h4/global.css?m=1516985148j&cssminify=yes' type='text/css' media='all' />
<script type='text/javascript' src='https://s0.wp.com/_static/??-eJyFztEKwjAMBdAfsquTiXsRv6XWOFKXtDbphn69HeiDMBQCgdzDJXZOBtmP5QJiQ517gfx4rybIxv4ChnDITqEh5A/2kRVYF0vxjCOYIpDdUG+16BpXXIqiBCIVraTfLyFPCPNfFkCT8zeTQfC5tJ7o2Hb9Yde3+24bXjRNW9I='></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://herbsutter.wordpress.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://s1.wp.com/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='GotW #7c Solution: Minimizing Compile-Time Dependencies, Part&nbsp;3' href='https://herbsutter.com/2014/01/06/gotw-7c-solution-minimizing-compile-time-dependencies-part-3/' />
<link rel='next' title='GotW #95 Solution: Thread Safety and&nbsp;Synchronization' href='https://herbsutter.com/2014/01/13/gotw-95-solution-thread-safety-and-synchronization/' />
<meta name="generator" content="WordPress.com" />
<link rel="canonical" href="https://herbsutter.com/2014/01/06/gotw-95-thread-safety-and-synchronization/" />
<link rel='shortlink' href='https://wp.me/peb5Y-CJ' />
<link rel="alternate" type="application/json+oembed" href="https://public-api.wordpress.com/oembed/?format=json&amp;url=https%3A%2F%2Fherbsutter.com%2F2014%2F01%2F06%2Fgotw-95-thread-safety-and-synchronization%2F&amp;for=wpcom-auto-discovery" /><link rel="alternate" type="application/xml+oembed" href="https://public-api.wordpress.com/oembed/?format=xml&amp;url=https%3A%2F%2Fherbsutter.com%2F2014%2F01%2F06%2Fgotw-95-thread-safety-and-synchronization%2F&amp;for=wpcom-auto-discovery" />
<!-- Jetpack Open Graph Tags -->
<meta property="og:type" content="article" />
<meta property="og:title" content="GotW #95: Thread Safety and Synchronization" />
<meta property="og:url" content="https://herbsutter.com/2014/01/06/gotw-95-thread-safety-and-synchronization/" />
<meta property="og:description" content="This GotW was written to answer a set of related frequently asked questions. So here&#8217;s a mini-FAQ on &#8220;thread safety and synchronization in a nutshell,&#8221; and the points we&#8217;ll …" />
<meta property="article:published_time" content="2014-01-06T16:00:09+00:00" />
<meta property="article:modified_time" content="2014-01-06T16:02:05+00:00" />
<meta property="og:site_name" content="Sutter’s Mill" />
<meta property="og:image" content="https://secure.gravatar.com/blavatar/4554b8d24c7f200dc5e2e1b18db1893f?s=200&amp;ts=1542965386" />
<meta property="og:image:width" content="200" />
<meta property="og:image:height" content="200" />
<meta property="og:locale" content="en_US" />
<meta name="twitter:site" content="@wordpressdotcom" />
<meta name="twitter:text:title" content="GotW #95: Thread Safety and&nbsp;Synchronization" />
<meta name="twitter:image" content="https://secure.gravatar.com/blavatar/4554b8d24c7f200dc5e2e1b18db1893f?s=240" />
<meta name="twitter:card" content="summary" />
<meta property="article:publisher" content="https://www.facebook.com/WordPresscom" />

<!-- End Jetpack Open Graph Tags -->
<link rel="shortcut icon" type="image/x-icon" href="https://secure.gravatar.com/blavatar/4554b8d24c7f200dc5e2e1b18db1893f?s=32" sizes="16x16" />
<link rel="icon" type="image/x-icon" href="https://secure.gravatar.com/blavatar/4554b8d24c7f200dc5e2e1b18db1893f?s=32" sizes="16x16" />
<link rel="apple-touch-icon-precomposed" href="https://secure.gravatar.com/blavatar/4554b8d24c7f200dc5e2e1b18db1893f?s=114" />
<link rel='openid.server' href='https://herbsutter.wordpress.com/?openidserver=1' />
<link rel='openid.delegate' href='https://herbsutter.wordpress.com/' />
<link rel="search" type="application/opensearchdescription+xml" href="https://herbsutter.com/osd.xml" title="Sutter’s Mill" />
<link rel="search" type="application/opensearchdescription+xml" href="https://s1.wp.com/opensearch.xml" title="WordPress.com" />
		<style id="wpcom-hotfix-masterbar-style">
			@media screen and (min-width: 783px) {
				#wpadminbar .quicklinks li#wp-admin-bar-my-account.with-avatar > a img {
					margin-top: 5px;
				}
			}
		</style>
		<script type="text/javascript" id="webfont-output">
  
  WebFontConfig = {"typekit":{"id":"cjs1oxc"}};
  (function() {
    var wf = document.createElement('script');
    wf.src = ('https:' == document.location.protocol ? 'https' : 'http') +
      '://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';
    wf.type = 'text/javascript';
    wf.async = 'true';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(wf, s);
	})();
</script><style type="text/css">
.widget_twitter li {
	word-wrap: break-word;
}
</style>
<meta name="application-name" content="Sutter’s Mill" /><meta name="msapplication-window" content="width=device-width;height=device-height" /><meta name="msapplication-tooltip" content="Herb Sutter on software development" /><meta name="msapplication-task" content="name=Subscribe;action-uri=https://herbsutter.com/feed/;icon-uri=https://secure.gravatar.com/blavatar/4554b8d24c7f200dc5e2e1b18db1893f?s=16" /><meta name="msapplication-task" content="name=Sign up for a free blog;action-uri=http://wordpress.com/signup/;icon-uri=https://s1.wp.com/i/favicon.ico" /><meta name="msapplication-task" content="name=WordPress.com Support;action-uri=http://support.wordpress.com/;icon-uri=https://s1.wp.com/i/favicon.ico" /><meta name="msapplication-task" content="name=WordPress.com Forums;action-uri=http://forums.wordpress.com/;icon-uri=https://s1.wp.com/i/favicon.ico" /><meta name="description" content="This GotW was written to answer a set of related frequently asked questions. So here&#039;s a mini-FAQ on &quot;thread safety and synchronization in a nutshell,&quot; and the points we&#039;ll cover apply to thread safety and synchronization in pretty much any mainstream language.  Problem JG Questions 1. What is a race condition, and how serious is&hellip;" />
<style type="text/css">
			#header h1 a,
		#header h2 {
			color: #265E15 !important;
		}
				#headerimage {
			background: url('https://herbsutter.files.wordpress.com/2011/10/cropped-blog-header.jpg') no-repeat;
			height: 200px;
		}
	</style>
<link rel="amphtml" href="https://herbsutter.com/2014/01/06/gotw-95-thread-safety-and-synchronization/amp/"><style type="text/css" id="syntaxhighlighteranchor"></style>
		<link rel="stylesheet" id="custom-css-css" type="text/css" href="https://s2.wp.com/?custom-css=1&#038;csblog=eb5Y&#038;cscache=6&#038;csrev=60" />
		</head>
<body id="section-index" class="post-template-default single single-post postid-2401 single-format-standard mp6 customizer-styles-applied highlander-enabled highlander-light">


<div id="navigation" class="clearfix">
		<div class="menu">
		<ul>
			<li ><a href="https://herbsutter.com/" title="Home">Home</a></li>
			<li class="page_item page-item-912"><a href="https://herbsutter.com/welcome-to-the-jungle/">Welcome to the&nbsp;Jungle</a></li>
<li class="page_item page-item-864 page_item_has_children"><a href="https://herbsutter.com/gotw/">GotW</a></li>
<li class="page_item page-item-761"><a href="https://herbsutter.com/elements-of-modern-c-style/">Elements of Modern C++&nbsp;Style</a></li>
<li class="page_item page-item-2 page_item_has_children"><a href="https://herbsutter.com/about/">About</a></li>
									<li class="search"><form method="get" id="searchform" action="https://herbsutter.com"><input type="text" class="textbox" value="" name="s" id="s" /><input type="submit" id="searchsubmit" value="Search" /></form></li>
					</ul>
	</div>
</div><!-- end id:navigation -->

<div id="container">

<div id="header">
<h1><a href="https://herbsutter.com/" title="Sutter’s Mill">Sutter’s Mill</a></h1>
<h2>Herb Sutter on software development</h2>
</div><!-- end id:header -->


	
		<div id="feedarea">
	<dl>
		<dt><strong>Feeds:</strong></dt>

			<dd><a href="https://herbsutter.com/feed/">Posts</a></dd>
	
			<dd><a href="https://herbsutter.com/comments/feed/">Comments</a></dd>
		</dl>
	</div><!-- end id:feedarea -->
	
	<div id="headerimage">
</div><!-- end id:headerimage -->

<div id="content">
<div id="content-main">

		
									<div class="postnav">
				<div class="alignleft">&laquo; <a href="https://herbsutter.com/2014/01/06/gotw-7c-solution-minimizing-compile-time-dependencies-part-3/" rel="prev">GotW #7c Solution: Minimizing Compile-Time Dependencies, Part&nbsp;3</a></div>
				<div class="alignright"><a href="https://herbsutter.com/2014/01/13/gotw-95-solution-thread-safety-and-synchronization/" rel="next">GotW #95 Solution: Thread Safety and&nbsp;Synchronization</a> &raquo;</div>
			</div>
			
			<div class="post-2401 post type-post status-publish format-standard hentry category-gotw" id="post-2401">
				<div class="posttitle">
					<h2>GotW #95: Thread Safety and&nbsp;Synchronization</h2>
					<p class="post-info">2014-01-06 by <a href="https://herbsutter.com/author/herbsutter/" title="Posts by Herb Sutter">Herb Sutter</a>  </p>
				</div>

				<div class="entry">
					<p><span style="color:#5a5a5a;"><em>This GotW was written to answer a set of related frequently asked questions. So here&#8217;s a mini-FAQ on &#8220;thread safety and synchronization in a nutshell,&#8221; and the points we&#8217;ll cover apply to thread safety and synchronization in pretty much any mainstream language.<br />
</em></span></p>
<p>
 </p>
<h1>Problem<br />
</h1>
<h2>JG Questions<br />
</h2>
<p>1. What is a race condition, and how serious is it?
</p>
<p>2. What is a correctly synchronized program? How do you achieve it? Be specific.
</p>
<p>
 </p>
<h2>Guru Questions<br />
</h2>
<p>3. Consider the following code, where <span style="color:#2e74b5;">some_obj</span> is a shared variable visible to multiple threads.
</p>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code>// thread 1 (performs no additional synchronization)<br />code_that_reads_from( some_obj );  // passes some_obj by const &amp;<br /><br />// thread 2 (performs no additional synchronization)<br />code_that_modifies( some_obj );    // passes some_obj by non-const &amp;
</code></pre>
</p>
<p>If threads 1 and 2 can run concurrently, is this code correctly synchronized if the type of <span style="color:#2e74b5;">some_obj</span> is:
</p>
<p style="margin-left:36pt;">(a) <span style="color:#2e74b5;">int</span>?
</p>
<p style="margin-left:36pt;">(b) <span style="color:#2e74b5;">string</span>?
</p>
<p style="margin-left:36pt;">(c) <span style="color:#2e74b5;">vector&lt;map&lt;int,string&gt;&gt;</span>?
</p>
<p style="margin-left:36pt;">(d) <span style="color:#2e74b5;">shared_ptr&lt;widget&gt;</span>?
</p>
<p style="margin-left:36pt;">(e) <span style="color:#2e74b5;">mutex</span>?
</p>
<p style="margin-left:36pt;">(f) <span style="color:#2e74b5;">condition_variable</span>?
</p>
<p style="margin-left:36pt;">(g) <span style="color:#2e74b5;">atomic&lt;unsigned&gt;</span>?<span style="color:#2e74b5;"><br />
		</span></p>
<p>Hint: This is actually a two-part question, not a seven-part question. There are only two unique answers, each of which covers a subset of the cases.
</p>
<p>4. <em>External synchronization</em> means that the code that uses/owns a given shared object is responsible for performing synchronization on that object. Answer the following questions related to external synchronization:
</p>
<p style="margin-left:36pt;">(a) What is the normal external synchronization responsibility of code that owns and uses a given shared variable?
</p>
<p style="margin-left:36pt;">(b) What is the &#8220;basic thread safety guarantee&#8221; that all types must obey to enable calling code to perform normal external synchronization?
</p>
<p style="margin-left:36pt;">(c) What partial internal synchronization can still be required within the shared variable&#8217;s implementation?
</p>
<p>5. <em>Full internal synchronization</em> (a.k.a. &#8220;synchronized types&#8221; or &#8220;thread-safe types&#8221;) means that a shared object performs all necessary synchronization internally within that object, so that calling code does not need to perform any external synchronization. What types should be fully internally synchronized, and why?</p>
									</div>

				<p class="postmetadata">
					Posted in <a href="https://herbsutter.com/category/c/gotw/" rel="category tag">GotW</a> | 											15 Comments									</p>
				
<!-- You can start editing here. -->

<h3 id="comments">15 Responses</h3>

	<ol class="commentlist">
			<li class="comment byuser comment-author-nosenseetal even thread-even depth-1 highlander-comment" id="comment-14095">
		<div id="div-comment-14095">
		<div class="cmtinfo"><em> on <a href="#comment-14095" title="">2014-01-09 at 1:13 pm</a></em> <img alt='' src='https://0.gravatar.com/avatar/6aea6e2f57f2a7b1cd6870375fbdc42f?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>nosenseetal</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_14095"></div><p>btw  thou shalt not return reference to a member variable&#8230; idk if that is answer to one of this questions but if it is not it should  be added&#8230; it is extremly easy to forgett about that when you decide to mutexify your class by adding a lock_guard to ever method. :)</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-bartoszmilewski odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-14094">
		<div id="div-comment-14094">
		<div class="cmtinfo"><em> on <a href="#comment-14094" title="">2014-01-09 at 11:47 am</a></em> <img alt='' src='https://0.gravatar.com/avatar/c018f213204496b4bbf481e7c8e6c15c?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://www.relisoft.com' rel='external nofollow' class='url'>Bartosz Milewski</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_14094"></div><p>As it often happens in OO programming, there is some confusion about what is meant by &#8220;object&#8221;. From the point of view of concurrency, a mutex protecting an object protects the transitive closure of all the pointers in that data structure. But that&#8217;s probably not what most people understand as an object, so the problem of pointers (references) going out of an object arises. If these pointers point to data that is independently shared &#8212; meaning: not only through the parent object &#8212; then there&#8217;s need for additional synchronization. It&#8217;s cases like these that may lead to deadlocks, but that&#8217;s probably a topic for another GotW.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 highlander-comment" id="comment-14089">
		<div id="div-comment-14089">
		<div class="cmtinfo"><em> on <a href="#comment-14089" title="">2014-01-08 at 3:44 pm</a></em> <img alt='' src='https://0.gravatar.com/avatar/0400152746a64b153a4bc543bf3cf76c?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>Ralph Tandetzky</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_14089"></div><p>1. What is a race condition, and how serious is it?</p>
<p>Well, a race condition is the unpredictable behavior of a piece of software due to a dependence on sequence and timing of different threads or processes. A data race is a race condition that follows from a write access to a non-atomic variable and access by an other thread (read or write) to that same variable. Access to atomic variables from multiple threads can still lead to race condition. However, as long as the end result of the program does not depend on it we&#8217;re fine and the program is correctly synchronized.<br />
A data race as defined above is much more dangerous since it implies undefined behavior. And undefined behavior means that your program may actually do **anything** including sending an e-mail to your boss that you quit or starting world war III against mankind. So a data race is indeed very serious!</p>
<p>2. What is a correctly synchronized program? How do you achieve it? Be specific. </p>
<p>A function is correctly synchronized, if the result of it does not depend on timing of threads or processes. A program is correctly synchronized if it consists of correctly synchronized functions only. That means that at least shared access to a common data amoung multiple threads must be safe: either the variables are atomic or it is ensured that while one thread writes to a location there are no accesses to the same location from other threads at the same time. Typically this is achieved by protecting the data by a mutex. </p>
<p>3. The types in (a)-(d) are not thread safe in the sense that concurrent read and write access is guaranteed to be without data race. Therefore, the program will not be correctly synchronized in these cases. </p>
<p>The types in (e)-(g) are thread safe. Hence, there will be no data race as defined above. However, the execution of the program may still depend on the order in which the variable is modified and read by the two functions. Therefore, the program might be correctly synchronized but it is also possible that the program is not correctly synchronized and there&#8217;s a latent hard to detect bug. (Even though there&#8217;s no undefined behavior.)</p>
<p>4. (a) What is the normal external synchronization responsibility of code that owns and uses a given shared variable?</p>
<p>The code must make sure that whenever there is a write to that variable there are no concurrent read or write accesses to it by other threads. Concurrent read accesses are allowed. </p>
<p>4. (b) What is the “basic thread safety guarantee” that all types must obey to enable calling code to perform normal external synchronization?</p>
<p>All access to a <code>const</code> object of that type must be thread-safe. Furthermore, if there are multiple instances of that type then it must be possible to access (read or write) different objects concurrently as long as each write to each object is mutually exclusive. In other words: As long as one thread has write access to an object there must be no other accesses from other threads to that objects, but other threads may access other objects at the same time. </p>
<p>This is what the standard library guarantees for all its types and functions (with only a few exceptions like <code>rand()</code>). The standard library also expects this from user types, for example when used as template arguments.</p>
<p>4. (c) What partial internal synchronization can still be required within the shared variable’s implementation?</p>
<p>If functions of a type access static or global data, then this access must be protected in order to provide the basic thread safety guarantee. Also different instances of a type may internally refer to some shared state. Access to that shared state must also be protected, if writes are possible. An example for this would be <code>shared_ptr</code>. When copying a <code>shared_ptr</code> the two resulting smart pointers will internally refer to the same object **and** the same reference counter. It is expected from the user to protect accesses to the pointee, but accesses to the reference counter must be synchronized internally. That&#8217;s the reason <code>shared_ptr</code> may incur a performance penalty compared to <code>unique_ptr</code> which is as efficient as a raw pointer in most cases. </p>
<p>5. What types should be fully internally synchronized, and why?</p>
<p>Types that are used in order to communicate between different threads or that enable synchronization between threads such as mutexes, condition variables, futures and concurrent containers should be internally synchronized. For almost all other types internal synchronization is not necessary. </p>
<p>There&#8217;s the so called monitor pattern which in essence turns a type providing the basic thread safety guarantee into a thread-safe type by adding a mutex and protecting every access to an instance by locking that mutex. This serializes the data accesses. Sometimes this kind of behavior is safer, but not very useful. An example are streams: E. g. writing to <code>cout</code> is thread-safe, but the letters arriving in the standard output might be interleaved. (That&#8217;s a race condition, but no data race as defined above. The program is not correctly synchronized.) That&#8217;s a mess with different threads and external synchronization is the only thing that really helps this issue. </p>
<p>For normal types there is no use in making them thread-safe, but it is usually better to let the caller decide on how to synchronize access. Most types don&#8217;t need to know about multi-threading. It a bit like exceptions. Most types don&#8217;t need to worry about exceptions, they let the caller take care of them. Don&#8217;t try to give every type the responsibility of synchronizing itself. Most often it is not necessary and it only slows down the program and external synchronization, if at all necessary, is the better alternative. </p>
<p>From my experience hardly any types need internal synchronization. Exceptions are typically types that are used for synchronization or types that have only one global instance (such as the standard output stream or particular pieces of hardware).</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-14088">
		<div id="div-comment-14088">
		<div class="cmtinfo"><em> on <a href="#comment-14088" title="">2014-01-08 at 3:15 pm</a></em> <img alt='' src='https://0.gravatar.com/avatar/6aea6e2f57f2a7b1cd6870375fbdc42f?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://gravatar.com/nosenseetal' rel='external nofollow' class='url'>nosenseetal</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_14088"></div><p>@Bartosz nice A, I think Herb in 5 is aiming for stuff from his talk you dont know const and mutable&#8230;<br />
and his M&amp;M rule, mutexes and mutable, aka you should make your mutex mutable so external callers can call const methods although those methods modify the mutex by locking it&#8230;</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 highlander-comment" id="comment-14086">
		<div id="div-comment-14086">
		<div class="cmtinfo"><em> on <a href="#comment-14086" title="">2014-01-08 at 7:33 am</a></em> <img alt='' src='https://0.gravatar.com/avatar/6d6e84697bfefc258d442f4ffcca30f1?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://cmeerw.org' rel='external nofollow' class='url'>cmeerw</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_14086"></div><p>I guess for question 4 you have your &#8220;You Don’t Know const and mutable&#8221; talk in mind (i.e. &#8220;const&#8221; means thread-safe)</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-luismarques83 odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-14085">
		<div id="div-comment-14085">
		<div class="cmtinfo"><em> on <a href="#comment-14085" title="">2014-01-08 at 5:59 am</a></em> <img alt='' src='https://1.gravatar.com/avatar/186595d443d24380c366e93823c03605?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://www.luismarques.eu' rel='external nofollow' class='url'>Luís Marques</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_14085"></div><p>Weird. This second time my comment appears and says explicitly that &#8220;Your comment is awaiting moderation.&#8221; Must have been a bug the first time&#8230;</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-luismarques83 even thread-even depth-1 highlander-comment" id="comment-14084">
		<div id="div-comment-14084">
		<div class="cmtinfo"><em> on <a href="#comment-14084" title="">2014-01-08 at 5:54 am</a></em> <img alt='' src='https://1.gravatar.com/avatar/186595d443d24380c366e93823c03605?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://www.luismarques.eu' rel='external nofollow' class='url'>Luís Marques</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_14084"></div><p>Ah, my comment now appeared (was it stuck in moderation limbo? wordpress would only say I was repeating myself if I posted it again). When I posted my comment Bartosz Milewski had not replied yet, I see now that I was not too off base :-) Bartosz, please bring your wizardry back to the D world!</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-14083">
		<div id="div-comment-14083">
		<div class="cmtinfo"><em> on <a href="#comment-14083" title="">2014-01-08 at 4:30 am</a></em> <img alt='' src='https://1.gravatar.com/avatar/de814752c75a845f3c2d54b99d59d199?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://gravatar.com/walkaniceday' rel='external nofollow' class='url'>Xin Huang</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_14083"></div><p>I agree most on Bartosz&#8217;s reply, except for 4(c) which I don&#8217;t quite understand. </p>
<p>A little comment on 3(a):</p>
<p>It&#8217;s not safe to access an int concurrently, even only 1 thread will write. Because you will never know what the compiler would do, it can just load the int into one register and never read it again; or it can rewrite the int value back to the memory. (yes, unchanged value! See <a href="http://software.intel.com/en-us/blogs/2013/01/06/benign-data-races-what-could-possibly-go-wrong" rel="nofollow">http://software.intel.com/en-us/blogs/2013/01/06/benign-data-races-what-could-possibly-go-wrong</a>)</p>
<p>There is no benign data races.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 highlander-comment" id="comment-14082">
		<div id="div-comment-14082">
		<div class="cmtinfo"><em> on <a href="#comment-14082" title="">2014-01-08 at 2:13 am</a></em> <img alt='' src='https://i2.wp.com/lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?resize=48%2C48&#038;ssl=1' class='avatar avatar-48' height='48' width='48' /> <cite><a href='https://plus.google.com/101759802355275422537' rel='external nofollow' class='url'>Łukasz Łucek</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_14082"></div><p>Let me try my luck :) I should state that i&#8217;m not a native english speaker so don&#8217;t mind my writing problems.</p>
<p>So for the first two questions I think the answers are allready in the comments.</p>
<p>For question 3: mutex, condition_variable, and atomic are ok. Int is close but not quite there, because of possible code reordering and lack of sequential consistency.</p>
<p>4. (a) The tesponsibility of the code that uses a shared object is to make sure that when some thread is wrinting to an object it is the only thread that has access to this object. No other thread should be allowed acces to object neither for writing nor reading. On the other hand there can be many reader threads accessing the object in the same time, but as long as noone is writing to it.</p>
<p>4. (b) I belive that this &#8220;basic thread safety guarantee&#8221; is the constness of an object. That means that the type which is to be synchronized cannot change a single bit of itself in const methods. Especially copy constructor and comparison operations cannot change anything in the memory of an object.</p>
<p>4. (c) I Made a mistake in answer to (b), but it is on purpouse. An object is allowed to change its state (bits in memory) in the const operations as long as those changes are internally synchronizeb by that object. Only then this object can be properly externally synchronized.</p>
<p>5. My guess is that you should design types to be thread-safe if you intend to share objects of this type across threads :). If cost of designing and using such a type is lower than a cost of synchronizing objects of this type externally then go for it &#8211; the code using your type will be much nicer to read, and less error prone :). The tricky question is: Is it possible to make internal synchronization without signifficant cost on performance? For example can you afford to lock/unlock a mutex every time you use your variable.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-14081">
		<div id="div-comment-14081">
		<div class="cmtinfo"><em> on <a href="#comment-14081" title="">2014-01-07 at 9:14 pm</a></em> <img alt='' src='https://1.gravatar.com/avatar/186595d443d24380c366e93823c03605?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://www.luismarques.eu' rel='external nofollow' class='url'>Luís Marques</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_14081"></div><p>My C++ is very rusty, but here is my 5:00 AM attempt!</p>
<p>1. Consider a concurrent system, where some data can be accessed concurrently by two or more threads, at least one of which might modify the shared data. A race condition is present in the program if it can result in a pattern of interleaved reads and writes that breaks the guarantees of the language or of the problem domain.</p>
<p>A race condition is very serious for various reasons. If we have a data race we are subject to undefined behavior in theory, and to torn writes in practice. Surely we do not want to access, say, a half written pointer? (In x86 perhaps that could happen in real-mode, when writing to a &#8220;far&#8221; pointer, if the segment and the offset were written by different instructions? Or a misaligned pointer? Particularly if it crosses cache lines and pages?). Even if we do not break the type system (perhaps &#8220;the language rules&#8221; might be more accurate?) a race condition in the problem domain logic is highly problematic, because the defect will tend to be very hard to reproduce and isolate, due to its non-deterministic nature.</p>
<p>2. A correctly synchronized program is one which is free of data races and where you observe the relevant data with the causality guarantees required by your program / problem domain (I suppose that second part is not required by the &#8220;data race free&#8221; first part?). Generally those causality guarantees would be achieved by providing sequential consistency on top of the more fundamental data synchronization steps? (the &#8220;atomic&#8221; bit in the atomics, as opposed to the ordering guarantees and in contrast with relaxed atomics?) (BTW, does that mean we have &#8220;total order for the parts of the program that matter to the relevant other parts&#8221;, if we don&#8217;t use relaxed atomics? Now that&#8217;s a confusing question!).</p>
<p>You achieve correct synchronization by first ditching your old broken compiler, and then not inserting race conditions of your own :-). That last part is done by either not mutating your data or by synchronizing access to it. That means you either make your objects internally synchronized (e.g., use an atomic, or require the object to be fundamentally thread-safe, like a mutex) or you use an external synchronization primitive, like a lock, to serialize and order your accesses.</p>
<p>3. (a). I suppose that this is not safe / correctly synchronized, because you have a data race and an int is not internally synchronized (is it?). BTW, (assuming that is correct) I would imagine that the Java memory model departs the C++ memory model here, and that you could not observe a torn write to an int (or other undefined behaviours). Is this a correct guess? If so, I suppose that implies you can only reasonably (with acceptable performance) implement concurrent Java in a system where the native types are guaranteed by the host system to be atomic (not in the C++ sense of providing ordering guarantees)</p>
<p>3. (b-d) Also not safe, but you can modify elements of the containers that you know won&#8217;t accessed by thread 1?</p>
<p>3. (e-g) These are correctly synchronized because they are internally synchronized?</p>
<p>It&#8217;s getting way too late, I&#8217;ll continue tomorrow/soon (I don&#8217;t know how long after the questions are the answers posted). I hope I was not too off base :-)</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-bartoszmilewski even thread-even depth-1 highlander-comment" id="comment-14080">
		<div id="div-comment-14080">
		<div class="cmtinfo"><em> on <a href="#comment-14080" title="">2014-01-07 at 6:26 pm</a></em> <img alt='' src='https://0.gravatar.com/avatar/c018f213204496b4bbf481e7c8e6c15c?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://www.relisoft.com' rel='external nofollow' class='url'>Bartosz Milewski</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_14080"></div><p>Since nobody raises their hand, let me give it a try.</p>
<p>1. I think there is some subtlety in the nomenclature: data race vs. race condition, so without looking at the Standard: More than one thread accessing the same memory location without synchronization, at least one of them writing. (The tricky part is the definition of synchronization.) </p>
<p>It&#8217;s deadly serious because a data race may go undetected for a long time until one day it causes a disaster. </p>
<p>2. A correctly synchronized program has no data races. You achieve it by making sure that all accesses to shared mutable memory are properly synchronized. The simplest approach is to associate a mutex with every such object (while trying to avoid deadlocks). If you&#8217;re adventurous, you may use atomics. If you are reckless, you may use weak atomics.</p>
<p>3. a, b, c, and d are not correctly synchronized. None provides its own synchronization. There is part of shared_ptr that&#8217;s thread safe &#8212; the reference counter &#8212; but that doesn&#8217;t protect the widget itself.</p>
<p>Mutex provides synchronization for other data and is designed to be accessed from multiple threads. So is condition_variable, although it can only be used in tandem with a mutex. That mutex, however, is not there to protect the condition_variable itself, but the data that&#8217;s used for signaling. Atomic variables are synchronized.</p>
<p>4 a. The code should provide mutual exclusion. Any access, read or write, must occur under a lock. </p>
<p>4 b. I&#8217;m not sure I understand this question. You probably have something very specific in mind. Shared data has to have the right granularity in order to be correctly protected &#8212; you can&#8217;t protect a single bit because there is no way to write a bit without touching other bits in the word. </p>
<p>4 c. This must be a tricky question. I would think that under total mutual exclusion you wouldn&#8217;t need any additional synchronization. Are you thinking of (multiple) reader / writer locks? </p>
<p>5. I guess this is more of a design question. I guess if you are exporting objects from a multithreading library and your library must access them concurrently with your client, these objects should have internal synchronization.</p>
<p>I&#8217;m sure there is much more to it, but that should be enough to start a discussion.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-herbsutter bypostauthor odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-14079">
		<div id="div-comment-14079">
		<div class="cmtinfo"><em> on <a href="#comment-14079" title="">2014-01-07 at 3:53 pm</a></em> <img alt='' src='https://0.gravatar.com/avatar/c0ba56bfd231f8f04feb057728975181?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://www.herbsutter.com' rel='external nofollow' class='url'>Herb Sutter</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_14079"></div><p>The lack of answers is a sign that the question is either too easy or too hard. :) I doubt the former, and hopefully this GotW&#8217;s solution will help if it&#8217;s the latter&#8230;</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-sbohmann even thread-even depth-1 highlander-comment" id="comment-14078">
		<div id="div-comment-14078">
		<div class="cmtinfo"><em> on <a href="#comment-14078" title="">2014-01-07 at 3:10 pm</a></em> <img alt='' src='https://2.gravatar.com/avatar/294f0812e844d56ae17adb9b025dba39?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>sbohmann</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_14078"></div><p>Btw., Herb, would you say that C++ as of version /14 can now, as these high-level models for memory and concurrency have entered the stage, add CommonLisp to its tree of ancestors? :)</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-14077">
		<div id="div-comment-14077">
		<div class="cmtinfo"><em> on <a href="#comment-14077" title="">2014-01-07 at 12:29 pm</a></em> <img alt='' src='https://2.gravatar.com/avatar/294f0812e844d56ae17adb9b025dba39?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://gravatar.com/sbohmann' rel='external nofollow' class='url'>Sebastian Bohmann</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_14077"></div><p>There&#8217;s a truly baffling number of incredibly deep sub-questions and sub-topics in that :)</p>
<p>(I know I&#8217;m overusing adjectives here from a stylistic point of view, but gosh&#8230;)</p>
<p>To me it&#8217;s a bit like, now that C++ finally is getting comprehensive abstract memory and threading models plus all the necessary abstractions in the STL, please go and learn everything possible about it&#8230; and I most certainly will attempt that, but I&#8217;m so looking forward to Herb&#8217;s answer post as a starting point ;)</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="pingback even thread-even depth-1 highlander-comment" id="comment-14058">
		<div id="div-comment-14058">
		<div class="cmtinfo"><em> on <a href="#comment-14058" title="">2014-01-06 at 9:21 am</a></em>  <cite><a href='http://guillaumebelz.wordpress.com/2014/01/06/guru-of-the-week-7/' rel='external nofollow' class='url'>Guru of the week 7 | C++, Qt, OpenGL, CUDA</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_14058"></div><p>[&#8230;] En complément, la question du GotW 95 : GotW #95: Thread Safety and Synchronization [&#8230;]</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
	</ol>

	<div class="navigation">
		<div class="alignleft"></div>
		<div class="alignright"></div>
	</div>
	<br />

  	<p class="nocomments">Comments are closed.</p>
  <div class="post-content">
<p>
</p>
</div>

			</div>

		
		<p align="center"></p>

	</div><!-- end id:content-main -->
<div id="sidebar">
<ul>
<li class="sidebox"><h2><label for="subscribe-field">Follow by email</label></h2>
				<form action="https://subscribe.wordpress.com" method="post" accept-charset="utf-8" id="subscribe-blog">
																	<p><input type="text" name="email" style="width: 95%; padding: 1px 2px" placeholder="Enter your email address" value="" id="subscribe-field"/></p>
					
					<p>
						<input type="hidden" name="action" value="subscribe"/>
						<input type="hidden" name="blog_id" value="3379246"/>
						<input type="hidden" name="source" value="https://herbsutter.com/2014/01/06/gotw-95-thread-safety-and-synchronization/"/>
						<input type="hidden" name="sub-type" value="widget"/>
						<input type="hidden" name="redirect_fragment" value="blog_subscription-3" />
						<input type="hidden" id="_wpnonce" name="_wpnonce" value="4590924cc6" />						<input type="submit" value="Subscribe" />
					</p>
				</form>
			
</li><li class="sidebox"><h2><a href='http://twitter.com/herbsutter'>Tweets</a></h2><ul class='tweets'></ul><a href="http://twitter.com/herbsutter"  class='twitter-follow-button' data-show-count='false' data-link-color='#265e15' data-text-color='#333333'>Follow @herbsutter</a></li><li class="sidebox"><h2>Popular</h2><ul>				<li>
										<a href="https://herbsutter.com/2018/11/13/trip-report-fall-iso-c-standards-meeting-san-diego/" class="bump-view" data-bump-view="tp">
						Trip report: Fall ISO C++ standards meeting (San Diego)					</a>
										</li>
								<li>
										<a href="https://herbsutter.com/gotw/" class="bump-view" data-bump-view="tp">
						GotW					</a>
										</li>
								<li>
										<a href="https://herbsutter.com/2018/09/20/lifetime-profile-v1-0-posted/" class="bump-view" data-bump-view="tp">
						Lifetime profile v1.0 posted					</a>
										</li>
				</ul></li><li class="sidebox"><h2>Categories</h2>		<ul>
				<li class="cat-item cat-item-291"><a href="https://herbsutter.com/category/apple/" >Apple</a>
</li>
	<li class="cat-item cat-item-49277"><a href="https://herbsutter.com/category/c-net/" >C# / .NET</a>
</li>
	<li class="cat-item cat-item-2426"><a href="https://herbsutter.com/category/c/" >C++</a>
</li>
	<li class="cat-item cat-item-69816"><a href="https://herbsutter.com/category/cloud/" >Cloud</a>
</li>
	<li class="cat-item cat-item-214618"><a href="https://herbsutter.com/category/concurrency/" >Concurrency</a>
</li>
	<li class="cat-item cat-item-8259773"><a href="https://herbsutter.com/category/effective-concurrency/" >Effective Concurrency</a>
</li>
	<li class="cat-item cat-item-3696745"><a href="https://herbsutter.com/category/friday-thoughts/" >Friday Thoughts</a>
</li>
	<li class="cat-item cat-item-3867746"><a href="https://herbsutter.com/category/c/gotw/" >GotW</a>
</li>
	<li class="cat-item cat-item-79"><a href="https://herbsutter.com/category/hardware/" >Hardware</a>
</li>
	<li class="cat-item cat-item-1017"><a href="https://herbsutter.com/category/java/" >Java</a>
</li>
	<li class="cat-item cat-item-637"><a href="https://herbsutter.com/category/microsoft/" >Microsoft</a>
</li>
	<li class="cat-item cat-item-420845"><a href="https://herbsutter.com/category/opinion-editorial/" >Opinion &amp; Editorial</a>
</li>
	<li class="cat-item cat-item-1633077"><a href="https://herbsutter.com/category/reader-qa/" >Reader Q&amp;A</a>
</li>
	<li class="cat-item cat-item-2301"><a href="https://herbsutter.com/category/software-development/" >Software Development</a>
</li>
	<li class="cat-item cat-item-393523"><a href="https://herbsutter.com/category/talks-events/" >Talks &amp; Events</a>
</li>
	<li class="cat-item cat-item-1"><a href="https://herbsutter.com/category/uncategorized/" >Uncategorized</a>
</li>
	<li class="cat-item cat-item-151"><a href="https://herbsutter.com/category/web/" >Web</a>
</li>
		</ul>
			</li></ul>
</div><!-- end id:sidebar -->
</div><!-- end id:content -->
</div><!-- end id:container -->
<div id="footer">
	<div id="colophon">
		<p><a href="https://wordpress.com/?ref=footer_blog">Blog at WordPress.com.</a></p>
		<p>WPThemes.</p>
		<br class="clear" />
	</div><!-- end #colophon-->
</div><!-- end #footer-->
<!--  -->
<script type='text/javascript' src='//0.gravatar.com/js/gprofiles.js?ver=201847y'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var WPGroHo = {"my_hash":""};
/* ]]> */
</script>
<script type='text/javascript' src='https://s1.wp.com/wp-content/mu-plugins/gravatar-hovercards/wpgroho.js?m=1380573781h'></script>

	<script>
		//initialize and attach hovercards to all gravatars
		jQuery( document ).ready( function( $ ) {

			if (typeof Gravatar === "undefined"){
				return;
			}

			if ( typeof Gravatar.init !== "function" ) {
				return;
			}			

			Gravatar.profile_cb = function( hash, id ) {
				WPGroHo.syncProfileData( hash, id );
			};
			Gravatar.my_hash = WPGroHo.my_hash;
			Gravatar.init( 'body', '#wp-admin-bar-my-account' );
		});
	</script>

		<div style="display:none">
	<div class="grofile-hash-map-6aea6e2f57f2a7b1cd6870375fbdc42f">
	</div>
	<div class="grofile-hash-map-c018f213204496b4bbf481e7c8e6c15c">
	</div>
	<div class="grofile-hash-map-0400152746a64b153a4bc543bf3cf76c">
	</div>
	<div class="grofile-hash-map-6aea6e2f57f2a7b1cd6870375fbdc42f">
	</div>
	<div class="grofile-hash-map-6d6e84697bfefc258d442f4ffcca30f1">
	</div>
	<div class="grofile-hash-map-186595d443d24380c366e93823c03605">
	</div>
	<div class="grofile-hash-map-de814752c75a845f3c2d54b99d59d199">
	</div>
	<div class="grofile-hash-map-bafa987ee4d9c2c1e54446b5d11fb3b7">
	</div>
	<div class="grofile-hash-map-186595d443d24380c366e93823c03605">
	</div>
	<div class="grofile-hash-map-c0ba56bfd231f8f04feb057728975181">
	</div>
	<div class="grofile-hash-map-294f0812e844d56ae17adb9b025dba39">
	</div>
	<div class="grofile-hash-map-294f0812e844d56ae17adb9b025dba39">
	</div>
	</div>
<script type='text/javascript' charset='UTF-8' id='polldaddyRatings'><!--//--><![CDATA[//><!--
PDRTJS_settings_468178_comm_14095={"id":468178,"unique_id":"wp-comment-14095","title":"btw%20%20thou%20shalt%20not%20return%20reference%20to%20a%20member%20variable...%20idk%20if%20that%20is%20answer%20to%20one%20of%20this%20questions%20but%20if%20it%20is%20not%20it%20should%20%20be%20added...%20it%20is%20extremly%20easy%20to%20forgett%20about%20that%20when%20...","permalink":"https:\/\/herbsutter.com\/2014\/01\/06\/gotw-95-thread-safety-and-synchronization\/#comment-14095","item_id":"_comm_14095"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_14095 == 'undefined' ){PDRTJS_468178_comm_14095 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_14095 );}}PDRTJS_settings_468178_comm_14094={"id":468178,"unique_id":"wp-comment-14094","title":"As%20it%20often%20happens%20in%20OO%20programming%2C%20there%20is%20some%20confusion%20about%20what%20is%20meant%20by%20%26quot%3Bobject%26quot%3B.%20From%20the%20point%20of%20view%20of%20concurrency%2C%20a%20mutex%20protecting%20an%20object%20protects%20the%20transitive%20closure...","permalink":"https:\/\/herbsutter.com\/2014\/01\/06\/gotw-95-thread-safety-and-synchronization\/#comment-14094","item_id":"_comm_14094"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_14094 == 'undefined' ){PDRTJS_468178_comm_14094 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_14094 );}}PDRTJS_settings_468178_comm_14089={"id":468178,"unique_id":"wp-comment-14089","title":"1.%20What%20is%20a%20race%20condition%2C%20and%20how%20serious%20is%20it%3FWell%2C%20a%20race%20condition%20is%20the%20unpredictable%20behavior%20of%20a%20piece%20of%20software%20due%20to%20a%20dependence%20on%20sequence%20and%20timing%20of%20different%20threads%20or%20p...","permalink":"https:\/\/herbsutter.com\/2014\/01\/06\/gotw-95-thread-safety-and-synchronization\/#comment-14089","item_id":"_comm_14089"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_14089 == 'undefined' ){PDRTJS_468178_comm_14089 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_14089 );}}PDRTJS_settings_468178_comm_14088={"id":468178,"unique_id":"wp-comment-14088","title":"%40Bartosz%20nice%20A%2C%20I%20think%20Herb%20in%205%20is%20aiming%20for%20stuff%20from%20his%20talk%20you%20dont%20know%20const%20and%20mutable...and%20his%20M%26amp%3BM%20rule%2C%20mutexes%20and%20mutable%2C%20aka%20you%20should%20make%20your%20mutex%20mutable%20so%20externa...","permalink":"https:\/\/herbsutter.com\/2014\/01\/06\/gotw-95-thread-safety-and-synchronization\/#comment-14088","item_id":"_comm_14088"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_14088 == 'undefined' ){PDRTJS_468178_comm_14088 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_14088 );}}PDRTJS_settings_468178_comm_14086={"id":468178,"unique_id":"wp-comment-14086","title":"I%20guess%20for%20question%204%20you%20have%20your%20%26quot%3BYou%20Dont%20Know%20const%20and%20mutable%26quot%3B%20talk%20in%20mind%20%28i.e.%20%26quot%3Bconst%26quot%3B%20means%20thread-safe%29...","permalink":"https:\/\/herbsutter.com\/2014\/01\/06\/gotw-95-thread-safety-and-synchronization\/#comment-14086","item_id":"_comm_14086"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_14086 == 'undefined' ){PDRTJS_468178_comm_14086 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_14086 );}}PDRTJS_settings_468178_comm_14085={"id":468178,"unique_id":"wp-comment-14085","title":"Weird.%20This%20second%20time%20my%20comment%20appears%20and%20says%20explicitly%20that%20%26quot%3BYour%20comment%20is%20awaiting%20moderation.%26quot%3B%20Must%20have%20been%20a%20bug%20the%20first%20time......","permalink":"https:\/\/herbsutter.com\/2014\/01\/06\/gotw-95-thread-safety-and-synchronization\/#comment-14085","item_id":"_comm_14085"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_14085 == 'undefined' ){PDRTJS_468178_comm_14085 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_14085 );}}PDRTJS_settings_468178_comm_14084={"id":468178,"unique_id":"wp-comment-14084","title":"Ah%2C%20my%20comment%20now%20appeared%20%28was%20it%20stuck%20in%20moderation%20limbo%3F%20wordpress%20would%20only%20say%20I%20was%20repeating%20myself%20if%20I%20posted%20it%20again%29.%20When%20I%20posted%20my%20comment%20Bartosz%20Milewski%20had%20not%20replied%20yet...","permalink":"https:\/\/herbsutter.com\/2014\/01\/06\/gotw-95-thread-safety-and-synchronization\/#comment-14084","item_id":"_comm_14084"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_14084 == 'undefined' ){PDRTJS_468178_comm_14084 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_14084 );}}PDRTJS_settings_468178_comm_14083={"id":468178,"unique_id":"wp-comment-14083","title":"I%20agree%20most%20on%20Bartosz%26%23039%3Bs%20reply%2C%20except%20for%204%28c%29%20which%20I%20don%26%23039%3Bt%20quite%20understand.%20A%20little%20comment%20on%203%28a%29%3AIt%26%23039%3Bs%20not%20safe%20to%20access%20an%20int%20concurrently%2C%20even%20only%201%20thread%20will%20write.%20Because%20you%20w...","permalink":"https:\/\/herbsutter.com\/2014\/01\/06\/gotw-95-thread-safety-and-synchronization\/#comment-14083","item_id":"_comm_14083"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_14083 == 'undefined' ){PDRTJS_468178_comm_14083 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_14083 );}}PDRTJS_settings_468178_comm_14082={"id":468178,"unique_id":"wp-comment-14082","title":"Let%20me%20try%20my%20luck%20%3A%29%20I%20should%20state%20that%20i%26%23039%3Bm%20not%20a%20native%20english%20speaker%20so%20don%26%23039%3Bt%20mind%20my%20writing%20problems.So%20for%20the%20first%20two%20questions%20I%20think%20the%20answers%20are%20allready%20in%20the%20comments.For%20qu...","permalink":"https:\/\/herbsutter.com\/2014\/01\/06\/gotw-95-thread-safety-and-synchronization\/#comment-14082","item_id":"_comm_14082"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_14082 == 'undefined' ){PDRTJS_468178_comm_14082 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_14082 );}}PDRTJS_settings_468178_comm_14081={"id":468178,"unique_id":"wp-comment-14081","title":"My%20C%2B%2B%20is%20very%20rusty%2C%20but%20here%20is%20my%205%3A00%20AM%20attempt%211.%20Consider%20a%20concurrent%20system%2C%20where%20some%20data%20can%20be%20accessed%20concurrently%20by%20two%20or%20more%20threads%2C%20at%20least%20one%20of%20which%20might%20modify%20the%20s...","permalink":"https:\/\/herbsutter.com\/2014\/01\/06\/gotw-95-thread-safety-and-synchronization\/#comment-14081","item_id":"_comm_14081"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_14081 == 'undefined' ){PDRTJS_468178_comm_14081 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_14081 );}}PDRTJS_settings_468178_comm_14080={"id":468178,"unique_id":"wp-comment-14080","title":"Since%20nobody%20raises%20their%20hand%2C%20let%20me%20give%20it%20a%20try.1.%20I%20think%20there%20is%20some%20subtlety%20in%20the%20nomenclature%3A%20data%20race%20vs.%20race%20condition%2C%20so%20without%20looking%20at%20the%20Standard%3A%20More%20than%20one%20thread%20...","permalink":"https:\/\/herbsutter.com\/2014\/01\/06\/gotw-95-thread-safety-and-synchronization\/#comment-14080","item_id":"_comm_14080"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_14080 == 'undefined' ){PDRTJS_468178_comm_14080 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_14080 );}}PDRTJS_settings_468178_comm_14079={"id":468178,"unique_id":"wp-comment-14079","title":"The%20lack%20of%20answers%20is%20a%20sign%20that%20the%20question%20is%20either%20too%20easy%20or%20too%20hard.%20%3A%29%20I%20doubt%20the%20former%2C%20and%20hopefully%20this%20GotW%26%23039%3Bs%20solution%20will%20help%20if%20it%26%23039%3Bs%20the%20latter......","permalink":"https:\/\/herbsutter.com\/2014\/01\/06\/gotw-95-thread-safety-and-synchronization\/#comment-14079","item_id":"_comm_14079"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_14079 == 'undefined' ){PDRTJS_468178_comm_14079 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_14079 );}}PDRTJS_settings_468178_comm_14078={"id":468178,"unique_id":"wp-comment-14078","title":"Btw.%2C%20Herb%2C%20would%20you%20say%20that%20C%2B%2B%20as%20of%20version%20%2F14%20can%20now%2C%20as%20these%20high-level%20models%20for%20memory%20and%20concurrency%20have%20entered%20the%20stage%2C%20add%20CommonLisp%20to%20its%20tree%20of%20ancestors%3F%20%3A%29...","permalink":"https:\/\/herbsutter.com\/2014\/01\/06\/gotw-95-thread-safety-and-synchronization\/#comment-14078","item_id":"_comm_14078"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_14078 == 'undefined' ){PDRTJS_468178_comm_14078 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_14078 );}}PDRTJS_settings_468178_comm_14077={"id":468178,"unique_id":"wp-comment-14077","title":"There%26%23039%3Bs%20a%20truly%20baffling%20number%20of%20incredibly%20deep%20sub-questions%20and%20sub-topics%20in%20that%20%3A%29%28I%20know%20I%26%23039%3Bm%20overusing%20adjectives%20here%20from%20a%20stylistic%20point%20of%20view%2C%20but%20gosh...%29To%20me%20it%26%23039%3Bs%20a%20bit%20like%2C%20...","permalink":"https:\/\/herbsutter.com\/2014\/01\/06\/gotw-95-thread-safety-and-synchronization\/#comment-14077","item_id":"_comm_14077"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_14077 == 'undefined' ){PDRTJS_468178_comm_14077 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_14077 );}}PDRTJS_settings_468178_comm_14058={"id":468178,"unique_id":"wp-comment-14058","title":"%26%23091%3B%26%238230%3B%26%23093%3B%20En%20complment%2C%20la%20question%20du%20GotW%2095%20%3AGotW%20%2395%3A%20Thread%20Safety%20and%20Synchronization%20%26%23091%3B%26%238230%3B%26%23093%3B...","permalink":"https:\/\/herbsutter.com\/2014\/01\/06\/gotw-95-thread-safety-and-synchronization\/#comment-14058","item_id":"_comm_14058"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_14058 == 'undefined' ){PDRTJS_468178_comm_14058 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_14058 );}}
//--><!]]></script><script type='text/javascript' charset='UTF-8' src='https://polldaddy.com/js/rating/rating.js'></script><script type='text/javascript' src='https://platform.twitter.com/widgets.js?ver=20111117'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var actionbardata = {"siteID":"3379246","siteName":"Sutter\u2019s Mill","siteURL":"https:\/\/herbsutter.com","icon":"<img alt='' src='https:\/\/secure.gravatar.com\/blavatar\/4554b8d24c7f200dc5e2e1b18db1893f?s=50&d=https%3A%2F%2Fs2.wp.com%2Fi%2Flogo%2Fwpcom-gray-white.png' class='avatar avatar-50' height='50' width='50' \/>","canManageOptions":"","canCustomizeSite":"","isFollowing":"","themeSlug":"pub\/mistylook","signupURL":"https:\/\/wordpress.com\/start\/","loginURL":"https:\/\/herbsutter.wordpress.com\/wp-login.php?redirect_to=https%3A%2F%2Fherbsutter.com%2F2014%2F01%2F06%2Fgotw-95-thread-safety-and-synchronization%2F","themeURL":"","xhrURL":"https:\/\/herbsutter.com\/wp-admin\/admin-ajax.php","nonce":"8fb9818ae2","isSingular":"1","isFolded":"","isLoggedIn":"","isMobile":"","subscribeNonce":"<input type=\"hidden\" id=\"_wpnonce\" name=\"_wpnonce\" value=\"4590924cc6\" \/>","referer":"https:\/\/herbsutter.com\/2014\/01\/06\/gotw-95-thread-safety-and-synchronization\/","canFollow":"1","feedID":"171936","statusMessage":"","customizeLink":"https:\/\/herbsutter.wordpress.com\/wp-admin\/customize.php?url=https%3A%2F%2Fherbsutter.wordpress.com%2F2014%2F01%2F06%2Fgotw-95-thread-safety-and-synchronization%2F","postID":"2401","shortlink":"https:\/\/wp.me\/peb5Y-CJ","canEditPost":"","editLink":"https:\/\/wordpress.com\/post\/herbsutter.com\/2401","statsLink":"https:\/\/wordpress.com\/stats\/post\/2401\/herbsutter.com","i18n":{"view":"View site","follow":"Follow","following":"Following","edit":"Edit","login":"Log in","signup":"Sign up","customize":"Customize","report":"Report this content","themeInfo":"Get theme: MistyLook","shortlink":"Copy shortlink","copied":"Copied","followedText":"New posts from this site will now appear in your <a href=\"https:\/\/wordpress.com\/\">Reader<\/a>","foldBar":"Collapse this bar","unfoldBar":"Expand this bar","editSubs":"Manage subscriptions","viewReader":"View site in Reader","viewReadPost":"View post in Reader","subscribe":"Sign me up","enterEmail":"Enter your email address","followers":"Join 19,532 other followers","alreadyUser":"Already have a WordPress.com account? <a href=\"https:\/\/herbsutter.wordpress.com\/wp-login.php?redirect_to=https%3A%2F%2Fherbsutter.com%2F2014%2F01%2F06%2Fgotw-95-thread-safety-and-synchronization%2F\">Log in now.<\/a>","stats":"Stats"}};
/* ]]> */
</script>
<script type='text/javascript' src='https://s0.wp.com/_static/??-eJyVjcEOgjAQRH/IuoIYT8Zvqe2GLrQLdlvAv7ceJEYTEg+bTGbe7MA8KjNwQk7QCVicyOC47DvZwUcUshp9bokFPPUocM+Y0Wm2HuM3/CblwUkvjlrnyyWMv87GjraBWN10hKCloEWpYcIYyZb91fvzQ4ra9LJVMokGfpVWVehruFSnujo0x+Zcd0+y+3Rn'></script>
<script type="text/javascript">
// <![CDATA[
(function() {
try{
  if ( window.external &&'msIsSiteMode' in window.external) {
    if (window.external.msIsSiteMode()) {
      var jl = document.createElement('script');
      jl.type='text/javascript';
      jl.async=true;
      jl.src='/wp-content/plugins/ie-sitemode/custom-jumplist.php';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(jl, s);
    }
  }
}catch(e){}
})();
// ]]>
</script><script src="//stats.wp.com/w.js?56" type="text/javascript" async defer></script>
<script type="text/javascript">
_tkq = window._tkq || [];
_stq = window._stq || [];
_tkq.push(['storeContext', {'blog_id':'3379246','blog_tz':'-8','user_lang':'en','blog_lang':'en','user_id':'0'}]);
_stq.push(['view', {'blog':'3379246','v':'wpcom','tz':'-8','user_id':'0','post':'2401','subd':'herbsutter'}]);
_stq.push(['extra', {'crypt':'UE40eW5QN0p8M2Y/RE1TaVhzUzFMbjdWNHpwZGhTayxPSUFCMGNrd29+Smw0TDhnZmRTK0hlRi9QSGh6bi9GXVhBJWIlZlR5U1JMLU8/MkNtblkvY1d1TjBELytHc0k/MXdHUVQyK2IyUVA5SjU1bj9VX3ExLHYsREFpcnlfNHYtXV1HSUIsLkJrcnp0eS5sJlV3QmpFVixIZG4teUtJXyxbc3FJRk1qVnV0dCV6dktYM0RHcit6fmc3Vm43a2IuSl1UTUVZcXFubi91Y2lrNiswZkRZTEptRlNuLy14R1txaVIrcU4/U1M2Wy1LRzVCaUNUUU02MHosVi9bTSw0W2tkXzVlTUxkb2lMeERwJmtHfHxxRWk2dHQ2a1ExRm9dLnIwWlU4MzFES2lXcXFoMmtXd3V5YVlpdzVnLzNfWDkxP3dvWldGZ0hUN11qaXM3REw4THk0'}]);
_stq.push([ 'clickTrackerInit', '3379246', '2401' ]);
	</script>
<noscript><img src="https://pixel.wp.com/b.gif?v=noscript" style="height:0px;width:0px;overflow:hidden" alt="" /></noscript>
<script>
if ( 'object' === typeof wpcom_mobile_user_agent_info ) {

	wpcom_mobile_user_agent_info.init();
	var mobileStatsQueryString = "";
	
	if( false !== wpcom_mobile_user_agent_info.matchedPlatformName )
		mobileStatsQueryString += "&x_" + 'mobile_platforms' + '=' + wpcom_mobile_user_agent_info.matchedPlatformName;
	
	if( false !== wpcom_mobile_user_agent_info.matchedUserAgentName )
		mobileStatsQueryString += "&x_" + 'mobile_devices' + '=' + wpcom_mobile_user_agent_info.matchedUserAgentName;
	
	if( wpcom_mobile_user_agent_info.isIPad() )
		mobileStatsQueryString += "&x_" + 'ipad_views' + '=' + 'views';

	if( "" != mobileStatsQueryString ) {
		new Image().src = document.location.protocol + '//pixel.wp.com/g.gif?v=wpcom-no-pv' + mobileStatsQueryString + '&baba=' + Math.random();
	}
	
}
</script></body>
</html>