<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>GotW #101: Compilation Firewalls, Part 2 (Difficulty: 8/10) | Sutter’s Mill</title>
<link rel="pingback" href="https://herbsutter.com/xmlrpc.php" />
<script type="text/javascript">
  WebFontConfig = {"typekit":{"id":"eyo0tqd"}};
  (function() {
    var wf = document.createElement('script');
    wf.src = 'https://s0.wp.com/wp-content/plugins/custom-fonts/js/webfont.js';
    wf.type = 'text/javascript';
    wf.async = 'true';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(wf, s);
	})();
</script><style id="jetpack-custom-fonts-css">.wf-active #header h1{font-size:2.12em;font-family:"ff-dagny-web-pro-1","ff-dagny-web-pro-2",sans-serif;font-style:normal;font-weight:400}.wf-active body{font-size:89.7%;font-family:"ff-basic-gothic-web-pro-1","ff-basic-gothic-web-pro-2",sans-serif}.wf-active #navigation{font-family:"ff-basic-gothic-web-pro-1","ff-basic-gothic-web-pro-2",sans-serif}.wf-active #navigation ul li.search{font-size:1.06em}.wf-active #navigation ul li.search input#searchsubmit{font-size:1.06em}.wf-active #content .post-info, .wf-active #content .postmetadata{font-size:1.06em}.wf-active #sidebar{font-size:1.06em}.wf-active #footer p.right{font-size:1.06em}.wf-active .commentnum{font-size:1.77em}.wf-active .commentlist li .cmtinfo{font-size:1.18em}.wf-active .commentlist li .cmtinfo em{font-size:1.06em}.wf-active #respond label{font-size:11.8px}.wf-active #respond .required{font-size:11.8px}.wf-active #respond .subscribe-label{font-size:14.2px}.wf-active #respond .comment-notes{font-size:13px}.wf-active .wp-caption p.wp-caption-text{font-size:13px}.wf-active #content h1, .wf-active h2, .wf-active h3, .wf-active h4, .wf-active h5, .wf-active h6{font-family:"ff-dagny-web-pro-1","ff-dagny-web-pro-2",sans-serif;font-style:normal;font-weight:400}.wf-active #header h2{font-size:1.18em;font-weight:400;font-family:"ff-dagny-web-pro-1","ff-dagny-web-pro-2",sans-serif;font-style:normal}.wf-active #content h3{font-size:1.65em;font-weight:400;font-style:normal}.wf-active #content h4{font-size:1.3em;font-style:normal;font-weight:400}.wf-active #content h5{font-size:1.18em;font-style:normal;font-weight:400}.wf-active #content .post h2{font-size:1.65em;font-weight:400;font-style:normal}.wf-active li.sidebox h2{font-weight:400;font-size:1.89em;font-style:normal}.wf-active .post h4{font-size:1.18em;font-weight:400;font-family:"ff-dagny-web-pro-1","ff-dagny-web-pro-2",sans-serif;font-style:normal}.wf-active .post h4 em{font-style:normal;font-weight:400}</style>
		<script src='https://r-login.wordpress.com/remote-login.php?action=js&amp;host=herbsutter.com&amp;id=3379246&amp;t=1542966241&amp;back=https%3A%2F%2Fherbsutter.com%2F2011%2F11%2F16%2Fgotw-101%2F' type="text/javascript"></script>
		<script type="text/javascript">
		/* <![CDATA[ */
			if ( 'function' === typeof WPRemoteLogin ) {
				document.cookie = "wordpress_test_cookie=test; path=/";
				if ( document.cookie.match( /(;|^)\s*wordpress_test_cookie\=/ ) ) {
					WPRemoteLogin();
				}
			}
		/* ]]> */
		</script>
		<link rel='dns-prefetch' href='//s2.wp.com' />
<link rel='dns-prefetch' href='//s0.wp.com' />
<link rel='dns-prefetch' href='//s1.wp.com' />
<link rel='dns-prefetch' href='//herbsutter.wordpress.com' />
<link rel="alternate" type="application/rss+xml" title="Sutter’s Mill &raquo; Feed" href="https://herbsutter.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="Sutter’s Mill &raquo; Comments Feed" href="https://herbsutter.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Sutter’s Mill &raquo; GotW #101: Compilation Firewalls, Part 2 (Difficulty:&nbsp;8/10) Comments Feed" href="https://herbsutter.com/2011/11/16/gotw-101/feed/" />
	<script type="text/javascript">
		/* <![CDATA[ */
		function addLoadEvent(func) {
			var oldonload = window.onload;
			if (typeof window.onload != 'function') {
				window.onload = func;
			} else {
				window.onload = function () {
					oldonload();
					func();
				}
			}
		}
		/* ]]> */
	</script>
			<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s0.wp.com\/wp-content\/mu-plugins\/wpcom-smileys\/twemoji\/2\/72x72\/","ext":".png","svgUrl":"https:\/\/s0.wp.com\/wp-content\/mu-plugins\/wpcom-smileys\/twemoji\/2\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/s1.wp.com\/wp-includes\/js\/wp-emoji-release.min.js?m=1532082729h&ver=4.9.8"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56760,9792,65039],[55358,56760,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel='stylesheet' id='all-css-0-1' href='https://s2.wp.com/_static/??-eJyNkN1uwjAMhV9onsUG69W0Z0laE0zzp8QR6tvjUlUCwSpuonOS81knxkuGPkWhKBgaZN8cx4qeR6p4JsmmH+HmPvtaP/B1nOORI8uEcqKgYG4WA1eZfErjFtinQnofspE5EWhgQ15nRNnCQv5ZqVmetORmv0vWNFibC9UKegZuAZayT9wKuabWUnEwt0Tb2A9ofbotxBZTJpx/SE8DXi3hn+h9Rx4cSUVJGXKqqt5GaurZeGCNPJoFZoxJlsdVbE11lEB/aYRTfDBw9IbLFlpI9+NUOtTUnZ2hv/C7O+y/uu9uf+jOV8Xg7sY=?cssminify=yes' type='text/css' media='all' />
<link rel='stylesheet' id='print-css-1-1' href='https://s2.wp.com/wp-content/mu-plugins/global-print/global-print.css?m=1465851035h&cssminify=yes' type='text/css' media='print' />
<link rel='stylesheet' id='all-css-2-1' href='https://s0.wp.com/_static/??/wp-content/mu-plugins/actionbar/actionbar.css,/wp-content/themes/h4/global.css?m=1516985148j&cssminify=yes' type='text/css' media='all' />
<script type='text/javascript' src='https://s0.wp.com/_static/??-eJyFztEKwjAMBdAfsquTiXsRv6XWOFKXtDbphn69HeiDMBQCgdzDJXZOBtmP5QJiQ517gfx4rybIxv4ChnDITqEh5A/2kRVYF0vxjCOYIpDdUG+16BpXXIqiBCIVraTfLyFPCPNfFkCT8zeTQfC5tJ7o2Hb9Yde3+24bXjRNW9I='></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://herbsutter.wordpress.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://s1.wp.com/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='GotW #100: Solution' href='https://herbsutter.com/2011/11/16/gotw-100-solution/' />
<link rel='next' title='C++ Spring: GoingNative, Feb 2-3,&nbsp;2012' href='https://herbsutter.com/2011/11/23/c-spring-goingnative-feb-2-3-2012/' />
<meta name="generator" content="WordPress.com" />
<link rel="canonical" href="https://herbsutter.com/2011/11/16/gotw-101/" />
<link rel='shortlink' href='https://wp.me/peb5Y-gm' />
<link rel="alternate" type="application/json+oembed" href="https://public-api.wordpress.com/oembed/?format=json&amp;url=https%3A%2F%2Fherbsutter.com%2F2011%2F11%2F16%2Fgotw-101%2F&amp;for=wpcom-auto-discovery" /><link rel="alternate" type="application/xml+oembed" href="https://public-api.wordpress.com/oembed/?format=xml&amp;url=https%3A%2F%2Fherbsutter.com%2F2011%2F11%2F16%2Fgotw-101%2F&amp;for=wpcom-auto-discovery" />
<!-- Jetpack Open Graph Tags -->
<meta property="og:type" content="article" />
<meta property="og:title" content="GotW #101: Compilation Firewalls, Part 2 (Difficulty: 8/10)" />
<meta property="og:url" content="https://herbsutter.com/2011/11/16/gotw-101/" />
<meta property="og:description" content="GotW #100 demonstrated the best way to express the Pimpl idiom using only standard C++11 features: Guru Question Is it possible to make the widget code easier to write by wrapping the Pimpl pattern…" />
<meta property="article:published_time" content="2011-11-16T19:03:10+00:00" />
<meta property="article:modified_time" content="2011-12-03T00:04:42+00:00" />
<meta property="og:site_name" content="Sutter’s Mill" />
<meta property="og:image" content="https://herbsutter.files.wordpress.com/2011/11/image_thumb17.png" />
<meta property="og:image:width" content="244" />
<meta property="og:image:height" content="123" />
<meta property="og:locale" content="en_US" />
<meta name="twitter:site" content="@wordpressdotcom" />
<meta name="twitter:text:title" content="GotW #101: Compilation Firewalls, Part 2 (Difficulty:&nbsp;8/10)" />
<meta name="twitter:card" content="summary" />
<meta property="article:publisher" content="https://www.facebook.com/WordPresscom" />

<!-- End Jetpack Open Graph Tags -->
<link rel="shortcut icon" type="image/x-icon" href="https://secure.gravatar.com/blavatar/4554b8d24c7f200dc5e2e1b18db1893f?s=32" sizes="16x16" />
<link rel="icon" type="image/x-icon" href="https://secure.gravatar.com/blavatar/4554b8d24c7f200dc5e2e1b18db1893f?s=32" sizes="16x16" />
<link rel="apple-touch-icon-precomposed" href="https://secure.gravatar.com/blavatar/4554b8d24c7f200dc5e2e1b18db1893f?s=114" />
<link rel='openid.server' href='https://herbsutter.wordpress.com/?openidserver=1' />
<link rel='openid.delegate' href='https://herbsutter.wordpress.com/' />
<link rel="search" type="application/opensearchdescription+xml" href="https://herbsutter.com/osd.xml" title="Sutter’s Mill" />
<link rel="search" type="application/opensearchdescription+xml" href="https://s1.wp.com/opensearch.xml" title="WordPress.com" />
		<style id="wpcom-hotfix-masterbar-style">
			@media screen and (min-width: 783px) {
				#wpadminbar .quicklinks li#wp-admin-bar-my-account.with-avatar > a img {
					margin-top: 5px;
				}
			}
		</style>
		<script type="text/javascript" id="webfont-output">
  
  WebFontConfig = {"typekit":{"id":"cjs1oxc"}};
  (function() {
    var wf = document.createElement('script');
    wf.src = ('https:' == document.location.protocol ? 'https' : 'http') +
      '://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';
    wf.type = 'text/javascript';
    wf.async = 'true';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(wf, s);
	})();
</script><style type="text/css">
.widget_twitter li {
	word-wrap: break-word;
}
</style>
<meta name="application-name" content="Sutter’s Mill" /><meta name="msapplication-window" content="width=device-width;height=device-height" /><meta name="msapplication-tooltip" content="Herb Sutter on software development" /><meta name="msapplication-task" content="name=Subscribe;action-uri=https://herbsutter.com/feed/;icon-uri=https://secure.gravatar.com/blavatar/4554b8d24c7f200dc5e2e1b18db1893f?s=16" /><meta name="msapplication-task" content="name=Sign up for a free blog;action-uri=http://wordpress.com/signup/;icon-uri=https://s1.wp.com/i/favicon.ico" /><meta name="msapplication-task" content="name=WordPress.com Support;action-uri=http://support.wordpress.com/;icon-uri=https://s1.wp.com/i/favicon.ico" /><meta name="msapplication-task" content="name=WordPress.com Forums;action-uri=http://forums.wordpress.com/;icon-uri=https://s1.wp.com/i/favicon.ico" /><meta name="description" content="GotW #100 demonstrated the best way to express the Pimpl idiom using only standard C++11 features: Guru Question Is it possible to make the widget code easier to write by wrapping the Pimpl pattern in some sort of library helper? If so, how? Try to make the widget code as convenient and concise as possible&hellip;" />
<style type="text/css">
			#header h1 a,
		#header h2 {
			color: #265E15 !important;
		}
				#headerimage {
			background: url('https://herbsutter.files.wordpress.com/2011/10/cropped-blog-header.jpg') no-repeat;
			height: 200px;
		}
	</style>
<link rel="amphtml" href="https://herbsutter.com/2011/11/16/gotw-101/amp/"><style type="text/css" id="syntaxhighlighteranchor"></style>
		<link rel="stylesheet" id="custom-css-css" type="text/css" href="https://s2.wp.com/?custom-css=1&#038;csblog=eb5Y&#038;cscache=6&#038;csrev=60" />
		</head>
<body id="section-index" class="post-template-default single single-post postid-1014 single-format-standard mp6 customizer-styles-applied highlander-enabled highlander-light">


<div id="navigation" class="clearfix">
		<div class="menu">
		<ul>
			<li ><a href="https://herbsutter.com/" title="Home">Home</a></li>
			<li class="page_item page-item-912"><a href="https://herbsutter.com/welcome-to-the-jungle/">Welcome to the&nbsp;Jungle</a></li>
<li class="page_item page-item-864 page_item_has_children"><a href="https://herbsutter.com/gotw/">GotW</a></li>
<li class="page_item page-item-761"><a href="https://herbsutter.com/elements-of-modern-c-style/">Elements of Modern C++&nbsp;Style</a></li>
<li class="page_item page-item-2 page_item_has_children"><a href="https://herbsutter.com/about/">About</a></li>
									<li class="search"><form method="get" id="searchform" action="https://herbsutter.com"><input type="text" class="textbox" value="" name="s" id="s" /><input type="submit" id="searchsubmit" value="Search" /></form></li>
					</ul>
	</div>
</div><!-- end id:navigation -->

<div id="container">

<div id="header">
<h1><a href="https://herbsutter.com/" title="Sutter’s Mill">Sutter’s Mill</a></h1>
<h2>Herb Sutter on software development</h2>
</div><!-- end id:header -->


	
		<div id="feedarea">
	<dl>
		<dt><strong>Feeds:</strong></dt>

			<dd><a href="https://herbsutter.com/feed/">Posts</a></dd>
	
			<dd><a href="https://herbsutter.com/comments/feed/">Comments</a></dd>
		</dl>
	</div><!-- end id:feedarea -->
	
	<div id="headerimage">
</div><!-- end id:headerimage -->

<div id="content">
<div id="content-main">

		
									<div class="postnav">
				<div class="alignleft">&laquo; <a href="https://herbsutter.com/2011/11/16/gotw-100-solution/" rel="prev">GotW #100: Solution</a></div>
				<div class="alignright"><a href="https://herbsutter.com/2011/11/23/c-spring-goingnative-feb-2-3-2012/" rel="next">C++ Spring: GoingNative, Feb 2-3,&nbsp;2012</a> &raquo;</div>
			</div>
			
			<div class="post-1014 post type-post status-publish format-standard hentry category-c category-gotw" id="post-1014">
				<div class="posttitle">
					<h2>GotW #101: Compilation Firewalls, Part 2 (Difficulty:&nbsp;8/10)</h2>
					<p class="post-info">2011-11-16 by <a href="https://herbsutter.com/author/herbsutter/" title="Posts by Herb Sutter">Herb Sutter</a>  </p>
				</div>

				<div class="entry">
					<p>GotW #100 demonstrated the best way to express the Pimpl idiom using only standard C++11 features:</p>
<div id="scid:C89E2BDB-ADD3-4f7a-9810-1B7EACF446C1:25a06b6b-e8fa-4092-8bfa-3054ee27e6c3" class="wlWriterEditableSmartContent" style="display:inline;float:none;margin:0;padding:10px;">
<pre class="brush: cpp; gutter: false; highlight: [1,11]; title: ; notranslate" title="">
// in header file
class widget {
public:
    widget();
    ~widget();
private:
    class impl;
    unique_ptr&lt;impl&gt; pimpl;
};

// in implementation file
class widget::impl {
    // :::
};

widget::widget() : pimpl{ new impl{ /*...*/ } } { }
widget::~widget() { }                   // or =default
</pre>
</div>
<p><a href="https://herbsutter.files.wordpress.com/2011/11/image23.png"><img style="background-image:none;padding-left:10px;padding-right:0;display:inline;padding-top:0;border-width:0;" title="image" src="https://herbsutter.files.wordpress.com/2011/11/image_thumb17.png?w=244&#038;h=123" alt="image" width="244" height="123" align="right" border="0" /></a></p>
<h3>Guru Question</h3>
<p>Is it possible to make the <em>widget</em> code easier to write by wrapping the Pimpl pattern in some sort of library helper? If so, how?</p>
<p>Try to make the <em>widget</em> code as convenient and concise as possible to write, with any compiler-generated semantics either correct by default or producing compile-time errors if the <em>widget</em> author forgets to write them.</p>
<p>&nbsp;</p>
<p><em>[Update: Removed move operations from the basic pattern. Since not all Pimpl’d types need to be move-aware, it’s not really part of the core pattern.]</em></p>
									</div>

				<p class="postmetadata">
					Posted in <a href="https://herbsutter.com/category/c/" rel="category tag">C++</a>, <a href="https://herbsutter.com/category/c/gotw/" rel="category tag">GotW</a> | 											10 Comments									</p>
				
<!-- You can start editing here. -->

<h3 id="comments">10 Responses</h3>

	<ol class="commentlist">
			<li class="comment even thread-even depth-1 highlander-comment" id="comment-4424">
		<div id="div-comment-4424">
		<div class="cmtinfo"><em> on <a href="#comment-4424" title="">2011-11-18 at 1:43 am</a></em> <img alt='' src='https://2.gravatar.com/avatar/856b8af00d92f7b05036ba4e53e05db4?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://pablo-aguilar.blogspot.com' rel='external nofollow' class='url'>Pablo Aguilar</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_4424"></div><p>How about this&#8230; CRTP as others have said, with a Pimpl base class template split in two files, one to declare it and one to define it out of line. Should look something like this:</p>
<p>pimpl.hpp:<br />
#include &lt;memory&gt;</p>
<p>template&lt;typename Derived&gt;<br />
class Pimpl_base<br />
{<br />
public:<br />
  template&lt;typename&#8230; Args&gt;<br />
  Pimpl_base(Args&amp;&amp;&#8230; args);<br />
  virtual ~Pimpl_base();</p>
<p>  Pimpl_base(Pimpl_base const&amp;);<br />
  Pimpl_base(Pimpl_base&amp;&amp;);</p>
<p>  Pimpl_base&amp; operator=(Pimpl_base const&amp; rhs);<br />
  Pimpl_base&amp; operator=(Pimpl_base&amp;&amp;);</p>
<p>protected:<br />
  struct Impl;<br />
  std::unique_ptr&lt;Impl&gt; m_impl;<br />
};</p>
<p>pimpl_impl.hpp:<br />
template&lt;typename Derived&gt;<br />
template&lt;typename&#8230; Args&gt;<br />
Pimpl_base&lt;Derived&gt;::Pimpl_base(Args&amp;&amp;&#8230; args)<br />
  : m_impl(new Impl(args&#8230;))<br />
{<br />
}</p>
<p>template&lt;typename Derived&gt;<br />
Pimpl_base&lt;Derived&gt;::Pimpl_base(Pimpl_base&lt;Derived&gt; const&amp; src)<br />
  : m_impl(new Impl(*src.m_impl))<br />
{<br />
}</p>
<p>template&lt;typename Derived&gt;<br />
Pimpl_base&lt;Derived&gt;::~Pimpl_base() = default;</p>
<p>template&lt;typename Derived&gt;<br />
Pimpl_base&lt;Derived&gt;::Pimpl_base(Pimpl_base&lt;Derived&gt;&amp;&amp;) = default;</p>
<p>template&lt;typename Derived&gt;<br />
Pimpl_base&lt;Derived&gt;&amp; Pimpl_base&lt;Derived&gt;::operator=(Pimpl_base&lt;Derived&gt;&amp;&amp;) = default;</p>
<p>template&lt;typename Derived&gt;<br />
Pimpl_base&lt;Derived&gt;&amp; Pimpl_base&lt;Derived&gt;::operator=(Pimpl_base&lt;Derived&gt; const&amp; rhs)<br />
{<br />
  *m_impl = *rhs.m_impl;<br />
}</p>
<p>And the user class would be split into declaration&#8230;:</p>
<p>A.hpp:<br />
#include &#8220;pimpl.hpp&#8221;</p>
<p>class A<br />
  : private Pimpl_base&lt;A&gt;<br />
{<br />
public:<br />
  A(int value);</p>
<p>  void speak() const;<br />
};</p>
<p>and definition:</p>
<p>A.cpp:<br />
#include &#8220;A.hpp&#8221;<br />
#include &#8220;Pimpl_impl.hpp&#8221;<br />
#include &lt;iostream&gt;</p>
<p>template&lt;&gt;<br />
struct Pimpl_base&lt;A&gt;::Impl<br />
{<br />
  Impl(int value)<br />
    : value(value)<br />
  {<br />
  }<br />
  int value;<br />
};<br />
template class Pimpl_base&lt;A&gt;;</p>
<p>A::A(int value = 0)<br />
  : Pimpl_base(value)<br />
{<br />
}</p>
<p>void A::speak() const<br />
{<br />
  std::cout &lt;&lt; m_impl-&gt;value &lt;&lt; std::endl;<br />
}</p>
<p>Finally, the client of class A doesn&#8217;t see the details of the Pimpl_base implementation.<br />
client.cpp<br />
#include &#8220;A.hpp&#8221;</p>
<p>int main()<br />
{<br />
  A a1(1), a2(2);<br />
  a1.speak();<br />
  a1 = move(a2);<br />
  a1.speak();<br />
  A a3(move(a1));<br />
  a3.speak();</p>
<p>  A a4(a3);<br />
  a4.speak();</p>
<p>  A a5;<br />
  a5 = a3;<br />
  a3.speak();</p>
<p>  return 0;<br />
}</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-4422">
		<div id="div-comment-4422">
		<div class="cmtinfo"><em> on <a href="#comment-4422" title="">2011-11-17 at 11:47 am</a></em> <img alt='' src='https://2.gravatar.com/avatar/59f3acd0026a59606bb7e5c5f503a573?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>AdamG</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_4422"></div><p>BTW In order to display &lt; &amp;rt; chars in GotW comments I use special HTML chars: &amp;lt; and &amp;rt;</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 highlander-comment" id="comment-4421">
		<div id="div-comment-4421">
		<div class="cmtinfo"><em> on <a href="#comment-4421" title="">2011-11-17 at 9:11 am</a></em> <img alt='' src='https://2.gravatar.com/avatar/59f3acd0026a59606bb7e5c5f503a573?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>AdamG</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_4421"></div><p>I tried with CRTP but always end up with serious trade-offs. Now I would go in below direction:</p>
<p>Pimpl wrapper (it need more work more on make it more secure and maybe add more pointer semantics).<br />
This is more a prototype than final solution:</p>
<p>template&lt; typename T &gt;<br />
class pimpl_wrapper<br />
{<br />
         std::unique_ptr&lt; T &gt; pimpl;<br />
public:<br />
	 pimpl_wrapper() : pimpl(new T) {}<br />
	 T *operator-&gt;() const { return pimpl.get(); }<br />
};</p>
<p>The widget class will look like this:</p>
<p>class widget<br />
{<br />
public:<br />
    widget();<br />
    ~widget();<br />
    widget( widget&amp;&amp; );<br />
    widget&amp; operator=( widget&amp;&amp; );<br />
private:<br />
    class impl;<br />
    pimpl_wrapper&lt;impl&gt; pimpl;<br />
};</p>
<p>and in widget you can call pimpl just like direct pointer (suppose both widget and impl have doWork method):</p>
<p>void widget::doWork()<br />
{<br />
   pimpl-&gt;doWork();<br />
}</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-4418">
		<div id="div-comment-4418">
		<div class="cmtinfo"><em> on <a href="#comment-4418" title="">2011-11-17 at 12:33 am</a></em> <img alt='' src='https://i1.wp.com/graph.facebook.com/100001418941828/picture?q=type%3Dlarge%26_md5%3D47afbdfc8248267899e3c6ed95dc766e&#038;resize=48%2C48' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://www.facebook.com/profile.php?id=100001418941828' rel='external nofollow' class='url'>Dmitriy Vilkov</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_4418"></div><p>Hello.<br />
There is a design pattern named Bridge. It is well-suited for this task.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-akrzemi1 even thread-even depth-1 highlander-comment" id="comment-4413">
		<div id="div-comment-4413">
		<div class="cmtinfo"><em> on <a href="#comment-4413" title="">2011-11-16 at 2:18 pm</a></em> <img alt='' src='https://0.gravatar.com/avatar/c3baf4aa5bebf6d1407ed4e3b0981864?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://akrzemi1.wordpress.com' rel='external nofollow' class='url'>Andrzej Krzemieński</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_4413"></div><p>This reminds me of Vladimir Batov&#8217;s Pimpl library:<br />
<a href="http://drdobbs.com/cpp/205918714?pgno=1" rel="nofollow">http://drdobbs.com/cpp/205918714?pgno=1</a></p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-4412">
		<div id="div-comment-4412">
		<div class="cmtinfo"><em> on <a href="#comment-4412" title="">2011-11-16 at 1:36 pm</a></em> <img alt='' src='https://1.gravatar.com/avatar/18c4b79a7fd7e606866246ff5991c7eb?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://gravatar.com/mjklaim' rel='external nofollow' class='url'>Joël Lamotte</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_4412"></div><p>Hi, I don&#8217;t feel skilled enough to propose a possible implementation but I follow the boost mailing list and I know there is a proposed library for providing the pimpl idiom : <a href="https://github.com/sean-/boost-pimpl" rel="nofollow">https://github.com/sean-/boost-pimpl</a><br />
It&#8217;s in the review queue but don&#8217;t have a review manager yet.</p>
<p>I believe it&#8217;s a C++03 implementation and I&#8217;m guessing that a C++11 implementation would certainly be simpler to express. But as it have been worked by someone who did thought a lot about the problem, I think it might be a good source to check first. Maybe it would be easily simplified by converting the current code to C++11 idioms?</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 highlander-comment" id="comment-4411">
		<div id="div-comment-4411">
		<div class="cmtinfo"><em> on <a href="#comment-4411" title="">2011-11-16 at 1:22 pm</a></em> <img alt='' src='https://2.gravatar.com/avatar/21e08c9dc5723cb8cd946ea149610656?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://gravatar.com/thematto' rel='external nofollow' class='url'>Matt D</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_4411"></div><p>Perhaps it is easier and safer to write if you don&#8217;t have to use it.</p>
<p>A pure interface can be used to refer to an unknown implementation just as easily and has full compiler support. In turn, to make this easier, an (abstract) factory of some sort could be used.</p>
<p>Perhaps a discussion of factory patterns in C++11 would be useful too.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-4410">
		<div id="div-comment-4410">
		<div class="cmtinfo"><em> on <a href="#comment-4410" title="">2011-11-16 at 1:12 pm</a></em> <img alt='' src='https://0.gravatar.com/avatar/37aa3ec65ec47c5a3f9e2a80534837f3?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://gravatar.com/stackedcrooked' rel='external nofollow' class='url'>StackedCrooked</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_4410"></div><p>I also think it would be possible to use CRTP with private inheritance. However I can&#8217;t see any benefits in doing so. The amount of code required to do so would probably be more than the non-librarized version.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 highlander-comment" id="comment-4406">
		<div id="div-comment-4406">
		<div class="cmtinfo"><em> on <a href="#comment-4406" title="">2011-11-16 at 11:54 am</a></em> <img alt='' src='https://0.gravatar.com/avatar/9fdfde82947baf080a81ef0db500f2a3?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>Ben Craig</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_4406"></div><p>And my attempt at escaping angle brackets with &#8216;\&#8217; fails :(<br />
The template argument to pimpl_base is supposed to be ImplT, and widget inherits from pimpl_base with an argument of widget_impl.  The unique_ptr is templated on ImplT.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-4405">
		<div id="div-comment-4405">
		<div class="cmtinfo"><em> on <a href="#comment-4405" title="">2011-11-16 at 11:52 am</a></em> <img alt='' src='https://0.gravatar.com/avatar/9fdfde82947baf080a81ef0db500f2a3?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>Ben Craig</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_4405"></div><p>I think CRTP (the Curiously Recurring Template Pattern) is what Herb is looking for.  We might be able to write a pimpl base class that looks something like this:</p>
<p>template<br />
class pimpl_base<br />
{<br />
protected:<br />
   pimpl_base(ImplT *p) : pimpl(p) {}<br />
   unique_ptr\ pimpl;<br />
};</p>
<p>And it would be used like this:<br />
struct widget_impl;<br />
class widget : private pimpl_base\<br />
{<br />
public:<br />
    widget();<br />
    ~widget();<br />
};</p>
<p>If you don&#8217;t declare some constructor, then you get errors about a lack of a suitable default constructor.<br />
If you don&#8217;t declare the destructor, you get errors about the use of an undefined type (widget_impl in this case).<br />
You don&#8217;t have to declare move or copy operations unless you want them.  If you want them, then you will need to out-of-line them, and =default them in your cpp.  If you try to use those operations, then the compile will fail.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
	</ol>

	<div class="navigation">
		<div class="alignleft"></div>
		<div class="alignright"></div>
	</div>
	<br />

  	<p class="nocomments">Comments are closed.</p>
  <div class="post-content">
<p>
</p>
</div>

			</div>

		
		<p align="center"></p>

	</div><!-- end id:content-main -->
<div id="sidebar">
<ul>
<li class="sidebox"><h2><label for="subscribe-field">Follow by email</label></h2>
				<form action="https://subscribe.wordpress.com" method="post" accept-charset="utf-8" id="subscribe-blog">
																	<p><input type="text" name="email" style="width: 95%; padding: 1px 2px" placeholder="Enter your email address" value="" id="subscribe-field"/></p>
					
					<p>
						<input type="hidden" name="action" value="subscribe"/>
						<input type="hidden" name="blog_id" value="3379246"/>
						<input type="hidden" name="source" value="https://herbsutter.com/2011/11/16/gotw-101/"/>
						<input type="hidden" name="sub-type" value="widget"/>
						<input type="hidden" name="redirect_fragment" value="blog_subscription-3" />
						<input type="hidden" id="_wpnonce" name="_wpnonce" value="4590924cc6" />						<input type="submit" value="Subscribe" />
					</p>
				</form>
			
</li><li class="sidebox"><h2><a href='http://twitter.com/herbsutter'>Tweets</a></h2><ul class='tweets'></ul><a href="http://twitter.com/herbsutter"  class='twitter-follow-button' data-show-count='false' data-link-color='#265e15' data-text-color='#333333'>Follow @herbsutter</a></li><li class="sidebox"><h2>Popular</h2><ul>				<li>
										<a href="https://herbsutter.com/2018/11/13/trip-report-fall-iso-c-standards-meeting-san-diego/" class="bump-view" data-bump-view="tp">
						Trip report: Fall ISO C++ standards meeting (San Diego)					</a>
										</li>
								<li>
										<a href="https://herbsutter.com/gotw/" class="bump-view" data-bump-view="tp">
						GotW					</a>
										</li>
								<li>
										<a href="https://herbsutter.com/2018/09/20/lifetime-profile-v1-0-posted/" class="bump-view" data-bump-view="tp">
						Lifetime profile v1.0 posted					</a>
										</li>
				</ul></li><li class="sidebox"><h2>Categories</h2>		<ul>
				<li class="cat-item cat-item-291"><a href="https://herbsutter.com/category/apple/" >Apple</a>
</li>
	<li class="cat-item cat-item-49277"><a href="https://herbsutter.com/category/c-net/" >C# / .NET</a>
</li>
	<li class="cat-item cat-item-2426"><a href="https://herbsutter.com/category/c/" >C++</a>
</li>
	<li class="cat-item cat-item-69816"><a href="https://herbsutter.com/category/cloud/" >Cloud</a>
</li>
	<li class="cat-item cat-item-214618"><a href="https://herbsutter.com/category/concurrency/" >Concurrency</a>
</li>
	<li class="cat-item cat-item-8259773"><a href="https://herbsutter.com/category/effective-concurrency/" >Effective Concurrency</a>
</li>
	<li class="cat-item cat-item-3696745"><a href="https://herbsutter.com/category/friday-thoughts/" >Friday Thoughts</a>
</li>
	<li class="cat-item cat-item-3867746"><a href="https://herbsutter.com/category/c/gotw/" >GotW</a>
</li>
	<li class="cat-item cat-item-79"><a href="https://herbsutter.com/category/hardware/" >Hardware</a>
</li>
	<li class="cat-item cat-item-1017"><a href="https://herbsutter.com/category/java/" >Java</a>
</li>
	<li class="cat-item cat-item-637"><a href="https://herbsutter.com/category/microsoft/" >Microsoft</a>
</li>
	<li class="cat-item cat-item-420845"><a href="https://herbsutter.com/category/opinion-editorial/" >Opinion &amp; Editorial</a>
</li>
	<li class="cat-item cat-item-1633077"><a href="https://herbsutter.com/category/reader-qa/" >Reader Q&amp;A</a>
</li>
	<li class="cat-item cat-item-2301"><a href="https://herbsutter.com/category/software-development/" >Software Development</a>
</li>
	<li class="cat-item cat-item-393523"><a href="https://herbsutter.com/category/talks-events/" >Talks &amp; Events</a>
</li>
	<li class="cat-item cat-item-1"><a href="https://herbsutter.com/category/uncategorized/" >Uncategorized</a>
</li>
	<li class="cat-item cat-item-151"><a href="https://herbsutter.com/category/web/" >Web</a>
</li>
		</ul>
			</li></ul>
</div><!-- end id:sidebar -->
</div><!-- end id:content -->
</div><!-- end id:container -->
<div id="footer">
	<div id="colophon">
		<p><a href="https://wordpress.com/?ref=footer_blog">Blog at WordPress.com.</a></p>
		<p>WPThemes.</p>
		<br class="clear" />
	</div><!-- end #colophon-->
</div><!-- end #footer-->
<!--  -->
<script type='text/javascript' src='//0.gravatar.com/js/gprofiles.js?ver=201847y'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var WPGroHo = {"my_hash":""};
/* ]]> */
</script>
<script type='text/javascript' src='https://s1.wp.com/wp-content/mu-plugins/gravatar-hovercards/wpgroho.js?m=1380573781h'></script>

	<script>
		//initialize and attach hovercards to all gravatars
		jQuery( document ).ready( function( $ ) {

			if (typeof Gravatar === "undefined"){
				return;
			}

			if ( typeof Gravatar.init !== "function" ) {
				return;
			}			

			Gravatar.profile_cb = function( hash, id ) {
				WPGroHo.syncProfileData( hash, id );
			};
			Gravatar.my_hash = WPGroHo.my_hash;
			Gravatar.init( 'body', '#wp-admin-bar-my-account' );
		});
	</script>

		<div style="display:none">
	<div class="grofile-hash-map-856b8af00d92f7b05036ba4e53e05db4">
	</div>
	<div class="grofile-hash-map-59f3acd0026a59606bb7e5c5f503a573">
	</div>
	<div class="grofile-hash-map-fe3ceea122cc9ed2ae826d2c8c09ae70">
	</div>
	<div class="grofile-hash-map-c3baf4aa5bebf6d1407ed4e3b0981864">
	</div>
	<div class="grofile-hash-map-18c4b79a7fd7e606866246ff5991c7eb">
	</div>
	<div class="grofile-hash-map-21e08c9dc5723cb8cd946ea149610656">
	</div>
	<div class="grofile-hash-map-37aa3ec65ec47c5a3f9e2a80534837f3">
	</div>
	<div class="grofile-hash-map-9fdfde82947baf080a81ef0db500f2a3">
	</div>
	</div>
<script type='text/javascript' charset='UTF-8' id='polldaddyRatings'><!--//--><![CDATA[//><!--
PDRTJS_settings_468178_comm_4424={"id":468178,"unique_id":"wp-comment-4424","title":"How%20about%20this...%20CRTP%20as%20others%20have%20said%2C%20with%20a%20Pimpl%20base%20class%20template%20split%20in%20two%20files%2C%20one%20to%20declare%20it%20and%20one%20to%20define%20it%20out%20of%20line.%20Should%20look%20something%20like%20this%3Apimpl.hpp%3A%23inc...","permalink":"https:\/\/herbsutter.com\/2011\/11\/16\/gotw-101\/#comment-4424","item_id":"_comm_4424"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_4424 == 'undefined' ){PDRTJS_468178_comm_4424 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_4424 );}}PDRTJS_settings_468178_comm_4422={"id":468178,"unique_id":"wp-comment-4422","title":"BTW%20In%20order%20to%20display%20%26lt%3B%20%26amp%3Brt%3B%20chars%20in%20GotW%20comments%20I%20use%20special%20HTML%20chars%3A%20%26amp%3Blt%3B%20and%20%26amp%3Brt%3B...","permalink":"https:\/\/herbsutter.com\/2011\/11\/16\/gotw-101\/#comment-4422","item_id":"_comm_4422"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_4422 == 'undefined' ){PDRTJS_468178_comm_4422 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_4422 );}}PDRTJS_settings_468178_comm_4421={"id":468178,"unique_id":"wp-comment-4421","title":"I%20tried%20with%20CRTP%20but%20always%20end%20up%20with%20serious%20trade-offs.%20Now%20I%20would%20go%20in%20below%20direction%3A%20Pimpl%20wrapper%20%28it%20need%20more%20work%20more%20on%20make%20it%20more%20secure%20and%20maybe%20add%20more%20pointer%20semantics%29....","permalink":"https:\/\/herbsutter.com\/2011\/11\/16\/gotw-101\/#comment-4421","item_id":"_comm_4421"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_4421 == 'undefined' ){PDRTJS_468178_comm_4421 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_4421 );}}PDRTJS_settings_468178_comm_4418={"id":468178,"unique_id":"wp-comment-4418","title":"Hello.There%20is%20a%20design%20pattern%20named%20Bridge.%20It%20is%20well-suited%20for%20this%20task....","permalink":"https:\/\/herbsutter.com\/2011\/11\/16\/gotw-101\/#comment-4418","item_id":"_comm_4418"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_4418 == 'undefined' ){PDRTJS_468178_comm_4418 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_4418 );}}PDRTJS_settings_468178_comm_4413={"id":468178,"unique_id":"wp-comment-4413","title":"This%20reminds%20me%20of%20Vladimir%20Batov%26%23039%3Bs%20Pimpl%20library%3A%20http%3A%2F%2Fdrdobbs.com%2Fcpp%2F205918714%3Fpgno%3D1...","permalink":"https:\/\/herbsutter.com\/2011\/11\/16\/gotw-101\/#comment-4413","item_id":"_comm_4413"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_4413 == 'undefined' ){PDRTJS_468178_comm_4413 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_4413 );}}PDRTJS_settings_468178_comm_4412={"id":468178,"unique_id":"wp-comment-4412","title":"Hi%2C%20I%20don%26%23039%3Bt%20feel%20skilled%20enough%20to%20propose%20a%20possible%20implementation%20but%20I%20follow%20the%20boost%20mailing%20list%20and%20I%20know%20there%20is%20a%20proposed%20library%20for%20providing%20the%20pimpl%20idiom%20%3A%20https%3A%2F%2Fgithub.com%2F...","permalink":"https:\/\/herbsutter.com\/2011\/11\/16\/gotw-101\/#comment-4412","item_id":"_comm_4412"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_4412 == 'undefined' ){PDRTJS_468178_comm_4412 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_4412 );}}PDRTJS_settings_468178_comm_4411={"id":468178,"unique_id":"wp-comment-4411","title":"Perhaps%20it%20is%20easier%20and%20safer%20to%20write%20if%20you%20don%26%23039%3Bt%20have%20to%20use%20it.A%20pure%20interface%20can%20be%20used%20to%20refer%20to%20an%20unknown%20implementation%20just%20as%20easily%20and%20has%20full%20compiler%20support.%20In%20turn%2C%20to%20ma...","permalink":"https:\/\/herbsutter.com\/2011\/11\/16\/gotw-101\/#comment-4411","item_id":"_comm_4411"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_4411 == 'undefined' ){PDRTJS_468178_comm_4411 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_4411 );}}PDRTJS_settings_468178_comm_4410={"id":468178,"unique_id":"wp-comment-4410","title":"I%20also%20think%20it%20would%20be%20possible%20to%20use%20CRTP%20with%20private%20inheritance.%20However%20I%20can%26%23039%3Bt%20see%20any%20benefits%20in%20doing%20so.%20The%20amount%20of%20code%20required%20to%20do%20so%20would%20probably%20be%20more%20than%20the%20non-libr...","permalink":"https:\/\/herbsutter.com\/2011\/11\/16\/gotw-101\/#comment-4410","item_id":"_comm_4410"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_4410 == 'undefined' ){PDRTJS_468178_comm_4410 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_4410 );}}PDRTJS_settings_468178_comm_4406={"id":468178,"unique_id":"wp-comment-4406","title":"And%20my%20attempt%20at%20escaping%20angle%20brackets%20with%20%26%23039%3B%26%23039%3B%20fails%20%3A%28The%20template%20argument%20to%20pimpl_base%20is%20supposed%20to%20be%20ImplT%2C%20and%20widget%20inherits%20from%20pimpl_base%20with%20an%20argument%20of%20widget_impl.%20%20The%20u...","permalink":"https:\/\/herbsutter.com\/2011\/11\/16\/gotw-101\/#comment-4406","item_id":"_comm_4406"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_4406 == 'undefined' ){PDRTJS_468178_comm_4406 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_4406 );}}PDRTJS_settings_468178_comm_4405={"id":468178,"unique_id":"wp-comment-4405","title":"I%20think%20CRTP%20%28the%20Curiously%20Recurring%20Template%20Pattern%29%20is%20what%20Herb%20is%20looking%20for.%20%20We%20might%20be%20able%20to%20write%20a%20pimpl%20base%20class%20that%20looks%20something%20like%20this%3Atemplate%20class%20pimpl_base%7Bprotect...","permalink":"https:\/\/herbsutter.com\/2011\/11\/16\/gotw-101\/#comment-4405","item_id":"_comm_4405"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_4405 == 'undefined' ){PDRTJS_468178_comm_4405 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_4405 );}}
//--><!]]></script><script type='text/javascript' charset='UTF-8' src='https://polldaddy.com/js/rating/rating.js'></script><script type='text/javascript' src='https://platform.twitter.com/widgets.js?ver=20111117'></script>
<script type='text/javascript' src='https://s1.wp.com/_static/??-eJzTLy/QTc7PK0nNK9EvyClNz8wr1i+uzCtJrMjITM/IAeKS1CJMEWP94uSizIISoOIM5/yiVL2sYh19yo1yKioFmldQADTOPtfW0MTIyNjEyNDYJAsAjsE/mg=='></script>
<script type='text/javascript'>
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "https://s1.wp.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.9b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "https://s2.wp.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?m=1363304414h&amp;ver=3.0.9b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.defaults['toolbar'] = false;
	SyntaxHighlighter.all();

	// Infinite scroll support
	if ( typeof( jQuery ) !== 'undefined' ) {
		jQuery( function( $ ) {
			$( document.body ).on( 'post-load', function() {
				SyntaxHighlighter.highlight();
			} );
		} );
	}
</script>
<script type='text/javascript'>
/* <![CDATA[ */
var actionbardata = {"siteID":"3379246","siteName":"Sutter\u2019s Mill","siteURL":"https:\/\/herbsutter.com","icon":"<img alt='' src='https:\/\/secure.gravatar.com\/blavatar\/4554b8d24c7f200dc5e2e1b18db1893f?s=50&d=https%3A%2F%2Fs2.wp.com%2Fi%2Flogo%2Fwpcom-gray-white.png' class='avatar avatar-50' height='50' width='50' \/>","canManageOptions":"","canCustomizeSite":"","isFollowing":"","themeSlug":"pub\/mistylook","signupURL":"https:\/\/wordpress.com\/start\/","loginURL":"https:\/\/herbsutter.wordpress.com\/wp-login.php?redirect_to=https%3A%2F%2Fherbsutter.com%2F2011%2F11%2F16%2Fgotw-101%2F","themeURL":"","xhrURL":"https:\/\/herbsutter.com\/wp-admin\/admin-ajax.php","nonce":"8fb9818ae2","isSingular":"1","isFolded":"","isLoggedIn":"","isMobile":"","subscribeNonce":"<input type=\"hidden\" id=\"_wpnonce\" name=\"_wpnonce\" value=\"4590924cc6\" \/>","referer":"https:\/\/herbsutter.com\/2011\/11\/16\/gotw-101\/","canFollow":"1","feedID":"171936","statusMessage":"","customizeLink":"https:\/\/herbsutter.wordpress.com\/wp-admin\/customize.php?url=https%3A%2F%2Fherbsutter.wordpress.com%2F2011%2F11%2F16%2Fgotw-101%2F","postID":"1014","shortlink":"https:\/\/wp.me\/peb5Y-gm","canEditPost":"","editLink":"https:\/\/wordpress.com\/post\/herbsutter.com\/1014","statsLink":"https:\/\/wordpress.com\/stats\/post\/1014\/herbsutter.com","i18n":{"view":"View site","follow":"Follow","following":"Following","edit":"Edit","login":"Log in","signup":"Sign up","customize":"Customize","report":"Report this content","themeInfo":"Get theme: MistyLook","shortlink":"Copy shortlink","copied":"Copied","followedText":"New posts from this site will now appear in your <a href=\"https:\/\/wordpress.com\/\">Reader<\/a>","foldBar":"Collapse this bar","unfoldBar":"Expand this bar","editSubs":"Manage subscriptions","viewReader":"View site in Reader","viewReadPost":"View post in Reader","subscribe":"Sign me up","enterEmail":"Enter your email address","followers":"Join 19,532 other followers","alreadyUser":"Already have a WordPress.com account? <a href=\"https:\/\/herbsutter.wordpress.com\/wp-login.php?redirect_to=https%3A%2F%2Fherbsutter.com%2F2011%2F11%2F16%2Fgotw-101%2F\">Log in now.<\/a>","stats":"Stats"}};
/* ]]> */
</script>
<script type='text/javascript' src='https://s0.wp.com/_static/??-eJyVjcEOgjAQRH/IuoIYT8Zvqe2GLrQLdlvAv7ceJEYTEg+bTGbe7MA8KjNwQk7QCVicyOC47DvZwUcUshp9bokFPPUocM+Y0Wm2HuM3/CblwUkvjlrnyyWMv87GjraBWN10hKCloEWpYcIYyZb91fvzQ4ra9LJVMokGfpVWVehruFSnujo0x+Zcd0+y+3Rn'></script>
<script type="text/javascript">
// <![CDATA[
(function() {
try{
  if ( window.external &&'msIsSiteMode' in window.external) {
    if (window.external.msIsSiteMode()) {
      var jl = document.createElement('script');
      jl.type='text/javascript';
      jl.async=true;
      jl.src='/wp-content/plugins/ie-sitemode/custom-jumplist.php';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(jl, s);
    }
  }
}catch(e){}
})();
// ]]>
</script><script src="//stats.wp.com/w.js?56" type="text/javascript" async defer></script>
<script type="text/javascript">
_tkq = window._tkq || [];
_stq = window._stq || [];
_tkq.push(['storeContext', {'blog_id':'3379246','blog_tz':'-8','user_lang':'en','blog_lang':'en','user_id':'0'}]);
_stq.push(['view', {'blog':'3379246','v':'wpcom','tz':'-8','user_id':'0','post':'1014','subd':'herbsutter'}]);
_stq.push(['extra', {'crypt':'UE40eW5QN0p8M2Y/RE1TaVhzUzFMbjdWNHpwZGhTayxPSUFCMGNrd29+Smw0TDhnZmRTK0hlRi9QSGh6bi9GXVhBJWIlZlR5U1JMLU8/MkNtblkvY1d1TjBELytHc0k/MXdHUVQyK2IyUVA5SjU1bj9VX3ExLHYsREFpcnlfNHYtXV1HSUIsLkJrcnp0eS5sNHw4Y2ZzcS9MM3N2cDh4Yk40dCZtMERWRHZldWt5LHprU2QlSU9QVFZRYS55UGRjL3BiVHptfjZoM3Y2QW1GQXNLWCVDUG4tOGlhUzYlW0t1eSY4V3w9eVtUdUMmYnBodD9ERmFsb2tNcH5xT0ZpSkdUNkVbel12UVBDbzFYQXlzWnEud2g3bzVONXBlMEhwWWN6K2hiX2VPeFBrL0VqJnwtZWlWLDJrdVlmQmR0aVBtYj0uWmVCRE5VZHZnJXg1K1lOX1I9RQ=='}]);
_stq.push([ 'clickTrackerInit', '3379246', '1014' ]);
	</script>
<noscript><img src="https://pixel.wp.com/b.gif?v=noscript" style="height:0px;width:0px;overflow:hidden" alt="" /></noscript>
<script>
if ( 'object' === typeof wpcom_mobile_user_agent_info ) {

	wpcom_mobile_user_agent_info.init();
	var mobileStatsQueryString = "";
	
	if( false !== wpcom_mobile_user_agent_info.matchedPlatformName )
		mobileStatsQueryString += "&x_" + 'mobile_platforms' + '=' + wpcom_mobile_user_agent_info.matchedPlatformName;
	
	if( false !== wpcom_mobile_user_agent_info.matchedUserAgentName )
		mobileStatsQueryString += "&x_" + 'mobile_devices' + '=' + wpcom_mobile_user_agent_info.matchedUserAgentName;
	
	if( wpcom_mobile_user_agent_info.isIPad() )
		mobileStatsQueryString += "&x_" + 'ipad_views' + '=' + 'views';

	if( "" != mobileStatsQueryString ) {
		new Image().src = document.location.protocol + '//pixel.wp.com/g.gif?v=wpcom-no-pv' + mobileStatsQueryString + '&baba=' + Math.random();
	}
	
}
</script></body>
</html>