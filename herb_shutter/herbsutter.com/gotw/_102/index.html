<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>GotW #102: Exception-Safe Function Calls (Difficulty: 7/10) | Sutter’s Mill</title>
<link rel="pingback" href="https://herbsutter.com/xmlrpc.php" />
<script type="text/javascript">
  WebFontConfig = {"typekit":{"id":"eyo0tqd"}};
  (function() {
    var wf = document.createElement('script');
    wf.src = 'https://s0.wp.com/wp-content/plugins/custom-fonts/js/webfont.js';
    wf.type = 'text/javascript';
    wf.async = 'true';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(wf, s);
	})();
</script><style id="jetpack-custom-fonts-css">.wf-active #header h1{font-size:2.12em;font-family:"ff-dagny-web-pro-1","ff-dagny-web-pro-2",sans-serif;font-style:normal;font-weight:400}.wf-active body{font-size:89.7%;font-family:"ff-basic-gothic-web-pro-1","ff-basic-gothic-web-pro-2",sans-serif}.wf-active #navigation{font-family:"ff-basic-gothic-web-pro-1","ff-basic-gothic-web-pro-2",sans-serif}.wf-active #navigation ul li.search{font-size:1.06em}.wf-active #navigation ul li.search input#searchsubmit{font-size:1.06em}.wf-active #content .post-info, .wf-active #content .postmetadata{font-size:1.06em}.wf-active #sidebar{font-size:1.06em}.wf-active #footer p.right{font-size:1.06em}.wf-active .commentnum{font-size:1.77em}.wf-active .commentlist li .cmtinfo{font-size:1.18em}.wf-active .commentlist li .cmtinfo em{font-size:1.06em}.wf-active #respond label{font-size:11.8px}.wf-active #respond .required{font-size:11.8px}.wf-active #respond .subscribe-label{font-size:14.2px}.wf-active #respond .comment-notes{font-size:13px}.wf-active .wp-caption p.wp-caption-text{font-size:13px}.wf-active #content h1, .wf-active h2, .wf-active h3, .wf-active h4, .wf-active h5, .wf-active h6{font-family:"ff-dagny-web-pro-1","ff-dagny-web-pro-2",sans-serif;font-style:normal;font-weight:400}.wf-active #header h2{font-size:1.18em;font-weight:400;font-family:"ff-dagny-web-pro-1","ff-dagny-web-pro-2",sans-serif;font-style:normal}.wf-active #content h3{font-size:1.65em;font-weight:400;font-style:normal}.wf-active #content h4{font-size:1.3em;font-style:normal;font-weight:400}.wf-active #content h5{font-size:1.18em;font-style:normal;font-weight:400}.wf-active #content .post h2{font-size:1.65em;font-weight:400;font-style:normal}.wf-active li.sidebox h2{font-weight:400;font-size:1.89em;font-style:normal}.wf-active .post h4{font-size:1.18em;font-weight:400;font-family:"ff-dagny-web-pro-1","ff-dagny-web-pro-2",sans-serif;font-style:normal}.wf-active .post h4 em{font-style:normal;font-weight:400}</style>
		<script src='https://r-login.wordpress.com/remote-login.php?action=js&amp;host=herbsutter.com&amp;id=3379246&amp;t=1542965320&amp;back=https%3A%2F%2Fherbsutter.com%2Fgotw%2F_102%2F' type="text/javascript"></script>
		<script type="text/javascript">
		/* <![CDATA[ */
			if ( 'function' === typeof WPRemoteLogin ) {
				document.cookie = "wordpress_test_cookie=test; path=/";
				if ( document.cookie.match( /(;|^)\s*wordpress_test_cookie\=/ ) ) {
					WPRemoteLogin();
				}
			}
		/* ]]> */
		</script>
		<link rel='dns-prefetch' href='//s2.wp.com' />
<link rel='dns-prefetch' href='//s0.wp.com' />
<link rel='dns-prefetch' href='//s1.wp.com' />
<link rel='dns-prefetch' href='//herbsutter.wordpress.com' />
<link rel="alternate" type="application/rss+xml" title="Sutter’s Mill &raquo; Feed" href="https://herbsutter.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="Sutter’s Mill &raquo; Comments Feed" href="https://herbsutter.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Sutter’s Mill &raquo; GotW #102: Exception-Safe Function Calls (Difficulty:&nbsp;7/10) Comments Feed" href="https://herbsutter.com/gotw/_102/feed/" />
	<script type="text/javascript">
		/* <![CDATA[ */
		function addLoadEvent(func) {
			var oldonload = window.onload;
			if (typeof window.onload != 'function') {
				window.onload = func;
			} else {
				window.onload = function () {
					oldonload();
					func();
				}
			}
		}
		/* ]]> */
	</script>
			<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s0.wp.com\/wp-content\/mu-plugins\/wpcom-smileys\/twemoji\/2\/72x72\/","ext":".png","svgUrl":"https:\/\/s0.wp.com\/wp-content\/mu-plugins\/wpcom-smileys\/twemoji\/2\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/s1.wp.com\/wp-includes\/js\/wp-emoji-release.min.js?m=1532082729h&ver=4.9.8"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56760,9792,65039],[55358,56760,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel='stylesheet' id='all-css-0-1' href='https://s2.wp.com/_static/??-eJyNkN1uwjAMhV9onsUG69W0Z0laE0zzp8QR6tvjUlUCwSpuonOS81knxkuGPkWhKBgaZN8cx4qeR6p4JsmmH+HmPvtaP/B1nOORI8uEcqKgYG4WA1eZfErjFtinQnofspE5EWhgQ15nRNnCQv5ZqVmetORmv0vWNFibC9UKegZuAZayT9wKuabWUnEwt0Tb2A9ofbotxBZTJpx/SE8DXi3hn+h9Rx4cSUVJGXKqqt5GaurZeGCNPJoFZoxJlsdVbE11lEB/aYRTfDBw9IbLFlpI9+NUOtTUnZ2hv/C7O+y/uu9uf+jOV8Xg7sY=?cssminify=yes' type='text/css' media='all' />
<link rel='stylesheet' id='print-css-1-1' href='https://s2.wp.com/wp-content/mu-plugins/global-print/global-print.css?m=1465851035h&cssminify=yes' type='text/css' media='print' />
<link rel='stylesheet' id='all-css-2-1' href='https://s0.wp.com/_static/??/wp-content/mu-plugins/actionbar/actionbar.css,/wp-content/themes/h4/global.css?m=1516985148j&cssminify=yes' type='text/css' media='all' />
<script type='text/javascript' src='https://s0.wp.com/_static/??-eJyFztEKwjAMBdAfsquTiXsRv6XWOFKXtDbphn69HeiDMBQCgdzDJXZOBtmP5QJiQ517gfx4rybIxv4ChnDITqEh5A/2kRVYF0vxjCOYIpDdUG+16BpXXIqiBCIVraTfLyFPCPNfFkCT8zeTQfC5tJ7o2Hb9Yde3+24bXjRNW9I='></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://herbsutter.wordpress.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://s1.wp.com/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress.com" />
<link rel="canonical" href="https://herbsutter.com/gotw/_102/" />
<link rel='shortlink' href='https://wp.me/Peb5Y-lp' />
<link rel="alternate" type="application/json+oembed" href="https://public-api.wordpress.com/oembed/?format=json&amp;url=https%3A%2F%2Fherbsutter.com%2Fgotw%2F_102%2F&amp;for=wpcom-auto-discovery" /><link rel="alternate" type="application/xml+oembed" href="https://public-api.wordpress.com/oembed/?format=xml&amp;url=https%3A%2F%2Fherbsutter.com%2Fgotw%2F_102%2F&amp;for=wpcom-auto-discovery" />
<!-- Jetpack Open Graph Tags -->
<meta property="og:type" content="article" />
<meta property="og:title" content="GotW #102: Exception-Safe Function Calls (Difficulty: 7/10)" />
<meta property="og:url" content="https://herbsutter.com/gotw/_102/" />
<meta property="og:description" content="[This is a C++11-updated version of the original GotW #56.] JG Questions 1. In each of the following statements, what can you say about the order of evaluation of the functions f, g, and h and the …" />
<meta property="article:published_time" content="2012-01-20T02:22:04+00:00" />
<meta property="article:modified_time" content="2014-01-21T20:47:32+00:00" />
<meta property="og:site_name" content="Sutter’s Mill" />
<meta property="og:image" content="https://secure.gravatar.com/blavatar/4554b8d24c7f200dc5e2e1b18db1893f?s=200&amp;ts=1542965320" />
<meta property="og:image:width" content="200" />
<meta property="og:image:height" content="200" />
<meta property="og:locale" content="en_US" />
<meta name="twitter:site" content="@wordpressdotcom" />
<meta name="twitter:text:title" content="GotW #102: Exception-Safe Function Calls (Difficulty:&nbsp;7/10)" />
<meta name="twitter:image" content="https://secure.gravatar.com/blavatar/4554b8d24c7f200dc5e2e1b18db1893f?s=240" />
<meta name="twitter:card" content="summary" />
<meta property="article:publisher" content="https://www.facebook.com/WordPresscom" />

<!-- End Jetpack Open Graph Tags -->
<link rel="shortcut icon" type="image/x-icon" href="https://secure.gravatar.com/blavatar/4554b8d24c7f200dc5e2e1b18db1893f?s=32" sizes="16x16" />
<link rel="icon" type="image/x-icon" href="https://secure.gravatar.com/blavatar/4554b8d24c7f200dc5e2e1b18db1893f?s=32" sizes="16x16" />
<link rel="apple-touch-icon-precomposed" href="https://secure.gravatar.com/blavatar/4554b8d24c7f200dc5e2e1b18db1893f?s=114" />
<link rel='openid.server' href='https://herbsutter.wordpress.com/?openidserver=1' />
<link rel='openid.delegate' href='https://herbsutter.wordpress.com/' />
<link rel="search" type="application/opensearchdescription+xml" href="https://herbsutter.com/osd.xml" title="Sutter’s Mill" />
<link rel="search" type="application/opensearchdescription+xml" href="https://s1.wp.com/opensearch.xml" title="WordPress.com" />
		<style id="wpcom-hotfix-masterbar-style">
			@media screen and (min-width: 783px) {
				#wpadminbar .quicklinks li#wp-admin-bar-my-account.with-avatar > a img {
					margin-top: 5px;
				}
			}
		</style>
		<script type="text/javascript" id="webfont-output">
  
  WebFontConfig = {"typekit":{"id":"cjs1oxc"}};
  (function() {
    var wf = document.createElement('script');
    wf.src = ('https:' == document.location.protocol ? 'https' : 'http') +
      '://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';
    wf.type = 'text/javascript';
    wf.async = 'true';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(wf, s);
	})();
</script><style type="text/css">
.widget_twitter li {
	word-wrap: break-word;
}
</style>
<meta name="application-name" content="Sutter’s Mill" /><meta name="msapplication-window" content="width=device-width;height=device-height" /><meta name="msapplication-tooltip" content="Herb Sutter on software development" /><meta name="msapplication-task" content="name=Subscribe;action-uri=https://herbsutter.com/feed/;icon-uri=https://secure.gravatar.com/blavatar/4554b8d24c7f200dc5e2e1b18db1893f?s=16" /><meta name="msapplication-task" content="name=Sign up for a free blog;action-uri=http://wordpress.com/signup/;icon-uri=https://s1.wp.com/i/favicon.ico" /><meta name="msapplication-task" content="name=WordPress.com Support;action-uri=http://support.wordpress.com/;icon-uri=https://s1.wp.com/i/favicon.ico" /><meta name="msapplication-task" content="name=WordPress.com Forums;action-uri=http://forums.wordpress.com/;icon-uri=https://s1.wp.com/i/favicon.ico" /><meta name="description" content="[This is a C++11-updated version of the original GotW #56.] JG Questions 1. In each of the following statements, what can you say about the order of evaluation of the functions f, g, and h and the expressions expr1 and expr2? Assume that expr1 and expr2 do not contain more function calls. Guru Questions 2.&hellip;" />
<style type="text/css">
			#header h1 a,
		#header h2 {
			color: #265E15 !important;
		}
				#headerimage {
			background: url('https://herbsutter.files.wordpress.com/2011/10/cropped-blog-header.jpg') no-repeat;
			height: 200px;
		}
	</style>
<style type="text/css" id="syntaxhighlighteranchor"></style>
		<link rel="stylesheet" id="custom-css-css" type="text/css" href="https://s2.wp.com/?custom-css=1&#038;csblog=eb5Y&#038;cscache=6&#038;csrev=60" />
		</head>
<body id="section-index" class="page-template-default page page-id-1327 page-child parent-pageid-864 mp6 customizer-styles-applied highlander-enabled highlander-light">


<div id="navigation" class="clearfix">
		<div class="menu">
		<ul>
			<li ><a href="https://herbsutter.com/" title="Home">Home</a></li>
			<li class="page_item page-item-912"><a href="https://herbsutter.com/welcome-to-the-jungle/">Welcome to the&nbsp;Jungle</a></li>
<li class="page_item page-item-864 page_item_has_children current_page_ancestor current_page_parent"><a href="https://herbsutter.com/gotw/">GotW</a></li>
<li class="page_item page-item-761"><a href="https://herbsutter.com/elements-of-modern-c-style/">Elements of Modern C++&nbsp;Style</a></li>
<li class="page_item page-item-2 page_item_has_children"><a href="https://herbsutter.com/about/">About</a></li>
									<li class="search"><form method="get" id="searchform" action="https://herbsutter.com"><input type="text" class="textbox" value="" name="s" id="s" /><input type="submit" id="searchsubmit" value="Search" /></form></li>
					</ul>
	</div>
</div><!-- end id:navigation -->

<div id="container">

<div id="header">
<h1><a href="https://herbsutter.com/" title="Sutter’s Mill">Sutter’s Mill</a></h1>
<h2>Herb Sutter on software development</h2>
</div><!-- end id:header -->


	
		<div id="feedarea">
	<dl>
		<dt><strong>Feeds:</strong></dt>

			<dd><a href="https://herbsutter.com/feed/">Posts</a></dd>
	
			<dd><a href="https://herbsutter.com/comments/feed/">Comments</a></dd>
		</dl>
	</div><!-- end id:feedarea -->
	
	<div id="headerimage">
</div><!-- end id:headerimage -->

<div id="content">
<div id="content-main">

		
			<div class="post post-1327 page type-page status-publish hentry" id="post-1327">
				<div class="posttitle">
				<h2><a href="https://herbsutter.com/gotw/_102/" rel="bookmark">GotW #102: Exception-Safe Function Calls (Difficulty:&nbsp;7/10)</a></h2>
							</div>

				<div class="entry">
					<p align="center"><em>[This is a C++11-updated version of the original </em><a href="http://www.gotw.ca/gotw/056.htm">GotW #56</a><em></em><em>.]</em></p>
<h3>JG Questions</h3>
<p>1. In each of the following statements, what can you say about the order of evaluation of the functions <em>f</em>, <em>g</em>, and <em>h </em>and the expressions <em>expr1 </em>and <em>expr2</em>? Assume that <em>expr1 </em>and <em>expr2 </em>do not contain more function calls.</p>
<div class="wlWriterEditableSmartContent" id="scid:C89E2BDB-ADD3-4f7a-9810-1B7EACF446C1:5bf2179d-c685-40a5-8a2a-6826c1dbc795" style="display:inline;float:none;margin:0;padding:0;">
<pre class="brush: cpp; gutter: false; highlight: [1,5]; pad-line-numbers: true; title: ; notranslate" title="">
// Example 1(a)
//
f( expr1, expr2 );

// Example 1(b)
//
f( g( expr1 ), h( expr2 ) );
</pre>
</div>
<h3>Guru Questions</h3>
<p>2. In your travels through the dusty corners of your company’s code archives, you find the following code fragment:</p>
<div class="wlWriterEditableSmartContent" id="scid:C89E2BDB-ADD3-4f7a-9810-1B7EACF446C1:4d6237c8-c2e5-4ff0-81b6-fb7d881b6832" style="display:inline;float:none;margin:0;padding:0;">
<pre class="brush: cpp; gutter: false; highlight: [1]; title: ; notranslate" title="">
// Example 2

// In some header file:
void f( T1*, T2* );

// At some call site:
f( new T1, new T2 );
</pre>
</div>
<p>Does this code have any potential exception safety or other problems? Explain.</p>
<p>3. As you continue to root through the archives, you see that someone must not have liked Example 2 because later versions of the files in question were changed as follows:</p>
<div class="wlWriterEditableSmartContent" id="scid:C89E2BDB-ADD3-4f7a-9810-1B7EACF446C1:447fc711-f93c-4345-8c3b-a96121fccc7e" style="display:inline;float:none;margin:0;padding:0;">
<pre class="brush: cpp; gutter: false; highlight: [1]; title: ; notranslate" title="">
// Example 3

// In some header file:
void f( std::unique_ptr&lt;T1&gt;, std::unique_ptr&lt;T2&gt; );

// At some call site:
f( std::unique_ptr&lt;T1&gt;{ new T1 }, std::unique_ptr&lt;T2&gt;{ new T2 } );
</pre>
</div>
<p>What improvements does this version offer over Example 2, if any? Do any exception safety problems remain? Explain.</p>
<p>4. Demonstrate how to write a <em>make_unique </em>facility that solves the safety problems in Example 3 and can be invoked as follows:</p>
<div class="wlWriterEditableSmartContent" id="scid:C89E2BDB-ADD3-4f7a-9810-1B7EACF446C1:ddf19e38-8df2-4f80-be80-ef76b3c5f6fa" style="display:inline;float:none;margin:0;padding:0;">
<pre class="brush: cpp; gutter: false; highlight: [1]; title: ; notranslate" title="">
// Example 4

// In some header file:
void f( std::unique_ptr&lt;T1&gt;, std::unique_ptr&lt;T2&gt; );

// At some call site:
f( make_unique&lt;T1&gt;(), make_unique&lt;T2&gt;() );
</pre>
</div>
<h3>Solution</h3>
<p><strong>1. In each of the following statements, what can you say about the order of evaluation of the functions <em>f</em>, <em>g</em>, and <em>h </em>and the expressions <em>expr1 </em>and <em>expr2</em>? Assume that <em>expr1 </em>and <em>expr2 </em>do not contain more function calls. </strong></p>
<div>
<p>The answer hinges on the following basic rules:</p>
<ul>
<li>All of a function’s arguments must be fully evaluated before the function is called. This includes the completion of any side effects of expressions used as function arguments.</li>
<li>Once the execution of a function begins, no expressions from the calling function may begin or continue to be evaluated until execution of the called function has completed. Function executions never interleave with each other.</li>
<li>Expressions used as function arguments may generally be evaluated in any order, including interleaved, except as otherwise restricted by the other rules.</li>
</ul>
<p>In ISO C++11, these intra-thread ordering constraints are specified by the “sequenced before” relation, which constrains the transformations that compilers and hardware can perform within a single thread of execution. This replaces, but is intended to be identical to, the older C/C++ formulation of sequence points.</p>
<div>
<p>Given those rules, let’s see what happens in our opening examples:</p>
</div>
</div>
<div class="wlWriterEditableSmartContent" id="scid:C89E2BDB-ADD3-4f7a-9810-1B7EACF446C1:55f97bc1-ec00-469c-bab4-62c50556db3d" style="display:inline;float:none;margin:0;padding:0;">
<pre class="brush: cpp; gutter: false; highlight: [1]; pad-line-numbers: true; title: ; notranslate" title="">
// Example 1(a)
//
f( expr1, expr2 );
</pre>
</div>
<p>In Example 1(a), all we can say is that both <em>expr1</em> and <em>expr2</em> must be evaluated before <em>f </em>is called.</p>
<p>That’s it. The compiler may choose to perform the evaluation of <em>expr1 </em>before, after, or interleaved with the evaluation of <em>expr2</em>. There are enough people who find this surprising that it comes up as a regular question in C++ forums, but it’s just a direct result of the C and C++ rules about intra-thread sequencing.</p>
<div class="wlWriterEditableSmartContent" id="scid:C89E2BDB-ADD3-4f7a-9810-1B7EACF446C1:d3a02904-a2a2-49a6-93c1-9a0c40ca1a67" style="display:inline;float:none;margin:0;padding:0;">
<pre class="brush: cpp; gutter: false; highlight: [1]; pad-line-numbers: true; title: ; notranslate" title="">
// Example 1(b)
//
f( g( expr1 ), h( expr2 ) );
</pre>
</div>
<p>In Example 1(b), the functions and expressions may be evaluated in any order that respects the following rules:</p>
<ul>
<li><em>expr1 </em>must be evaluated before <em>g </em>is called.</li>
<li><em>expr2 </em>must be evaluated before <em>h </em>is called.</li>
<li>Both <em>g </em>and <em>h </em>must complete before <em>f </em>is called.</li>
</ul>
<p>The evaluations of <em>expr1 </em>and <em>expr2 </em>may be interleaved with each other, but nothing may be interleaved with any of the function calls. For example, no part of the evaluation of <em>expr2 </em>or any of the execution of <em>h</em> may occur from the time <em>g</em> begins until it ends; however, it’s possible for <em>h</em> to be called either before or after <em>g</em>.</p>
<h3></h3>
<h3>Some Function Call Exception Safety Problems</h3>
<p><strong>2. In your travels through the dusty corners of your company’s code archives, you find the following code fragment: </strong></p>
<div class="wlWriterEditableSmartContent" id="scid:C89E2BDB-ADD3-4f7a-9810-1B7EACF446C1:8a652ac3-72c4-40f7-af8f-a4c4cc7e80c3" style="display:inline;float:none;margin:0;padding:0;">
<pre class="brush: cpp; gutter: false; highlight: [1]; title: ; notranslate" title="">
// Example 2

// In some header file:
void f( T1*, T2* );

// At some call site:
f( new T1, new T2 );
</pre>
</div>
<p><strong>Does this code have any potential exception safety or other problems? Explain. </strong></p>
<p>Yes, there are several potential exception safety problems.</p>
<p>Brief recap: An expression such as <em>new T1 </em>is called, simply enough, a new-expression. Recall what a new-expression really does (ignoring in-place and array forms for simplicity, because they’re not very relevant here):</p>
<ul>
<li>it allocates memory;</li>
<li>it constructs a new object in that memory; and</li>
<li>if the construction fails because of an exception the allocated memory is freed.</li>
</ul>
<p>So each new-expression is essentially a series of two function calls: one call to <em>operator new</em> (either the global one, or one provided by the type of the object being created), and then a call to the constructor.</p>
<p>For Example 2, consider what happens if the compiler decides to generate code that performs the following steps in order:</p>
<ol>
<li>allocate memory for the <em>T1</em></li>
<li>construct the <em>T1</em></li>
<li>allocate memory for the <em>T2</em></li>
<li>construct the <em>T2</em></li>
<li>call <em>f</em></li>
</ol>
<p>The problem is this: If either step 3 or step 4 fails because of an exception, the C++ standard does not require that the <em>T1 </em>object be destroyed and its memory deallocated. This is a classic memory leak, and clearly Not a Good Thing.</p>
<p>Another possible sequence of events is the following:</p>
<ol>
<li>allocate memory for the <em>T1</em></li>
<li>allocate memory for the <em>T2</em></li>
<li>construct the <em>T1</em></li>
<li>construct the <em>T2</em></li>
<li>call <em>f</em></li>
</ol>
<p>This sequence has, not one, but two exception safety problems with different effects:</p>
<ul>
<li>If step 3 fails because of an exception, then the memory allocated for the <em>T1 </em>object is automatically deallocated (step 1 is undone), but the standard does not require that the memory allocated for the <em>T2 </em>object be deallocated. The memory is leaked.</li>
<li>If step 4 fails because of an exception, then the <em>T1 </em>object has been allocated and fully constructed, but the standard does not require that it be destroyed and its memory deallocated. The <em>T1 </em>object is leaked.</li>
</ul>
<p>“Hmm,” you might wonder, “then why does this exception safety loophole exist at all? Why doesn’t the standard just prevent the problem by requiring compilers to Do the Right Thing when it comes to cleanup?”</p>
<p>Following the spirit of C in the matter of efficiency, the C++ standard allows the compiler some latitude with the order of evaluation of expressions, because this allows the compiler to perform optimizations that might not otherwise be possible. To permit this, the expression evaluation rules are specified in a way that is not exception-safe, so if you want to write exception-safe code you need to know about, and avoid, these cases.</p>
<p>Fortunately, you can do just that and prevent this problem. Perhaps a smart pointer like <em>unique_ptr </em>could help?</p>
<p><strong>3. As you continue to root through the archives, you see that someone must not have liked Example 2 because later versions of the files in question were changed as follows: </strong></p>
<div class="wlWriterEditableSmartContent" id="scid:C89E2BDB-ADD3-4f7a-9810-1B7EACF446C1:87f54997-c030-4850-9791-be9cf8442aba" style="display:inline;float:none;margin:0;padding:0;">
<pre class="brush: cpp; gutter: false; highlight: [1]; title: ; notranslate" title="">
// Example 3

// In some header file:
void f( std::unique_ptr&lt;T1&gt;, std::unique_ptr&lt;T2&gt; );

// At some call site:
f( std::unique_ptr&lt;T1&gt;{ new T1 }, std::unique_ptr&lt;T2&gt;{ new T2 } );
</pre>
</div>
<p><strong>What improvements does this version offer over Example 2, if any? Do any exception safety problems remain? Explain. </strong></p>
<p>This code attempts to “throw <em>unique_ptr</em> at the problem.” Many people believe that a smart pointer is an exception-safety panacea, a touchstone or amulet that by its mere presence somewhere nearby can help ward off compiler indigestion.</p>
<p>It is not. Nothing has changed. Example 3 is still not exception-safe, for exactly the same reasons as before.</p>
<p>Specifically, the problem is that the resources are safe only if they really make it into a managing <em>unique_ptr</em>, but the same problems already noted can still occur before either <em>unique_ptr </em>constructor is ever reached. This is because both of the two problematic execution orders mentioned earlier are still possible, but now with the <em>unique_ptr </em>constructors tacked onto the end before invoking <em>f</em>. For one example:</p>
<ol>
<li>allocate memory for the <em>T1</em></li>
<li>construct the <em>T1</em></li>
<li>allocate memory for the <em>T2</em></li>
<li>construct the <em>T2</em></li>
<li>construct the <em>unique_ptr&lt;T1&gt;</em></li>
<li>construct the <em>unique_ptr&lt;T2&gt;</em></li>
<li>call <em>f</em></li>
</ol>
<p>In the above case, the same problems are still present if either of steps 3 or 4 throws. Similarly with:</p>
<ol>
<li>allocate memory for the <em>T1</em></li>
<li>allocate memory for the <em>T2</em></li>
<li>construct the <em>T1</em></li>
<li>construct the <em>T2</em></li>
<li>construct the <em>unique_ptr&lt;T1&gt;</em></li>
<li>construct the <em>unique_ptr&lt;T2&gt;</em></li>
<li>call <em>f</em></li>
</ol>
<p>Again, the same problems are present if either of steps 3 or 4 throws.</p>
<p>Fortunately, though, this is not a problem with <em>unique_ptr</em>; it’s just being used the wrong way, that’s all. Let’s see how to use it better.</p>
<h3>Enter make_unique</h3>
<p><strong>4. Demonstrate how to write a <em>make_unique </em>facility that solves the safety problems in Example 3 and can be invoked as follows: </strong></p>
<div class="wlWriterEditableSmartContent" id="scid:C89E2BDB-ADD3-4f7a-9810-1B7EACF446C1:e20c8929-8864-4b2d-8f0d-1f2de8e1beac" style="display:inline;float:none;margin:0;padding:0;">
<pre class="brush: cpp; gutter: false; highlight: [1]; title: ; notranslate" title="">
// Example 4

// In some header file:
void f( std::unique_ptr&lt;T1&gt;, std::unique_ptr&lt;T2&gt; );

// At some call site:
f( make_unique&lt;T1&gt;(), make_unique&lt;T2&gt;() );
</pre>
</div>
<p>The basic idea is:</p>
<ul>
<li>We want to leverage the fact that functions called from the same thread won’t interleave, so we want to provide a function that does the work of allocation and construction of the object and construction of the <em>unique_ptr</em>.</li>
<li>Because the function should be able to work with any type, we want to express it as a function template.</li>
<li>Because the caller will want to pass constructor parameters from outside <em>make_unique</em>, we’ll use the C++11 perfect forwarding style to pass those along to the new-expression inside <em>make_unique</em>.</li>
<li>Because <em>shared_ptr</em> already has an analogous <em>std::make_shared</em>, for consistency we’ll call this one <em>make_unique</em>. (That C++11 doesn’t include <em>make_unique </em>is partly an oversight, and it will almost certainly be added in the future. In the meantime, use the one provided below.)</li>
</ul>
<p>Putting the ingredients together, we get:</p>
<div class="wlWriterEditableSmartContent" id="scid:C89E2BDB-ADD3-4f7a-9810-1B7EACF446C1:a097b818-32a5-4e09-a6a9-dec770b1a912" style="display:inline;float:none;margin:0;padding:0;">
<pre class="brush: cpp; gutter: false; title: ; notranslate" title="">
template&lt;typename T, typename ...Args&gt;
std::unique_ptr&lt;T&gt; make_unique( Args&amp;&amp; ...args )
{
    return std::unique_ptr&lt;T&gt;( new T( std::forward&lt;Args&gt;(args)... ) );
}
</pre>
</div>
<p>This solves the exception safety problems. No sequence of generated code can cause resources to be leaked, because now all we have is two functions, and we know that one must be executed entirely before the other. Consider the following evaluation order:</p>
<ol>
<li>call <em>make_unique&lt;T1&gt;</em></li>
<li>call <em>make_unique&lt;T2&gt;</em></li>
<li>call <em>f</em></li>
</ol>
<p>If step 1 throws, there are no leaks because <em>make_unique</em> is itself strongly exception-safe.</p>
<p>If step 2 throws, then is the temporary <em>unique_ptr&lt;T1&gt;</em> created by step 1 guaranteed to be cleaned up? Yes, it is. One might wonder: Isn’t this pretty much the same as the new <em>T1</em> object created in the corresponding case in Example 2, which isn’t correctly cleaned up? No, this time it’s not quite the same, because here the <em>unique_ptr&lt;T1&gt;</em> is actually a temporary object, and cleanup of temporary objects is correctly specified in the standard. From the standard, in 12.2/3 (unchanged from C++98):</p>
<blockquote><p>Temporary objects are destroyed as the last step in evaluating the full-expression that (lexically) contains the point where they were created. This is true even if that evaluation ends in throwing an exception.</p></blockquote>
<p><strong>Guidelines:</strong></p>
<ul>
<li>Prefer to allocate objects to be managed by a <em>shared_ptr </em>using <em>make_shared</em>, and objects to be managed by a <em>unique_ptr</em> with <em>make_unique</em>.</li>
<li>Although Standard C++ does not yet have <em>make_unique</em>, this is mostly an oversight and it will almost certainly eventually be added. In the meantime, use the version shown above, and your code will be forward-compatible with the likely direction of the C++ standard.</li>
<li>Avoid using plain <em>new</em> or other raw unmanaged allocation directly. Instead, use a factory like <em>make_unique</em> that wraps the raw allocation and immediately passes it to another object that will own the resource. Often that owning object will be a smart pointer, but it can be a scope guard or any other kind of owning object whose destructor will deallocate the resource safely.</li>
</ul>
<h3>Acknowledgments</h3>
<p>This Item was prompted by a discussion thread on comp.lang.c++.moderated. This solution draws on observations presented by James Kanze, Steve Clamage, and Dave Abrahams in that and other threads, and in private correspondence. Thanks also to Clark Nelson, who drafted C++11’s “sequenced before” wording, for clarifying the C++11 status quo.</p>
																			</div>

									<p class="postmetadata"><a href="https://herbsutter.com/gotw/_102/#comments">33 Comments &#187;</a></p>
				
				
<!-- You can start editing here. -->

<h3 id="comments">33 Responses</h3>

	<ol class="commentlist">
			<li class="pingback even thread-even depth-1 highlander-comment" id="comment-9579">
		<div id="div-comment-9579">
		<div class="cmtinfo"><em> on <a href="#comment-9579" title="">2013-04-24 at 7:28 am</a></em>  <cite><a href='http://theotherbranch.wordpress.com/2013/04/24/iso-c-committee-draft/' rel='external nofollow' class='url'>ISO C++ committee draft | The other branch</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_9579"></div><p>[&#8230;] Proposes the missing unique_ptr analogue for make_shared. There are 3 overloads: 1 for a single object with argument pack that is forwarded to the object constructor, and 2 for arrays, one of which is deleted to ensure it is used correctly (it takes a single argument: the array size, so cannot be used for a fixed-size array). The implementation of the single object overload matches that suggested by Herb in GotW 102. [&#8230;]</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="pingback odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-6939">
		<div id="div-comment-6939">
		<div class="cmtinfo"><em> on <a href="#comment-6939" title="">2012-11-19 at 5:23 am</a></em>  <cite><a href='http://theotherbranch.wordpress.com/2012/11/19/generalised-type-deduction-for-class-template-instance-construction/' rel='external nofollow' class='url'>Generalised type-deduction for class template instance construction &laquo; The other branch</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_6939"></div><p>[&#8230;] If you are unfamiliar with these techniques I recommend reading Sutter&#8217;s description of a make_unique function (see the section entitled Enter make_unique) and Meyers&#8217; post on what he calls [&#8230;]</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 highlander-comment" id="comment-6520">
		<div id="div-comment-6520">
		<div class="cmtinfo"><em> on <a href="#comment-6520" title="">2012-10-26 at 12:53 pm</a></em> <img alt='' src='https://1.gravatar.com/avatar/4ce5c5a72b334e27007a979753054a33?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>David Oliver</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_6520"></div><p>@Alf,</p>
<p>Thanks for your comments.</p>
<p>Some of the slips were typos as I fiddled with the markup: I should have said to use <code>std::unique_ptr&lt;std::array&lt;T, N&gt;&gt;</code> for fixed size arrays. Unlike <code>vector</code>, this results in a true pointer-to-array type requiring an extra level of indirection:</p>
<pre class="brush: plain; title: ; notranslate" title="">
    typedef std::array&lt;char, 42&gt; Array;
    std::unique_ptr&lt;Array&gt; v = make_unique&lt;Array&gt;();
    (*v)[2] = 'x';
    Assert::AreEqual('x', (*v)[2]);
    Assert::AreEqual(size_t(42), v-&gt;size());
</pre>
<p>Thanks for the correction about deleters being &#8211; possibly elided &#8211; objects, rather than just types: when all else fails, read the standard.</p>
<p>In this case, it would seem that providing a function modelled on <code>allocate_shared()</code> is appropriate, something like:</p>
<pre class="brush: plain; title: ; notranslate" title="">
template &lt;typename T, template &lt;typename &gt; typename Alloc, typename... Args&gt;
unique_ptr&lt;T, Deleter&lt;Alloc&lt;T&gt;&gt;&gt; allocate_unique(const Alloc&amp; alloc, Args&amp;&amp;... args)
{
    Alloc&lt;T&gt; allocator(alloc);      // allocator is copied, c.f. allocate_shared&lt;&gt;()
    typedef Deleter&lt;Alloc&lt;T&gt;&gt;	Del;
    T* tp = allocator.allocate(1);
    try {
        allocator.construct(tp, args...);
        return unique_ptr&lt;T, Del&gt;(tp, Del());
    }
    catch (...) {   // allocation succeeded, but construction failed.
        allocator.deallocate(tp, 1);
        throw;
    }
}
// For example 
auto uptr = allocate_unique&lt;MyClass&gt;(my_alloc, &quot;hello&quot;, &quot;world&quot;));
</pre>
<p>The <code>Deleter</code> wraps the allocator looks like:</p>
<pre class="brush: plain; title: ; notranslate" title="">
template &lt;class Alloc&gt;
class Deleter
    : private Alloc     // use EBCO to avoid growing unique_ptr.
{
private:
    using Alloc::destroy;       // needed for VC++12
    using Alloc::deallocate;

public:
	typedef typename Alloc::value_type value_type;

	Deleter() : Alloc() {}
	Deleter(const Alloc&amp; alloc) : Alloc(alloc) {}
	void operator()(value_type* p) {
		destroy(p);
		deallocate(p, 1);
	}
};
</pre>
<p>Caveat: I have tested this with VC++12, using &#8220;manually expanded variable arguments&#8221; and without confirming correct exception handling.</p>
<p>If only local, scoped heap objects were needed, using <code>auto</code> in declarations would be fine, and <code>Deleter</code> could be buried out of the user&#8217;s sight. Where a full type is needed, it becomes ugly:</p>
<pre class="brush: plain; title: ; notranslate" title="">
unique_ptr&lt;MyClass, Deleter&lt;MyAllocator&lt;MyClass&gt;&gt;&gt; uptr =
    allocate_unique&lt;MyClass&gt;(my_alloc, &quot;hello&quot;, &quot;world&quot;));
</pre>
<p>Ideally, a alias declaration would simplify this. In the meantime, a poor-man&#8217;s implementation &#8220;works&#8221; well enough for testing:</p>
<pre class="brush: plain; title: ; notranslate" title="">
template &lt;class T, template &lt;class S&gt; class Alloc&gt;
class UniqueAllocPtr
    : public unique_ptr&lt;T, Deleter&lt;Alloc&lt;T&gt;&gt;&gt;
{
public:
    typedef unique_ptr&lt;T, Deleter&lt;Alloc&lt;T&gt;&gt;&gt; Ptr;
    class UniqueAllocPtr(Ptr&amp;&amp; ptr)
        : Ptr(std::move(ptr))
    {}
};

// For example:
UniqueAllocPtr&lt;MyClass, MyAllocator&gt; uptr =
    allocate_unique&lt;MyClass&gt;(my_alloc, &quot;hello&quot;, &quot;world&quot;));
</pre>
<p>I&#8217;ll leave C-style arrays for another time: they seem to require the <code>Deleter</code> hanging onto the array size for the <code>Allocator</code>&#8216;s <code>deallocate()</code> and repeated calls to <code>destroy()</code>. Some thought will also be needed to perform initialization cleanup correctly in the presence of exceptions, which I&#8217;ll leave for another day.</p>
<p>Hoping my markup is better this time,</p>
<p>Cheers!</p>
<p>David.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-6496">
		<div id="div-comment-6496">
		<div class="cmtinfo"><em> on <a href="#comment-6496" title="">2012-10-23 at 10:16 pm</a></em> <img alt='' src='https://0.gravatar.com/avatar/c6d1c46e2968a7674186b73b819dbca4?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://gravatar.com/alfps' rel='external nofollow' class='url'>Alf P. Steinbach</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_6496"></div><p>@David: well I hope Herb can fix up the postings (by deleting first tries).</p>
<p>Anyway, just a few factoids:</p>
<p>    <code>std::unique_ptr</code> does have an associated (stored) deleter object. But it&#8217;s designed to allow Empty Base Class optimization, which you in practice can rely on for the default deleter. In other direction, ungoodness, for performance reasons it does not support general conversion up a class inheritance chain wrt. getting the deleter argument correct, i.e. it&#8217;s <em>not quite</em> type safe, whereas `std::shared_ptr` is.<br />
    <code>std::unique_ptr</code> is <em>specialized</em><em> for arrays, and there is no such thing as <code>std::unique_array</code></p>
<p>Therefore, in order for <code>make_unique</code> to be able to create all kinds of <code>std::unique_ptr</code>, it needs to be (effectively) specialized for array pointee so that in that case, it allocates an array pointee.</p>
<p>The deleter problem is that a deleter argument comes in addition to the pointee constructor arguments.</p>
<p>True, it&#8217;s not particularly difficult, or doesn&#8217;t seem to be, but in light of the two bullet points above (hopefully the markup worked) the implementations we&#8217;ve all put forward, are merely proofs of concept, nothing more.</p>
<p>Cheers &amp; hth.,</p>
<p>&#8211; Alf</em></p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 highlander-comment" id="comment-6491">
		<div id="div-comment-6491">
		<div class="cmtinfo"><em> on <a href="#comment-6491" title="">2012-10-23 at 11:48 am</a></em> <img alt='' src='https://1.gravatar.com/avatar/4ce5c5a72b334e27007a979753054a33?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>David Oliver</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_6491"></div><p>(resent with markup fixed)<br />
@Alf,</p>
<p>My version of <code>make_unique</code> is VC++ specific (recent versions &#8211; works with 2012), and makes use of Microsoft&#8217;s macros for faking variadic templates by creating one template for each number of template parameters from 0 through 4 (VC++2010 supported up to ten!).</p>
<p>Other than this kludge, it is a blatant copy of Herb&#8217;s original version, including the signature which matches <a href="http://en.cppreference.com/w/cpp/memory/shared_ptr/make_shared" rel="nofollow">std::make_shared</a>. This may be clearer if I manage to post it with markup:</p>
<pre class="brush: cpp; title: ; notranslate" title=""> 
// TEMPLATE FUNCTION make_unique
#define _MAKE_UNIQUE(TEMPLATE_LIST, PADDING_LIST, LIST, COMMA, X1, X2, X3, X4)	\
																				\
template&lt;class T COMMA LIST(_CLASS_TYPE)&gt;&gt;									\
std::unique_ptr&lt;T&gt; make_unique(LIST(_TYPE_REFREF_ARG))							\
{																				\
    return std::unique_ptr&lt;T&gt;(new T(LIST(_FORWARD_ARG)));						\
}

_VARIADIC_EXPAND_0X(_MAKE_UNIQUE, , , , )
</pre>
<p>Barring the kludge, I believe that this, like Herb&#8217;s original, is complete:</p>
<p><code>std::unique_ptr</code>s do not have associated deleter objects, though they may templatized with a <code>Deleter</code> type, so the &#8220;obvious&#8221; solution of <code>allocate_unique()</code> (c.f. <code>std::allocate_shared()</code>) would require the provision of an extended unique pointer type.</p>
<p>As for arrays, it may be significant that the standards committee didn&#8217;t decide to adopt/adapt Boost&#8217;s <code>shared/scoped_array</code>. The reason for this may be because there are very few situations where there is a significant benefit: for fixed size arrays, <code>std::unique_array&lt;std::array&lt;T, N&gt;&gt;</code> works fine (and fits in with <code>make_unique()</code>).</p>
<p>For variable-sized arrays, <code>std::vector&lt;T&gt;</code> is almost always a better bet: it&#8217;s familiar and easy to use: <code>std::vector&lt;T&gt; v(n)</code> versus:</p>
<pre class="brush: plain; title: ; notranslate" title="">std::unique_ptr&lt;char[], std::default_delete&lt;char[]&gt;&gt; v(new char[42], std::default_delete&lt;char[]&gt;());</pre>
<p>even if that was simplified by a <code>make_unique</code> overload into:</p>
<pre class="brush: plain; title: ; notranslate" title="">std::unique_ptr&lt;T[], std::default_delete&lt;T[]&gt;&gt; v = make_unique&lt;T[], std::default_delete&gt;(42));</pre>
<p>Cheers!</p>
<p>David.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-6490">
		<div id="div-comment-6490">
		<div class="cmtinfo"><em> on <a href="#comment-6490" title="">2012-10-23 at 11:42 am</a></em> <img alt='' src='https://1.gravatar.com/avatar/4ce5c5a72b334e27007a979753054a33?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>David Oliver</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_6490"></div><p>@Alf,</p>
<p>Your <code>UniquePtr_&lt;&gt;</code> is an interesting and clever example of using the type system to enforce a programming style &#8211; in this case, &#8220;never use <code>new</code> or <code>delete</code> in application level code&#8221;.</p>
<p>My version of <code>make_unique</code> is VC++ specific (recent versions &#8211; works with 2012), and makes use of Microsoft&#8217;s macros for faking variadic templates by creating one template for each number of template parameters from 0 through 4 (VC++2010 supported up to ten!).</p>
<p>Other than this kludge, it is a blatant copy of Herb&#8217;s original version, including the signature which matches <a href="http://en.cppreference.com/w/cpp/memory/shared_ptr/make_shared" rel="nofollow">std::make_shared</a>. This may be clearer if I manage to post it with markup:</p>
<pre class="brush: cpp; title: ; notranslate" title=""> 
// TEMPLATE FUNCTION make_unique
#define _MAKE_UNIQUE(TEMPLATE_LIST, PADDING_LIST, LIST, COMMA, X1, X2, X3, X4)	\
																				\
template&amp;lt;class T COMMA LIST(_CLASS_TYPE)&gt;&amp;gt;									\
std::unique_ptr&amp;lt;T&amp;gt; make_unique(LIST(_TYPE_REFREF_ARG))							\
{																				\
    return std::unique_ptr&amp;lt;T&amp;gt;(new T(LIST(_FORWARD_ARG)));						\
}

_VARIADIC_EXPAND_0X(_MAKE_UNIQUE, , , , )
</pre>
<p>Barring the kludge, I believe that this, like Herb&#8217;s original, is complete:</p>
<p><code>std::unique_ptr</code>s do not have associated deleter objects, though they may templatized with a <code>Deleter</code> type, so the &#8220;obvious&#8221; solution of <code>allocate_unique()</code> (c.f. <code>std::allocate_shared()</code>) would require the provision of an extended unique pointer type.</p>
<p>As for arrays, it may be significant that the standards committee didn&#8217;t decide to adopt/adapt Boost&#8217;s <code>shared/scoped_array</code>. The reason for this may be because there are very few situations where there is a significant benefit: for fixed size arrays, <code>std::unique_array&lt;std::array&lt;T, N&gt;&gt;</code> works fine (and fits in with <code>make_unique()</code>).</p>
<p>For variable-sized arrays, <code>std::vector&lt;T&gt;</code> is almost always a better bet: it&#8217;s familiar and easy to use: <code>std::vector&lt;T&gt; v(n)</code> versus:</p>
<pre class="brush: plain; title: ; notranslate" title="">std::unique_ptr&amp;lt;T[], std::default_delete&amp;lt;T[]&amp;gt;&amp;gt; v(new T[n], std::default_delete&amp;lt;T[]&amp;gt;());</pre>
<p>even if that was simplified by a <code>make_unique</code> overload into:</p>
<pre class="brush: plain; title: ; notranslate" title="">std::unique_ptr&amp;lt;T[], std::default_delete&amp;lt;T[]&amp;gt;&amp;gt; v = make_unique&amp;lt;T[]&amp;gt;(42));</pre>
<p>Cheers!</p>
<p>David.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 highlander-comment" id="comment-6439">
		<div id="div-comment-6439">
		<div class="cmtinfo"><em> on <a href="#comment-6439" title="">2012-10-19 at 5:15 pm</a></em> <img alt='' src='https://0.gravatar.com/avatar/c6d1c46e2968a7674186b73b819dbca4?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://gravatar.com/alfps' rel='external nofollow' class='url'>Alf P. Steinbach</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_6439"></div><p>@David: Well, it&#8217;s not that difficult to support a <code>makeUnique</code> function with Visual C++ 11.0 (Visual Studio 2012), with standard-conforming C++03 code. I have already linked to my long-ago <a href="http://alfps.wordpress.com/2010/05/15/cppx-c98-constructor-arguments-forwarding-v2-posting/" rel="nofollow">blog article</a> about it. But just to be concrete, I now sat down and created the following <em>proof of concept</em> code, in Visual Studio 2012. It&rsquo;s proof-of-concept because it doesn&rsquo;t handle a deleter, and it doesn&rsquo;t handle arrays. But in that sense also the implementation given by Herb is proof-of-concept.</p>
<p>Important detail: here <code>makeUnique</code> produces an instance of a *derived class*, so that functions like this GOTW&rsquo;s <code>foo</code> can be made type safe.</p>
<pre class="brush: cpp; title: ; notranslate" title="">
#include &lt;memory&gt;           // std::unique_ptr
#include &lt;utility&gt;          // std::move
#include &quot;progrock/cppx/ConstructorArgForwarder_.h&quot;

namespace progrock { namespace cppx {
    using std::unique_ptr;

    template&lt; class Pointee &gt;
    class UniquePtr_
        : public unique_ptr&lt; Pointee &gt;
    {
    public:
        typedef unique_ptr&lt; Pointee &gt; Base;

    protected:
        UniquePtr_( Pointee* p ): Base( p ) {}

        UniquePtr_( unique_ptr&lt; Pointee &gt;&amp;&amp; other )
            : Base( move( other ) )
        {}

    public:
        template&lt; class ArgPack &gt;
        static UniquePtr_ from( ArgPack const&amp; args )
        {
            return UniquePtr_( new ConstructorArgForwarder_&lt; Pointee &gt;( args ) );
        }

        static UniquePtr_ fromExisting( unique_ptr&lt; Pointee &gt; existingPtr )
        {
            return UniquePtr_( move( existingPtr ) );
        }

        UniquePtr_( UniquePtr_&amp;&amp; other )
            : Base( move( other ) )
        {}
    };

    template&lt; class Pointee, class ArgPack &gt;
    UniquePtr_&lt; Pointee &gt; makeUnique_( ArgPack const&amp; args )
    {
        return UniquePtr_&lt; Pointee &gt;::from( args );
    }

} }  // namespace progrock::cppx

#include &lt;iostream&gt;
#include &lt;string&gt;
using namespace std;
using namespace progrock;
using cppx::UniquePtr_;
using cppx::makeUnique_;
using cppx::args;

void foo( UniquePtr_&lt; wstring &gt; a, UniquePtr_&lt; wstring &gt; b )
{
    wcout &lt;&lt; *a &lt;&lt; endl;
    wcout &lt;&lt; *b &lt;&lt; endl;
}

void bar( unique_ptr&lt; wstring &gt; a, unique_ptr&lt; wstring &gt; b )
{
    wcout &lt;&lt; *a &lt;&lt; endl;
    wcout &lt;&lt; *b &lt;&lt; endl;
}

int main()
{
    // OK
    foo(
        makeUnique_&lt; wstring &gt;(
            args( L&quot;The Visual Studio 2012 text editor can't handle this string:&quot; )
            ),
        makeUnique_ &lt;wstring &gt;( args( 72, L'-' ) )
        );

    // OK
    bar(
        makeUnique_&lt; wstring &gt;(
            args( L&quot;The edit position just goes completely haywire...&quot; )
            ),
        makeUnique_&lt; wstring &gt;( args( 72, L'-' ) )
        );

    // Uh oh -- the `bar` programmer didn't do his job properly, and the using code
    // programmer hasn't understood the importance of using `makeUnique_`, which 
    // after all isn't enforced by bar (if it was important it would be enforced?).
    bar(
        unique_ptr&lt; wstring &gt;(
            new wstring( L&quot;Simply put, it gets the width of a hyphen, wrong. Oh my!&quot; )
            ),
        unique_ptr&lt; wstring &gt;( new wstring( 72, L'-' ) )
        );
    // Well, nothing bad happened here, because no exception was thrown. Phew! :-)
}
</pre>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-6428">
		<div id="div-comment-6428">
		<div class="cmtinfo"><em> on <a href="#comment-6428" title="">2012-10-19 at 8:34 am</a></em> <img alt='' src='https://1.gravatar.com/avatar/4ce5c5a72b334e27007a979753054a33?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>David Oliver</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_6428"></div><p>Is there a way to write make_unique() in VS2012?</p>
<p>Yes, but it&#8217;s not pretty, as you have to fake variadic templates. Fortunately, the library provides these (for relatively small numbers of parameters &#8211; Boost metaprogramming provides larger numbers, but is correspondingly harder to use).</p>
<p>The following code works for zero to four parameters; it will probably get mangled during the post.</p>
<p>#include &lt;memory&gt;    // brings in TEMPLATE macros.</p>
<p>#define _MAKE_UNIQUE(TEMPLATE_LIST, PADDING_LIST, LIST, COMMA, X1, X2, X3, X4)	\<br />
																		\<br />
template&lt;class T COMMA LIST(_CLASS_TYPE)&gt;									\<br />
inline std::unique_ptr&lt;T&gt; make_unique(LIST(_TYPE_REFREF_ARG))					\<br />
{																		\<br />
    return std::unique_ptr&lt;T&gt;(new T(LIST(_FORWARD_ARG)));						\<br />
}</p>
<p>_VARIADIC_EXPAND_0X(_MAKE_UNIQUE, , , , )<br />
#undef _MAKE_UNIQUE</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="pingback even thread-even depth-1 highlander-comment" id="comment-6115">
		<div id="div-comment-6115">
		<div class="cmtinfo"><em> on <a href="#comment-6115" title="">2012-09-22 at 2:25 pm</a></em>  <cite><a href='http://jisku.com/blog/2012/09/is-there-a-way-to-write-make_unique-in-vs2012/' rel='external nofollow' class='url'>Is there a way to write make_unique() in VS2012? | Jisku.com - Developers Network</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_6115"></div><p>[&#8230;] Is there a way to write make_unique() in VS2012?   Herb Sutter propose a simple implementation of make_unique() there: <a href="https://herbsutter.com/gotw/_102/" rel="nofollow">https://herbsutter.com/gotw/_102/</a> [&#8230;]</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-6072">
		<div id="div-comment-6072">
		<div class="cmtinfo"><em> on <a href="#comment-6072" title="">2012-09-14 at 7:29 am</a></em> <img alt='' src='https://0.gravatar.com/avatar/c238867a97899a610770b1c436942f4c?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>Geoff Romer</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_6072"></div><p>One drawback I see with make_unique is that you can&#8217;t use it to construct a unique_ptr with a deleter other than std::default_deleter. Is there any way around that?</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 highlander-comment" id="comment-5725">
		<div id="div-comment-5725">
		<div class="cmtinfo"><em> on <a href="#comment-5725" title="">2012-06-26 at 4:57 am</a></em> <img alt='' src='https://0.gravatar.com/avatar/9c9eca3f1fac0fad2535d8164891ec46?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>Christophe Bourez</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_5725"></div><p>I thought that inlining make_unique in f( make_unique(), make_unique() ); could lead to a code equivalent to f( std::unique_ptr{ new T1 }, std::unique_ptr{ new T2 } );. Does it mean that the latitude of code optimization differ when we refactor a part of code inside a function we could expect to be inline by the compiler (The compiler is not forced to inline, but let&#8217;s suppose it does &#8230;) ?</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="pingback odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-5698">
		<div id="div-comment-5698">
		<div class="cmtinfo"><em> on <a href="#comment-5698" title="">2012-06-21 at 1:00 pm</a></em> <img alt='' src='https://secure.gravatar.com/blavatar/4554b8d24c7f200dc5e2e1b18db1893f?s=48' class='avatar avatar-48' height='48' width='48' /> <cite><a href='https://herbsutter.com/2012/06/21/reader-qa-why-dont-modern-smart-pointers-implicitly-convert-to/' rel='external nofollow' class='url'>Reader Q&amp;A: Why don&rsquo;t modern smart pointers implicitly convert to *? &laquo; Sutter’s Mill</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_5698"></div><p>[&#8230;] is your friend – and “rarely” becomes “never” if you use make_unique which is described here and should become standard in the [&#8230;]</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="pingback even thread-even depth-1 highlander-comment" id="comment-5568">
		<div id="div-comment-5568">
		<div class="cmtinfo"><em> on <a href="#comment-5568" title="">2012-05-28 at 2:08 pm</a></em>  <cite><a href='http://www.dkphp.com/questions-2/cc-evaluation-of-the-arguments-in-a-function-call-closed.html' rel='external nofollow' class='url'>C/C++ &#8211; evaluation of the arguments in a function call [closed] | PHP Developer Resource</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_5568"></div><p>[&#8230;] Edit: C++11 version <a href="https://herbsutter.com/gotw/_102/" rel="nofollow">https://herbsutter.com/gotw/_102/</a> [&#8230;]</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-5504">
		<div id="div-comment-5504">
		<div class="cmtinfo"><em> on <a href="#comment-5504" title="">2012-05-10 at 5:59 am</a></em> <img alt='' src='https://2.gravatar.com/avatar/8b8c45fca125ca20d44aa7300d59aca9?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>johnathon</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_5504"></div><p>template<br />
std::unique_ptr make_unique( Args&amp;&amp; &#8230;args )<br />
{<br />
    return std::unique_ptr( new T( std::forward(args)&#8230; ) );<br />
}</p>
<p>Herb, I have this etched into my future template trinkets, but sadly VC as of yet does not support variadiac templates. I would like to express gratitude for all the hard work you and the standards committee have done preparing this wonderful new language to use. Thank You! I&#8217;m sure Mr Caves is working diligently on the variadiac template issue, but if you get the chance give him and STL a pat on the back for the ranged for loop added to the beta.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 highlander-comment" id="comment-5384">
		<div id="div-comment-5384">
		<div class="cmtinfo"><em> on <a href="#comment-5384" title="">2012-04-29 at 2:36 am</a></em> <img alt='' src='https://0.gravatar.com/avatar/c8dba2f6f4d8be9cedf020c0907e9361?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://wellcoded.blogspot.com' rel='external nofollow' class='url'>Frantisek Silvasi</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_5384"></div><p>This is a great solution to this subtle problem &#8230; Thanks.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-alfps odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-5247">
		<div id="div-comment-5247">
		<div class="cmtinfo"><em> on <a href="#comment-5247" title="">2012-04-19 at 4:43 am</a></em> <img alt='' src='https://0.gravatar.com/avatar/c6d1c46e2968a7674186b73b819dbca4?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://alfps.wordpress.com' rel='external nofollow' class='url'>Alf P. Steinbach</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_5247"></div><p>@Mateusz: see my blog posting of May 2010 &ldquo;C++98 constructor arguments forwarding&rdquo; (<a href="http://alfps.wordpress.com/2010/05/15/cppx-c98-constructor-arguments-forwarding-v2-posting/#0x_standard_forwarding_example" rel="nofollow">link</a>).</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-alfps even thread-even depth-1 highlander-comment" id="comment-5243">
		<div id="div-comment-5243">
		<div class="cmtinfo"><em> on <a href="#comment-5243" title="">2012-04-18 at 11:47 pm</a></em> <img alt='' src='https://0.gravatar.com/avatar/c6d1c46e2968a7674186b73b819dbca4?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://alfps.wordpress.com' rel='external nofollow' class='url'>Alf P. Steinbach</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_5243"></div><p>@Mateusz: for C++03 techniques, see my <a href="http://alfps.wordpress.com/2010/05/15/cppx-c98-constructor-arguments-forwarding-v2-posting/#0x_standard_forwarding_example" rel="nofollow">blog posting from May 2010</a>.</p>
<p>Cheers,</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-mpusz odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-5241">
		<div id="div-comment-5241">
		<div class="cmtinfo"><em> on <a href="#comment-5241" title="">2012-04-18 at 10:19 pm</a></em> <img alt='' src='https://0.gravatar.com/avatar/37e370fb4e87500805abb44c8820ec1f?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>Mateusz Pusz</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_5241"></div><p>@herb: Could you please provide information how to implement make_unique in a correct way in VS2010 and VS2011?</p>
<p>Thanks</p>
<p>Mat</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-alfps even thread-even depth-1 highlander-comment" id="comment-4730">
		<div id="div-comment-4730">
		<div class="cmtinfo"><em> on <a href="#comment-4730" title="">2012-01-25 at 5:51 am</a></em> <img alt='' src='https://0.gravatar.com/avatar/c6d1c46e2968a7674186b73b819dbca4?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://alfps.wordpress.com' rel='external nofollow' class='url'>Alf P. Steinbach</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_4730"></div><p>@herb: by &#8220;free function&#8221; to be replaced with a constructor, I meant <code>make_unique</code>. Sorry but WordPress is not perfect wrt. offering editing of user comments.</p>
<p>Cheers,</p>
<p>&#8211; Alf</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-alfps odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-4729">
		<div id="div-comment-4729">
		<div class="cmtinfo"><em> on <a href="#comment-4729" title="">2012-01-25 at 5:45 am</a></em> <img alt='' src='https://0.gravatar.com/avatar/c6d1c46e2968a7674186b73b819dbca4?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://alfps.wordpress.com' rel='external nofollow' class='url'>Alf P. Steinbach</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_4729"></div><p>@Herb: For <code>f</code> to be unsafe it is enough that <code>f</code> <em>can</em> be called without using <code>make_unique</code>.</p>
<p>Relying on the user realzing and remembering that <code>make_unique</code> should be used, is to rely on convention.</p>
<p>That&#8217;s always risky, and to be avoided when the convention can very easily be expressed and enforced within the language (in this case, by replacing the free function with a constructor, andly changing the function signature accordingly).</p>
<p>Cheers &amp; hth.,</p>
<p>&#8211; Alf</p>
<p>PS: Again, thanks for keeping up this eris,</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 highlander-comment" id="comment-4727">
		<div id="div-comment-4727">
		<div class="cmtinfo"><em> on <a href="#comment-4727" title="">2012-01-24 at 1:13 pm</a></em> <img alt='' src='https://2.gravatar.com/avatar/ec85f0ec6771c78fd5b4af14c75b4ee4?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>Michael</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_4727"></div><p>@Chris &#8211; The point that confuses me about 1(b) is this: &#8220;For example, no part of the evaluation of expr2 or any of the execution of h may occur from the time g begins until it ends&#8221;.</p>
<p>Consider an expression</p>
<p>f( !expr1, -expr2 );</p>
<p>If I read Herb correctly, the execution of operator!() and operator-() is unsequenced and allowed to overlap if the operators are built-in (e.g. if expr1 and exp2 are int), but is indeterminately sequenced and not allowed to overlap if the operators are user-defined. This looks counter-intuitive so I want to make sure my understanding is correct.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-4726">
		<div id="div-comment-4726">
		<div class="cmtinfo"><em> on <a href="#comment-4726" title="">2012-01-24 at 6:41 am</a></em> <img alt='' src='https://0.gravatar.com/avatar/c50719691fd50a67225edf1f07c6d5b0?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>Chris Blume</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_4726"></div><p>@Michael &#8211; Yes, g( expr1 ) is still an expression in its own right. However, the key here is that before each function call all parameters must be fully evaluated.<br />
f( g( expr1 ), h( expr2 ) );<br />
g and h must be evaluated before f is called<br />
expr1 must be evaluated before g is called<br />
expr2 must be evaluated before h is called</p>
<p>That means expr1 and expr2 can still be executed in whatever order.<br />
Case 1: expr1, expr2, g, h, f<br />
Case 2: expr2, expr1, g, h, f<br />
Either way still meets the guarantee that the expressions will have been fully evaluated before the functions are called. (This is opposed to, say, assuming arguments will be evaluated left-to-right.)</p>
<p>In case 1 for example, you could have: new T2, new T1 (throws)(cleans up this T1 instance), T2 was not cleaned. Plus what Herb mentioned about the new actually breaking into allocate and constructor pieces.</p>
<p>Thanks for the great insight, Herb!</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-robdesbois even thread-even depth-1 highlander-comment" id="comment-4719">
		<div id="div-comment-4719">
		<div class="cmtinfo"><em> on <a href="#comment-4719" title="">2012-01-23 at 6:27 am</a></em> <img alt='' src='https://1.gravatar.com/avatar/1e167d740c35575fe04f3290df8b204d?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>robdesbois</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_4719"></div><p>@Alf &#8211; I can&#8217;t see your original solution you refer to; could you repost or clarify here please? I cannot see why f() would be unsafe if it is accepting 2 unique_ptr arguments&#8230;unless you mean that the most natural way to call it is without using make_unique?</p>
<p>Thanks Herb :-)</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-4713">
		<div id="div-comment-4713">
		<div class="cmtinfo"><em> on <a href="#comment-4713" title="">2012-01-22 at 6:51 pm</a></em> <img alt='' src='https://0.gravatar.com/avatar/95d915f7b4e5974a5c673a328ebac3f6?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>CM</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_4713"></div><p>Blog software ate all angle brackets. Here is pastebin version: <a href="http://pastebin.com/ufRE5Snj" rel="nofollow">http://pastebin.com/ufRE5Snj</a> .</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 highlander-comment" id="comment-4712">
		<div id="div-comment-4712">
		<div class="cmtinfo"><em> on <a href="#comment-4712" title="">2012-01-22 at 6:48 pm</a></em> <img alt='' src='https://0.gravatar.com/avatar/95d915f7b4e5974a5c673a328ebac3f6?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>CM</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_4712"></div><p>Just checked both GCC and MSVC2010 &#8212; in both cases adding make_unique causes magic of RVO to disappear. I suspect this has something to do with the fact that to allocate an object we use &#8216;statement new&#8217; (as opposed to &#8216;operator new&#8217;) and certain rules about sequence points do not apply to it (thus allowing RVO to work).<br />
I.e. perfect forwarding actually is not perfect :-) &#8212; in order for it to become perfect we need a way to declare that make_unique is not a function, but a statement.<br />
I hope that make_shared/make_unique in future C++ will get special status similar to statement new.</p>
<p>Here is test code, if anyone wants to trcheck:</p>
<p>#include<br />
#include<br />
#include<br />
#include </p>
<p>using namespace std;</p>
<p>struct A<br />
{<br />
    int m;<br />
    A(int i) : m(i) { printf(&#8220;ctor(%d)\n&#8221;, i); }<br />
    A(A const&amp; o) : m(o.m) { printf(&#8220;cctor(%d)\n&#8221;, o.m); }<br />
    A const&amp; operator=(A const&amp; o){ m = o.m; printf(&#8220;op=(%d)\n&#8221;, o.m); }<br />
    ~A() { printf(&#8220;dtor\n&#8221;); }<br />
};</p>
<p>A foo() { return A( rand() ); }<br />
auto_ptr<a> make_unique(A&amp;&amp; a) { return auto_ptr</a><a>(new A(forward</a><a>(a))); }<br />
//unique_ptr</a><a> make_unique(A&amp;&amp; a) { return unique_ptr</a><a>(new A(forward</a><a>(a))); }</p>
<p>int main()<br />
{<br />
	srand(time(NULL));<br />
    auto_ptr</a><a> p( new A(foo()) );<br />
//    auto_ptr</a><a> p( make_unique(foo()) );<br />
//    unique_ptr</a><a> p( make_unique(foo()) );<br />
    return 1;<br />
}</a></p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-alfps odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-4709">
		<div id="div-comment-4709">
		<div class="cmtinfo"><em> on <a href="#comment-4709" title="">2012-01-22 at 3:52 pm</a></em> <img alt='' src='https://0.gravatar.com/avatar/c6d1c46e2968a7674186b73b819dbca4?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://alfps.wordpress.com' rel='external nofollow' class='url'>Alf P. Steinbach</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_4709"></div><p>As I discussed in my proposed solution, while the <em>call</em> to <code>f</code> is now safe enough, <code>f</code> is still as unsafe as ever.</p>
<p>It is still not just possible, but <em>most natural</em>, to call <code>f</code> in an unsafe way.</p>
<p>And one solution is to replace the <code>make_unique</code> function with a <code>Unique</code> class whose constructor does the same as <code>make_unique</code> (namely forwarding arguments and doing the <code>new</code>&#8216;ing), and use this class for the formal arguments of <code>f</code>.</p>
<p>Cheers &amp; hth., &amp; thanks for keeping up the GOTW series!, :-)</p>
<p>&#8211; Alf</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-alfps even thread-even depth-1 highlander-comment" id="comment-4708">
		<div id="div-comment-4708">
		<div class="cmtinfo"><em> on <a href="#comment-4708" title="">2012-01-22 at 3:51 pm</a></em> <img alt='' src='https://0.gravatar.com/avatar/c6d1c46e2968a7674186b73b819dbca4?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://alfps.wordpress.com' rel='external nofollow' class='url'>Alf P. Steinbach</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_4708"></div><p>As I discussed in my proposed solution, while the <em>call</em> to <code>f</code> is now safe enough, <code>f</code> is still as unsafe as ever.</p>
<p>It is still not just possible, but <em>most natural</em><em>, to call <code>f</code> in an unsafe way.</p>
<p>And one solution is to replace the <code>make_unique</code> function with a <code>Unique</code> class whose constructor does the same as <code>make_unique</code> (namely forwarding arguments and doing the <code>new</code>&#8216;ing), and use this class for the formal arguments of <code>f</code>.</p>
<p>Cheers &amp; hth., &amp; thanks for keeping up the GOTW series!, :-)</p>
<p>&#8211; Alf</em></p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-4706">
		<div id="div-comment-4706">
		<div class="cmtinfo"><em> on <a href="#comment-4706" title="">2012-01-22 at 12:39 pm</a></em> <img alt='' src='https://0.gravatar.com/avatar/95d915f7b4e5974a5c673a328ebac3f6?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>CM</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_4706"></div><p>Correction: you should end up with unnecessary move constructor call (assuming your class has it). It is better, but still an unnecessary overhead.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 highlander-comment" id="comment-4705">
		<div id="div-comment-4705">
		<div class="cmtinfo"><em> on <a href="#comment-4705" title="">2012-01-22 at 12:06 pm</a></em> <img alt='' src='https://0.gravatar.com/avatar/95d915f7b4e5974a5c673a328ebac3f6?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>CM</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_4705"></div><p>I might be wrong, but there is an unfortunate side effect of &#8216;make_unique&#8217; trick:<br />
&#8211; normally this construct utilizes RVO and avoids calling copy constructor:<br />
    MyType foo() { return MyType(&#8230;); }<br />
    MyType* p = new MyType( foo() );</p>
<p>logic suggest that it should not work (foo() call should complete before we allocate any memory and therefore we are doomed to have a copy), but it seems that major compilers (GCC/MSVC) recognize this situation and (unless you overload operator new) go extra mile and allow RVO to work here (or may be there is an obscure clause in C++ standard that allows that).</p>
<p>&#8211; unfortunately &#8216;make_unique&#8217; facility will break it and this will leave you with unnecessary copy constructor call:</p>
<p>    auto p = make_unique(foo());</p>
<p>Disclaimer: I reserve my right to be wrong. :-)</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-4703">
		<div id="div-comment-4703">
		<div class="cmtinfo"><em> on <a href="#comment-4703" title="">2012-01-22 at 2:51 am</a></em> <img alt='' src='https://2.gravatar.com/avatar/ec85f0ec6771c78fd5b4af14c75b4ee4?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>Michael</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_4703"></div><p>Why is there any difference between 1(a) and 1(b)? Is wrapping an expression into a function call makes it a non-expression? I.e. is g( expr1 ) not an expression in its own right?</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 highlander-comment" id="comment-4700">
		<div id="div-comment-4700">
		<div class="cmtinfo"><em> on <a href="#comment-4700" title="">2012-01-21 at 7:05 am</a></em> <img alt='' src='https://2.gravatar.com/avatar/2fb810cf7313d38d554fdea16371519f?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>Victor</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_4700"></div><p>Wow. Thanks a lot!</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-4696">
		<div id="div-comment-4696">
		<div class="cmtinfo"><em> on <a href="#comment-4696" title="">2012-01-20 at 10:26 pm</a></em> <img alt='' src='https://1.gravatar.com/avatar/7e3aabc69f3b83c9567b61dcd5ffbde9?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>Nick Form</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_4696"></div><p>Thanks, learned a lot.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="pingback even thread-even depth-1 highlander-comment" id="comment-4690">
		<div id="div-comment-4690">
		<div class="cmtinfo"><em> on <a href="#comment-4690" title="">2012-01-20 at 12:42 pm</a></em> <img alt='' src='https://secure.gravatar.com/blavatar/4554b8d24c7f200dc5e2e1b18db1893f?s=48' class='avatar avatar-48' height='48' width='48' /> <cite><a href='https://herbsutter.com/2012/01/20/gotw-102-solution/' rel='external nofollow' class='url'>GotW #102: Solution &laquo; Sutter’s Mill</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_4690"></div><p>[&#8230;] The solution to GotW #102 is now live. Share this:EmailRedditTwitter [&#8230;]</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
	</ol>

	<div class="navigation">
		<div class="alignleft"></div>
		<div class="alignright"></div>
	</div>
	<br />

  	<p class="nocomments">Comments are closed.</p>
  <div class="post-content">
<p>
</p>
</div>

			</div>

		
		<p align="center"></p>

	</div><!-- end id:content-main -->
<div id="sidebar">
<ul>
<li class="sidebox"><h2><label for="subscribe-field">Follow by email</label></h2>
				<form action="https://subscribe.wordpress.com" method="post" accept-charset="utf-8" id="subscribe-blog">
																	<p><input type="text" name="email" style="width: 95%; padding: 1px 2px" placeholder="Enter your email address" value="" id="subscribe-field"/></p>
					
					<p>
						<input type="hidden" name="action" value="subscribe"/>
						<input type="hidden" name="blog_id" value="3379246"/>
						<input type="hidden" name="source" value="https://herbsutter.com/gotw/_102/"/>
						<input type="hidden" name="sub-type" value="widget"/>
						<input type="hidden" name="redirect_fragment" value="blog_subscription-3" />
						<input type="hidden" id="_wpnonce" name="_wpnonce" value="4590924cc6" />						<input type="submit" value="Subscribe" />
					</p>
				</form>
			
</li><li class="sidebox"><h2><a href='http://twitter.com/herbsutter'>Tweets</a></h2><ul class='tweets'></ul><a href="http://twitter.com/herbsutter"  class='twitter-follow-button' data-show-count='false' data-link-color='#265e15' data-text-color='#333333'>Follow @herbsutter</a></li><li class="sidebox"><h2>Popular</h2><ul>				<li>
										<a href="https://herbsutter.com/2018/11/13/trip-report-fall-iso-c-standards-meeting-san-diego/" class="bump-view" data-bump-view="tp">
						Trip report: Fall ISO C++ standards meeting (San Diego)					</a>
										</li>
								<li>
										<a href="https://herbsutter.com/gotw/" class="bump-view" data-bump-view="tp">
						GotW					</a>
										</li>
								<li>
										<a href="https://herbsutter.com/2018/09/20/lifetime-profile-v1-0-posted/" class="bump-view" data-bump-view="tp">
						Lifetime profile v1.0 posted					</a>
										</li>
				</ul></li><li class="sidebox"><h2>Categories</h2>		<ul>
				<li class="cat-item cat-item-291"><a href="https://herbsutter.com/category/apple/" >Apple</a>
</li>
	<li class="cat-item cat-item-49277"><a href="https://herbsutter.com/category/c-net/" >C# / .NET</a>
</li>
	<li class="cat-item cat-item-2426"><a href="https://herbsutter.com/category/c/" >C++</a>
</li>
	<li class="cat-item cat-item-69816"><a href="https://herbsutter.com/category/cloud/" >Cloud</a>
</li>
	<li class="cat-item cat-item-214618"><a href="https://herbsutter.com/category/concurrency/" >Concurrency</a>
</li>
	<li class="cat-item cat-item-8259773"><a href="https://herbsutter.com/category/effective-concurrency/" >Effective Concurrency</a>
</li>
	<li class="cat-item cat-item-3696745"><a href="https://herbsutter.com/category/friday-thoughts/" >Friday Thoughts</a>
</li>
	<li class="cat-item cat-item-3867746"><a href="https://herbsutter.com/category/c/gotw/" >GotW</a>
</li>
	<li class="cat-item cat-item-79"><a href="https://herbsutter.com/category/hardware/" >Hardware</a>
</li>
	<li class="cat-item cat-item-1017"><a href="https://herbsutter.com/category/java/" >Java</a>
</li>
	<li class="cat-item cat-item-637"><a href="https://herbsutter.com/category/microsoft/" >Microsoft</a>
</li>
	<li class="cat-item cat-item-420845"><a href="https://herbsutter.com/category/opinion-editorial/" >Opinion &amp; Editorial</a>
</li>
	<li class="cat-item cat-item-1633077"><a href="https://herbsutter.com/category/reader-qa/" >Reader Q&amp;A</a>
</li>
	<li class="cat-item cat-item-2301"><a href="https://herbsutter.com/category/software-development/" >Software Development</a>
</li>
	<li class="cat-item cat-item-393523"><a href="https://herbsutter.com/category/talks-events/" >Talks &amp; Events</a>
</li>
	<li class="cat-item cat-item-1"><a href="https://herbsutter.com/category/uncategorized/" >Uncategorized</a>
</li>
	<li class="cat-item cat-item-151"><a href="https://herbsutter.com/category/web/" >Web</a>
</li>
		</ul>
			</li></ul>
</div><!-- end id:sidebar -->
</div><!-- end id:content -->
</div><!-- end id:container -->
<div id="footer">
	<div id="colophon">
		<p><a href="https://wordpress.com/?ref=footer_blog">Blog at WordPress.com.</a></p>
		<p>WPThemes.</p>
		<br class="clear" />
	</div><!-- end #colophon-->
</div><!-- end #footer-->
<!--  -->
<script type='text/javascript' src='//0.gravatar.com/js/gprofiles.js?ver=201847y'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var WPGroHo = {"my_hash":""};
/* ]]> */
</script>
<script type='text/javascript' src='https://s1.wp.com/wp-content/mu-plugins/gravatar-hovercards/wpgroho.js?m=1380573781h'></script>

	<script>
		//initialize and attach hovercards to all gravatars
		jQuery( document ).ready( function( $ ) {

			if (typeof Gravatar === "undefined"){
				return;
			}

			if ( typeof Gravatar.init !== "function" ) {
				return;
			}			

			Gravatar.profile_cb = function( hash, id ) {
				WPGroHo.syncProfileData( hash, id );
			};
			Gravatar.my_hash = WPGroHo.my_hash;
			Gravatar.init( 'body', '#wp-admin-bar-my-account' );
		});
	</script>

		<div style="display:none">
	<div class="grofile-hash-map-4ce5c5a72b334e27007a979753054a33">
	</div>
	<div class="grofile-hash-map-c6d1c46e2968a7674186b73b819dbca4">
	</div>
	<div class="grofile-hash-map-c238867a97899a610770b1c436942f4c">
	</div>
	<div class="grofile-hash-map-9c9eca3f1fac0fad2535d8164891ec46">
	</div>
	<div class="grofile-hash-map-8b8c45fca125ca20d44aa7300d59aca9">
	</div>
	<div class="grofile-hash-map-c8dba2f6f4d8be9cedf020c0907e9361">
	</div>
	<div class="grofile-hash-map-c6d1c46e2968a7674186b73b819dbca4">
	</div>
	<div class="grofile-hash-map-37e370fb4e87500805abb44c8820ec1f">
	</div>
	<div class="grofile-hash-map-ec85f0ec6771c78fd5b4af14c75b4ee4">
	</div>
	<div class="grofile-hash-map-c50719691fd50a67225edf1f07c6d5b0">
	</div>
	<div class="grofile-hash-map-1e167d740c35575fe04f3290df8b204d">
	</div>
	<div class="grofile-hash-map-95d915f7b4e5974a5c673a328ebac3f6">
	</div>
	<div class="grofile-hash-map-2fb810cf7313d38d554fdea16371519f">
	</div>
	<div class="grofile-hash-map-7e3aabc69f3b83c9567b61dcd5ffbde9">
	</div>
	</div>
<script type='text/javascript' charset='UTF-8' id='polldaddyRatings'><!--//--><![CDATA[//><!--
PDRTJS_settings_468178_comm_9579={"id":468178,"unique_id":"wp-comment-9579","title":"%26%23091%3B...%26%23093%3B%20Proposes%20the%20missing%20unique_ptr%20analogue%20for%20make_shared.%20There%20are%203%20overloads%3A%201%20for%20a%20single%20object%20with%20argument%20pack%20that%20is%20forwarded%20to%20the%20object%20constructor%2C%20and%202%20for%20arrays%2C%20one%20...","permalink":"https:\/\/herbsutter.com\/gotw\/_102\/#comment-9579","item_id":"_comm_9579"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_9579 == 'undefined' ){PDRTJS_468178_comm_9579 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_9579 );}}PDRTJS_settings_468178_comm_6939={"id":468178,"unique_id":"wp-comment-6939","title":"%26%23091%3B...%26%23093%3B%20If%20you%20are%20unfamiliar%20with%20these%20techniques%20I%20recommend%20reading%20Sutter%26%238217%3Bs%20description%20of%20a%20make_unique%20function%20%28see%20the%20section%20entitled%20Enter%20make_unique%29%20and%20Meyers%26%238217%3B%20post%20on%20w...","permalink":"https:\/\/herbsutter.com\/gotw\/_102\/#comment-6939","item_id":"_comm_6939"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_6939 == 'undefined' ){PDRTJS_468178_comm_6939 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_6939 );}}PDRTJS_settings_468178_comm_6520={"id":468178,"unique_id":"wp-comment-6520","title":"%40Alf%2CThanks%20for%20your%20comments.Some%20of%20the%20slips%20were%20typos%20as%20I%20fiddled%20with%20the%20markup%3A%20I%20should%20have%20said%20to%20use%20%26lt%3Bcode%26gt%3Bstd%3A%3Aunique_ptr%26lt%3Bstd%3A%3Aarray%26lt%3BT%2C%20N%26gt%3B%26gt%3B%26lt%3B%2Fcode%26gt%3B%20for%20fixed%20size%20arrays...","permalink":"https:\/\/herbsutter.com\/gotw\/_102\/#comment-6520","item_id":"_comm_6520"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_6520 == 'undefined' ){PDRTJS_468178_comm_6520 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_6520 );}}PDRTJS_settings_468178_comm_6496={"id":468178,"unique_id":"wp-comment-6496","title":"%40David%3A%20well%20I%20hope%20Herb%20can%20fix%20up%20the%20postings%20%28by%20deleting%20first%20tries%29.Anyway%2C%20just%20a%20few%20factoids%3A%20%20%20%20%26lt%3Bcode%26gt%3Bstd%3A%3Aunique_ptr%26lt%3B%2Fcode%26gt%3B%20does%20have%20an%20associated%20%28stored%29%20deleter%20object.%20But%20it%26%23039%3Bs%20d...","permalink":"https:\/\/herbsutter.com\/gotw\/_102\/#comment-6496","item_id":"_comm_6496"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_6496 == 'undefined' ){PDRTJS_468178_comm_6496 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_6496 );}}PDRTJS_settings_468178_comm_6491={"id":468178,"unique_id":"wp-comment-6491","title":"%28resent%20with%20markup%20fixed%29%40Alf%2CMy%20version%20of%20%26lt%3Bcode%26gt%3Bmake_unique%26lt%3B%2Fcode%26gt%3B%20is%20VC%2B%2B%20specific%20%28recent%20versions%20-%20works%20with%202012%29%2C%20and%20makes%20use%20of%20Microsoft%26%23039%3Bs%20macros%20for%20faking%20variadic%20templates%20by%20cr...","permalink":"https:\/\/herbsutter.com\/gotw\/_102\/#comment-6491","item_id":"_comm_6491"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_6491 == 'undefined' ){PDRTJS_468178_comm_6491 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_6491 );}}PDRTJS_settings_468178_comm_6490={"id":468178,"unique_id":"wp-comment-6490","title":"%40Alf%2CYour%20%26lt%3Bcode%26gt%3BUniquePtr_%26lt%3B%26gt%3B%26lt%3B%2Fcode%26gt%3B%20is%20an%20interesting%20and%20clever%20example%20of%20using%20the%20type%20system%20to%20enforce%20a%20programming%20style%20-%20in%20this%20case%2C%20%26quot%3Bnever%20use%20%26lt%3Bcode%26gt%3Bnew%26lt%3B%2Fcode%26gt%3B%20or%20%26lt%3Bcode%26gt%3Bdelete%26lt%3B...","permalink":"https:\/\/herbsutter.com\/gotw\/_102\/#comment-6490","item_id":"_comm_6490"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_6490 == 'undefined' ){PDRTJS_468178_comm_6490 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_6490 );}}PDRTJS_settings_468178_comm_6439={"id":468178,"unique_id":"wp-comment-6439","title":"%40David%3A%20Well%2C%20it%26%23039%3Bs%20not%20that%20difficult%20to%20support%20a%20%26lt%3Bcode%26gt%3BmakeUnique%26lt%3B%2Fcode%26gt%3B%20function%20with%20Visual%20C%2B%2B%2011.0%20%28Visual%20Studio%202012%29%2C%20with%20standard-conforming%20C%2B%2B03%20code.%20I%20have%20already%20linked%20to%20my%20lon...","permalink":"https:\/\/herbsutter.com\/gotw\/_102\/#comment-6439","item_id":"_comm_6439"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_6439 == 'undefined' ){PDRTJS_468178_comm_6439 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_6439 );}}PDRTJS_settings_468178_comm_6428={"id":468178,"unique_id":"wp-comment-6428","title":"Is%20there%20a%20way%20to%20write%20make_unique%28%29%20in%20VS2012%3FYes%2C%20but%20it%26%23039%3Bs%20not%20pretty%2C%20as%20you%20have%20to%20fake%20variadic%20templates.%20Fortunately%2C%20the%20library%20provides%20these%20%28for%20relatively%20small%20numbers%20of%20paramete...","permalink":"https:\/\/herbsutter.com\/gotw\/_102\/#comment-6428","item_id":"_comm_6428"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_6428 == 'undefined' ){PDRTJS_468178_comm_6428 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_6428 );}}PDRTJS_settings_468178_comm_6115={"id":468178,"unique_id":"wp-comment-6115","title":"%26%23091%3B...%26%23093%3B%20Is%20there%20a%20way%20to%20write%20make_unique%28%29%20in%20VS2012%3F%20%20%20Herb%20Sutter%20propose%20a%20simple%20implementation%20of%20make_unique%28%29%20there%3A%20http%3A%2F%2Fherbsutter.com%2Fgotw%2F_102%2F%20%26%23091%3B...%26%23093%3B...","permalink":"https:\/\/herbsutter.com\/gotw\/_102\/#comment-6115","item_id":"_comm_6115"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_6115 == 'undefined' ){PDRTJS_468178_comm_6115 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_6115 );}}PDRTJS_settings_468178_comm_6072={"id":468178,"unique_id":"wp-comment-6072","title":"One%20drawback%20I%20see%20with%20make_unique%20is%20that%20you%20can%26%23039%3Bt%20use%20it%20to%20construct%20a%20unique_ptr%20with%20a%20deleter%20other%20than%20std%3A%3Adefault_deleter.%20Is%20there%20any%20way%20around%20that%3F...","permalink":"https:\/\/herbsutter.com\/gotw\/_102\/#comment-6072","item_id":"_comm_6072"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_6072 == 'undefined' ){PDRTJS_468178_comm_6072 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_6072 );}}PDRTJS_settings_468178_comm_5725={"id":468178,"unique_id":"wp-comment-5725","title":"I%20thought%20that%20inlining%20make_unique%20in%20f%28%20make_unique%28%29%2C%20make_unique%28%29%20%29%3B%20could%20lead%20to%20a%20code%20equivalent%20to%20f%28%20std%3A%3Aunique_ptr%7B%20new%20T1%20%7D%2C%20std%3A%3Aunique_ptr%7B%20new%20T2%20%7D%20%29%3B.%20Does%20it%20mean%20that%20the%20lati...","permalink":"https:\/\/herbsutter.com\/gotw\/_102\/#comment-5725","item_id":"_comm_5725"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_5725 == 'undefined' ){PDRTJS_468178_comm_5725 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_5725 );}}PDRTJS_settings_468178_comm_5698={"id":468178,"unique_id":"wp-comment-5698","title":"%26%23091%3B...%26%23093%3B%20is%20your%20friend%20%20and%20rarely%20becomes%20never%20if%20you%20use%20make_unique%20which%20is%20described%20here%20and%20should%20become%20standard%20in%20the%20%26%23091%3B...%26%23093%3B...","permalink":"https:\/\/herbsutter.com\/gotw\/_102\/#comment-5698","item_id":"_comm_5698"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_5698 == 'undefined' ){PDRTJS_468178_comm_5698 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_5698 );}}PDRTJS_settings_468178_comm_5568={"id":468178,"unique_id":"wp-comment-5568","title":"%26%23091%3B...%26%23093%3B%20Edit%3A%20C%2B%2B11%20version%20http%3A%2F%2Fherbsutter.com%2Fgotw%2F_102%2F%20%26%23091%3B...%26%23093%3B...","permalink":"https:\/\/herbsutter.com\/gotw\/_102\/#comment-5568","item_id":"_comm_5568"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_5568 == 'undefined' ){PDRTJS_468178_comm_5568 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_5568 );}}PDRTJS_settings_468178_comm_5504={"id":468178,"unique_id":"wp-comment-5504","title":"templatestd%3A%3Aunique_ptr%20make_unique%28%20Args%26amp%3B%26amp%3B%20...args%20%29%7B%20%20%20%20return%20std%3A%3Aunique_ptr%28%20new%20T%28%20std%3A%3Aforward%28args%29...%20%29%20%29%3B%7DHerb%2C%20I%20have%20this%20etched%20into%20my%20future%20template%20trinkets%2C%20but%20sadly%20VC...","permalink":"https:\/\/herbsutter.com\/gotw\/_102\/#comment-5504","item_id":"_comm_5504"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_5504 == 'undefined' ){PDRTJS_468178_comm_5504 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_5504 );}}PDRTJS_settings_468178_comm_5384={"id":468178,"unique_id":"wp-comment-5384","title":"This%20is%20a%20great%20solution%20to%20this%20subtle%20problem%20...%20Thanks....","permalink":"https:\/\/herbsutter.com\/gotw\/_102\/#comment-5384","item_id":"_comm_5384"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_5384 == 'undefined' ){PDRTJS_468178_comm_5384 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_5384 );}}PDRTJS_settings_468178_comm_5247={"id":468178,"unique_id":"wp-comment-5247","title":"%40Mateusz%3A%20see%20my%20blog%20posting%20of%20May%202010%20%26ldquo%3BC%2B%2B98%20constructor%20arguments%20forwarding%26rdquo%3B%20%28%26lt%3Ba%20href%3D%26quot%3Bhttp%3A%2F%2Falfps.wordpress.com%2F2010%2F05%2F15%2Fcppx-c98-constructor-arguments-forwarding-v2-posting...","permalink":"https:\/\/herbsutter.com\/gotw\/_102\/#comment-5247","item_id":"_comm_5247"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_5247 == 'undefined' ){PDRTJS_468178_comm_5247 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_5247 );}}PDRTJS_settings_468178_comm_5243={"id":468178,"unique_id":"wp-comment-5243","title":"%40Mateusz%3A%20for%20C%2B%2B03%20techniques%2C%20see%20my%20%26lt%3Ba%20href%3D%26quot%3Bhttp%3A%2F%2Falfps.wordpress.com%2F2010%2F05%2F15%2Fcppx-c98-constructor-arguments-forwarding-v2-posting%2F%230x_standard_forwarding_example%26quot%3B%20rel%3D%26quot%3Bnofollow%26quot%3B%26gt%3Bblog%20pos...","permalink":"https:\/\/herbsutter.com\/gotw\/_102\/#comment-5243","item_id":"_comm_5243"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_5243 == 'undefined' ){PDRTJS_468178_comm_5243 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_5243 );}}PDRTJS_settings_468178_comm_5241={"id":468178,"unique_id":"wp-comment-5241","title":"%40herb%3A%20Could%20you%20please%20provide%20information%20how%20to%20implement%20make_unique%20in%20a%20correct%20way%20in%20VS2010%20and%20VS2011%3FThanksMat...","permalink":"https:\/\/herbsutter.com\/gotw\/_102\/#comment-5241","item_id":"_comm_5241"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_5241 == 'undefined' ){PDRTJS_468178_comm_5241 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_5241 );}}PDRTJS_settings_468178_comm_4730={"id":468178,"unique_id":"wp-comment-4730","title":"%40herb%3A%20by%20%26quot%3Bfree%20function%26quot%3B%20to%20be%20replaced%20with%20a%20constructor%2C%20I%20meant%20%26lt%3Bcode%26gt%3Bmake_unique%26lt%3B%2Fcode%26gt%3B.%20Sorry%20but%20Wordpress%20is%20not%20perfect%20wrt.%20offering%20editing%20of%20user%20comments.Cheers%2C-%20Alf...","permalink":"https:\/\/herbsutter.com\/gotw\/_102\/#comment-4730","item_id":"_comm_4730"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_4730 == 'undefined' ){PDRTJS_468178_comm_4730 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_4730 );}}PDRTJS_settings_468178_comm_4729={"id":468178,"unique_id":"wp-comment-4729","title":"%40Herb%3A%20For%20%26lt%3Bcode%26gt%3Bf%26lt%3B%2Fcode%26gt%3B%20to%20be%20unsafe%20it%20is%20enough%20that%20%26lt%3Bcode%26gt%3Bf%26lt%3B%2Fcode%26gt%3B%20%26lt%3Bem%26gt%3Bcan%26lt%3B%2Fem%26gt%3B%20be%20called%20without%20using%20%26lt%3Bcode%26gt%3Bmake_unique%26lt%3B%2Fcode%26gt%3B.Relying%20on%20the%20user%20realzing%20and%20remembering%20that%20%26lt%3Bcode%26gt%3Bmake_...","permalink":"https:\/\/herbsutter.com\/gotw\/_102\/#comment-4729","item_id":"_comm_4729"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_4729 == 'undefined' ){PDRTJS_468178_comm_4729 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_4729 );}}PDRTJS_settings_468178_comm_4727={"id":468178,"unique_id":"wp-comment-4727","title":"%40Chris%20-%20The%20point%20that%20confuses%20me%20about%201%28b%29%20is%20this%3A%20%26quot%3BFor%20example%2C%20no%20part%20of%20the%20evaluation%20of%20expr2%20or%20any%20of%20the%20execution%20of%20h%20may%20occur%20from%20the%20time%20g%20begins%20until%20it%20ends%26quot%3B.Consider%20an%20e...","permalink":"https:\/\/herbsutter.com\/gotw\/_102\/#comment-4727","item_id":"_comm_4727"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_4727 == 'undefined' ){PDRTJS_468178_comm_4727 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_4727 );}}PDRTJS_settings_468178_comm_4726={"id":468178,"unique_id":"wp-comment-4726","title":"%40Michael%20-%20Yes%2C%20g%28%20expr1%20%29%20is%20still%20an%20expression%20in%20its%20own%20right.%20However%2C%20the%20key%20here%20is%20that%20before%20each%20function%20call%20all%20parameters%20must%20be%20fully%20evaluated.f%28%20g%28%20expr1%20%29%2C%20h%28%20expr2%20%29%20%29%3Bg%20an...","permalink":"https:\/\/herbsutter.com\/gotw\/_102\/#comment-4726","item_id":"_comm_4726"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_4726 == 'undefined' ){PDRTJS_468178_comm_4726 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_4726 );}}PDRTJS_settings_468178_comm_4719={"id":468178,"unique_id":"wp-comment-4719","title":"%40Alf%20-%20I%20can%26%23039%3Bt%20see%20your%20original%20solution%20you%20refer%20to%3B%20could%20you%20repost%20or%20clarify%20here%20please%3F%20I%20cannot%20see%20why%20f%28%29%20would%20be%20unsafe%20if%20it%20is%20accepting%202%20unique_ptr%20arguments...unless%20you%20mean%20t...","permalink":"https:\/\/herbsutter.com\/gotw\/_102\/#comment-4719","item_id":"_comm_4719"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_4719 == 'undefined' ){PDRTJS_468178_comm_4719 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_4719 );}}PDRTJS_settings_468178_comm_4713={"id":468178,"unique_id":"wp-comment-4713","title":"Blog%20software%20ate%20all%20angle%20brackets.%20Here%20is%20pastebin%20version%3A%20http%3A%2F%2Fpastebin.com%2FufRE5Snj%20....","permalink":"https:\/\/herbsutter.com\/gotw\/_102\/#comment-4713","item_id":"_comm_4713"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_4713 == 'undefined' ){PDRTJS_468178_comm_4713 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_4713 );}}PDRTJS_settings_468178_comm_4712={"id":468178,"unique_id":"wp-comment-4712","title":"Just%20checked%20both%20GCC%20and%20MSVC2010%20--%20in%20both%20cases%20adding%20make_unique%20causes%20magic%20of%20RVO%20to%20disappear.%20I%20suspect%20this%20has%20something%20to%20do%20with%20the%20fact%20that%20to%20allocate%20an%20object%20we%20use%20%26%23039%3Bstatem...","permalink":"https:\/\/herbsutter.com\/gotw\/_102\/#comment-4712","item_id":"_comm_4712"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_4712 == 'undefined' ){PDRTJS_468178_comm_4712 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_4712 );}}PDRTJS_settings_468178_comm_4709={"id":468178,"unique_id":"wp-comment-4709","title":"As%20I%20discussed%20in%20my%20proposed%20solution%2C%20while%20the%20%26lt%3Bem%26gt%3Bcall%26lt%3B%2Fem%26gt%3B%20to%20%26lt%3Bcode%26gt%3Bf%26lt%3B%2Fcode%26gt%3B%20is%20now%20safe%20enough%2C%20%26lt%3Bcode%26gt%3Bf%26lt%3B%2Fcode%26gt%3B%20is%20still%20as%20unsafe%20as%20ever.It%20is%20still%20not%20just%20possible%2C%20but%20%26lt%3Bem%26gt%3Bmost%20natural...","permalink":"https:\/\/herbsutter.com\/gotw\/_102\/#comment-4709","item_id":"_comm_4709"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_4709 == 'undefined' ){PDRTJS_468178_comm_4709 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_4709 );}}PDRTJS_settings_468178_comm_4708={"id":468178,"unique_id":"wp-comment-4708","title":"As%20I%20discussed%20in%20my%20proposed%20solution%2C%20while%20the%20%26lt%3Bem%26gt%3Bcall%26lt%3B%2Fem%26gt%3B%20to%20%26lt%3Bcode%26gt%3Bf%26lt%3B%2Fcode%26gt%3B%20is%20now%20safe%20enough%2C%20%26lt%3Bcode%26gt%3Bf%26lt%3B%2Fcode%26gt%3B%20is%20still%20as%20unsafe%20as%20ever.It%20is%20still%20not%20just%20possible%2C%20but%20%26lt%3Bem%26gt%3Bmost%20natural...","permalink":"https:\/\/herbsutter.com\/gotw\/_102\/#comment-4708","item_id":"_comm_4708"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_4708 == 'undefined' ){PDRTJS_468178_comm_4708 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_4708 );}}PDRTJS_settings_468178_comm_4706={"id":468178,"unique_id":"wp-comment-4706","title":"Correction%3A%20you%20should%20end%20up%20with%20unnecessary%20move%20constructor%20call%20%28assuming%20your%20class%20has%20it%29.%20It%20is%20better%2C%20but%20still%20an%20unnecessary%20overhead....","permalink":"https:\/\/herbsutter.com\/gotw\/_102\/#comment-4706","item_id":"_comm_4706"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_4706 == 'undefined' ){PDRTJS_468178_comm_4706 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_4706 );}}PDRTJS_settings_468178_comm_4705={"id":468178,"unique_id":"wp-comment-4705","title":"I%20might%20be%20wrong%2C%20but%20there%20is%20an%20unfortunate%20side%20effect%20of%20%26%23039%3Bmake_unique%26%23039%3B%20trick%3A-%20normally%20this%20construct%20utilizes%20RVO%20and%20avoids%20calling%20copy%20constructor%3A%20%20%20%20MyType%20foo%28%29%20%7B%20return%20MyType%28...%29%3B%20...","permalink":"https:\/\/herbsutter.com\/gotw\/_102\/#comment-4705","item_id":"_comm_4705"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_4705 == 'undefined' ){PDRTJS_468178_comm_4705 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_4705 );}}PDRTJS_settings_468178_comm_4703={"id":468178,"unique_id":"wp-comment-4703","title":"Why%20is%20there%20any%20difference%20between%201%28a%29%20and%201%28b%29%3F%20Is%20wrapping%20an%20expression%20into%20a%20function%20call%20makes%20it%20a%20non-expression%3F%20I.e.%20is%20g%28%20expr1%20%29%20not%20an%20expression%20in%20its%20own%20right%3F...","permalink":"https:\/\/herbsutter.com\/gotw\/_102\/#comment-4703","item_id":"_comm_4703"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_4703 == 'undefined' ){PDRTJS_468178_comm_4703 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_4703 );}}PDRTJS_settings_468178_comm_4700={"id":468178,"unique_id":"wp-comment-4700","title":"Wow.%20Thanks%20a%20lot%21...","permalink":"https:\/\/herbsutter.com\/gotw\/_102\/#comment-4700","item_id":"_comm_4700"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_4700 == 'undefined' ){PDRTJS_468178_comm_4700 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_4700 );}}PDRTJS_settings_468178_comm_4696={"id":468178,"unique_id":"wp-comment-4696","title":"Thanks%2C%20learned%20a%20lot....","permalink":"https:\/\/herbsutter.com\/gotw\/_102\/#comment-4696","item_id":"_comm_4696"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_4696 == 'undefined' ){PDRTJS_468178_comm_4696 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_4696 );}}PDRTJS_settings_468178_comm_4690={"id":468178,"unique_id":"wp-comment-4690","title":"%26%23091%3B...%26%23093%3B%20The%20solution%20to%20GotW%20%23102%20is%20now%20live.%20Share%20this%3AEmailRedditTwitter%20%26%23091%3B...%26%23093%3B...","permalink":"https:\/\/herbsutter.com\/gotw\/_102\/#comment-4690","item_id":"_comm_4690"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_4690 == 'undefined' ){PDRTJS_468178_comm_4690 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_4690 );}}
//--><!]]></script><script type='text/javascript' charset='UTF-8' src='https://polldaddy.com/js/rating/rating.js'></script><script type='text/javascript' src='https://platform.twitter.com/widgets.js?ver=20111117'></script>
<script type='text/javascript' src='https://s0.wp.com/_static/??-eJzTLy/QTc7PK0nNK9EvyClNz8wr1i+uzCtJrMjITM/IAeKS1CJMEWP94uSizIISoOIM5/yiVL2sYh19yo1yKioFmldQQE3jAnISM/OABtrn2hqaGBkZmxgZGptkAQB2YF92'></script>
<script type='text/javascript'>
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "https://s1.wp.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.9b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "https://s2.wp.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?m=1363304414h&amp;ver=3.0.9b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.defaults['toolbar'] = false;
	SyntaxHighlighter.all();

	// Infinite scroll support
	if ( typeof( jQuery ) !== 'undefined' ) {
		jQuery( function( $ ) {
			$( document.body ).on( 'post-load', function() {
				SyntaxHighlighter.highlight();
			} );
		} );
	}
</script>
<script type='text/javascript'>
/* <![CDATA[ */
var actionbardata = {"siteID":"3379246","siteName":"Sutter\u2019s Mill","siteURL":"https:\/\/herbsutter.com","icon":"<img alt='' src='https:\/\/secure.gravatar.com\/blavatar\/4554b8d24c7f200dc5e2e1b18db1893f?s=50&d=https%3A%2F%2Fs2.wp.com%2Fi%2Flogo%2Fwpcom-gray-white.png' class='avatar avatar-50' height='50' width='50' \/>","canManageOptions":"","canCustomizeSite":"","isFollowing":"","themeSlug":"pub\/mistylook","signupURL":"https:\/\/wordpress.com\/start\/","loginURL":"https:\/\/herbsutter.wordpress.com\/wp-login.php?redirect_to=https%3A%2F%2Fherbsutter.com%2Fgotw%2F_102%2F","themeURL":"","xhrURL":"https:\/\/herbsutter.com\/wp-admin\/admin-ajax.php","nonce":"8fb9818ae2","isSingular":"1","isFolded":"","isLoggedIn":"","isMobile":"","subscribeNonce":"<input type=\"hidden\" id=\"_wpnonce\" name=\"_wpnonce\" value=\"4590924cc6\" \/>","referer":"https:\/\/herbsutter.com\/gotw\/_102\/","canFollow":"1","feedID":"171936","statusMessage":"","customizeLink":"https:\/\/herbsutter.wordpress.com\/wp-admin\/customize.php?url=https%3A%2F%2Fherbsutter.wordpress.com%2Fgotw%2F_102%2F","postID":"1327","shortlink":"https:\/\/wp.me\/Peb5Y-lp","canEditPost":"","editLink":"https:\/\/wordpress.com\/page\/herbsutter.com\/1327","statsLink":"https:\/\/wordpress.com\/stats\/post\/1327\/herbsutter.com","i18n":{"view":"View site","follow":"Follow","following":"Following","edit":"Edit","login":"Log in","signup":"Sign up","customize":"Customize","report":"Report this content","themeInfo":"Get theme: MistyLook","shortlink":"Copy shortlink","copied":"Copied","followedText":"New posts from this site will now appear in your <a href=\"https:\/\/wordpress.com\/\">Reader<\/a>","foldBar":"Collapse this bar","unfoldBar":"Expand this bar","editSubs":"Manage subscriptions","viewReader":"View site in Reader","viewReadPost":"View post in Reader","subscribe":"Sign me up","enterEmail":"Enter your email address","followers":"Join 19,532 other followers","alreadyUser":"Already have a WordPress.com account? <a href=\"https:\/\/herbsutter.wordpress.com\/wp-login.php?redirect_to=https%3A%2F%2Fherbsutter.com%2Fgotw%2F_102%2F\">Log in now.<\/a>","stats":"Stats"}};
/* ]]> */
</script>
<script type='text/javascript' src='https://s0.wp.com/_static/??-eJyVjcEOgjAQRH/IuoIYT8Zvqe2GLrQLdlvAv7ceJEYTEg+bTGbe7MA8KjNwQk7QCVicyOC47DvZwUcUshp9bokFPPUocM+Y0Wm2HuM3/CblwUkvjlrnyyWMv87GjraBWN10hKCloEWpYcIYyZb91fvzQ4ra9LJVMokGfpVWVehruFSnujo0x+Zcd0+y+3Rn'></script>
<script type="text/javascript">
// <![CDATA[
(function() {
try{
  if ( window.external &&'msIsSiteMode' in window.external) {
    if (window.external.msIsSiteMode()) {
      var jl = document.createElement('script');
      jl.type='text/javascript';
      jl.async=true;
      jl.src='/wp-content/plugins/ie-sitemode/custom-jumplist.php';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(jl, s);
    }
  }
}catch(e){}
})();
// ]]>
</script><script src="//stats.wp.com/w.js?56" type="text/javascript" async defer></script>
<script type="text/javascript">
_tkq = window._tkq || [];
_stq = window._stq || [];
_tkq.push(['storeContext', {'blog_id':'3379246','blog_tz':'-8','user_lang':'en','blog_lang':'en','user_id':'0'}]);
_stq.push(['view', {'blog':'3379246','v':'wpcom','tz':'-8','user_id':'0','post':'1327','subd':'herbsutter'}]);
_stq.push(['extra', {'crypt':'UE40eW5QN0p8M2Y/RE1TaVhzUzFMbjdWNHpwZGhTayxPSUFCMGNrd29+Smw0TDhnZmRTK0hlRi9QSGh6bi9GXVhBJWIlZlR5U1JMLU8/MkNtblkvY1d1TjBELytHc0k/MXdHUVQyK2IyUVA5SjU1bj9VX3ExLHYsREFpcnlfNHYtXV1HSUIsLkJrcnp0eS5sNDN2N2dXb1twWGVNSz9OZCUlN0tDNVplb2djandObz9sLG9xW1ZYJWUtb2NNMEtZSER2UzU1MUtqcG9uNW94ZnZyTFFlck9zY11qXVE0Q2ZHOUdzUktSWmUmLldEX3dhRl1Cc2I/bFREJTE4MV9HUzBvODVndV1IbiV3UlF2K19DR3ZFTkd0N3krVEJyQjFSPV9CblI9dVI5SGRhZEpiYzFsbV89RTk2JSZuQUFkcw=='}]);
_stq.push([ 'clickTrackerInit', '3379246', '1327' ]);
	</script>
<noscript><img src="https://pixel.wp.com/b.gif?v=noscript" style="height:0px;width:0px;overflow:hidden" alt="" /></noscript>
<script>
if ( 'object' === typeof wpcom_mobile_user_agent_info ) {

	wpcom_mobile_user_agent_info.init();
	var mobileStatsQueryString = "";
	
	if( false !== wpcom_mobile_user_agent_info.matchedPlatformName )
		mobileStatsQueryString += "&x_" + 'mobile_platforms' + '=' + wpcom_mobile_user_agent_info.matchedPlatformName;
	
	if( false !== wpcom_mobile_user_agent_info.matchedUserAgentName )
		mobileStatsQueryString += "&x_" + 'mobile_devices' + '=' + wpcom_mobile_user_agent_info.matchedUserAgentName;
	
	if( wpcom_mobile_user_agent_info.isIPad() )
		mobileStatsQueryString += "&x_" + 'ipad_views' + '=' + 'views';

	if( "" != mobileStatsQueryString ) {
		new Image().src = document.location.protocol + '//pixel.wp.com/g.gif?v=wpcom-no-pv' + mobileStatsQueryString + '&baba=' + Math.random();
	}
	
}
</script></body>
</html>
<!--
	generated in 0.166 seconds
	112579 bytes batcached for 300 seconds
-->
