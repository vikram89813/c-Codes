<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Effective Concurrency: Associate Mutexes with Data to Prevent Races | Sutter’s Mill</title>
<link rel="pingback" href="https://herbsutter.com/xmlrpc.php" />
<script type="text/javascript">
  WebFontConfig = {"typekit":{"id":"eyo0tqd"}};
  (function() {
    var wf = document.createElement('script');
    wf.src = 'https://s0.wp.com/wp-content/plugins/custom-fonts/js/webfont.js';
    wf.type = 'text/javascript';
    wf.async = 'true';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(wf, s);
	})();
</script><style id="jetpack-custom-fonts-css">.wf-active #header h1{font-size:2.12em;font-family:"ff-dagny-web-pro-1","ff-dagny-web-pro-2",sans-serif;font-style:normal;font-weight:400}.wf-active body{font-size:89.7%;font-family:"ff-basic-gothic-web-pro-1","ff-basic-gothic-web-pro-2",sans-serif}.wf-active #navigation{font-family:"ff-basic-gothic-web-pro-1","ff-basic-gothic-web-pro-2",sans-serif}.wf-active #navigation ul li.search{font-size:1.06em}.wf-active #navigation ul li.search input#searchsubmit{font-size:1.06em}.wf-active #content .post-info, .wf-active #content .postmetadata{font-size:1.06em}.wf-active #sidebar{font-size:1.06em}.wf-active #footer p.right{font-size:1.06em}.wf-active .commentnum{font-size:1.77em}.wf-active .commentlist li .cmtinfo{font-size:1.18em}.wf-active .commentlist li .cmtinfo em{font-size:1.06em}.wf-active #respond label{font-size:11.8px}.wf-active #respond .required{font-size:11.8px}.wf-active #respond .subscribe-label{font-size:14.2px}.wf-active #respond .comment-notes{font-size:13px}.wf-active .wp-caption p.wp-caption-text{font-size:13px}.wf-active #content h1, .wf-active h2, .wf-active h3, .wf-active h4, .wf-active h5, .wf-active h6{font-family:"ff-dagny-web-pro-1","ff-dagny-web-pro-2",sans-serif;font-style:normal;font-weight:400}.wf-active #header h2{font-size:1.18em;font-weight:400;font-family:"ff-dagny-web-pro-1","ff-dagny-web-pro-2",sans-serif;font-style:normal}.wf-active #content h3{font-size:1.65em;font-weight:400;font-style:normal}.wf-active #content h4{font-size:1.3em;font-style:normal;font-weight:400}.wf-active #content h5{font-size:1.18em;font-style:normal;font-weight:400}.wf-active #content .post h2{font-size:1.65em;font-weight:400;font-style:normal}.wf-active li.sidebox h2{font-weight:400;font-size:1.89em;font-style:normal}.wf-active .post h4{font-size:1.18em;font-weight:400;font-family:"ff-dagny-web-pro-1","ff-dagny-web-pro-2",sans-serif;font-style:normal}.wf-active .post h4 em{font-style:normal;font-weight:400}</style>
		<script src='https://r-login.wordpress.com/remote-login.php?action=js&amp;host=herbsutter.com&amp;id=3379246&amp;t=1542965658&amp;back=https%3A%2F%2Fherbsutter.com%2F2010%2F05%2F24%2Feffective-concurrency-associate-mutexes-with-data-to-prevent-races%2F' type="text/javascript"></script>
		<script type="text/javascript">
		/* <![CDATA[ */
			if ( 'function' === typeof WPRemoteLogin ) {
				document.cookie = "wordpress_test_cookie=test; path=/";
				if ( document.cookie.match( /(;|^)\s*wordpress_test_cookie\=/ ) ) {
					WPRemoteLogin();
				}
			}
		/* ]]> */
		</script>
		<link rel='dns-prefetch' href='//s2.wp.com' />
<link rel='dns-prefetch' href='//s0.wp.com' />
<link rel='dns-prefetch' href='//s1.wp.com' />
<link rel='dns-prefetch' href='//herbsutter.wordpress.com' />
<link rel="alternate" type="application/rss+xml" title="Sutter’s Mill &raquo; Feed" href="https://herbsutter.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="Sutter’s Mill &raquo; Comments Feed" href="https://herbsutter.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Sutter’s Mill &raquo; Effective Concurrency: Associate Mutexes with Data to Prevent&nbsp;Races Comments Feed" href="https://herbsutter.com/2010/05/24/effective-concurrency-associate-mutexes-with-data-to-prevent-races/feed/" />
	<script type="text/javascript">
		/* <![CDATA[ */
		function addLoadEvent(func) {
			var oldonload = window.onload;
			if (typeof window.onload != 'function') {
				window.onload = func;
			} else {
				window.onload = function () {
					oldonload();
					func();
				}
			}
		}
		/* ]]> */
	</script>
			<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s0.wp.com\/wp-content\/mu-plugins\/wpcom-smileys\/twemoji\/2\/72x72\/","ext":".png","svgUrl":"https:\/\/s0.wp.com\/wp-content\/mu-plugins\/wpcom-smileys\/twemoji\/2\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/s1.wp.com\/wp-includes\/js\/wp-emoji-release.min.js?m=1532082729h&ver=4.9.8"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56760,9792,65039],[55358,56760,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel='stylesheet' id='all-css-0-1' href='https://s2.wp.com/_static/??-eJyNkN1uwjAMhV9onsUG69W0Z0laE0zzp8QR6tvjUlUCwSpuonOS81knxkuGPkWhKBgaZN8cx4qeR6p4JsmmH+HmPvtaP/B1nOORI8uEcqKgYG4WA1eZfErjFtinQnofspE5EWhgQ15nRNnCQv5ZqVmetORmv0vWNFibC9UKegZuAZayT9wKuabWUnEwt0Tb2A9ofbotxBZTJpx/SE8DXi3hn+h9Rx4cSUVJGXKqqt5GaurZeGCNPJoFZoxJlsdVbE11lEB/aYRTfDBw9IbLFlpI9+NUOtTUnZ2hv/C7O+y/uu9uf+jOV8Xg7sY=?cssminify=yes' type='text/css' media='all' />
<link rel='stylesheet' id='print-css-1-1' href='https://s2.wp.com/wp-content/mu-plugins/global-print/global-print.css?m=1465851035h&cssminify=yes' type='text/css' media='print' />
<link rel='stylesheet' id='all-css-2-1' href='https://s0.wp.com/_static/??/wp-content/mu-plugins/actionbar/actionbar.css,/wp-content/themes/h4/global.css?m=1516985148j&cssminify=yes' type='text/css' media='all' />
<script type='text/javascript' src='https://s0.wp.com/_static/??-eJyFztEKwjAMBdAfsquTiXsRv6XWOFKXtDbphn69HeiDMBQCgdzDJXZOBtmP5QJiQ517gfx4rybIxv4ChnDITqEh5A/2kRVYF0vxjCOYIpDdUG+16BpXXIqiBCIVraTfLyFPCPNfFkCT8zeTQfC5tJ7o2Hb9Yde3+24bXjRNW9I='></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://herbsutter.wordpress.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://s1.wp.com/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='The &ldquo;You Call This Journalism?&rdquo; Department' href='https://herbsutter.com/2010/05/07/the-you-call-this-journalism-department/' />
<link rel='next' title='C++ and Beyond: About 2/3&nbsp;Full' href='https://herbsutter.com/2010/05/28/c-and-beyond-about-23-full/' />
<meta name="generator" content="WordPress.com" />
<link rel="canonical" href="https://herbsutter.com/2010/05/24/effective-concurrency-associate-mutexes-with-data-to-prevent-races/" />
<link rel='shortlink' href='https://wp.me/peb5Y-6R' />
<link rel="alternate" type="application/json+oembed" href="https://public-api.wordpress.com/oembed/?format=json&amp;url=https%3A%2F%2Fherbsutter.com%2F2010%2F05%2F24%2Feffective-concurrency-associate-mutexes-with-data-to-prevent-races%2F&amp;for=wpcom-auto-discovery" /><link rel="alternate" type="application/xml+oembed" href="https://public-api.wordpress.com/oembed/?format=xml&amp;url=https%3A%2F%2Fherbsutter.com%2F2010%2F05%2F24%2Feffective-concurrency-associate-mutexes-with-data-to-prevent-races%2F&amp;for=wpcom-auto-discovery" />
<!-- Jetpack Open Graph Tags -->
<meta property="og:type" content="article" />
<meta property="og:title" content="Effective Concurrency: Associate Mutexes with Data to Prevent Races" />
<meta property="og:url" content="https://herbsutter.com/2010/05/24/effective-concurrency-associate-mutexes-with-data-to-prevent-races/" />
<meta property="og:description" content="This month’s Effective Concurrency column, Associate Mutexes with Data to Prevent Races”, is now live on DDJ’s website. From the article: Come together: Associate mutexes with the data they protect…" />
<meta property="article:published_time" content="2010-05-24T20:36:57+00:00" />
<meta property="article:modified_time" content="2010-05-24T20:39:07+00:00" />
<meta property="og:site_name" content="Sutter’s Mill" />
<meta property="og:image" content="https://secure.gravatar.com/blavatar/4554b8d24c7f200dc5e2e1b18db1893f?s=200&amp;ts=1542965658" />
<meta property="og:image:width" content="200" />
<meta property="og:image:height" content="200" />
<meta property="og:locale" content="en_US" />
<meta name="twitter:site" content="@wordpressdotcom" />
<meta name="twitter:text:title" content="Effective Concurrency: Associate Mutexes with Data to Prevent&nbsp;Races" />
<meta name="twitter:image" content="https://secure.gravatar.com/blavatar/4554b8d24c7f200dc5e2e1b18db1893f?s=240" />
<meta name="twitter:card" content="summary" />
<meta property="article:publisher" content="https://www.facebook.com/WordPresscom" />

<!-- End Jetpack Open Graph Tags -->
<link rel="shortcut icon" type="image/x-icon" href="https://secure.gravatar.com/blavatar/4554b8d24c7f200dc5e2e1b18db1893f?s=32" sizes="16x16" />
<link rel="icon" type="image/x-icon" href="https://secure.gravatar.com/blavatar/4554b8d24c7f200dc5e2e1b18db1893f?s=32" sizes="16x16" />
<link rel="apple-touch-icon-precomposed" href="https://secure.gravatar.com/blavatar/4554b8d24c7f200dc5e2e1b18db1893f?s=114" />
<link rel='openid.server' href='https://herbsutter.wordpress.com/?openidserver=1' />
<link rel='openid.delegate' href='https://herbsutter.wordpress.com/' />
<link rel="search" type="application/opensearchdescription+xml" href="https://herbsutter.com/osd.xml" title="Sutter’s Mill" />
<link rel="search" type="application/opensearchdescription+xml" href="https://s1.wp.com/opensearch.xml" title="WordPress.com" />
		<style id="wpcom-hotfix-masterbar-style">
			@media screen and (min-width: 783px) {
				#wpadminbar .quicklinks li#wp-admin-bar-my-account.with-avatar > a img {
					margin-top: 5px;
				}
			}
		</style>
		<script type="text/javascript" id="webfont-output">
  
  WebFontConfig = {"typekit":{"id":"cjs1oxc"}};
  (function() {
    var wf = document.createElement('script');
    wf.src = ('https:' == document.location.protocol ? 'https' : 'http') +
      '://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';
    wf.type = 'text/javascript';
    wf.async = 'true';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(wf, s);
	})();
</script><style type="text/css">
.widget_twitter li {
	word-wrap: break-word;
}
</style>
<meta name="application-name" content="Sutter’s Mill" /><meta name="msapplication-window" content="width=device-width;height=device-height" /><meta name="msapplication-tooltip" content="Herb Sutter on software development" /><meta name="msapplication-task" content="name=Subscribe;action-uri=https://herbsutter.com/feed/;icon-uri=https://secure.gravatar.com/blavatar/4554b8d24c7f200dc5e2e1b18db1893f?s=16" /><meta name="msapplication-task" content="name=Sign up for a free blog;action-uri=http://wordpress.com/signup/;icon-uri=https://s1.wp.com/i/favicon.ico" /><meta name="msapplication-task" content="name=WordPress.com Support;action-uri=http://support.wordpress.com/;icon-uri=https://s1.wp.com/i/favicon.ico" /><meta name="msapplication-task" content="name=WordPress.com Forums;action-uri=http://forums.wordpress.com/;icon-uri=https://s1.wp.com/i/favicon.ico" /><meta name="description" content="This month’s Effective Concurrency column, Associate Mutexes with Data to Prevent Races”, is now live on DDJ’s website. From the article: Come together: Associate mutexes with the data they protect, and you can make your code race-free by construction Race conditions are one of the worst plagues of concurrent code: They can cause disastrous effects&hellip;" />
<style type="text/css">
			#header h1 a,
		#header h2 {
			color: #265E15 !important;
		}
				#headerimage {
			background: url('https://herbsutter.files.wordpress.com/2011/10/cropped-blog-header.jpg') no-repeat;
			height: 200px;
		}
	</style>
<link rel="amphtml" href="https://herbsutter.com/2010/05/24/effective-concurrency-associate-mutexes-with-data-to-prevent-races/amp/"><style type="text/css" id="syntaxhighlighteranchor"></style>
		<link rel="stylesheet" id="custom-css-css" type="text/css" href="https://s2.wp.com/?custom-css=1&#038;csblog=eb5Y&#038;cscache=6&#038;csrev=60" />
		</head>
<body id="section-index" class="post-template-default single single-post postid-425 single-format-standard mp6 customizer-styles-applied highlander-enabled highlander-light">


<div id="navigation" class="clearfix">
		<div class="menu">
		<ul>
			<li ><a href="https://herbsutter.com/" title="Home">Home</a></li>
			<li class="page_item page-item-912"><a href="https://herbsutter.com/welcome-to-the-jungle/">Welcome to the&nbsp;Jungle</a></li>
<li class="page_item page-item-864 page_item_has_children"><a href="https://herbsutter.com/gotw/">GotW</a></li>
<li class="page_item page-item-761"><a href="https://herbsutter.com/elements-of-modern-c-style/">Elements of Modern C++&nbsp;Style</a></li>
<li class="page_item page-item-2 page_item_has_children"><a href="https://herbsutter.com/about/">About</a></li>
									<li class="search"><form method="get" id="searchform" action="https://herbsutter.com"><input type="text" class="textbox" value="" name="s" id="s" /><input type="submit" id="searchsubmit" value="Search" /></form></li>
					</ul>
	</div>
</div><!-- end id:navigation -->

<div id="container">

<div id="header">
<h1><a href="https://herbsutter.com/" title="Sutter’s Mill">Sutter’s Mill</a></h1>
<h2>Herb Sutter on software development</h2>
</div><!-- end id:header -->


	
		<div id="feedarea">
	<dl>
		<dt><strong>Feeds:</strong></dt>

			<dd><a href="https://herbsutter.com/feed/">Posts</a></dd>
	
			<dd><a href="https://herbsutter.com/comments/feed/">Comments</a></dd>
		</dl>
	</div><!-- end id:feedarea -->
	
	<div id="headerimage">
</div><!-- end id:headerimage -->

<div id="content">
<div id="content-main">

		
									<div class="postnav">
				<div class="alignleft">&laquo; <a href="https://herbsutter.com/2010/05/07/the-you-call-this-journalism-department/" rel="prev">The &ldquo;You Call This Journalism?&rdquo; Department</a></div>
				<div class="alignright"><a href="https://herbsutter.com/2010/05/28/c-and-beyond-about-23-full/" rel="next">C++ and Beyond: About 2/3&nbsp;Full</a> &raquo;</div>
			</div>
			
			<div class="post-425 post type-post status-publish format-standard hentry category-concurrency category-software-development" id="post-425">
				<div class="posttitle">
					<h2>Effective Concurrency: Associate Mutexes with Data to Prevent&nbsp;Races</h2>
					<p class="post-info">2010-05-24 by <a href="https://herbsutter.com/author/herbsutter/" title="Posts by Herb Sutter">Herb Sutter</a>  </p>
				</div>

				<div class="entry">
					<p>This month’s <strong>Effective Concurrency</strong> column, <a href="http://www.drdobbs.com/go-parallel/article/showArticle.jhtml?articleID=224701827">Associate Mutexes with Data to Prevent Races”</a>, is now live on DDJ’s website.</p>
<p>From the article:</p>
<blockquote>
<p><em>Come together: Associate mutexes with the data they protect, and you can make your code race-free by construction</em></p>
<p>Race conditions are one of the worst plagues of concurrent code: They can cause disastrous effects all the way up to undefined behavior and random code execution, yet they&#8217;re hard to discover reliably during testing, hard to reproduce when they do occur, and the icing on the cake is that we have immature and inadequate race detection and prevention tool support available today.</p>
<p>The holy grail of the Consistency pillar is to make a concurrent program race-free and deadlock-free by construction. … This article shows how to achieve the &quot;race-free by construction&quot; grail via sound engineering, with automatic and deterministic race identification at test time based on code coverage alone.</p>
</blockquote>
<p>I hope you enjoy it. Finally, here are links to previous Effective Concurrency columns:</p>
<blockquote>
<p>1 <a href="http://www.ddj.com/hpc-high-performance-computing/200001985">The Pillars of Concurrency</a> (Aug 2007) </p>
<p>2 <a href="http://www.ddj.com/hpc-high-performance-computing/201202924">How Much Scalability Do You Have or Need?</a> (Sep 2007) </p>
<p>3 <a href="http://ddj.com/cpp/201804238">Use Critical Sections (Preferably Locks) to Eliminate Races</a> (Oct 2007) </p>
<p>4 <a href="http://www.ddj.com/hpc-high-performance-computing/202401098">Apply Critical Sections Consistently</a> (Nov 2007) </p>
<p>5 <a href="http://ddj.com/architect/202802983">Avoid Calling Unknown Code While Inside a Critical Section</a> (Dec 2007) </p>
<p>6 <a href="http://www.ddj.com/hpc-high-performance-computing/204801163">Use Lock Hierarchies to Avoid Deadlock</a> (Jan 2008) </p>
<p>7 <a href="http://www.ddj.com/cpp/205900309">Break Amdahl’s Law!</a> (Feb 2008) </p>
<p>8 <a href="http://www.ddj.com/hpc-high-performance-computing/206100542">Going Superlinear</a> (Mar 2008) </p>
<p>9 <a href="http://www.ddj.com/hpc-high-performance-computing/206903306">Super Linearity and the Bigger Machine</a> (Apr 2008) </p>
<p>10 <a href="http://ddj.com/architect/207100682">Interrupt Politely</a> (May 2008) </p>
<p>11 <a href="http://ddj.com/architect/208200273">Maximize Locality, Minimize Contention</a> (Jun 2008) </p>
<p>12 <a href="http://www.ddj.com/hpc-high-performance-computing/208801371">Choose Concurrency-Friendly Data Structures</a> (Jul 2008) </p>
<p>13 <a href="http://www.ddj.com/hpc-high-performance-computing/209900973">The Many Faces of Deadlock</a> (Aug 2008) </p>
<p>14 <a href="http://www.ddj.com/cpp/210600279">Lock-Free Code: A False Sense of Security</a> (Sep 2008) </p>
<p>15 <a href="http://www.ddj.com/hpc-high-performance-computing/210604448">Writing Lock-Free Code: A Corrected Queue</a> (Oct 2008) </p>
<p>16 <a href="http://www.ddj.com/cpp/211601363">Writing a Generalized Concurrent Queue</a> (Nov 2008) </p>
<p>17 <a href="http://www.ddj.com/cpp/211800538">Understanding Parallel Performance</a> (Dec 2008)</p>
<p>18 <a href="http://www.ddj.com/hpc-high-performance-computing/212201163">Measuring Parallel Performance: Optimizing a Concurrent Queue</a> (Jan 2009)</p>
<p>19 <a href="http://www.ddj.com/hpc-high-performance-computing/212701484">volatile vs. volatile</a> (Feb 2009)</p>
<p>20 <a href="http://www.ddj.com/go-parallel/article/showArticle.jhtml?articleID=214100002">Sharing Is the Root of All Contention</a> (Mar 2009)</p>
<p>21 <a href="http://www.ddj.com/go-parallel/article/showArticle.jhtml?articleID=215900465">Use Threads Correctly = Isolation + Asynchronous Messages</a> (Apr 2009)</p>
<p>22 <a href="http://www.ddj.com/go-parallel/article/showArticle.jhtml?articleID=216500409">Use Thread Pools Correctly: Keep Tasks Short and Nonblocking</a> (Apr 2009)</p>
<p>23 <a href="http://www.ddj.com/go-parallel/article/showArticle.jhtml?articleID=217500206">Eliminate False Sharing</a> (May 2009)</p>
<p>24 <a href="http://www.ddj.com/go-parallel/article/showArticle.jhtml?articleID=217801299">Break Up and Interleave Work to Keep Threads Responsive</a> (Jun 2009)</p>
<p>25 <a href="http://www.ddj.com/go-parallel/article/showArticle.jhtml?articleID=218401447">The Power of “In Progress”</a> (Jul 2009)</p>
<p>26 <a href="http://www.ddj.com/go-parallel/article/showArticle.jhtml?articleID=219200099">Design for Manycore Systems</a> (Aug 2009)</p>
<p>27 <a href="http://www.ddj.com/go-parallel/article/showArticle.jhtml?articleID=220600388">Avoid Exposing Concurrency – Hide It Inside Synchronous Methods</a> (Oct 2009)</p>
<p>28 <a href="http://www.ddj.com/go-parallel/article/showArticle.jhtml?articleID=221601309">Prefer structured lifetimes – local, nested, bounded, deterministic</a> (Nov 2009)</p>
<p>29 <a href="http://www.ddj.com/go-parallel/article/showArticle.jhtml?articleID=222301165">Prefer Futures to Baked-In “Async APIs”</a> (Jan 2010)</p>
<p>30 <a href="http://www.drdobbs.com/go-parallel/article/showArticle.jhtml?articleID=224701827">Associate Mutexes with Data to Prevent Races</a> (May 2010)</p>
</blockquote>
									</div>

				<p class="postmetadata">
					Posted in <a href="https://herbsutter.com/category/concurrency/" rel="category tag">Concurrency</a>, <a href="https://herbsutter.com/category/software-development/" rel="category tag">Software Development</a> | 											10 Comments									</p>
				
<!-- You can start editing here. -->

<h3 id="comments">10 Responses</h3>

	<ol class="commentlist">
			<li class="pingback even thread-even depth-1 highlander-comment" id="comment-2266">
		<div id="div-comment-2266">
		<div class="cmtinfo"><em> on <a href="#comment-2266" title="">2010-09-05 at 10:08 pm</a></em>  <cite><a href='http://toddseiler.com/wordpress/?p=31' rel='external nofollow' class='url'>Todd Seiler &raquo; Concurrency &amp; Parallelism</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_2266"></div><p>[&#8230;] Multicore Articles <a href="http://docs.sun.com/app/docs/doc/816-5137" rel="nofollow">http://docs.sun.com/app/docs/doc/816-5137</a> <a href="https://herbsutter.com/2010/05/24/effective-concurrency-associate-mutexes-with-data-to-prevent-races/" rel="nofollow">https://herbsutter.com/2010/05/24/effective-concurrency-associate-mutexes-with-data-to-prevent-races/</a> <a href="http://msdn.microsoft.com/en-us/library/ee416321.aspx" rel="nofollow">http://msdn.microsoft.com/en-us/library/ee416321.aspx</a> [&#8230;]</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-herbsutter bypostauthor odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-2104">
		<div id="div-comment-2104">
		<div class="cmtinfo"><em> on <a href="#comment-2104" title="">2010-05-27 at 5:03 pm</a></em> <img alt='' src='https://0.gravatar.com/avatar/c0ba56bfd231f8f04feb057728975181?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://www.gotw.ca' rel='external nofollow' class='url'>Herb Sutter</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_2104"></div><p>Yes, that&#8217;s a useful technique too. The tradeoff is that you then need a special lock type; in this design I decided to illustrate the technique in a way that hooks into the C++0x standard locks so that you can write things like lock_guard&lt;Group1&gt;; (see my reply to a later comment asking about this).</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-herbsutter bypostauthor even thread-even depth-1 highlander-comment" id="comment-2103">
		<div id="div-comment-2103">
		<div class="cmtinfo"><em> on <a href="#comment-2103" title="">2010-05-27 at 5:01 pm</a></em> <img alt='' src='https://0.gravatar.com/avatar/c0ba56bfd231f8f04feb057728975181?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://www.gotw.ca' rel='external nofollow' class='url'>Herb Sutter</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_2103"></div><p>David is spot-on that you want mutexes to cover invariants, not just individual pieces of data. How to design the groups of data that should be covered by the same mutex (or, which mutexes protect which data) is the subject of another article. This article focuses only on the question of how to ensure that you then used the mutexes correctly.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-herbsutter bypostauthor odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-2102">
		<div id="div-comment-2102">
		<div class="cmtinfo"><em> on <a href="#comment-2102" title="">2010-05-27 at 4:57 pm</a></em> <img alt='' src='https://0.gravatar.com/avatar/c0ba56bfd231f8f04feb057728975181?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://www.gotw.ca' rel='external nofollow' class='url'>Herb Sutter</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_2102"></div><p>Re map: Yes, thank the Lords of Templates. For types like that, you write a typedef to get rid of the comma. Fun stuff.</p>
<p>Re lock_guard: Actually that is correct and slickly intended. The reason I wrote the group to provide lock/try_lock/unlock was specifically to make it satisfy the C++0x mutex concept, so that you can use the group itself with all the C++0x locking machinery including lock_guard&lt;Group1&gt;. Pretty snazzy, huh?</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment byuser comment-author-herbsutter bypostauthor even thread-even depth-1 highlander-comment" id="comment-2101">
		<div id="div-comment-2101">
		<div class="cmtinfo"><em> on <a href="#comment-2101" title="">2010-05-27 at 4:53 pm</a></em> <img alt='' src='https://0.gravatar.com/avatar/c0ba56bfd231f8f04feb057728975181?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://www.gotw.ca' rel='external nofollow' class='url'>Herb Sutter</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_2101"></div><p>Right, that is the other (orthogonal) issue. As mentioned in the intro, this article focuses on eliminating races by associating data with locks; the earlier article focuses on exactly the issue eliminating deadlocks by using lock ordering to ensure locks are taken in a consistent order (typically, but not only, by using lock hierarchies). </p>
<p>Both parts are necessary, and the techniques compose well.</p>
<p>In addition to races and deadlocks, there&#8217;s actually a third issue: Composability. I intend to cover that one in a future article, possibly next month&#8217;s.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-2100">
		<div id="div-comment-2100">
		<div class="cmtinfo"><em> on <a href="#comment-2100" title="">2010-05-26 at 10:24 am</a></em> <img alt='' src='https://1.gravatar.com/avatar/16b8a9971551c67422fea478a6e73bae?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>Sebastian</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_2100"></div><p>The PROTECTED_MEMBER macro won&#8217;t work for types like map &lt; int,int &gt; due to the comma. I see that you have put parenthesis around it but (map &lt; int,int &gt; ) isn&#8217;t a type, is it?</p>
<p>Also, lock_guard &lt; Group1 &gt; doesn&#8217;t seem correct. Group1 is not a mutex.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 highlander-comment" id="comment-2099">
		<div id="div-comment-2099">
		<div class="cmtinfo"><em> on <a href="#comment-2099" title="">2010-05-25 at 3:30 pm</a></em> <img alt='' src='https://0.gravatar.com/avatar/cb8fc369f939c23a8931d6bec1ec56a2?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://magiclantern.wikia.com/' rel='external nofollow' class='url'>Trammell Hudson</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_2099"></div><p>One very important topic (from the &#8220;Use Lock Hierarchies&#8221; article) that this doesn&#8217;t cover is lock ordering &#8212; if one thread calls:</p>
<p>lock_guard hold(data1);<br />
lock_guard hold(data2);</p>
<p>and another thread calls:</p>
<p>lock_guard hold(data2);<br />
lock_guard hold(data1);</p>
<p>These will be &#8220;correct&#8221; in that the testcase won&#8217;t complain, but the two threads will deadlock.  Sometimes.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-2098">
		<div id="div-comment-2098">
		<div class="cmtinfo"><em> on <a href="#comment-2098" title="">2010-05-25 at 12:53 pm</a></em> <img alt='' src='https://0.gravatar.com/avatar/3450f3b1a849d45e4e55585fc96da9f1?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>David Svoboda</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_2098"></div><p>The previous comment is spot-on. Using mutexes to protect data is a good start, but it doesn&#8217;t solve all problems. For instance, to use your &#8216;transfer-element-between-tables&#8217; example, this code:</p>
<p>  // lock mutTable1<br />
  table1.erase( x );<br />
  // unlock mutTable1<br />
  // lock mutTable2<br />
  table2.insert( x );<br />
  // unlock mutTable2</p>
<p>would pass your &#8216;protect-the-data&#8217; test. It however fails the invariant that x is in either table1 or table2. For the purposes of your program, this may not be a problem. But it may be, in which case you need some lock that protects *both* table1 and table2.  But a better way to think about it is that your mutex would guarantee that any transfer between table1 and table2 was atomic&#8230;no observer could ever see that x was neither in table1 nor table2.</p>
<p>There is a lot of research in Java about making more general locks&#8230;for instance, the @GuardedBy annotation associates locks with data (essentially your approach). See this CERT secure coding rule in Java for more information about using annotations (along with analysis tools) to eliminate race conditions:</p>
<p><a href="https://www.securecoding.cert.org/confluence/x/cwCMAg" rel="nofollow">https://www.securecoding.cert.org/confluence/x/cwCMAg</a></p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1 highlander-comment" id="comment-2097">
		<div id="div-comment-2097">
		<div class="cmtinfo"><em> on <a href="#comment-2097" title="">2010-05-25 at 4:08 am</a></em> <img alt='' src='https://2.gravatar.com/avatar/b45888050af2a1ce07b2151d5bbde98f?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite><a href='http://www.mr-edd.co.uk' rel='external nofollow' class='url'>Edd</a></cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_2097"></div><p>Rather than thinking of a mutex as protecting data, I prefer to think of them as protectors of invariants. Lock hierarchies then fall out naturally for invariants involving other invariants naturally. I suspect this distinction would also help in deciding which objects should go in to which &#8216;MyData&#8217; class.</p>
<p>I saw something similar on codeproject once, actually (can&#8217;t find the link now). The approach taken then was to have something like a &#8216;guardian&#8217; class that holds a private MyData object and a mutex. To access the MyData object inside, you had to create a special kind of lock whose constructor took a reference to the guardian object. While the lock exists, the guardian&#8217;s mutex would acquired as usual but the lock provided a get() method and overloaded the &#8216;arrow operator&#8217; to return a pointer to the MyData inside the guardian. In this way, you fundamentally could not get to the MyData object without holding the lock. This approach is even more race-free-by-construction as even the asserts aren&#8217;t needed!</p>
<p>I could sketch this out in code, by I fear the commenting system will eat my C++ templates :)</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1 highlander-comment" id="comment-2095">
		<div id="div-comment-2095">
		<div class="cmtinfo"><em> on <a href="#comment-2095" title="">2010-05-24 at 2:07 pm</a></em> <img alt='' src='https://0.gravatar.com/avatar/0a78e39fdc91872f840361b94889ead2?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /> <cite>Leo Sutic</cite></div>
						<div class="pd-rating" id="pd_rating_holder_468178_comm_2095"></div><p>&#8220;// use table1 and table2 (both are shared)<br />
table1.erase( x );<br />
table2.insert( x );</p>
<p>Quick: What locks should you take to make this code correct?&#8221;</p>
<p>I know that the examples given in the EC series should be seen as illustrative and I don&#8217;t want to detract from what the article is trying to teach, but I&#8217;d just like to give one answer that I think is relevant for a completely different strategy: Lock x.</p>
<p>One way of getting concurrency in this case is to have a function </p>
<p>    int lock_number(x)</p>
<p>that maps keys to any number of locks, and then lock mutex[lock_number(x)].</p>
<p>Then we know that relevant parts of both table1 and table2 are locked for the duration of the transaction. This assumes that the internals of table1 and table2 are written in such ways that they, too, are split according to the lock_number function.</p>
			<br style="clear: both" />
		</div>
</li><!-- #comment-## -->
	</ol>

	<div class="navigation">
		<div class="alignleft"></div>
		<div class="alignright"></div>
	</div>
	<br />

  	<p class="nocomments">Comments are closed.</p>
  <div class="post-content">
<p>
</p>
</div>

			</div>

		
		<p align="center"></p>

	</div><!-- end id:content-main -->
<div id="sidebar">
<ul>
<li class="sidebox"><h2><label for="subscribe-field">Follow by email</label></h2>
				<form action="https://subscribe.wordpress.com" method="post" accept-charset="utf-8" id="subscribe-blog">
																	<p><input type="text" name="email" style="width: 95%; padding: 1px 2px" placeholder="Enter your email address" value="" id="subscribe-field"/></p>
					
					<p>
						<input type="hidden" name="action" value="subscribe"/>
						<input type="hidden" name="blog_id" value="3379246"/>
						<input type="hidden" name="source" value="https://herbsutter.com/2010/05/24/effective-concurrency-associate-mutexes-with-data-to-prevent-races/"/>
						<input type="hidden" name="sub-type" value="widget"/>
						<input type="hidden" name="redirect_fragment" value="blog_subscription-3" />
						<input type="hidden" id="_wpnonce" name="_wpnonce" value="4590924cc6" />						<input type="submit" value="Subscribe" />
					</p>
				</form>
			
</li><li class="sidebox"><h2><a href='http://twitter.com/herbsutter'>Tweets</a></h2><ul class='tweets'></ul><a href="http://twitter.com/herbsutter"  class='twitter-follow-button' data-show-count='false' data-link-color='#265e15' data-text-color='#333333'>Follow @herbsutter</a></li><li class="sidebox"><h2>Popular</h2><ul>				<li>
										<a href="https://herbsutter.com/2018/11/13/trip-report-fall-iso-c-standards-meeting-san-diego/" class="bump-view" data-bump-view="tp">
						Trip report: Fall ISO C++ standards meeting (San Diego)					</a>
										</li>
								<li>
										<a href="https://herbsutter.com/gotw/" class="bump-view" data-bump-view="tp">
						GotW					</a>
										</li>
								<li>
										<a href="https://herbsutter.com/2018/09/20/lifetime-profile-v1-0-posted/" class="bump-view" data-bump-view="tp">
						Lifetime profile v1.0 posted					</a>
										</li>
				</ul></li><li class="sidebox"><h2>Categories</h2>		<ul>
				<li class="cat-item cat-item-291"><a href="https://herbsutter.com/category/apple/" >Apple</a>
</li>
	<li class="cat-item cat-item-49277"><a href="https://herbsutter.com/category/c-net/" >C# / .NET</a>
</li>
	<li class="cat-item cat-item-2426"><a href="https://herbsutter.com/category/c/" >C++</a>
</li>
	<li class="cat-item cat-item-69816"><a href="https://herbsutter.com/category/cloud/" >Cloud</a>
</li>
	<li class="cat-item cat-item-214618"><a href="https://herbsutter.com/category/concurrency/" >Concurrency</a>
</li>
	<li class="cat-item cat-item-8259773"><a href="https://herbsutter.com/category/effective-concurrency/" >Effective Concurrency</a>
</li>
	<li class="cat-item cat-item-3696745"><a href="https://herbsutter.com/category/friday-thoughts/" >Friday Thoughts</a>
</li>
	<li class="cat-item cat-item-3867746"><a href="https://herbsutter.com/category/c/gotw/" >GotW</a>
</li>
	<li class="cat-item cat-item-79"><a href="https://herbsutter.com/category/hardware/" >Hardware</a>
</li>
	<li class="cat-item cat-item-1017"><a href="https://herbsutter.com/category/java/" >Java</a>
</li>
	<li class="cat-item cat-item-637"><a href="https://herbsutter.com/category/microsoft/" >Microsoft</a>
</li>
	<li class="cat-item cat-item-420845"><a href="https://herbsutter.com/category/opinion-editorial/" >Opinion &amp; Editorial</a>
</li>
	<li class="cat-item cat-item-1633077"><a href="https://herbsutter.com/category/reader-qa/" >Reader Q&amp;A</a>
</li>
	<li class="cat-item cat-item-2301"><a href="https://herbsutter.com/category/software-development/" >Software Development</a>
</li>
	<li class="cat-item cat-item-393523"><a href="https://herbsutter.com/category/talks-events/" >Talks &amp; Events</a>
</li>
	<li class="cat-item cat-item-1"><a href="https://herbsutter.com/category/uncategorized/" >Uncategorized</a>
</li>
	<li class="cat-item cat-item-151"><a href="https://herbsutter.com/category/web/" >Web</a>
</li>
		</ul>
			</li></ul>
</div><!-- end id:sidebar -->
</div><!-- end id:content -->
</div><!-- end id:container -->
<div id="footer">
	<div id="colophon">
		<p><a href="https://wordpress.com/?ref=footer_blog">Blog at WordPress.com.</a></p>
		<p>WPThemes.</p>
		<br class="clear" />
	</div><!-- end #colophon-->
</div><!-- end #footer-->
<!--  -->
<script type='text/javascript' src='//0.gravatar.com/js/gprofiles.js?ver=201847y'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var WPGroHo = {"my_hash":""};
/* ]]> */
</script>
<script type='text/javascript' src='https://s1.wp.com/wp-content/mu-plugins/gravatar-hovercards/wpgroho.js?m=1380573781h'></script>

	<script>
		//initialize and attach hovercards to all gravatars
		jQuery( document ).ready( function( $ ) {

			if (typeof Gravatar === "undefined"){
				return;
			}

			if ( typeof Gravatar.init !== "function" ) {
				return;
			}			

			Gravatar.profile_cb = function( hash, id ) {
				WPGroHo.syncProfileData( hash, id );
			};
			Gravatar.my_hash = WPGroHo.my_hash;
			Gravatar.init( 'body', '#wp-admin-bar-my-account' );
		});
	</script>

		<div style="display:none">
	<div class="grofile-hash-map-c0ba56bfd231f8f04feb057728975181">
	</div>
	<div class="grofile-hash-map-16b8a9971551c67422fea478a6e73bae">
	</div>
	<div class="grofile-hash-map-cb8fc369f939c23a8931d6bec1ec56a2">
	</div>
	<div class="grofile-hash-map-3450f3b1a849d45e4e55585fc96da9f1">
	</div>
	<div class="grofile-hash-map-b45888050af2a1ce07b2151d5bbde98f">
	</div>
	<div class="grofile-hash-map-0a78e39fdc91872f840361b94889ead2">
	</div>
	</div>
<script type='text/javascript' charset='UTF-8' id='polldaddyRatings'><!--//--><![CDATA[//><!--
PDRTJS_settings_468178_comm_2266={"id":468178,"unique_id":"wp-comment-2266","title":"%26%23091%3B...%26%23093%3B%20Multicore%20Articles%20http%3A%2F%2Fdocs.sun.com%2Fapp%2Fdocs%2Fdoc%2F816-5137%20http%3A%2F%2Fherbsutter.com%2F2010%2F05%2F24%2Feffective-concurrency-associate-mutexes-with-data-to-prevent-races%2F%20http%3A%2F%2Fmsdn.microsoft.com%2Fe...","permalink":"https:\/\/herbsutter.com\/2010\/05\/24\/effective-concurrency-associate-mutexes-with-data-to-prevent-races\/#comment-2266","item_id":"_comm_2266"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_2266 == 'undefined' ){PDRTJS_468178_comm_2266 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_2266 );}}PDRTJS_settings_468178_comm_2104={"id":468178,"unique_id":"wp-comment-2104","title":"Yes%2C%20that%26%23039%3Bs%20a%20useful%20technique%20too.%20The%20tradeoff%20is%20that%20you%20then%20need%20a%20special%20lock%20type%3B%20in%20this%20design%20I%20decided%20to%20illustrate%20the%20technique%20in%20a%20way%20that%20hooks%20into%20the%20C%2B%2B0x%20standard%20locks%20...","permalink":"https:\/\/herbsutter.com\/2010\/05\/24\/effective-concurrency-associate-mutexes-with-data-to-prevent-races\/#comment-2104","item_id":"_comm_2104"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_2104 == 'undefined' ){PDRTJS_468178_comm_2104 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_2104 );}}PDRTJS_settings_468178_comm_2103={"id":468178,"unique_id":"wp-comment-2103","title":"David%20is%20spot-on%20that%20you%20want%20mutexes%20to%20cover%20invariants%2C%20not%20just%20individual%20pieces%20of%20data.%20How%20to%20design%20the%20groups%20of%20data%20that%20should%20be%20covered%20by%20the%20same%20mutex%20%28or%2C%20which%20mutexes%20protec...","permalink":"https:\/\/herbsutter.com\/2010\/05\/24\/effective-concurrency-associate-mutexes-with-data-to-prevent-races\/#comment-2103","item_id":"_comm_2103"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_2103 == 'undefined' ){PDRTJS_468178_comm_2103 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_2103 );}}PDRTJS_settings_468178_comm_2102={"id":468178,"unique_id":"wp-comment-2102","title":"Re%20map%3A%20Yes%2C%20thank%20the%20Lords%20of%20Templates.%20For%20types%20like%20that%2C%20you%20write%20a%20typedef%20to%20get%20rid%20of%20the%20comma.%20Fun%20stuff.Re%20lock_guard%3A%20Actually%20that%20is%20correct%20and%20slickly%20intended.%20The%20reason%20I%20w...","permalink":"https:\/\/herbsutter.com\/2010\/05\/24\/effective-concurrency-associate-mutexes-with-data-to-prevent-races\/#comment-2102","item_id":"_comm_2102"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_2102 == 'undefined' ){PDRTJS_468178_comm_2102 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_2102 );}}PDRTJS_settings_468178_comm_2101={"id":468178,"unique_id":"wp-comment-2101","title":"Right%2C%20that%20is%20the%20other%20%28orthogonal%29%20issue.%20As%20mentioned%20in%20the%20intro%2C%20this%20article%20focuses%20on%20eliminating%20races%20by%20associating%20data%20with%20locks%3B%20the%20earlier%20article%20focuses%20on%20exactly%20the%20issue%20...","permalink":"https:\/\/herbsutter.com\/2010\/05\/24\/effective-concurrency-associate-mutexes-with-data-to-prevent-races\/#comment-2101","item_id":"_comm_2101"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_2101 == 'undefined' ){PDRTJS_468178_comm_2101 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_2101 );}}PDRTJS_settings_468178_comm_2100={"id":468178,"unique_id":"wp-comment-2100","title":"The%20PROTECTED_MEMBER%20macro%20won%26%23039%3Bt%20work%20for%20types%20like%20map%20%26lt%3B%20int%2Cint%20%26gt%3B%20due%20to%20the%20comma.%20I%20see%20that%20you%20have%20put%20parenthesis%20around%20it%20but%20%28map%20%26lt%3B%20int%2Cint%20%26gt%3B%20%29%20isn%26%23039%3Bt%20a%20type%2C%20is%20it%3FAlso%2C%20l...","permalink":"https:\/\/herbsutter.com\/2010\/05\/24\/effective-concurrency-associate-mutexes-with-data-to-prevent-races\/#comment-2100","item_id":"_comm_2100"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_2100 == 'undefined' ){PDRTJS_468178_comm_2100 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_2100 );}}PDRTJS_settings_468178_comm_2099={"id":468178,"unique_id":"wp-comment-2099","title":"One%20very%20important%20topic%20%28from%20the%20%26quot%3BUse%20Lock%20Hierarchies%26quot%3B%20article%29%20that%20this%20doesn%26%23039%3Bt%20cover%20is%20lock%20ordering%20--%20if%20one%20thread%20calls%3Alock_guard%20hold%28data1%29%3Block_guard%20hold%28data2%29%3Band%20another%20thread...","permalink":"https:\/\/herbsutter.com\/2010\/05\/24\/effective-concurrency-associate-mutexes-with-data-to-prevent-races\/#comment-2099","item_id":"_comm_2099"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_2099 == 'undefined' ){PDRTJS_468178_comm_2099 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_2099 );}}PDRTJS_settings_468178_comm_2098={"id":468178,"unique_id":"wp-comment-2098","title":"The%20previous%20comment%20is%20spot-on.%20Using%20mutexes%20to%20protect%20data%20is%20a%20good%20start%2C%20but%20it%20doesn%26%23039%3Bt%20solve%20all%20problems.%20For%20instance%2C%20to%20use%20your%20%26%23039%3Btransfer-element-between-tables%26%23039%3B%20example%2C%20this%20code%3A%20...","permalink":"https:\/\/herbsutter.com\/2010\/05\/24\/effective-concurrency-associate-mutexes-with-data-to-prevent-races\/#comment-2098","item_id":"_comm_2098"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_2098 == 'undefined' ){PDRTJS_468178_comm_2098 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_2098 );}}PDRTJS_settings_468178_comm_2097={"id":468178,"unique_id":"wp-comment-2097","title":"Rather%20than%20thinking%20of%20a%20mutex%20as%20protecting%20data%2C%20I%20prefer%20to%20think%20of%20them%20as%20protectors%20of%20invariants.%20Lock%20hierarchies%20then%20fall%20out%20naturally%20for%20invariants%20involving%20other%20invariants%20natur...","permalink":"https:\/\/herbsutter.com\/2010\/05\/24\/effective-concurrency-associate-mutexes-with-data-to-prevent-races\/#comment-2097","item_id":"_comm_2097"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_2097 == 'undefined' ){PDRTJS_468178_comm_2097 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_2097 );}}PDRTJS_settings_468178_comm_2095={"id":468178,"unique_id":"wp-comment-2095","title":"%26quot%3B%2F%2F%20use%20table1%20and%20table2%20%28both%20are%20shared%29table1.erase%28%20x%20%29%3Btable2.insert%28%20x%20%29%3BQuick%3A%20What%20locks%20should%20you%20take%20to%20make%20this%20code%20correct%3F%26quot%3BI%20know%20that%20the%20examples%20given%20in%20the%20EC%20series%20should...","permalink":"https:\/\/herbsutter.com\/2010\/05\/24\/effective-concurrency-associate-mutexes-with-data-to-prevent-races\/#comment-2095","item_id":"_comm_2095"}; if ( typeof PDRTJS_RATING !== 'undefined' ){if ( typeof PDRTJS_468178_comm_2095 == 'undefined' ){PDRTJS_468178_comm_2095 = new PDRTJS_RATING( PDRTJS_settings_468178_comm_2095 );}}
//--><!]]></script><script type='text/javascript' charset='UTF-8' src='https://polldaddy.com/js/rating/rating.js'></script><script type='text/javascript' src='https://platform.twitter.com/widgets.js?ver=20111117'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var actionbardata = {"siteID":"3379246","siteName":"Sutter\u2019s Mill","siteURL":"https:\/\/herbsutter.com","icon":"<img alt='' src='https:\/\/secure.gravatar.com\/blavatar\/4554b8d24c7f200dc5e2e1b18db1893f?s=50&d=https%3A%2F%2Fs2.wp.com%2Fi%2Flogo%2Fwpcom-gray-white.png' class='avatar avatar-50' height='50' width='50' \/>","canManageOptions":"","canCustomizeSite":"","isFollowing":"","themeSlug":"pub\/mistylook","signupURL":"https:\/\/wordpress.com\/start\/","loginURL":"https:\/\/herbsutter.wordpress.com\/wp-login.php?redirect_to=https%3A%2F%2Fherbsutter.com%2F2010%2F05%2F24%2Feffective-concurrency-associate-mutexes-with-data-to-prevent-races%2F","themeURL":"","xhrURL":"https:\/\/herbsutter.com\/wp-admin\/admin-ajax.php","nonce":"8fb9818ae2","isSingular":"1","isFolded":"","isLoggedIn":"","isMobile":"","subscribeNonce":"<input type=\"hidden\" id=\"_wpnonce\" name=\"_wpnonce\" value=\"4590924cc6\" \/>","referer":"https:\/\/herbsutter.com\/2010\/05\/24\/effective-concurrency-associate-mutexes-with-data-to-prevent-races\/","canFollow":"1","feedID":"171936","statusMessage":"","customizeLink":"https:\/\/herbsutter.wordpress.com\/wp-admin\/customize.php?url=https%3A%2F%2Fherbsutter.wordpress.com%2F2010%2F05%2F24%2Feffective-concurrency-associate-mutexes-with-data-to-prevent-races%2F","postID":"425","shortlink":"https:\/\/wp.me\/peb5Y-6R","canEditPost":"","editLink":"https:\/\/wordpress.com\/post\/herbsutter.com\/425","statsLink":"https:\/\/wordpress.com\/stats\/post\/425\/herbsutter.com","i18n":{"view":"View site","follow":"Follow","following":"Following","edit":"Edit","login":"Log in","signup":"Sign up","customize":"Customize","report":"Report this content","themeInfo":"Get theme: MistyLook","shortlink":"Copy shortlink","copied":"Copied","followedText":"New posts from this site will now appear in your <a href=\"https:\/\/wordpress.com\/\">Reader<\/a>","foldBar":"Collapse this bar","unfoldBar":"Expand this bar","editSubs":"Manage subscriptions","viewReader":"View site in Reader","viewReadPost":"View post in Reader","subscribe":"Sign me up","enterEmail":"Enter your email address","followers":"Join 19,532 other followers","alreadyUser":"Already have a WordPress.com account? <a href=\"https:\/\/herbsutter.wordpress.com\/wp-login.php?redirect_to=https%3A%2F%2Fherbsutter.com%2F2010%2F05%2F24%2Feffective-concurrency-associate-mutexes-with-data-to-prevent-races%2F\">Log in now.<\/a>","stats":"Stats"}};
/* ]]> */
</script>
<script type='text/javascript' src='https://s0.wp.com/_static/??-eJyVjcEOgjAQRH/IuoIYT8Zvqe2GLrQLdlvAv7ceJEYTEg+bTGbe7MA8KjNwQk7QCVicyOC47DvZwUcUshp9bokFPPUocM+Y0Wm2HuM3/CblwUkvjlrnyyWMv87GjraBWN10hKCloEWpYcIYyZb91fvzQ4ra9LJVMokGfpVWVehruFSnujo0x+Zcd0+y+3Rn'></script>
<script type="text/javascript">
// <![CDATA[
(function() {
try{
  if ( window.external &&'msIsSiteMode' in window.external) {
    if (window.external.msIsSiteMode()) {
      var jl = document.createElement('script');
      jl.type='text/javascript';
      jl.async=true;
      jl.src='/wp-content/plugins/ie-sitemode/custom-jumplist.php';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(jl, s);
    }
  }
}catch(e){}
})();
// ]]>
</script><script src="//stats.wp.com/w.js?56" type="text/javascript" async defer></script>
<script type="text/javascript">
_tkq = window._tkq || [];
_stq = window._stq || [];
_tkq.push(['storeContext', {'blog_id':'3379246','blog_tz':'-8','user_lang':'en','blog_lang':'en','user_id':'0'}]);
_stq.push(['view', {'blog':'3379246','v':'wpcom','tz':'-8','user_id':'0','post':'425','subd':'herbsutter'}]);
_stq.push(['extra', {'crypt':'UE40eW5QN0p8M2Y/RE1TaVhzUzFMbjdWNHpwZGhTayxPSUFCMGNrd29+Smw0TDhnZmRTK0hlRi9QSGh6bi9GXVhBJWIlZlR5U1JMLU8/MkNtblkvY1d1TjBELytHc0k/MXdHUVQyK2IyUVA5SjU1bj9VX3ExLHYsREFpcnlfNHYtXV1HSUIsLkJrcnp0eS5sLmp5UjNUUnMzLF1CUHIySV89T0lpflZ2c11qSGgxTD93UT9rcUpILStaY0hDNWx0OVdkK3FTaCVyQXNBMEJua11JZDMxZUVEa29PdnhMQT9Peno0WWQsTjhtRlJYenUsRWQtdXBiLUwtRXJsbnBEdVhRNG5MX01CQlkxdiYxcj9tViZZWzNaVkpHYVc1QS41SFBJUzRxWGdITGNmOUhwfHpEdG9UazZbZWM9XWwuc1lvSTJQLU92WkN5cV1KMEc2VElxSn5OTA=='}]);
_stq.push([ 'clickTrackerInit', '3379246', '425' ]);
	</script>
<noscript><img src="https://pixel.wp.com/b.gif?v=noscript" style="height:0px;width:0px;overflow:hidden" alt="" /></noscript>
<script>
if ( 'object' === typeof wpcom_mobile_user_agent_info ) {

	wpcom_mobile_user_agent_info.init();
	var mobileStatsQueryString = "";
	
	if( false !== wpcom_mobile_user_agent_info.matchedPlatformName )
		mobileStatsQueryString += "&x_" + 'mobile_platforms' + '=' + wpcom_mobile_user_agent_info.matchedPlatformName;
	
	if( false !== wpcom_mobile_user_agent_info.matchedUserAgentName )
		mobileStatsQueryString += "&x_" + 'mobile_devices' + '=' + wpcom_mobile_user_agent_info.matchedUserAgentName;
	
	if( wpcom_mobile_user_agent_info.isIPad() )
		mobileStatsQueryString += "&x_" + 'ipad_views' + '=' + 'views';

	if( "" != mobileStatsQueryString ) {
		new Image().src = document.location.protocol + '//pixel.wp.com/g.gif?v=wpcom-no-pv' + mobileStatsQueryString + '&baba=' + Math.random();
	}
	
}
</script></body>
</html>