<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Java | Sutter’s Mill | Page 2</title>
<link rel="pingback" href="https://herbsutter.com/xmlrpc.php" />
<script type="text/javascript">
  WebFontConfig = {"typekit":{"id":"eyo0tqd"}};
  (function() {
    var wf = document.createElement('script');
    wf.src = 'https://s0.wp.com/wp-content/plugins/custom-fonts/js/webfont.js';
    wf.type = 'text/javascript';
    wf.async = 'true';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(wf, s);
	})();
</script><style id="jetpack-custom-fonts-css">.wf-active #header h1{font-size:2.12em;font-family:"ff-dagny-web-pro-1","ff-dagny-web-pro-2",sans-serif;font-style:normal;font-weight:400}.wf-active body{font-size:89.7%;font-family:"ff-basic-gothic-web-pro-1","ff-basic-gothic-web-pro-2",sans-serif}.wf-active #navigation{font-family:"ff-basic-gothic-web-pro-1","ff-basic-gothic-web-pro-2",sans-serif}.wf-active #navigation ul li.search{font-size:1.06em}.wf-active #navigation ul li.search input#searchsubmit{font-size:1.06em}.wf-active #content .post-info, .wf-active #content .postmetadata{font-size:1.06em}.wf-active #sidebar{font-size:1.06em}.wf-active #footer p.right{font-size:1.06em}.wf-active .commentnum{font-size:1.77em}.wf-active .commentlist li .cmtinfo{font-size:1.18em}.wf-active .commentlist li .cmtinfo em{font-size:1.06em}.wf-active #respond label{font-size:11.8px}.wf-active #respond .required{font-size:11.8px}.wf-active #respond .subscribe-label{font-size:14.2px}.wf-active #respond .comment-notes{font-size:13px}.wf-active .wp-caption p.wp-caption-text{font-size:13px}.wf-active #content h1, .wf-active h2, .wf-active h3, .wf-active h4, .wf-active h5, .wf-active h6{font-family:"ff-dagny-web-pro-1","ff-dagny-web-pro-2",sans-serif;font-style:normal;font-weight:400}.wf-active #header h2{font-size:1.18em;font-weight:400;font-family:"ff-dagny-web-pro-1","ff-dagny-web-pro-2",sans-serif;font-style:normal}.wf-active #content h3{font-size:1.65em;font-weight:400;font-style:normal}.wf-active #content h4{font-size:1.3em;font-style:normal;font-weight:400}.wf-active #content h5{font-size:1.18em;font-style:normal;font-weight:400}.wf-active #content .post h2{font-size:1.65em;font-weight:400;font-style:normal}.wf-active li.sidebox h2{font-weight:400;font-size:1.89em;font-style:normal}.wf-active .post h4{font-size:1.18em;font-weight:400;font-family:"ff-dagny-web-pro-1","ff-dagny-web-pro-2",sans-serif;font-style:normal}.wf-active .post h4 em{font-style:normal;font-weight:400}</style>
		<script src='https://r-login.wordpress.com/remote-login.php?action=js&amp;host=herbsutter.com&amp;id=3379246&amp;t=1542965512&amp;back=https%3A%2F%2Fherbsutter.com%2Fcategory%2Fjava%2Fpage%2F2%2F' type="text/javascript"></script>
		<script type="text/javascript">
		/* <![CDATA[ */
			if ( 'function' === typeof WPRemoteLogin ) {
				document.cookie = "wordpress_test_cookie=test; path=/";
				if ( document.cookie.match( /(;|^)\s*wordpress_test_cookie\=/ ) ) {
					WPRemoteLogin();
				}
			}
		/* ]]> */
		</script>
		<link rel='dns-prefetch' href='//s2.wp.com' />
<link rel='dns-prefetch' href='//s0.wp.com' />
<link rel='dns-prefetch' href='//s1.wp.com' />
<link rel='dns-prefetch' href='//herbsutter.wordpress.com' />
<link rel="alternate" type="application/rss+xml" title="Sutter’s Mill &raquo; Feed" href="https://herbsutter.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="Sutter’s Mill &raquo; Comments Feed" href="https://herbsutter.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Sutter’s Mill &raquo; Java Category Feed" href="https://herbsutter.com/category/java/feed/" />
	<script type="text/javascript">
		/* <![CDATA[ */
		function addLoadEvent(func) {
			var oldonload = window.onload;
			if (typeof window.onload != 'function') {
				window.onload = func;
			} else {
				window.onload = function () {
					oldonload();
					func();
				}
			}
		}
		/* ]]> */
	</script>
			<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s0.wp.com\/wp-content\/mu-plugins\/wpcom-smileys\/twemoji\/2\/72x72\/","ext":".png","svgUrl":"https:\/\/s0.wp.com\/wp-content\/mu-plugins\/wpcom-smileys\/twemoji\/2\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/s1.wp.com\/wp-includes\/js\/wp-emoji-release.min.js?m=1532082729h&ver=4.9.8"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56760,9792,65039],[55358,56760,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel='stylesheet' id='all-css-0-1' href='https://s2.wp.com/_static/??-eJyNkN1uwjAMhV9onsUG69W0Z0laE0zzp8QR6tvjUlUCwSpuonOS81knxkuGPkWhKBgaZN8cx4qeR6p4JsmmH+HmPvtaP/B1nOORI8uEcqKgYG4WA1eZfErjFtinQnofspE5EWhgQ15nRNnCQv5ZqVmetORmv0vWNFibC9UKegZuAZayT9wKuabWUnEwt0Tb2A9ofbotxBZTJpx/SE8DXi3hn+h9Rx4cSUVJGXKqqt5GaurZeGCNPJoFZoxJlsdVbE11lEB/aYRTfDBw9IbLFlpI9+NUOtTUnZ2hv/C7O+y/uu9uf+jOV8Xg7sY=?cssminify=yes' type='text/css' media='all' />
<link rel='stylesheet' id='print-css-1-1' href='https://s2.wp.com/wp-content/mu-plugins/global-print/global-print.css?m=1465851035h&cssminify=yes' type='text/css' media='print' />
<link rel='stylesheet' id='all-css-2-1' href='https://s0.wp.com/_static/??/wp-content/mu-plugins/actionbar/actionbar.css,/wp-content/themes/h4/global.css?m=1516985148j&cssminify=yes' type='text/css' media='all' />
<script type='text/javascript' src='https://s0.wp.com/_static/??-eJyFztEKwjAMBdAfsquTiXsRv6XWOFKXtDbphn69HeiDMBQCgdzDJXZOBtmP5QJiQ517gfx4rybIxv4ChnDITqEh5A/2kRVYF0vxjCOYIpDdUG+16BpXXIqiBCIVraTfLyFPCPNfFkCT8zeTQfC5tJ7o2Hb9Yde3+24bXjRNW9I='></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://herbsutter.wordpress.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://s1.wp.com/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress.com" />
<link rel="shortcut icon" type="image/x-icon" href="https://secure.gravatar.com/blavatar/4554b8d24c7f200dc5e2e1b18db1893f?s=32" sizes="16x16" />
<link rel="icon" type="image/x-icon" href="https://secure.gravatar.com/blavatar/4554b8d24c7f200dc5e2e1b18db1893f?s=32" sizes="16x16" />
<link rel="apple-touch-icon-precomposed" href="https://secure.gravatar.com/blavatar/4554b8d24c7f200dc5e2e1b18db1893f?s=114" />
<link rel='openid.server' href='https://herbsutter.wordpress.com/?openidserver=1' />
<link rel='openid.delegate' href='https://herbsutter.wordpress.com/' />
<link rel="search" type="application/opensearchdescription+xml" href="https://herbsutter.com/osd.xml" title="Sutter’s Mill" />
<link rel="search" type="application/opensearchdescription+xml" href="https://s1.wp.com/opensearch.xml" title="WordPress.com" />
		<style id="wpcom-hotfix-masterbar-style">
			@media screen and (min-width: 783px) {
				#wpadminbar .quicklinks li#wp-admin-bar-my-account.with-avatar > a img {
					margin-top: 5px;
				}
			}
		</style>
		<script type="text/javascript" id="webfont-output">
  
  WebFontConfig = {"typekit":{"id":"cjs1oxc"}};
  (function() {
    var wf = document.createElement('script');
    wf.src = ('https:' == document.location.protocol ? 'https' : 'http') +
      '://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';
    wf.type = 'text/javascript';
    wf.async = 'true';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(wf, s);
	})();
</script><style type="text/css">
.widget_twitter li {
	word-wrap: break-word;
}
</style>
<meta name="application-name" content="Sutter’s Mill" /><meta name="msapplication-window" content="width=device-width;height=device-height" /><meta name="msapplication-tooltip" content="Herb Sutter on software development" /><meta name="msapplication-task" content="name=Subscribe;action-uri=https://herbsutter.com/feed/;icon-uri=https://secure.gravatar.com/blavatar/4554b8d24c7f200dc5e2e1b18db1893f?s=16" /><meta name="msapplication-task" content="name=Sign up for a free blog;action-uri=http://wordpress.com/signup/;icon-uri=https://s1.wp.com/i/favicon.ico" /><meta name="msapplication-task" content="name=WordPress.com Support;action-uri=http://support.wordpress.com/;icon-uri=https://s1.wp.com/i/favicon.ico" /><meta name="msapplication-task" content="name=WordPress.com Forums;action-uri=http://forums.wordpress.com/;icon-uri=https://s1.wp.com/i/favicon.ico" /><meta name="description" content="Posts about Java written by Herb Sutter" />
<style type="text/css">
			#header h1 a,
		#header h2 {
			color: #265E15 !important;
		}
				#headerimage {
			background: url('https://herbsutter.files.wordpress.com/2011/10/cropped-blog-header.jpg') no-repeat;
			height: 200px;
		}
	</style>
<style type="text/css" id="syntaxhighlighteranchor"></style>
		<link rel="stylesheet" id="custom-css-css" type="text/css" href="https://s2.wp.com/?custom-css=1&#038;csblog=eb5Y&#038;cscache=6&#038;csrev=60" />
		</head>
<body id="section-index" class="archive paged category category-java category-1017 paged-2 category-paged-2 mp6 customizer-styles-applied highlander-enabled highlander-light">


<div id="navigation" class="clearfix">
		<div class="menu">
		<ul>
			<li ><a href="https://herbsutter.com/" title="Home">Home</a></li>
			<li class="page_item page-item-912"><a href="https://herbsutter.com/welcome-to-the-jungle/">Welcome to the&nbsp;Jungle</a></li>
<li class="page_item page-item-864 page_item_has_children"><a href="https://herbsutter.com/gotw/">GotW</a></li>
<li class="page_item page-item-761"><a href="https://herbsutter.com/elements-of-modern-c-style/">Elements of Modern C++&nbsp;Style</a></li>
<li class="page_item page-item-2 page_item_has_children"><a href="https://herbsutter.com/about/">About</a></li>
									<li class="search"><form method="get" id="searchform" action="https://herbsutter.com"><input type="text" class="textbox" value="" name="s" id="s" /><input type="submit" id="searchsubmit" value="Search" /></form></li>
					</ul>
	</div>
</div><!-- end id:navigation -->

<div id="container">

<div id="header">
<h1><a href="https://herbsutter.com/" title="Sutter’s Mill">Sutter’s Mill</a></h1>
<h2>Herb Sutter on software development</h2>
</div><!-- end id:header -->


	
		<div id="feedarea">
	<dl>
		<dt><strong>Feeds:</strong></dt>

			<dd><a href="https://herbsutter.com/feed/">Posts</a></dd>
	
			<dd><a href="https://herbsutter.com/comments/feed/">Comments</a></dd>
		</dl>
	</div><!-- end id:feedarea -->
	
	<div id="headerimage">
</div><!-- end id:headerimage -->

<div id="content">
<div id="content-main">
	              <h2 class="pagetitle">Archive for the &#8216;Java&#8217; Category</h2>
      		
			<div class="post-131 post type-post status-publish format-standard hentry category-c-net category-c category-concurrency category-java" id="post-131">
				<div class="posttitle">
					<h2><a href="https://herbsutter.com/2008/08/05/effective-concurrency-lock-free-code-a-false-sense-of-security/" rel="bookmark">Effective Concurrency: Lock-Free Code &#8212; A False Sense of&nbsp;Security</a></h2>
					<p class="post-info">
					Posted in <a href="https://herbsutter.com/category/c-net/" rel="category tag">C# / .NET</a>, <a href="https://herbsutter.com/category/c/" rel="category tag">C++</a>, <a href="https://herbsutter.com/category/concurrency/" rel="category tag">Concurrency</a>, <a href="https://herbsutter.com/category/java/" rel="category tag">Java</a> on 2008-08-05|
													<a href="https://herbsutter.com/2008/08/05/effective-concurrency-lock-free-code-a-false-sense-of-security/#comments">13 Comments &#187;</a>											</p>
				</div>

				<div class="entry">
					<div>DDJ posted the next <strong>Effective Concurrency</strong> column a couple of weeks earlier than usual. You can find it here: <a href="http://www.ddj.com/cpp/210600279"><strong>&#8220;Lock-Free Code: A False Sense of Security&#8221;</strong></a>, just went live on DDJ&#8217;s site, and also appears in the print magazine.</div>
<div> </div>
<div>This is a special column in a way, because I rarely critique someone else&#8217;s published code. However, mere weeks ago DDJ itself published <a href="http://www.ddj.com/208801974">an article with fundamentally broken code</a> that tried to show how to write a simplified lock-free queue. I corresponded with the author, Petru Marginean, and his main reviewer, Andrei Alexandrescu, to discuss the problems, and they have patched the code somewhat and added a disclaimer to the article. But the issues need to be addressed, and so Petru kindly let me vivisect his code in public in this column (and the next, not yet available, which will show how to do it right).</div>
<div> </div>
<div>From the article:</div>
<blockquote><p>[Lock-free code is] hard even for experts. It&#8217;s easy to write lock-free code that appears to work, but it&#8217;s very difficult to write lock-free code that is correct and performs well. Even good magazines and refereed journals have published a substantial amount of lock-free code that was actually broken in subtle ways and needed correction.</p>
<p>To illustrate, let&#8217;s dissect some peer-reviewed lock-free code that was published here in <em>DDJ</em> just two months ago &#8230;</p></blockquote>
<div>I hope you enjoy it. (Note: Yes, the title is a riff on Tom Cargill&#8217;s classic article <a href="http://www.informit.com/content/images/020163371x/supplements/Exception_Handling_Article.html">&#8220;Exception Handling: A False Sense of Security&#8221;</a>, one of Scott Meyers&#8217; five <a href="http://www.artima.com/cppsource/top_cpp_publications.html">&#8220;Most Important C++ Non-Book Publications&#8230;Ever&#8221;</a>.)</div>
<div> </div>
<div>Finally, here are links to previous Effective Concurrency columns (based on the magazine print issue dates):</div>
<table border="0" cellspacing="5" cellpadding="5" width="555">
<tbody>
<tr>
<td width="114" valign="top">August 2007</td>
<td width="422" valign="top"><a href="http://www.ddj.com/hpc-high-performance-computing/200001985">The Pillars of Concurrency</a></td>
</tr>
<tr>
<td width="114" valign="top">September 2007</td>
<td width="422" valign="top"><a href="http://www.ddj.com/hpc-high-performance-computing/201202924">How Much Scalability Do You Have or Need?</a></td>
</tr>
<tr>
<td width="114" valign="top">October 2007</td>
<td width="422" valign="top"><a title="Use Critical Sections (Preferably Locks) to Eliminate Races" href="http://ddj.com/cpp/201804238">Use Critical Sections (Preferably Locks) to Eliminate Races</a></td>
</tr>
<tr>
<td width="114" valign="top">November 2007</td>
<td width="422" valign="top"><a title="Use Critical Sections (Preferably Locks) to Eliminate Races" href="http://www.ddj.com/hpc-high-performance-computing/202401098">Apply Critical Sections Consistently</a></td>
</tr>
<tr>
<td width="114" valign="top">December 2007</td>
<td width="422" valign="top"><a href="http://herbsutter.spaces.live.com/blog/cns!2D4327CC297151BB!342.entry"></a><a title="Avoid Calling Unknown Code While Inside a Critical Section" href="http://ddj.com/architect/202802983">Avoid Calling Unknown Code While Inside a Critical Section</a></td>
</tr>
<tr>
<td width="114" valign="top">January 2007</td>
<td width="422" valign="top"><a href="http://www.ddj.com/hpc-high-performance-computing/204801163">Use Lock Hierarchies to Avoid Deadlock</a></td>
</tr>
<tr>
<td width="114" valign="top">February 2008</td>
<td width="422" valign="top"><a href="http://www.ddj.com/cpp/205900309">Break Amdahl&#8217;s Law!</a></td>
</tr>
<tr>
<td width="114" valign="top">March 2008</td>
<td width="422" valign="top"><a href="http://www.ddj.com/hpc-high-performance-computing/206100542">Going Superlinear</a></td>
</tr>
<tr>
<td width="114" valign="top">April 2008</td>
<td width="422" valign="top"><a href="http://www.ddj.com/hpc-high-performance-computing/206903306">Super Linearity and the Bigger Machine</a></td>
</tr>
<tr>
<td width="114" valign="top">May 2008</td>
<td width="422" valign="top"><a href="http://ddj.com/architect/207100682">Interrupt Politely</a></td>
</tr>
<tr>
<td width="114" valign="top">June 2008</td>
<td width="422" valign="top"><a href="http://ddj.com/architect/208200273">Maximize Locality, Minimize Contention</a></td>
</tr>
<tr>
<td width="114" valign="top">July 2008</td>
<td width="422" valign="top"><a href="http://www.ddj.com/hpc-high-performance-computing/208801371">Choose Concurrency-Friendly Data Structures</a></td>
</tr>
<tr>
<td width="114" valign="top">August 2008</td>
<td width="422" valign="top"><a href="http://www.ddj.com/hpc-high-performance-computing/209900973">The Many Faces of Deadlock</a></td>
</tr>
<tr>
<td width="114" valign="top">September 2008</td>
<td width="422" valign="top"><a href="http://www.ddj.com/cpp/210600279">&#8220;Lock-Free Code: A False Sense of Security&#8221;</a></td>
</tr>
</tbody>
</table>
					<p><a href="https://herbsutter.com/2008/08/05/effective-concurrency-lock-free-code-a-false-sense-of-security/" rel="bookmark" title="Permanent Link to Effective Concurrency: Lock-Free Code &#8212; A False Sense of&nbsp;Security">Read Full Post &raquo;</a></p>
				</div>
							</div>

		
			<div class="post-110 post type-post status-publish format-standard hentry category-c-net category-c category-java category-software-development" id="post-110">
				<div class="posttitle">
					<h2><a href="https://herbsutter.com/2008/07/25/constructor-exceptions-in-c-c-and-java/" rel="bookmark">Constructor Exceptions in C++, C#, and&nbsp;Java</a></h2>
					<p class="post-info">
					Posted in <a href="https://herbsutter.com/category/c-net/" rel="category tag">C# / .NET</a>, <a href="https://herbsutter.com/category/c/" rel="category tag">C++</a>, <a href="https://herbsutter.com/category/java/" rel="category tag">Java</a>, <a href="https://herbsutter.com/category/software-development/" rel="category tag">Software Development</a> on 2008-07-25|
													<a href="https://herbsutter.com/2008/07/25/constructor-exceptions-in-c-c-and-java/#comments">35 Comments &#187;</a>											</p>
				</div>

				<div class="entry">
					<p>I just received the following question, whose answer is the same in C++, C#, and Java.</p>
<p>Question: In the following code, why isn&#8217;t the destructor/disposer ever called to clean up the Widget when the constructor emits an exception? You can entertain this question in your mainstream language of choice:</p>
<table border="0" cellspacing="1" cellpadding="15" width="400">
<tbody>
<tr>
<td width="400" valign="top">// C++ (an edited version of the original code<br />
// that the reader emailed me)<br />
class Gadget {<br />
   Widget* w;</p>
<p>public:<br />
   Gadget() {<br />
     w = new Widget();<br />
     throw new exception();<br />
     // &#8230; or some API call might throw<br />
   };</p>
<p>   <strong>~Gadget()</strong> {<br />
<strong>      if( w != nullptr ) delete w;<br />
</strong>   }<br />
};</td>
</tr>
<tr>
<td width="400" valign="top">// C# (equivalent)<br />
class Gadget <strong>: IDisposable</strong> {<br />
   private Widget w;</p>
<p>   public Gadget() {<br />
     w = new Widget();<br />
     throw new Exception();<br />
     // &#8230; or some API call might throw<br />
   };</p>
<p><strong>   public void Dispose()</strong> {<br />
     // &#8230; eliding other mechanics, eventually calls:<br />
<strong>     if( w != null ) w.Dispose();<br />
     // or just &#8220;w = null;&#8221; if Widget isn&#8217;t IDisposable<br />
</strong>   }<br />
};</td>
</tr>
<tr>
<td width="400" valign="top">// Java (equivalent)<br />
class Gadget {<br />
   private Widget w;</p>
<p>   public Gadget() {<br />
     w = new Widget();<br />
     throw new Exception();<br />
     // &#8230; or some API call might throw<br />
   };</p>
<p><strong>   public void dispose()</strong> {<br />
<strong>     if( w != null ) w.dispose();<br />
     // or just &#8220;w = null;&#8221; if Widget isn&#8217;t disposable</strong><br />
   }<br />
};</td>
</tr>
</tbody>
</table>
<p>Interestingly, we can answer this even without knowing the calling code&#8230; but there is typical calling code that is similar in all three languages that reinforces the answer.</p>
<h3>Construction and Lifetime</h3>
<p>The fundamental principles behind the answer is the same in C++, C#, and Java:</p>
<ol>
<li>A constructor conceptually turns a suitably sized chunk of raw memory into an object that obeys its invariants. <strong>An object&#8217;s lifetime doesn&#8217;t begin until its constructor completes successfully. </strong>If a constructor ends by throwing an exception, that means it never finished creating the object and setting up its invariants &#8212; and at the point the exceptional constructor exits, the object not only doesn&#8217;t exist, but never existed.</li>
<li>A destructor/disposer conceptually turns an object back into raw memory. Therefore, just like all other nonprivate methods, destructors/disposers assume as a precondition that &#8220;this&#8221; object is actually a valid object and that its invariants hold. Hence, <strong>destructors/disposers only run on successfully constructed objects.</strong></li>
</ol>
<p>I&#8217;ve covered some of these concepts and consequences before in <a href="http://www.gotw.ca/gotw/066.htm">GotW #66, &#8220;Constructor Failures,&#8221;</a> which appeared in updated and expanded form as Items 17 and 18 of <em><a href="http://www.amazon.com/exec/obidos/ASIN/020170434X/gotwca-20">More Exceptional C++</a></em>.</p>
<p>In particular, if Gadget&#8217;s constructor throws, it means that the Gadget object wasn&#8217;t created and never existed. So there&#8217;s nothing to destroy or dispose: The destructor/disposer not only isn&#8217;t needed to run, but it can&#8217;t run because it doesn&#8217;t have a valid object to run against.</p>
<p>Incidentally, it also means that the Gadget constructor isn&#8217;t exception-safe, because it and only it can clean up resources it might leak. In the C++ version, the usual simple way to write the code correctly is to change the w member&#8217;s type from Widget* to shared_ptr&lt;Widget&gt; or an equivalent smart pointer type that owns the object. But let&#8217;s leave that aside for now to explore the more general issue.</p>
<h3>A Look At the Calling Code</h3>
<p>Next, let&#8217;s see how these semantics are actually enforced, whether by language rules or by convention, on the calling side in each language. Here are the major idiomatic ways in each language to use an Gadget object in an exception-safe way:</p>
<table border="0" cellspacing="1" cellpadding="15" width="400">
<tbody>
<tr>
<td width="400" valign="top">// C++ caller</p>
<p>{<br />
<strong>  Gadget myGadget;<br />
</strong>  // do something with myGadget<br />
}</td>
</tr>
<tr>
<td width="400" valign="top">// C# caller</p>
<p><strong>using( Gadget myGadget = new Gadget() )<br />
</strong>{<br />
  // do something with myGadget<br />
}</td>
</tr>
<tr>
<td width="400" valign="top">// Java caller</p>
<p>Gadget myGadget = new Gadget();</p>
<p><strong>try {<br />
</strong>  // do something with myGadget<br />
<strong>}<br />
finally {<br />
  myGadget.dispose();<br />
}</strong></td>
</tr>
</tbody>
</table>
<p>Consider the two cases where an exception can occur:</p>
<ul>
<li>What if an exception is thrown <strong>while using myGadget </strong>&#8212; that is, during &#8220;do something with myGadget&#8221;? In all cases, we know that myGadget&#8217;s destructor/dispose method is guaranteed to be called.</li>
<li>But what if an exception is thrown <strong>while constructing myGadget</strong>? Now in all cases the answer is that the destructor/dispose method is guaranteed <strong>not </strong>to be called.</li>
</ul>
<p>Put another way, we can say for all cases: The destructor/dispose is guaranteed to be run if and only if the constructor completed successfully.</p>
<h3>Another Look At the Destructor/Dispose Code</h3>
<p>Finally, let&#8217;s return to each key line of code one more time:</p>
<table border="0" cellspacing="1" cellpadding="15" width="404">
<tbody>
<tr>
<td width="400" valign="top">// C++<br />
<strong>      if( w != nullptr ) delete w;</strong></td>
</tr>
<tr>
<td width="400" valign="top">// C#<br />
<strong>     if( w != null ) w.Dispose();</strong></td>
</tr>
<tr>
<td width="400" valign="top">// Java<br />
<strong>     if( w != null ) w.dispose();</strong></td>
</tr>
</tbody>
</table>
<p>The motivation for the nullness tests in the original example was to clean up partly-constructed objects. That motivation is suspect in principle &#8212; it means the constructors aren&#8217;t exception-safe because only they can clean up after themselves &#8212; and as we&#8217;ve seen it&#8217;s flawed in practice because the destructors/disposers won&#8217;t ever run on the code paths that the original motivation cared about. So we don&#8217;t need the nullness tests for that reason, although you might still have nullness tests in destructors/disposers to handle &#8216;optional&#8217; parts of an object where a valid object might hold a null pointer or reference member during its lifetime.</p>
<p>In this particular example, we can observe that the nullness tests are actually unnecessary, because w will always be non-null if the object was constructed successfully. There is no (legitimate) way that you can call the destructor/disposer (Furthermore, C++ developers will know that the test is unnecessary for a second reason: Delete is a no-op if the pointer passed to it is null, so there&#8217;s never a need to check for that special case.)</p>
<h3>Conclusion</h3>
<p>When it comes to object lifetimes, all OO languages are more alike than different. Object and resource lifetime matters, whether or not you have a managed language, garbage collection (finalizers are not destructors/disposers!), templates, generics, or any other fancy bell or whistle layered on top of the basic humble class.</p>
<p>The same basic issues arise everywhere&#8230; the code you write to deal with them is just spelled using different language features and/or idioms in the different languages, that&#8217;s all. We can have lively discussions about which language offers the easiest/best/greenest/lowest-carbon-footprint way to express how we want to deal with a particular aspect of object construction, lifetime, and teardown, but those concerns are general and fundamental no matter which favorite language you&#8217;re using to write your code this week.</p>
					<p><a href="https://herbsutter.com/2008/07/25/constructor-exceptions-in-c-c-and-java/" rel="bookmark" title="Permanent Link to Constructor Exceptions in C++, C#, and&nbsp;Java">Read Full Post &raquo;</a></p>
				</div>
							</div>

		
		<p align="center"><a href="https://herbsutter.com/category/java/" >&laquo; Newer Posts</a></p>

	</div><!-- end id:content-main -->
<div id="sidebar">
<ul>
<li class="sidebox"><h2><label for="subscribe-field">Follow by email</label></h2>
				<form action="https://subscribe.wordpress.com" method="post" accept-charset="utf-8" id="subscribe-blog">
																	<p><input type="text" name="email" style="width: 95%; padding: 1px 2px" placeholder="Enter your email address" value="" id="subscribe-field"/></p>
					
					<p>
						<input type="hidden" name="action" value="subscribe"/>
						<input type="hidden" name="blog_id" value="3379246"/>
						<input type="hidden" name="source" value="https://herbsutter.com/category/java/page/2/"/>
						<input type="hidden" name="sub-type" value="widget"/>
						<input type="hidden" name="redirect_fragment" value="blog_subscription-3" />
						<input type="hidden" id="_wpnonce" name="_wpnonce" value="4590924cc6" />						<input type="submit" value="Subscribe" />
					</p>
				</form>
			
</li><li class="sidebox"><h2><a href='http://twitter.com/herbsutter'>Tweets</a></h2><ul class='tweets'></ul><a href="http://twitter.com/herbsutter"  class='twitter-follow-button' data-show-count='false' data-link-color='#265e15' data-text-color='#333333'>Follow @herbsutter</a></li><li class="sidebox"><h2>Popular</h2><ul>				<li>
										<a href="https://herbsutter.com/2018/11/13/trip-report-fall-iso-c-standards-meeting-san-diego/" class="bump-view" data-bump-view="tp">
						Trip report: Fall ISO C++ standards meeting (San Diego)					</a>
										</li>
								<li>
										<a href="https://herbsutter.com/gotw/" class="bump-view" data-bump-view="tp">
						GotW					</a>
										</li>
								<li>
										<a href="https://herbsutter.com/2018/09/20/lifetime-profile-v1-0-posted/" class="bump-view" data-bump-view="tp">
						Lifetime profile v1.0 posted					</a>
										</li>
				</ul></li><li class="sidebox"><h2>Categories</h2>		<ul>
				<li class="cat-item cat-item-291"><a href="https://herbsutter.com/category/apple/" >Apple</a>
</li>
	<li class="cat-item cat-item-49277"><a href="https://herbsutter.com/category/c-net/" >C# / .NET</a>
</li>
	<li class="cat-item cat-item-2426"><a href="https://herbsutter.com/category/c/" >C++</a>
</li>
	<li class="cat-item cat-item-69816"><a href="https://herbsutter.com/category/cloud/" >Cloud</a>
</li>
	<li class="cat-item cat-item-214618"><a href="https://herbsutter.com/category/concurrency/" >Concurrency</a>
</li>
	<li class="cat-item cat-item-8259773"><a href="https://herbsutter.com/category/effective-concurrency/" >Effective Concurrency</a>
</li>
	<li class="cat-item cat-item-3696745"><a href="https://herbsutter.com/category/friday-thoughts/" >Friday Thoughts</a>
</li>
	<li class="cat-item cat-item-3867746"><a href="https://herbsutter.com/category/c/gotw/" >GotW</a>
</li>
	<li class="cat-item cat-item-79"><a href="https://herbsutter.com/category/hardware/" >Hardware</a>
</li>
	<li class="cat-item cat-item-1017 current-cat"><a href="https://herbsutter.com/category/java/" >Java</a>
</li>
	<li class="cat-item cat-item-637"><a href="https://herbsutter.com/category/microsoft/" >Microsoft</a>
</li>
	<li class="cat-item cat-item-420845"><a href="https://herbsutter.com/category/opinion-editorial/" >Opinion &amp; Editorial</a>
</li>
	<li class="cat-item cat-item-1633077"><a href="https://herbsutter.com/category/reader-qa/" >Reader Q&amp;A</a>
</li>
	<li class="cat-item cat-item-2301"><a href="https://herbsutter.com/category/software-development/" >Software Development</a>
</li>
	<li class="cat-item cat-item-393523"><a href="https://herbsutter.com/category/talks-events/" >Talks &amp; Events</a>
</li>
	<li class="cat-item cat-item-1"><a href="https://herbsutter.com/category/uncategorized/" >Uncategorized</a>
</li>
	<li class="cat-item cat-item-151"><a href="https://herbsutter.com/category/web/" >Web</a>
</li>
		</ul>
			</li></ul>
</div><!-- end id:sidebar -->
</div><!-- end id:content -->
</div><!-- end id:container -->
<div id="footer">
	<div id="colophon">
		<p><a href="https://wordpress.com/?ref=footer_blog">Blog at WordPress.com.</a></p>
		<p>WPThemes.</p>
		<br class="clear" />
	</div><!-- end #colophon-->
</div><!-- end #footer-->
<!--  -->
<script type='text/javascript' src='//0.gravatar.com/js/gprofiles.js?ver=201847y'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var WPGroHo = {"my_hash":""};
/* ]]> */
</script>
<script type='text/javascript' src='https://s1.wp.com/wp-content/mu-plugins/gravatar-hovercards/wpgroho.js?m=1380573781h'></script>

	<script>
		//initialize and attach hovercards to all gravatars
		jQuery( document ).ready( function( $ ) {

			if (typeof Gravatar === "undefined"){
				return;
			}

			if ( typeof Gravatar.init !== "function" ) {
				return;
			}			

			Gravatar.profile_cb = function( hash, id ) {
				WPGroHo.syncProfileData( hash, id );
			};
			Gravatar.my_hash = WPGroHo.my_hash;
			Gravatar.init( 'body', '#wp-admin-bar-my-account' );
		});
	</script>

		<div style="display:none">
	</div>
<script type='text/javascript' src='https://platform.twitter.com/widgets.js?ver=20111117'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var actionbardata = {"siteID":"3379246","siteName":"Sutter\u2019s Mill","siteURL":"https:\/\/herbsutter.com","icon":"<img alt='' src='https:\/\/secure.gravatar.com\/blavatar\/4554b8d24c7f200dc5e2e1b18db1893f?s=50&d=https%3A%2F%2Fs2.wp.com%2Fi%2Flogo%2Fwpcom-gray-white.png' class='avatar avatar-50' height='50' width='50' \/>","canManageOptions":"","canCustomizeSite":"","isFollowing":"","themeSlug":"pub\/mistylook","signupURL":"https:\/\/wordpress.com\/start\/","loginURL":"https:\/\/herbsutter.wordpress.com\/wp-login.php?redirect_to=https%3A%2F%2Fherbsutter.com%2F2008%2F08%2F05%2Feffective-concurrency-lock-free-code-a-false-sense-of-security%2F","themeURL":"","xhrURL":"https:\/\/herbsutter.com\/wp-admin\/admin-ajax.php","nonce":"8fb9818ae2","isSingular":"","isFolded":"","isLoggedIn":"","isMobile":"","subscribeNonce":"<input type=\"hidden\" id=\"_wpnonce\" name=\"_wpnonce\" value=\"4590924cc6\" \/>","referer":"https:\/\/herbsutter.com\/category\/java\/page\/2\/","canFollow":"1","feedID":"171936","statusMessage":"","customizeLink":"https:\/\/herbsutter.wordpress.com\/wp-admin\/customize.php?url=https%3A%2F%2Fherbsutter.wordpress.com%2Fcategory%2Fjava%2Fpage%2F2%2F","i18n":{"view":"View site","follow":"Follow","following":"Following","edit":"Edit","login":"Log in","signup":"Sign up","customize":"Customize","report":"Report this content","themeInfo":"Get theme: MistyLook","shortlink":"Copy shortlink","copied":"Copied","followedText":"New posts from this site will now appear in your <a href=\"https:\/\/wordpress.com\/\">Reader<\/a>","foldBar":"Collapse this bar","unfoldBar":"Expand this bar","editSubs":"Manage subscriptions","viewReader":"View site in Reader","viewReadPost":"View post in Reader","subscribe":"Sign me up","enterEmail":"Enter your email address","followers":"Join 19,532 other followers","alreadyUser":"Already have a WordPress.com account? <a href=\"https:\/\/herbsutter.wordpress.com\/wp-login.php?redirect_to=https%3A%2F%2Fherbsutter.com%2F2008%2F08%2F05%2Feffective-concurrency-lock-free-code-a-false-sense-of-security%2F\">Log in now.<\/a>","stats":"Stats"}};
/* ]]> */
</script>
<script type='text/javascript' src='https://s0.wp.com/_static/??-eJyVjcEOgjAQRH/IuoIYT8Zvqe2GLrQLdlvAv7ceJEYTEg+bTGbe7MA8KjNwQk7QCVicyOC47DvZwUcUshp9bokFPPUocM+Y0Wm2HuM3/CblwUkvjlrnyyWMv87GjraBWN10hKCloEWpYcIYyZb91fvzQ4ra9LJVMokGfpVWVehruFSnujo0x+Zcd0+y+3Rn'></script>
<script type="text/javascript">
// <![CDATA[
(function() {
try{
  if ( window.external &&'msIsSiteMode' in window.external) {
    if (window.external.msIsSiteMode()) {
      var jl = document.createElement('script');
      jl.type='text/javascript';
      jl.async=true;
      jl.src='/wp-content/plugins/ie-sitemode/custom-jumplist.php';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(jl, s);
    }
  }
}catch(e){}
})();
// ]]>
</script><script src="//stats.wp.com/w.js?56" type="text/javascript" async defer></script>
<script type="text/javascript">
_tkq = window._tkq || [];
_stq = window._stq || [];
_tkq.push(['storeContext', {'blog_id':'3379246','blog_tz':'-8','user_lang':'en','blog_lang':'en','user_id':'0'}]);
_stq.push(['view', {'blog':'3379246','v':'wpcom','tz':'-8','user_id':'0','subd':'herbsutter'}]);
_stq.push(['extra', {'crypt':'UE40eW5QN0p8M2Y/RE1TaVhzUzFMbjdWNHpwZGhTayxPSUFCMGNrd29+Smw0TDhnZmRTK0hlRi9QSGh6bi9GXVhBJWIlZlR5U1JMLU8/MkNtblkvY1d1TjBELytHc0k/MXdHUVQyK2IyUVA5SjU1bj9VX3ExLHYsREFpcnlfNHYtXV1HSUIsLkJrcnp0eS5sLk93MlEtR1Rrd1FdY2hyVXFoUHxWOFQ3OTcuNTZsQV9ob0czQ2d1bW9WT2NkdHFlU2dHVmJRTGtMTG0lPURZNFE/bDBLbmcvPVpuLzAsaDFqfEdbRU5MLC5pR0hCYnlmdnpxYWkzVElHOU4rVi1Iel03W3dXXWlhTmJ2dVlkbTVmcV01Q0xjc0tWW2xQUiwrMDF5WkVDRU0ueV0rZmx2UDh8Xy50RUJ4VHFWb01YdjRpUEpu'}]);
_stq.push([ 'clickTrackerInit', '3379246', '0' ]);
	</script>
<noscript><img src="https://pixel.wp.com/b.gif?v=noscript" style="height:0px;width:0px;overflow:hidden" alt="" /></noscript>
<script>
if ( 'object' === typeof wpcom_mobile_user_agent_info ) {

	wpcom_mobile_user_agent_info.init();
	var mobileStatsQueryString = "";
	
	if( false !== wpcom_mobile_user_agent_info.matchedPlatformName )
		mobileStatsQueryString += "&x_" + 'mobile_platforms' + '=' + wpcom_mobile_user_agent_info.matchedPlatformName;
	
	if( false !== wpcom_mobile_user_agent_info.matchedUserAgentName )
		mobileStatsQueryString += "&x_" + 'mobile_devices' + '=' + wpcom_mobile_user_agent_info.matchedUserAgentName;
	
	if( wpcom_mobile_user_agent_info.isIPad() )
		mobileStatsQueryString += "&x_" + 'ipad_views' + '=' + 'views';

	if( "" != mobileStatsQueryString ) {
		new Image().src = document.location.protocol + '//pixel.wp.com/g.gif?v=wpcom-no-pv' + mobileStatsQueryString + '&baba=' + Math.random();
	}
	
}
</script></body>
</html>