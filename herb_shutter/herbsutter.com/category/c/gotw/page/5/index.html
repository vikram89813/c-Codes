<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>GotW | Sutter’s Mill | Page 5</title>
<link rel="pingback" href="https://herbsutter.com/xmlrpc.php" />
<script type="text/javascript">
  WebFontConfig = {"typekit":{"id":"eyo0tqd"}};
  (function() {
    var wf = document.createElement('script');
    wf.src = 'https://s0.wp.com/wp-content/plugins/custom-fonts/js/webfont.js';
    wf.type = 'text/javascript';
    wf.async = 'true';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(wf, s);
	})();
</script><style id="jetpack-custom-fonts-css">.wf-active #header h1{font-size:2.12em;font-family:"ff-dagny-web-pro-1","ff-dagny-web-pro-2",sans-serif;font-style:normal;font-weight:400}.wf-active body{font-size:89.7%;font-family:"ff-basic-gothic-web-pro-1","ff-basic-gothic-web-pro-2",sans-serif}.wf-active #navigation{font-family:"ff-basic-gothic-web-pro-1","ff-basic-gothic-web-pro-2",sans-serif}.wf-active #navigation ul li.search{font-size:1.06em}.wf-active #navigation ul li.search input#searchsubmit{font-size:1.06em}.wf-active #content .post-info, .wf-active #content .postmetadata{font-size:1.06em}.wf-active #sidebar{font-size:1.06em}.wf-active #footer p.right{font-size:1.06em}.wf-active .commentnum{font-size:1.77em}.wf-active .commentlist li .cmtinfo{font-size:1.18em}.wf-active .commentlist li .cmtinfo em{font-size:1.06em}.wf-active #respond label{font-size:11.8px}.wf-active #respond .required{font-size:11.8px}.wf-active #respond .subscribe-label{font-size:14.2px}.wf-active #respond .comment-notes{font-size:13px}.wf-active .wp-caption p.wp-caption-text{font-size:13px}.wf-active #content h1, .wf-active h2, .wf-active h3, .wf-active h4, .wf-active h5, .wf-active h6{font-family:"ff-dagny-web-pro-1","ff-dagny-web-pro-2",sans-serif;font-style:normal;font-weight:400}.wf-active #header h2{font-size:1.18em;font-weight:400;font-family:"ff-dagny-web-pro-1","ff-dagny-web-pro-2",sans-serif;font-style:normal}.wf-active #content h3{font-size:1.65em;font-weight:400;font-style:normal}.wf-active #content h4{font-size:1.3em;font-style:normal;font-weight:400}.wf-active #content h5{font-size:1.18em;font-style:normal;font-weight:400}.wf-active #content .post h2{font-size:1.65em;font-weight:400;font-style:normal}.wf-active li.sidebox h2{font-weight:400;font-size:1.89em;font-style:normal}.wf-active .post h4{font-size:1.18em;font-weight:400;font-family:"ff-dagny-web-pro-1","ff-dagny-web-pro-2",sans-serif;font-style:normal}.wf-active .post h4 em{font-style:normal;font-weight:400}</style>
		<script src='https://r-login.wordpress.com/remote-login.php?action=js&amp;host=herbsutter.com&amp;id=3379246&amp;t=1542966375&amp;back=https%3A%2F%2Fherbsutter.com%2Fcategory%2Fc%2Fgotw%2Fpage%2F5%2F' type="text/javascript"></script>
		<script type="text/javascript">
		/* <![CDATA[ */
			if ( 'function' === typeof WPRemoteLogin ) {
				document.cookie = "wordpress_test_cookie=test; path=/";
				if ( document.cookie.match( /(;|^)\s*wordpress_test_cookie\=/ ) ) {
					WPRemoteLogin();
				}
			}
		/* ]]> */
		</script>
		<link rel='dns-prefetch' href='//s2.wp.com' />
<link rel='dns-prefetch' href='//s1.wp.com' />
<link rel='dns-prefetch' href='//s0.wp.com' />
<link rel='dns-prefetch' href='//herbsutter.wordpress.com' />
<link rel="alternate" type="application/rss+xml" title="Sutter’s Mill &raquo; Feed" href="https://herbsutter.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="Sutter’s Mill &raquo; Comments Feed" href="https://herbsutter.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Sutter’s Mill &raquo; GotW Category Feed" href="https://herbsutter.com/category/c/gotw/feed/" />
	<script type="text/javascript">
		/* <![CDATA[ */
		function addLoadEvent(func) {
			var oldonload = window.onload;
			if (typeof window.onload != 'function') {
				window.onload = func;
			} else {
				window.onload = function () {
					oldonload();
					func();
				}
			}
		}
		/* ]]> */
	</script>
			<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s0.wp.com\/wp-content\/mu-plugins\/wpcom-smileys\/twemoji\/2\/72x72\/","ext":".png","svgUrl":"https:\/\/s0.wp.com\/wp-content\/mu-plugins\/wpcom-smileys\/twemoji\/2\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/s1.wp.com\/wp-includes\/js\/wp-emoji-release.min.js?m=1532082729h&ver=4.9.8"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56760,9792,65039],[55358,56760,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel='stylesheet' id='all-css-0-1' href='https://s0.wp.com/_static/??-eJyNkN1uwjAMhV9onrUN1qtpz5K0JpjmT4kj1LfHpeoEglXcROck53Ns4zlDn6JQFAwNsm+OY0XPI1U8kWTTj3B1732tb/g8zvHAkWX6Ey+F5UhBf8nNYuAqk09p3AL7VEjvQzYyJwINbMhrjShbWMjfKzXLo060Ocw5axqszYVqBT0DtwBLsw/cCrmm1lJxMHeJtrEf0Pp03Z4tpkw4T0gPBZ4t4Z/obY88OJKKkjLkVFW9jNTUs/HAGrk3C8wYkyyPq9iq6iiBTmmEU7wzcPCGyxZaSPfjVDrU1I2dod/w87HffXZf3W7fnS4bTgAo?cssminify=yes' type='text/css' media='all' />
<link rel='stylesheet' id='print-css-1-1' href='https://s2.wp.com/wp-content/mu-plugins/global-print/global-print.css?m=1465851035h&cssminify=yes' type='text/css' media='print' />
<link rel='stylesheet' id='all-css-2-1' href='https://s0.wp.com/_static/??/wp-content/mu-plugins/actionbar/actionbar.css,/wp-content/themes/h4/global.css?m=1516985148j&cssminify=yes' type='text/css' media='all' />
<script type='text/javascript' src='https://s2.wp.com/_static/??-eJyF0G0KwjAMBuAL2dXJxP0Rz1Lr60hdP2zaDT29FSYiVIVAIHkISeQcBDk95hNYmhLXjHhbUmN4JX8BYWmIKqGx5F5Ye5fg0tNaf6QRIjOiGkqtDDr7iguekwVzQZXu50rkJsL8lxmkoPRFRDDdUTuEw3vn7x9Y1MHu267fbfp2263NA675cvs='></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://herbsutter.wordpress.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://s1.wp.com/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress.com" />
<link rel="shortcut icon" type="image/x-icon" href="https://secure.gravatar.com/blavatar/4554b8d24c7f200dc5e2e1b18db1893f?s=32" sizes="16x16" />
<link rel="icon" type="image/x-icon" href="https://secure.gravatar.com/blavatar/4554b8d24c7f200dc5e2e1b18db1893f?s=32" sizes="16x16" />
<link rel="apple-touch-icon-precomposed" href="https://secure.gravatar.com/blavatar/4554b8d24c7f200dc5e2e1b18db1893f?s=114" />
<link rel='openid.server' href='https://herbsutter.wordpress.com/?openidserver=1' />
<link rel='openid.delegate' href='https://herbsutter.wordpress.com/' />
<link rel="search" type="application/opensearchdescription+xml" href="https://herbsutter.com/osd.xml" title="Sutter’s Mill" />
<link rel="search" type="application/opensearchdescription+xml" href="https://s1.wp.com/opensearch.xml" title="WordPress.com" />
		<style id="wpcom-hotfix-masterbar-style">
			@media screen and (min-width: 783px) {
				#wpadminbar .quicklinks li#wp-admin-bar-my-account.with-avatar > a img {
					margin-top: 5px;
				}
			}
		</style>
		<script type="text/javascript" id="webfont-output">
  
  WebFontConfig = {"typekit":{"id":"cjs1oxc"}};
  (function() {
    var wf = document.createElement('script');
    wf.src = ('https:' == document.location.protocol ? 'https' : 'http') +
      '://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';
    wf.type = 'text/javascript';
    wf.async = 'true';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(wf, s);
	})();
</script><style type="text/css">
.widget_twitter li {
	word-wrap: break-word;
}
</style>
<meta name="application-name" content="Sutter’s Mill" /><meta name="msapplication-window" content="width=device-width;height=device-height" /><meta name="msapplication-tooltip" content="Herb Sutter on software development" /><meta name="msapplication-task" content="name=Subscribe;action-uri=https://herbsutter.com/feed/;icon-uri=https://secure.gravatar.com/blavatar/4554b8d24c7f200dc5e2e1b18db1893f?s=16" /><meta name="msapplication-task" content="name=Sign up for a free blog;action-uri=http://wordpress.com/signup/;icon-uri=https://s1.wp.com/i/favicon.ico" /><meta name="msapplication-task" content="name=WordPress.com Support;action-uri=http://support.wordpress.com/;icon-uri=https://s1.wp.com/i/favicon.ico" /><meta name="msapplication-task" content="name=WordPress.com Forums;action-uri=http://forums.wordpress.com/;icon-uri=https://s1.wp.com/i/favicon.ico" /><meta name="description" content="Posts about GotW written by Herb Sutter" />
<style type="text/css">
			#header h1 a,
		#header h2 {
			color: #265E15 !important;
		}
				#headerimage {
			background: url('https://herbsutter.files.wordpress.com/2011/10/cropped-blog-header.jpg') no-repeat;
			height: 200px;
		}
	</style>
<style type="text/css" id="syntaxhighlighteranchor"></style>
		<link rel="stylesheet" id="custom-css-css" type="text/css" href="https://s2.wp.com/?custom-css=1&#038;csblog=eb5Y&#038;cscache=6&#038;csrev=60" />
		</head>
<body id="section-index" class="archive paged category category-gotw category-3867746 paged-5 category-paged-5 mp6 customizer-styles-applied highlander-enabled highlander-light infinite-scroll neverending">


<div id="navigation" class="clearfix">
		<div class="menu">
		<ul>
			<li ><a href="https://herbsutter.com/" title="Home">Home</a></li>
			<li class="page_item page-item-912"><a href="https://herbsutter.com/welcome-to-the-jungle/">Welcome to the&nbsp;Jungle</a></li>
<li class="page_item page-item-864 page_item_has_children"><a href="https://herbsutter.com/gotw/">GotW</a></li>
<li class="page_item page-item-761"><a href="https://herbsutter.com/elements-of-modern-c-style/">Elements of Modern C++&nbsp;Style</a></li>
<li class="page_item page-item-2 page_item_has_children"><a href="https://herbsutter.com/about/">About</a></li>
									<li class="search"><form method="get" id="searchform" action="https://herbsutter.com"><input type="text" class="textbox" value="" name="s" id="s" /><input type="submit" id="searchsubmit" value="Search" /></form></li>
					</ul>
	</div>
</div><!-- end id:navigation -->

<div id="container">

<div id="header">
<h1><a href="https://herbsutter.com/" title="Sutter’s Mill">Sutter’s Mill</a></h1>
<h2>Herb Sutter on software development</h2>
</div><!-- end id:header -->


	
		<div id="feedarea">
	<dl>
		<dt><strong>Feeds:</strong></dt>

			<dd><a href="https://herbsutter.com/feed/">Posts</a></dd>
	
			<dd><a href="https://herbsutter.com/comments/feed/">Comments</a></dd>
		</dl>
	</div><!-- end id:feedarea -->
	
	<div id="headerimage">
</div><!-- end id:headerimage -->

<div id="content">
<div id="content-main">
	              <h2 class="pagetitle">Archive for the &#8216;GotW&#8217; Category</h2>
      		
			<div class="post-1920 post type-post status-publish format-standard hentry category-gotw" id="post-1920">
				<div class="posttitle">
					<h2><a href="https://herbsutter.com/2013/05/16/gotw-4-class-mechanics-710/" rel="bookmark">GotW #4: Class Mechanics&nbsp;(7/10)</a></h2>
					<p class="post-info">
					Posted in <a href="https://herbsutter.com/category/c/gotw/" rel="category tag">GotW</a> on 2013-05-16|
													<a href="https://herbsutter.com/2013/05/16/gotw-4-class-mechanics-710/#comments">34 Comments &#187;</a>											</p>
				</div>

				<div class="entry">
					<p><span style="color:#5a5a5a;"><em>How good are you at the details of writing classes? This item focuses not only on blatant errors, but even more so on professional style. Understanding these principles will help you to design classes that are easier to use and easier to maintain.<br />
</em></span></p>
<p>
 </p>
<h1>Problem<br />
</h1>
<h2>JG Question<br />
</h2>
<p>1. What makes interfaces &#8220;easy to use correctly, hard to use incorrectly&#8221;? Explain.
</p>
<h2>Guru Question<br />
</h2>
<p>2. You are doing a code review. A programmer has written the following class, which shows some poor style and has some real errors. How many can you find, and how would you fix them?
</p>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code>class complex {<br />public:<br />    complex( double r, double i = 0 )<br />        : real(r), imag(i)<br />    { }<br /><br />    void operator+ ( complex other ) {<br />        real = real + other.real;<br />        imag = imag + other.imag;<br />    }<br /><br />    void operator&lt;&lt;( ostream os ) {<br />        os &lt;&lt; "(" &lt;&lt; real &lt;&lt; "," &lt;&lt; imag &lt;&lt; ")";<br />    }<br /><br />    complex operator++() {<br />        ++real;<br />        return *this;<br />    }<br /><br />    complex operator++( int ) {<br />        auto temp = *this;<br />        ++real;<br />        return temp;<br />    }<br /><br />    // ... more functions that complement the above ...<br /><br />private:<br />    double real, imag;<br />};
</code></pre>
</p>
<p>Note: This is not intended to be a complete class. For example, if you provide <span style="color:#2e74b5;">operator++</span> you would normally also provide <span style="color:#2e74b5;">operator&#8211;</span>. Rather, this is an instructive example to focus on the mechanics of writing correctly the kinds of functions this class is trying to support.</p>
					<p><a href="https://herbsutter.com/2013/05/16/gotw-4-class-mechanics-710/" rel="bookmark" title="Permanent Link to GotW #4: Class Mechanics&nbsp;(7/10)">Read Full Post &raquo;</a></p>
				</div>
							</div>

		
			<div class="post-1912 post type-post status-publish format-standard hentry category-gotw" id="post-1912">
				<div class="posttitle">
					<h2><a href="https://herbsutter.com/2013/05/16/gotw-3-solution-using-the-standard-library-or-temporaries-revisited/" rel="bookmark">GotW #3 Solution: Using the Standard Library (or, Temporaries&nbsp;Revisited)</a></h2>
					<p class="post-info">
					Posted in <a href="https://herbsutter.com/category/c/gotw/" rel="category tag">GotW</a> on 2013-05-16|
													<a href="https://herbsutter.com/2013/05/16/gotw-3-solution-using-the-standard-library-or-temporaries-revisited/#comments">32 Comments &#187;</a>											</p>
				</div>

				<div class="entry">
					<p><span style="color:#5a5a5a;"><em>Effective reuse is an important part of good software engineering. To demonstrate how much better off you can be by using standard library algorithms instead of handcrafting your own, let&#8217;s reconsider the previous question to demonstrate how many of the problems could have been avoided by simply reusing what&#8217;s already available in the standard library.<br />
</em></span></p>
<p>
 </p>
<h1>Problem<br />
</h1>
<h2>JG Question<br />
</h2>
<p>1. What is the most widely used C++ library?
</p>
<h2>Guru Question<br />
</h2>
<p>2. How many of the pitfalls in GotW #2 could have been avoided in the first place, if only the programmer had replaced the explicit iterator-based <span style="color:#2e74b5;">for</span> loop with:
</p>
<p style="margin-left:36pt;">(a) a range-based <span style="color:#2e74b5;">for</span> loop?
</p>
<p style="margin-left:36pt;">(b) a standard library algorithm call?
</p>
<p>Demonstrate. (Note: As with GotW #2, don&#8217;t change the semantics of the function, even though they could be improved.)
</p>
<p>To recap, here is the mostly-fixed function:
</p>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code>string find_addr( const list&lt;employee&gt;&amp; emps, const string&amp; name ) {<br />    for( auto i = begin(emps);  i != end(emps); ++i ) {<br />        if( i-&gt;name() == name ) {<br />            return i-&gt;addr;<br />        }<br />    }<br />    return "";<br />}
</code></pre>
</p>
<p>
 </p>
<h1>Solution<br />
</h1>
<h2>1. What is the most widely used C++ library?<br />
</h2>
<p>The C++ standard library, with its implementations on every platform.
</p>
<p>
 </p>
<h2>2. (a) How many of the pitfalls in GotW #2 could have been avoided with a range-based for loop?<br />
</h2>
<p>Astute readers of GotW #2 will have been champing at the bit to say: &#8220;Why aren&#8217;t you using a range-based <span style="color:#2e74b5;">for</span> loop?&#8221; Indeed, why not? That would solve several of the temporaries, never mind be easier to write.
</p>
<p>Compare the original unimproved explicit iterator loop:
</p>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code>    for( auto i = begin(emps); i != end(emps); i++ ) {<br />        if( *i == name ) {<br />            return i-&gt;addr;<br />        }<br />    }
</code></pre>
</p>
<p>with the range-based <span style="color:#2e74b5;">for</span> loop (bonus points if you remembered to write the <span style="color:#2e74b5;">const auto&amp;</span>):
</p>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code>    for( const auto&amp; e : emps ) {<br />        if( e == name ) {<br />            return e.addr;<br />        }<br />    }
</code></pre>
</p>
<p>The expressions <span style="color:#2e74b5;">e == name</span> and <span style="color:#2e74b5;">return e.addr;</span> are unchanged in terms of their possible or actual temporaries. But the questions in the naked loop code about whether or not the <span style="color:#2e74b5;">=</span> causes a temporary (recall: it doesn&#8217;t), whether or not <span style="color:#2e74b5;">end()</span> recalculation matters and should be hoisted (recall: probably not, but maybe), and whether or not <span style="color:#2e74b5;">i++</span> should be rewritten <span style="color:#2e74b5;">++i</span> (recall: it should) all simply don&#8217;t arise in the range-<span style="color:#2e74b5;">for</span> code. Such is the power of clear code, and using a higher level of abstraction.
</p>
<p>A key advantage is that using the range-based <span style="color:#2e74b5;">for</span> loop has increased our level of abstraction, the information density in our code. Consider: What can you say about the following two pieces of code without reading what comes next?
</p>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code>    for( auto i = begin(emps); i != end(emps); i++ ) {   // A<br /><br />    for( const auto&amp; e : emps ) {                        // B
</code></pre>
</p>
<p>At first it might seem that lines A and B convey the same information, but they don&#8217;t. When you see A, all you know is that there&#8217;s a loop of some sort that uses an iterator over <span style="color:#2e74b5;">emps</span>. Granted, we&#8217;re so used to A that our eye&#8217;s peripheral vision tends to &#8220;autocomplete&#8221; it in our heads into &#8220;a loop that visits the elements of <span style="color:#2e74b5;">emps</span> in order&#8221; and our autocomplete is often correct—except when it isn&#8217;t: was that a <span style="color:#2e74b5;">++</span>, or a s<span style="color:#2e74b5;">+= 2</span> in a strided loop? is the index modified inside the body? Our peripheral vision might be wrong.
</p>
<p>On the other hand, B conveys more information to the reader. When you see B, you know for certain without inspecting the body of the loop that it is a loop that visits the element of <span style="color:#2e74b5;">emps</span> in order. What&#8217;s more, you&#8217;ve simplified the loop control because there&#8217;s no need for an iterator indirection. Both of these are raising the level of abstraction of our code, and that&#8217;s a good thing.
</p>
<p>Note that, as discussed in GotW #2, the naked <span style="color:#2e74b5;">for</span> loop didn&#8217;t naturally allow consolidating to a single <span style="color:#2e74b5;">return</span> statement without resorting to making the code more complex by adding an additional variable and performing extra computation (a default construction followed by an assignment, instead of just a construction). That&#8217;s still true of the range-based <span style="color:#2e74b5;">for</span> loop form, because it still has the two <span style="color:#2e74b5;">return</span> statements in different scopes.
</p>
<h2>2. (b) … with a standard library algorithm call?<br />
</h2>
<p>With no other changes, simply using the standard <span style="color:#2e74b5;">find</span> algorithm could do everything the range-based <span style="color:#2e74b5;">for</span> loop did to avoid needless temporaries (and questions about them):
</p>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code>// Better (focusing on internals)<br />//<br />string find_addr( /*...*/ ) {<br />    const auto i = find( begin(emps), end(emps), name );   // TFTFY<br />    return i != end(emps) ? i-&gt;addr : "";<br />}
</code></pre>
</p>
<p>This naturally eliminates the same temporaries as the range-<span style="color:#2e74b5;">for</span> version, and it further increases our level of abstraction. As with the range-based <span style="color:#2e74b5;">for</span> loop, we can see at a glance and for certain that the loop will visit the elements of <span style="color:#2e74b5;">emps</span> in order, but on top of that we also know we&#8217;re trying to <span style="color:#2e74b5;">find</span> something and will get back an iterator to the first matching element if one exists. We do still have an iterator indirection, but only a single-use iterator object and no iterator arithmetic as in the original naked iterator <span style="color:#2e74b5;">for</span> loop.
</p>
<p>Further, we have eliminated a loop nested scope entirely and flattened out the function to a single scope which can simplify this calling function in ways even the range-<span style="color:#2e74b5;">for</span> couldn&#8217;t. To demonstrate still more just how fundamental this point is, note that what else the flattening out of the body buys us: Now, because the <span style="color:#2e74b5;">return</span> statements are in the same scope (possible only because we eliminated the loop scope), we have the option of naturally combining them. You could still write <span style="color:#2e74b5;">if( i != end(emps) ) return i-&gt;addr; else return &#8220;&#8221;;</span> here, on one or two or four lines, but there&#8217;s no need to. To be clear, the point here is not that reducing <span style="color:#2e74b5;">return</span> statements should be a goal in itself—it shouldn&#8217;t be, and &#8220;single exit&#8221; thinking has always been flawed as we already saw in GotW #2. Rather, the point is that using an algorithm often simplifies our code more than an explicit loop, even a range-<span style="color:#2e74b5;">for</span> loop, can do—not only directly by removing extra indirections and extra variables and a loop nested scope, but often also by permitting additional simplifications in nearby code.
</p>
<p>The above code might still cause a temporary when comparing an <span style="color:#2e74b5;">employee</span> with a <span style="color:#2e74b5;">string</span>, and we can eliminate even that temporary if we go one small step further and use <span style="color:#2e74b5;">find_if</span> with a custom comparison that compares <span style="color:#2e74b5;">e.name() == name</span> to avoid a possible conversion, assuming something like a suitable <span style="color:#2e74b5;">employee::name()</span> is available as we did in GotW #2. Combining this with the other fixes to pass parameters by reference, we get:
</p>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code>// Better still (complete)<br />//<br />string find_addr( const list&lt;employee&gt;&amp; emps, const string&amp; name ) {<br />    const auto i = find_if( begin(emps), end(emps),<br />                      [&amp;](const auto&amp; e) { return e.name() == name; } );<br />    return i != end(emps) ? i-&gt;addr : "";<br />}
</code></pre>
</p>
<p>
 </p>
<h2>Summary<br />
</h2>
<p>Prefer algorithm calls over explicit loops, when you have or can write a suitable algorithm that does what you want. They raise the level of abstraction and the clarity of our code. Scott Meyers&#8217; advice in <em>Effective STL</em> is still true, and more applicable than even now that lambdas make algorithms much more usable than before:
</p>
<blockquote>
<p><strong>Guideline: </strong>Prefer algorithm calls to explicit loops. Algorithm calls are often clearer and reduce complexity. If no suitable algorithm exists, why not write it? You&#8217;ll use it again.
</p>
</blockquote>
<p>Prefer reusing existing library code to handcrafting your own. The more widely used the library, the more likely it is to come well-designed, pre-debugged, and pre-optimized for many common requirements. And what library is more widely used than the standard library? In your C++ program, your standard library implementation is the most widely used library code you&#8217;re likely to use. This helps you both in the library&#8217;s design and its implementation: It&#8217;s full of code that&#8217;s intended to be used and reused, and to that end a lot of thought and care has gone into the design of its features, including its standard algorithms like <span style="color:#2e74b5;">find</span> and <span style="color:#2e74b5;">sort</span>. Implementers have also spent hours sweating over efficiency details, and usability details, and all sorts of other considerations so that you don&#8217;t have to—including performing optimizations you should almost never resort to in application-level code, such as using nonportable OS- and CPU-target specific optimizations.
</p>
<p>So, always prefer to reuse code, especially algorithms and especially the standard library, and escape the trap of &#8220;I&#8217;ll-write-my-own-just-&#8217;cause-I-can.&#8221;
</p>
<blockquote>
<p><strong>Guideline: </strong>Reuse code—especially standard library code—instead of handcrafting your own. It&#8217;s faster, easier, and safer.
</p>
</blockquote>
<h2>Acknowledgments<br />
</h2>
<p>Thanks in particular to the following for their feedback to improve this article: Olaf ven der Spek, Sam Kramer.</p>
					<p><a href="https://herbsutter.com/2013/05/16/gotw-3-solution-using-the-standard-library-or-temporaries-revisited/" rel="bookmark" title="Permanent Link to GotW #3 Solution: Using the Standard Library (or, Temporaries&nbsp;Revisited)">Read Full Post &raquo;</a></p>
				</div>
							</div>

		
			<div class="post-1888 post type-post status-publish format-standard hentry category-gotw" id="post-1888">
				<div class="posttitle">
					<h2><a href="https://herbsutter.com/2013/05/13/gotw-3-using-the-standard-library-or-temporaries-revisited-310/" rel="bookmark">GotW #3: Using the Standard Library (or, Temporaries Revisited)&nbsp;(3/10)</a></h2>
					<p class="post-info">
					Posted in <a href="https://herbsutter.com/category/c/gotw/" rel="category tag">GotW</a> on 2013-05-13|
													<a href="https://herbsutter.com/2013/05/13/gotw-3-using-the-standard-library-or-temporaries-revisited-310/#comments">35 Comments &#187;</a>											</p>
				</div>

				<div class="entry">
					<p><span style="color:#5a5a5a;"><em>Effective reuse is an important part of good software engineering. To demonstrate how much better off you can be by using standard library algorithms instead of handcrafting your own, let&#8217;s reconsider the previous question to demonstrate how many of the problems could have been avoided by simply reusing what&#8217;s already available in the standard library.<br />
</em></span></p>
<p>
 </p>
<h1>Problem<br />
</h1>
<h2>JG Question<br />
</h2>
<p>1. What is the most widely used C++ library?
</p>
<h2>Guru Question<br />
</h2>
<p>2. How many of the pitfalls in GotW #2 could have been avoided in the first place, if only the programmer had replaced the explicit iterator-based <span style="color:#2e74b5;">for</span> loop with:
</p>
<p style="margin-left:36pt;">(a) a range-based <span style="color:#2e74b5;">for</span> loop?
</p>
<p style="margin-left:36pt;">(b) a standard library algorithm call?
</p>
<p>Demonstrate. (Note: As with GotW #2, don&#8217;t change the semantics of the function, even though they could be improved.)
</p>
<p>To recap, here is the mostly-fixed function:
</p>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code>string find_addr( const list&lt;employee&gt;&amp; emps, const string&amp; name ) {<br />    for( auto i = begin(emps);  i != end(emps); ++i ) {<br />        if( i-&gt;name() == name ) {<br />            return i-&gt;addr;<br />        }<br />    }<br />    return "";<br />}
</code></pre></p>
					<p><a href="https://herbsutter.com/2013/05/13/gotw-3-using-the-standard-library-or-temporaries-revisited-310/" rel="bookmark" title="Permanent Link to GotW #3: Using the Standard Library (or, Temporaries Revisited)&nbsp;(3/10)">Read Full Post &raquo;</a></p>
				</div>
							</div>

		
			<div class="post-1874 post type-post status-publish format-standard hentry category-gotw" id="post-1874">
				<div class="posttitle">
					<h2><a href="https://herbsutter.com/2013/05/13/gotw-2-solution-temporary-objects/" rel="bookmark">GotW #2 Solution: Temporary&nbsp;Objects</a></h2>
					<p class="post-info">
					Posted in <a href="https://herbsutter.com/category/c/gotw/" rel="category tag">GotW</a> on 2013-05-13|
													<a href="https://herbsutter.com/2013/05/13/gotw-2-solution-temporary-objects/#comments">59 Comments &#187;</a>											</p>
				</div>

				<div class="entry">
					<p><span style="color:#5a5a5a;"><em>Unnecessary and/or temporary objects are frequent culprits that can throw all your hard work—and your program&#8217;s performance—right out the window. How can you spot them and avoid them?<br />
</em></span></p>
<p>
 </p>
<h1>Problem<br />
</h1>
<h2>JG Question<br />
</h2>
<p>1. What is a temporary object?
</p>
<h2>Guru Question<br />
</h2>
<p>2. You are doing a code review. A programmer has written the following function, which uses unnecessary temporary or extra objects in at least three places. How many can you identify, and how should the programmer fix them?
</p>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code>string find_addr( list&lt;employee&gt; emps, string name ) {<br />    for( auto i = begin(emps); i != end(emps); i++ ) {<br />        if( *i == name ) {<br />            return i-&gt;addr;<br />        }<br />    }<br />    return "";<br />}
</code></pre>
</p>
<p>Do not change the operational semantics of this function, even though they could be improved.
</p>
<p>
 </p>
<h1>Solution<br />
</h1>
<h2>1. What is a temporary object?<br />
</h2>
<p>Informally, a temporary object is an unnamed object that you can&#8217;t take the address of. A temporary is often created as an intermediate value during the evaluation of an expression, such as an object created by returning a value from a function, performing an implicit conversion, or throwing an exception. We usually call a temporary object an &#8220;rvalue,&#8221; so named because it can appear on the &#8220;r&#8221;ight hand side of an assignment. Here are some simple examples:
</p>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code><span style="background-color:yellow;">widget</span> f();            // f returns a temporary widget object<br /><br />auto a = 0, b = 1;<br />auto c = <span style="background-color:yellow;">a + b</span>;        // "a+b" creates a temporary int object
</code></pre>
</p>
<p>In contrast, in the same code we have objects like <span style="color:#2e74b5;">a</span> and <span style="color:#2e74b5;">c</span> that do each have a name and a memory address. Such an object is usually called an &#8220;lvalue,&#8221; because it can appear on the &#8220;l&#8221;eft hand side of an assignment.
</p>
<p>That&#8217;s a simplification of the truth, but it&#8217;s generally all you need to know. More precisely, C++ now has five categories of values, but distinguishing them is primarily useful for writing down the language specification, and you can mostly ignore them and just think about &#8220;rvalues&#8221; for temporary objects without names and whose addresses can&#8217;t be taken, and &#8220;lvalues&#8221; for non-temporary objects that have names and whose addresses can be taken.
</p>
<p>
 </p>
<h2>2. How many unnecessary temporary objects can you identify, and how should the programmer fix them?<br />
</h2>
<p>Believe it or not, this short function harbors three obvious cases of unnecessary temporaries or extra copies of objects, two subtler ones, and three red herrings.
</p>
<h3>The parameters are passed by value.<br />
</h3>
<p>The most obvious extra copies are buried in the function signature itself:
</p>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code>  string find_addr( list&lt;employee&gt; emps, string name )
</code></pre>
</p>
<p>The parameters should be passed by <span style="color:#2e74b5;">const&amp;</span>—that is, <span style="color:#2e74b5;">const list&lt;employee&gt;&amp;</span> and <span style="color:#2e74b5;">const string&amp;</span>, respectively—instead of by value. Pass-by-value forces the compiler to make complete copy of both objects, which can be expensive and, here, is completely unnecessary.
</p>
<blockquote>
<p><strong>Guideline:</strong> Prefer passing a read-only parameter by <strong>const&amp;</strong> if you are only going to read from it (not make a copy of it).
</p>
</blockquote>
<p>Pedantic note: Yes, with pass-by-value, if the caller passed a temporary <span style="color:#2e74b5;">list</span> or <span style="color:#2e74b5;">string</span> argument then it could be moved from rather than copied. But I&#8217;m deliberately saying &#8220;forces the compiler to make a complete copy&#8221; here because no caller is realistically going to be passing a temporary <span style="color:#2e74b5;">list</span> to <span style="color:#2e74b5;">find_addr</span>, except by mistake.
</p>
<h3>Non-issue: Initializing with &#8220;=&#8221;.<br />
</h3>
<p>Next we come to the first red herring, in the <span style="color:#2e74b5;">for</span> loop&#8217;s initialization:
</p>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code>    for( auto i = begin(emps); /*...*/ )
</code></pre>
</p>
<p>You might be tempted to say that this code should prefer to be spelled <span style="color:#2e74b5;">auto i(begin(emps))</span> rather than <span style="color:#2e74b5;">auto i = begin(emps)</span>, on the grounds that the <span style="color:#2e74b5;">=</span> syntax incurs an extra temporary object, even if it might be optimized away. After all, as we saw in GotW #1, usually that extra <span style="color:#2e74b5;">=</span> means the two-step &#8220;convert to a temporary then copy/move&#8221; of copy-initialization—but recall that doesn&#8217;t apply when using <span style="color:#2e74b5;">auto</span> like this. Why?
</p>
<p>Remember that <span style="color:#2e74b5;">auto</span> always deduces the exact type of the initializer expression, minus top-level <span style="color:#2e74b5;">const</span> and <span style="color:#2e74b5;">&amp;</span> which don&#8217;t matter for conversions, and so… presto! there cannot be any need for a conversion and we directly construct <span style="color:#2e74b5;">i</span>.
</p>
<p>So there is no difference between <span style="color:#2e74b5;">auto i(begin(emps))</span> and <span style="color:#2e74b5;">auto i = begin(emps)</span>. Which syntax you choose is up to you, but it depends only on taste, not on temporaries or any other performance or semantic difference.
</p>
<blockquote>
<p><strong>Guideline:</strong> Prefer declaring variables using <strong>auto</strong>. Among other reasons to do so, it naturally guarantees zero extra temporaries due to implicit conversions.
</p>
</blockquote>
<h3>The end of the range is recalculated on each loop iteration.<br />
</h3>
<p>Another potential avoidable temporary occurs in the <span style="color:#2e74b5;">for</span> loop&#8217;s termination condition:
</p>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code>  for( /*...*/ ; i != end(emps); /*...*/ )
</code></pre>
</p>
<p>For most containers, including <span style="color:#2e74b5;">list</span>, calling <span style="color:#2e74b5;">end()</span> returns a temporary object that must be constructed and destroyed, even though the value will not change.
</p>
<p>Normally when a value will not change, instead of recomputing it (and reconstructing and redestroying it) on every loop iteration, we would want to compute the value only once, store it in a local object, and reuse it.
</p>
<blockquote>
<p><strong>Guideline:</strong> Prefer precomputing values that won&#8217;t change, instead of recreating objects unnecessarily.
</p>
</blockquote>
<p>However, a caution is in order: In practice, for simple inline functions like <span style="color:#2e74b5;">list&lt;T&gt;::end()</span> in particular used in a loop, compilers routinely notice their values won&#8217;t change and hoist them out of the loop for you without you having to do it yourself. So I actually don&#8217;t recommend any change to hoist the <span style="color:#2e74b5;">end</span> calculation here, because that would make the code slightly more complex and the definition of premature optimization is making the code more complex in the name of efficiency without data that it&#8217;s actually needed. Clarity comes first:
</p>
<blockquote>
<p><strong><em>Definition</em>: Premature optimization</strong> is when you make code more complex in the name of efficiency without data that it&#8217;s actually needed.
</p>
</blockquote>
<blockquote>
<p><strong>Guideline:</strong> Write for clarity and correctness first. Don&#8217;t optimize prematurely, before you have profiler data proving the optimization is needed, especially in the case of calls to simple inline calls to short functions that compilers normally can handle for you.
</p>
</blockquote>
<h3>The iterator increment uses postincrement.<br />
</h3>
<p>Next, consider the way we increment <span style="color:#2e74b5;">i</span> in the for loop:
</p>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code>  for( /*...*/ ; i++ )
</code></pre>
</p>
<p>This temporary is more subtle, but it&#8217;s easy to understand once you remember how preincrement and postincrement differ. Postincrement is usually less efficient than preincrement because it has to remember and return its original value.
</p>
<p>Postincrement for a class <span style="color:#2e74b5;">T</span> should normally be implemented using the canonical form as follows:
</p>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code>T T::operator++(int)() {<br />    auto old = *this; // remember our original value<br />    ++*this;          // always implement postincr in terms of preincr<br />    return old;       // return our original value<br />}
</code></pre>
</p>
<p>Now it&#8217;s easy to see why postincrement is less efficient than preincrement: Postincrement has to do all the same work as preincrement, but in addition it also has to construct and return another object containing the original value.
</p>
<blockquote>
<p><strong>Guideline:</strong> For consistency, always implement postincrement in terms of preincrement, otherwise your users will get surprising (and often unpleasant) results.
</p>
</blockquote>
<p>In the problem&#8217;s code, the original value is never used, and so there&#8217;s no reason to use postincrement. Preincrement should be used instead. Although the difference is unlikely to matter for a built-in type or a simple iterator type, where the compiler can often optimize away the extra unneeded work for you, it&#8217;s still a good habit not to ask for more than you need.
</p>
<blockquote>
<p><strong>Guideline:</strong> Prefer preincrement. Only use postincrement if you&#8217;re going to use the original value.
</p>
</blockquote>
<p> &#8220;But wait, you&#8217;re being inconsistent!&#8221; I can just hear someone saying. &#8220;That&#8217;s premature optimization. You said that compilers can hoist the <span style="color:#2e74b5;">end()</span> call out of the loop, and it&#8217;s just as easy for a compiler to optimize away this postincrement temporary.&#8221;
</p>
<p>That&#8217;s true, but it doesn&#8217;t imply premature optimization. Preferring <span style="color:#2e74b5;">++i</span> does not mean writing more complex code in the name of performance before you can prove it&#8217;s needed—<span style="color:#2e74b5;">++i</span> is not more complex than <span style="color:#2e74b5;">i++</span>, so it&#8217;s not as if you need performance data to justify using it! Rather, preferring <span style="color:#2e74b5;">++i</span> is <em>avoiding premature pessimization</em>, which means avoiding writing equivalently complex code that needlessly asks for extra work that it&#8217;s just going to ignore anyway.
</p>
<blockquote>
<p><strong><em>Definition</em>: Premature pessimization</strong> is when you write code that is slower than it needs to be, usually by asking for unnecessary extra work, when equivalently complex code would be faster and should just naturally flow out of your fingers.
</p>
</blockquote>
<h3>The comparison might use an implicit conversion.<br />
</h3>
<p>Next, we come to this:
</p>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code>    if( *i == name )
</code></pre>
</p>
<p>The <span style="color:#2e74b5;">employee</span> class isn&#8217;t shown in the problem, but we can deduce a few things about it. For this code to work, <span style="color:#2e74b5;">employee</span> likely must either have a conversion to <span style="color:#2e74b5;">string</span> or a conversion constructor taking a <span style="color:#2e74b5;">string</span>. Both cases create a temporary object, invoking either <span style="color:#2e74b5;">operator==</span> for <span style="color:#2e74b5;">string</span>s or <span style="color:#2e74b5;">operator==</span> for <span style="color:#2e74b5;">employee</span>s. (Only if there does happen to be an <span style="color:#2e74b5;">operator==</span> that takes one of each, or <span style="color:#2e74b5;">employee</span> has a conversion to a reference, that is, <span style="color:#2e74b5;">string&amp;</span>, is a temporary not needed.)
</p>
<blockquote>
<p><strong>Guideline: </strong>Watch out for hidden temporaries created by implicit conversions. One good way to avoid this is to make constructors and conversion operators <strong>explicit</strong> by default unless implicit conversions are really desirable.
</p>
</blockquote>
<h3>Probably a non-issue: return &#8220;&#8221;.<br />
</h3>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code>    return "";
</code></pre>
</p>
<p>Here we unavoidably create a temporary (unless we change the return type, but we shouldn&#8217;t; see below), but the question is: Is there a better way?
</p>
<p>As written, <span style="color:#2e74b5;">return &#8220;&#8221;;</span> calls the <span style="color:#2e74b5;">string</span> constructor that takes a <span style="color:#2e74b5;">const char*</span>, and if the <span style="color:#2e74b5;">string</span> implementation you&#8217;re using either (a) is smart enough to check for the case where it&#8217;s being passed an empty string, or (b) uses the small string optimization (SSO) that stores strings up to a certain size directly within the string object instead of on the heap, no heap allocation will happen.
</p>
<p>Indeed, every <span style="color:#2e74b5;">string</span> implementation I checked is smart enough not to perform an allocation here, which is maximally efficient for <span style="color:#2e74b5;">string</span>, and so in practice there&#8217;s nothing to optimize. But what alternatives do we have? Let&#8217;s consider two.
</p>
<p>First, you might consider re-spelling this as <span style="color:#2e74b5;">return &#8220;&#8221;s;</span> which is new in C++14. That essentially relies on the same implementation smarts to check for empty strings or to use SSO, just in a different function—the literal <span style="color:#2e74b5;">operator&#8221;&#8221;</span>.
</p>
<p>Second, you might consider re-spelling this as <span style="color:#2e74b5;">return { };</span>. On implementations that are both non-smart <em>and</em> non-SSO, this might have a slight advantage over the others because it invokes the default constructor, and so even the most naïve implementation is likely not to do an allocation since clearly no value is needed.
</p>
<p>In summary, there&#8217;s no difference in practice among returning <span style="color:#2e74b5;">&#8220;&#8221;</span>, <span style="color:#2e74b5;">&#8220;&#8221;s</span>, or <span style="color:#2e74b5;">{ }</span>; use whichever you prefer for stylistic reasons. If your <span style="color:#2e74b5;">string</span> implementation is either smart or uses SSO, which covers all implementations I know of, there&#8217;s exactly zero allocation difference.
</p>
<p>Note: SSO is a wonderful optimization for avoiding allocation overhead and contention, and every modern <span style="color:#2e74b5;">string</span> ought to use it. If your <span style="color:#2e74b5;">string</span> implementation doesn&#8217;t use SSO (as of this writing, I&#8217;m looking at you, libstdc++), write to your standard library implementer—it really should.
</p>
<h3>Non-issue: Multiple returns.<br />
</h3>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code>    return i-&gt;addr;<br />    return "";
</code></pre>
</p>
<p>This was a second subtle red herring, designed to lure in errant disciples of the &#8220;single-entry/single-exit&#8221; (SE/SE) persuasion.
</p>
<p>I In the past, I&#8217;ve heard some people argue that it&#8217;s better to declare a local <span style="color:#2e74b5;">string</span> object to hold the return value and have a single <span style="color:#2e74b5;">return</span> statement that returns that <span style="color:#2e74b5;">string</span>, such as writing <span style="color:#2e74b5;">string ret; &#8230; ret = i-&gt;addr; break; &#8230; return ret;</span>. The idea, they say, is that this will assist the optimizer perform the &#8216;named return value optimization.&#8217;
</p>
<p>The truth is that whether single-return will improve or degrade performance can depend greatly on your actual code and compiler. In this case, the problem is that creating a single local <span style="color:#2e74b5;">string</span> object and then assigning it would mean calling string&#8217;s default constructor <em>and</em> then possibly its assignment  operator, instead of just a single constructor as in our original code. &#8220;But,&#8221; you ask, &#8220;how expensive could a plain old <span style="color:#2e74b5;">string</span> default constructor be?&#8221; Well, here&#8217;s how the &#8220;two-return&#8221; version performed on one popular compiler last time I tried it:
</p>
<ul>
<li>with optimizations disabled: two-return 5% faster than a &#8220;return value&#8221; <span style="color:#2e74b5;">string</span> object
</li>
<li>with aggressive optimizations: two-return 40% faster than a &#8220;return value&#8221; <span style="color:#2e74b5;">string</span> object
</li>
</ul>
<p>Note what this means: Not only did the single-return version generate slower code on this particular compiler on this particular day, but the slowdown was greater with optimizations turned on. In other words, a single-return version didn&#8217;t assist optimization, but actively interfered with it by making the code more complex.
</p>
<p>In general, note that SE/SE is an obsolete idea and has always been wrong. &#8220;Single entry,&#8221; or the idea that functions should always be entered in one place (at their start) and not with <span style="color:#2e74b5;">goto</span> jumps from the caller&#8217;s code directly to random places inside the function body, was and is an immensely valuable advance in computer science. It&#8217;s what made libraries possible, because it meant you could package up a function and reuse it and the function would always know its starting state, where it begins, regardless of the calling code. &#8220;Single exit,&#8221; on the other hand, got unfairly popular on the basis of optimization (&#8216;if there&#8217;s a single <span style="color:#2e74b5;">return</span> the compiler can perform return value optimization better&#8217;—see counterexample above) and symmetry (&#8216;if single entry is good, single exit must be good too&#8217;) but that is wrong because the reasons don&#8217;t hold in reverse—allowing a caller to jump in is bad because it&#8217;s not under the function&#8217;s control, but allowing the function itself to return early when it knows it&#8217;s done is perfectly fine and fully under the function&#8217;s control. To put the final nail in the coffin, note that &#8220;single exit&#8221; has always been a fiction in any language that has exceptions, because you can get an early exceptional return from any point where you call something that could throw an exception.
</p>
<h3>Non-issue: Return by value.<br />
</h3>
<p>Which brings us to the third red herring:
</p>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code>string find_addr( /*...*/ )
</code></pre>
</p>
<p>Because C++ naturally enables move semantics for returned values like this <span style="color:#2e74b5;">string</span> object, there&#8217;s usually little to be gained by trying to avoid the temporary when you return by value. For example, if the caller writes <span style="color:#2e74b5;">auto address = find_addr( mylist, &#8220;Marvin the Robot&#8221; );</span>, there will be at most a cheap move (not a deep copy) of the returned temporary into <span style="color:#2e74b5;">address</span>, and compilers are allowed to optimize away even that cheap move and construct the result into <span style="color:#2e74b5;">address</span> directly.
</p>
<p>But what if you did feel tempted to try to avoid a temporary in all return cases by returning a <span style="color:#2e74b5;">string&amp;</span> instead of <span style="color:#2e74b5;">string</span>? Here&#8217;s one way you might try doing it that avoids the pitfall of returning a dangling reference to a local or temporary object:
</p>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code>const string&amp; find_addr( /* ... */ ) {<br />    for( /* ... */ ) {<br />        if( /* found */ ) {<br />            return i-&gt;addr;<br />        }<br />    }<br />    static const string empty;<br />    return empty;<br />}
</code></pre>
</p>
<p>To demonstrate why this is brittle, here&#8217;s an extra question:
</p>
<p><strong>For the above function, write the documentation for how long the returned reference is valid.<br />
</strong></p>
<p>Go ahead, we&#8217;ll wait.
</p>
<p>Done? Okay, let&#8217;s consider: If the object is found, we are returning a reference to a <span style="color:#2e74b5;">string</span> inside an <span style="color:#2e74b5;">employee</span> object inside the <span style="color:#2e74b5;">list</span>, and so the reference itself is only valid for the lifetime of said <span style="color:#2e74b5;">employee</span> object inside the <span style="color:#2e74b5;">list</span>. So we might try something like this (assuming an empty address is not valid for any employee):
</p>
<blockquote>
<p>&#8220;If the returned string is nonempty, then the reference is valid until the next time you modify the employee object for which this is the address, including if you remove that employee from the list.&#8221;
</p>
</blockquote>
<p>Those are very brittle semantics, not least because the first (but far from only) problem that immediately arises is that the caller has no idea which employee that is—not only doesn&#8217;t he have a pointer or reference to the right <span style="color:#2e74b5;">employee</span> object, but he may not even be able to easily figure out which one it is if two employees could have the same address. Second, calling code can be notoriously forgetful and careless about the lifetimes of the returned reference, as in the following code which compiles just fine:
</p>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code>auto&amp; a = find_addr( emps, "John Doe" );  // yay, avoided temporary!<br />emps.clear();<br />cout &lt;&lt; a;                                // oops
</code></pre>
</p>
<p>When the calling code does something like this and uses a reference beyond its lifetime, the bug will typically be intermittent and very difficult to diagnose. Indeed, one of the most common mistakes programmers make with the standard library is to use iterators after they are no longer valid, which is pretty much the same thing as using a reference beyond its lifetime; see GotW #18 for details about the accidental use of invalid iterators.
</p>
<h2>Summary<br />
</h2>
<p>There are some other optimization opportunities. Ignoring these for now, here is one possible corrected version of <span style="color:#2e74b5;">find_addr</span> which fixes the unnecessary temporaries. To avoid a possible conversion in the <span style="color:#2e74b5;">employee</span>/<span style="color:#2e74b5;">string</span> comparison, we&#8217;ll assume there&#8217;s something like an <span style="color:#2e74b5;">employee::name()</span> function and that <span style="color:#2e74b5;">.name() == name</span> has equivalent semantics.
</p>
<p>Note another reason to prefer declaring local variables with <span style="color:#2e74b5;">auto</span>: Because the <span style="color:#2e74b5;">list&lt;employee&gt;</span> parameter is now <span style="color:#2e74b5;">const</span>, calling <span style="color:#2e74b5;">begin</span> and <span style="color:#2e74b5;">end</span> return a different type—not <span style="color:#2e74b5;">iterator</span>s but <span style="color:#2e74b5;">const_iterator</span>s—but <span style="color:#2e74b5;">auto</span> naturally deduces the right thing so you don&#8217;t have to remember to make that change in your code.
</p>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code>string find_addr( const list&lt;employee&gt;&amp; emps, const string&amp; name ) {<br />    for( auto i = begin(emps);  i != end(emps); ++i ) {<br />        if( i-&gt;name() == name ) {<br />            return i-&gt;addr;<br />        }<br />    }<br />    return "";<br />}
</code></pre>
</p>
<h2>Acknowledgments<br />
</h2>
<p>Thanks in particular to the following for their feedback to improve this article: &#8220;litb1,&#8221; Daan Nusman, &#8220;Adrian,&#8221; Michael Marcin, Ville Voutilainen, Rick Yorgason, &#8220;kkoehne,&#8221; and Olaf van der Spek.</p>
					<p><a href="https://herbsutter.com/2013/05/13/gotw-2-solution-temporary-objects/" rel="bookmark" title="Permanent Link to GotW #2 Solution: Temporary&nbsp;Objects">Read Full Post &raquo;</a></p>
				</div>
							</div>

		
			<div class="post-1855 post type-post status-publish format-standard hentry category-gotw" id="post-1855">
				<div class="posttitle">
					<h2><a href="https://herbsutter.com/2013/05/09/gotw-2-temporary-objects-510/" rel="bookmark">GotW #2: Temporary&nbsp;Objects</a></h2>
					<p class="post-info">
					Posted in <a href="https://herbsutter.com/category/c/gotw/" rel="category tag">GotW</a> on 2013-05-09|
													<a href="https://herbsutter.com/2013/05/09/gotw-2-temporary-objects-510/#comments">56 Comments &#187;</a>											</p>
				</div>

				<div class="entry">
					<p><span style="color:#5a5a5a;"><em>Unnecessary and/or temporary objects are frequent culprits that can throw all your hard work — and your program&#8217;s performance — right out the window. How can you spot them and avoid them?<br />
</em></span></p>
<p>
 </p>
<h1>Problem<br />
</h1>
<h2>JG Question<br />
</h2>
<p>1. What is a temporary object?
</p>
<h2>Guru Question<br />
</h2>
<p>2. You are doing a code review. A programmer has written the following function, which uses unnecessary temporary objects in at least three places. How many can you identify, and how should the programmer fix them?
</p>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code>string find_addr( list&lt;employee&gt; emps, string name ) {<br />    for( auto i = begin(emps); i != end(emps); i++ ) {<br />        if( *i == name ) {<br />            return i-&gt;addr;<br />        }<br />    }<br />    return "";<br />}
</code></pre>
</p>
<p>Do not change the operational semantics of this function, even though they could be improved.</p>
					<p><a href="https://herbsutter.com/2013/05/09/gotw-2-temporary-objects-510/" rel="bookmark" title="Permanent Link to GotW #2: Temporary&nbsp;Objects">Read Full Post &raquo;</a></p>
				</div>
							</div>

		
			<div class="post-1831 post type-post status-publish format-standard hentry category-c category-gotw" id="post-1831">
				<div class="posttitle">
					<h2><a href="https://herbsutter.com/2013/05/09/gotw-1-solution/" rel="bookmark">GotW #1 Solution: Variable Initialization – or Is&nbsp;It?</a></h2>
					<p class="post-info">
					Posted in <a href="https://herbsutter.com/category/c/" rel="category tag">C++</a>, <a href="https://herbsutter.com/category/c/gotw/" rel="category tag">GotW</a> on 2013-05-09|
													<a href="https://herbsutter.com/2013/05/09/gotw-1-solution/#comments">55 Comments &#187;</a>											</p>
				</div>

				<div class="entry">
					<p><span style="color:#5a5a5a;"><em>This first problem highlights the importance of understanding what you write. Here we have a few simple lines of code—most of which mean something different from all the others, even though the syntax varies only slightly.<br />
</em></span></p>
<p>
 </p>
<h1>Problem<br />
</h1>
<h2>JG Question<br />
</h2>
<p>1. What is the difference, if any, among the following?
</p>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code>widget w;                   // (a)<br /><br />widget w();                 // (b)<br />widget w{};                 // (c)<br /><br />widget w(x);                // (d)<br />widget w{x};                // (e)<br /><br />widget w = x;               // (f)<br />widget w = {x};             // (g)<br /><br />auto w = x;                 // (h)<br />auto w = widget{x};         // (i)
</code></pre>
</p>
<h2>Guru Questions<br />
</h2>
<p>2. What do each of the following lines do?
</p>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code>vector&lt;int&gt; v1( 10, 20 );   // (a)<br /><br />vector&lt;int&gt; v2{ 10, 20 };   // (b)
</code></pre>
</p>
<p>3. Besides the cases above, what other benefits are there to using <span style="color:#1f4e79;">{ }</span> to initialize objects?
</p>
<p>4. When should you use <span style="color:#1f4e79;">( )</span> vs. <span style="color:#1f4e79;">{ }</span> syntax to initialize objects? Why?
</p>
<p>
 </p>
<h1>Solution<br />
</h1>
<p>This puzzle demonstrates several things:
</p>
<ul>
<li>The difference between default initialization, direct initialization, copy initialization, and list initialization.
</li>
<li>The difference between using <span style="color:#1f4e79;">( )</span> and using <span style="color:#1f4e79;">{ }</span> for initialization.
</li>
<li>A red herring that isn&#8217;t initialization at all, and which modern C++ entirely avoids.
</li>
</ul>
<p>But, most important of all: If you stick to two simple Guidelines, which we&#8217;ll cover in #4, you can ignore most of these cases and the rules are pretty simple and deliver efficient performance by default.
</p>
<p>
 </p>
<h2>1. What is the difference, if any, among the following?<br />
</h2>
<p>Let&#8217;s consider the cases one by one.
</p>
<h3>(a) is default initialization.<br />
</h3>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code>widget w;                   // (a)
</code></pre>
</p>
<p>This code declares a variable named <span style="color:#1f4e79;">w</span>, of type <span style="color:#1f4e79;">widget</span>. For most types, it is initialized using the default constructor <span style="color:#1f4e79;">widget::widget()</span>.
</p>
<p>Note that <span style="color:#1f4e79;">w</span> is not initialized and contains garbage values if <span style="color:#1f4e79;">widget</span> happens to be a built-in type like <span style="color:#1f4e79;">int</span>, or a simple &#8220;<span style="color:#1f4e79;">int</span>-like&#8221; class type with what&#8217;s called a &#8220;trivial&#8221; default constructor—a type that relies on the compiler-generated default constructor, has no virtual functions or virtual base classes or data member initializers, and all its bases and members satisfy the same restrictions.
</p>
<h3> (b) is a &#8220;vexing&#8221; red herring, now mostly a historical curiosity.<br />
</h3>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code>widget w();                 // (b)
</code></pre>
</p>
<p>This is a pre-modern C++ pitfall: At first glance, it may look like just another variable declaration calling a default constructor <span style="color:#1f4e79;">widget::widget()</span>; in reality, thanks to a grammar ambiguity, it&#8217;s a function declaration for a function named <span style="color:#1f4e79;">w</span> that takes no parameters and returns a <span style="color:#1f4e79;">widget</span> object by value. (If you can&#8217;t see this at first, consider that the above code is no different from writing something like <span style="color:#1f4e79;">int f();</span> which is clearly a function declaration.)
</p>
<p>Lest you think &#8220;aw, but those <span style="color:#1f4e79;">( )</span> parentheses are redundant, it&#8217;s the programmer&#8217;s own fault for not just writing <span style="color:#1f4e79;">widget w;</span> there!&#8221;, note that the same problem arises in those occasional cases where you think you&#8217;re initializing a variable with temporary objects:
</p>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code>// same problem (gadget and doodad are types)<br />//<br />widget w( gadget(), doodad() );  // pitfall: not a variable declaration
</code></pre>
</p>
<p>Scott Meyers long ago named this &#8220;C++&#8217;s most vexing parse,&#8221; because the standard resolves the parsing ambiguity by saying: &#8220;if it can be a function declaration, it is.&#8221;
</p>
<p>The good news is that this is now mostly a historical curiosity, not something you should encounter in new code, because C++11 removed this pitfall. Note that C++11 does not change the meaning of the code—C++11 has great backward compatibility with C++98, including that this ambiguity still has the same meaning it always had. Rather, C++11 solves this by providing a syntax that supersedes case (b) in nearly all cases, so that we don&#8217;t need to ever fall into this pit anymore:
</p>
<h3>(c) is non-vexing and clear.<br />
</h3>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code>widget w{};                 // (c)
</code></pre>
</p>
<p>Here we have the first reason to prefer <span style="color:#1f4e79;">{ }</span> to <span style="color:#1f4e79;">( )</span>: For any class type <span style="color:#1f4e79;">widget</span>, line (c) does the &#8220;best parts&#8221; of (a) and (b)—it always initializes the variable, and is never ambiguous with a function declaration. No vex, no fuss, no muss.
</p>
<p>&#8220;Aha, but wait, it&#8217;s not that simple!&#8221; someone might object. &#8220;What if <span style="color:#1f4e79;">widget</span> has a constructor that takes a <span style="color:#1f4e79;">std::initializer_list</span>? Those are greedy (preferred), so if <span style="color:#1f4e79;">widget</span> has one of those wouldn&#8217;t this call that?&#8221;
</p>
<p>The answer is no, this really is just as simple as it looks, because the standard is explicit that an empty <span style="color:#1f4e79;">{ }</span> list means to call the default constructor if available. However, it&#8217;s good to be aware of <span style="color:#1f4e79;">initializer_list</span>s, so let&#8217;s talk about those next.
</p>
<h3>(d) and (e) are direct initialization.<br />
</h3>
<p>Now let&#8217;s consider cases where we actually initialize <span style="color:#1f4e79;">w</span> from some existing variable:
</p>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code>widget w(x);                // (d)<br />widget w{x};                // (e)
</code></pre>
</p>
<p>Assuming <span style="color:#1f4e79;">x</span> is not the name of a type, these are both direct initialization. That&#8217;s because the variable <span style="color:#1f4e79;">w</span> is initialized &#8220;directly&#8221; from the value of <span style="color:#1f4e79;">x</span> by calling <span style="color:#1f4e79;">widget::widget(x)</span>. If <span style="color:#1f4e79;">x</span> is also of type <span style="color:#1f4e79;">widget</span>, this invokes the copy constructor. Otherwise, it invokes a converting constructor.
</p>
<p>However, note that the syntax <span style="color:#1f4e79;">{x}</span> creates an <span style="color:#1f4e79;">initializer_list</span>. If <span style="color:#1f4e79;">widget</span> has a constructor that takes an <span style="color:#1f4e79;">initializer_list</span>, that constructor is preferred; otherwise, if <span style="color:#1f4e79;">widget</span> has a constructor that takes whatever type <span style="color:#1f4e79;">x</span> is (possibly with conversions), that constructor is used.
</p>
<p>There are two major differences that make (e) superior to (d): First, like (c), syntax (e) is unambiguous and avoids the vexing parse. If <span style="color:#1f4e79;">x</span> is a type name, then (d) is a function declaration even if there is also a variable named <span style="color:#1f4e79;">x</span> in scope (see above), whereas (e) is never a function declaration.
</p>
<p>Second, syntax (e) is safer because it does not allow narrowing (a.k.a. &#8220;lossy&#8221;) conversions that are otherwise allowed for some built-in types. Consider:
</p>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code><span style="color:#c00000;">int i1( 12.345 );           // ok: toss .345, we didn't like it anyway<br /><span style="color:#00b050;">int i2{ 12.345 };           // error: would be lossy implicit narrowing
</span></span></code></pre>
</p>
<h3>(f) and (g) are copy initialization and copy list initialization.<br />
</h3>
<p>This brings us to our final two non-<span style="color:#1f4e79;">auto</span> cases:
</p>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code>widget w = x;               // (f)
</code></pre>
</p>
<p>This is called &#8220;copy initialization.&#8221; Conceptually, the variable <span style="color:#1f4e79;">w</span> is initialized using <span style="color:#1f4e79;">widget</span>&#8216;s move or copy constructor, possibly after calling another function to convert the argument implicitly (<span style="color:#1f4e79;">explicit</span> conversions won&#8217;t be invoked here).
</p>
<blockquote>
<p><strong>Common Mistake:</strong> This is always initialization; it is never assignment, and so it never calls <strong>T::operator=()</strong>. Yes, I know there&#8217;s an &#8220;<strong>=</strong>&#8221; character in there, but don&#8217;t let that throw you — that&#8217;s just a syntax holdover from C, not an assignment operation.
</p>
</blockquote>
<p>Here are the semantics:
</p>
<ul>
<li>If <span style="color:#1f4e79;">x</span> is of type <span style="color:#1f4e79;">widget</span>, line (f) means the same as (d) <span style="color:#1f4e79;">widget w(x);</span> except that <span style="color:#1f4e79;">explicit</span> constructors cannot be used. It&#8217;s guaranteed that only a single constructor is called.
</li>
<li>If <span style="color:#1f4e79;">x</span> is of some other type, <em>conceptually</em> the compiler first implicitly converts <span style="color:#1f4e79;">x</span> to a temporary <span style="color:#1f4e79;">widget</span> object, then move-constructs <span style="color:#1f4e79;">w</span> from that temporary rvalue, using copy construction as &#8220;the slow way to move&#8221; as a backup if no better move constructor is available. Assuming that an implicit conversion is available, (f) means the same as <span style="color:#1f4e79;">widget w( widget(x) );</span>.
</li>
</ul>
<p>Note that I said &#8220;conceptually&#8221; a few times above. That&#8217;s because <em>practically</em> compilers are allowed to, and routinely do, optimize away the temporary and, if an implicit conversion is available, convert (f) to (d), thus optimizing away the extra move operation. However, even when the compiler does this, the <span style="color:#1f4e79;">widget</span> copy constructor must still be accessible, even if is not called—the copy constructor&#8217;s side effects may or may not happen, that&#8217;s all.
</p>
<p>Now note the related syntax that adds &#8220;<span style="color:#1f4e79;">=</span>&#8220;:
</p>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code>widget w = {x};             // (g)
</code></pre>
</p>
<p>This is called &#8220;copy list initialization.&#8221; It means the same as <span style="color:#1f4e79;">widget w{x};</span> except that <span style="color:#1f4e79;">explicit</span> constructors cannot be used. It&#8217;s guaranteed that only a single constructor is called.
</p>
<h3>(h) and (i) are also copy initialization, but simpler.<br />
</h3>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code>auto w = x;                 // (h)<br />auto w = widget{x};         // (i)
</code></pre>
</p>
<p>The semantics are just like (f) and (g), except simpler to teach, learn, and use because using <span style="color:#1f4e79;">auto</span> guarantees the right-hand expression&#8217;s type will be deduced exactly. Note that the (i) syntax works fine for both implicit and <span style="color:#1f4e79;">explicit</span> conversions.
</p>
<p>Line (h) means the same as (d), <span style="color:#1f4e79;"><em>type_of_x</em> w(x);</span>. Only a single copy constructor is called. This is <em>guaranteed to stay true</em> as the program evolves: Because line (h) does not commit to an explicit type, it is guaranteed to be both maximally efficient because there can be no conversion involved, and maximally robust under maintenance as the type of <span style="color:#1f4e79;">w</span> &#8220;auto&#8221;-matically tracks the type of <span style="color:#1f4e79;">x</span> which may change as the program is maintained.
</p>
<p>Line (i) is the most consistent spelling when you do want to commit to a specific type and explicitly request a conversion if needed, and once again the <span style="color:#1f4e79;">{ }</span> syntax happily avoids lossy narrowing conversions. In practice on most compilers, only a single constructor is called—similarly to what we saw with (f) and (g), conceptually there are two constructor calls, a converting or copy constructor to create a temporary <span style="color:#1f4e79;">widget{x}</span> followed by a move to move it to <span style="color:#1f4e79;">w</span>, but compilers routinely elide the latter.
</p>
<p>In general, I recommend that you try out these two forms, and increasingly prefer using them as you grow comfortable with them. I&#8217;m at the point where I&#8217;m now inclined to write virtually all of my local variable declarations this way. (I know some of you will be skeptical about this broad claim—more on &#8220;the <span style="color:#1f4e79;">auto</span> question&#8221; in another GotW.)
</p>
<p>
 </p>
<h2>2. What do each of the following lines do?<br />
</h2>
<p>In the Question 2 code, we&#8217;re creating a <span style="color:#1f4e79;">vector&lt;int&gt;</span> and passing the arguments <span style="color:#1f4e79;">10</span> and <span style="color:#1f4e79;">20</span> to its constructor—in the first case as <span style="color:#1f4e79;">( 10, 20 )</span> and in the second case as <span style="color:#1f4e79;">{ 10, 20 }</span>.
</p>
<p>Both will call a constructor, but which one(s)? Well, <span style="color:#1f4e79;">vector&lt;int&gt;</span> has several constructors that can take two parameters, but only two could be correctly called with the parameters <span style="color:#1f4e79;">10</span> and <span style="color:#1f4e79;">20</span>. Ignoring defaulted optional allocator parameters for simplicity, the two constructors are:
</p>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code>vector( size_t n, const int&amp; value );    // A: n copies of value<br /><br />vector( initializer_list&lt;int&gt; values );  // B: copy of values
</code></pre>
</p>
<p>There are two simple C++ rules that tell us which one will be called for the code in question:
</p>
<ul>
<li>The syntax <span style="color:#1f4e79;">{ /*…*/ }</span> used in an expression context gives you an <span style="color:#1f4e79;">initializer_list</span>.
</li>
<li>Constructors that take an <span style="color:#1f4e79;">initializer_list</span> are preferred over other constructors, and so can hide other constructors that might otherwise be viable.
</li>
</ul>
<p>Armed with those two tidbits, the answer is simple:
</p>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code>vector&lt;int&gt; v1( 10, 20 );    // (a) calls A: 10 copies of the value 20<br />assert( v1.size() == 10 );<br /><br />vector&lt;int&gt; v2{ 10, 20 };    // (b) calls B: the values 10 and 20<br />assert( v2.size() == 2 );
</code></pre>
</p>
<p>
 </p>
<h2>3. Besides the cases above, what other benefits are there to using { } to initialize objects?<br />
</h2>
<p>For one thing, it&#8217;s called &#8220;uniform initialization&#8221; because it&#8217;s, well, uniform—the same for all types, including aggregate structs and arrays and <span style="color:#1f4e79;">std::</span> containers, and without the &#8220;vexing parse&#8221; annoyance:
</p>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code>struct mystruct { int x, y; };<br /><br />// C++98 <br />rectangle       w( origin(), extents() );       // oops, vexing parse <br />complex&lt;double&gt; c( 2.71828, 3.14159 ); <br />mystruct        m = { 1, 2 };<br />int             a[] = { 1, 2, 3, 4 };<br />vector&lt;int&gt;     v;                              // urk, need more code<br />for( int i = 1; i &lt;= 4; ++i ) v.push_back(i);   //   to initialize this<br /><br />// C++11 (note: "=" is mostly optional)<br />rectangle       w   = { origin(), extents() }; <br />complex&lt;double&gt; c   = { 2.71828, 3.14159 }; <br />mystruct        m   = { 1, 2 }; <br />int             a[] = { 1, 2, 3, 4 };<br />vector&lt;int&gt;     v   = { 1, 2, 3, 4 };
</code></pre>
</p>
<p>And note that this isn&#8217;t just an aesthetic issue. Consider writing generic code that should be able to initialize any type… and while we&#8217;re at it, let&#8217;s gratuitously use perfect forwarding as an example:
</p>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code>template&lt;typename T, typename ...Args&gt;<br />void forwarder( Args&amp;&amp;... args ) {<br />    // ...<br />    T local <span style="background-color:yellow;">= {</span> std::forward&lt;Args&gt;(args)... <span style="background-color:yellow;">}</span>;<br />    // ...<br />}<br /><br />forwarder&lt;int&gt;            ( 42 );                  // ok<br />forwarder&lt;rectangle&gt;      ( origin(), extents() ); // ok<br />forwarder&lt;complex&lt;double&gt;&gt;( 2.71828, 3.14159 );    // ok<br />forwarder&lt;mystruct&gt;       ( 1, 2 );                // ok because of {}<br />forwarder&lt;int[]&gt;          ( 1, 2, 3, 4 );          // ok because of {}<br />forwarder&lt;vector&lt;int&gt;&gt;    ( 1, 2, 3, 4 );          // ok because of {}
</code></pre>
</p>
<p>The last three lines would not be legal if <span style="color:#1f4e79;">forwarder</span> used <span style="color:#1f4e79;">( )</span> initialization syntax internally.
</p>
<p>The new <span style="color:#1f4e79;">{ }</span> syntax works pretty much everywhere, including to initialize members:
</p>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code>widget::widget( /*...*/ ) : mem1<span style="background-color:yellow;">{</span>init1<span style="background-color:yellow;">}</span>, mem2<span style="background-color:yellow;">{</span>init2, init3<span style="background-color:yellow;">}</span> { /*...*/ } 
</code></pre>
</p>
<p>And, as icing on the take, it&#8217;s often just plain convenient to pass function arguments, or return a value, without a type-named temporary:
</p>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code>void draw_rect( rectangle ); <br /><br />draw_rect( rectangle(origin, selection) );         // C++98<br />draw_rect(<span style="background-color:yellow;">{</span> origin, selection <span style="background-color:yellow;">}</span>);                  // C++11<br /><br />rectangle compute_rect() {<br />   // ...<br />   if(cpp98) return rectangle(origin, selection);  // C++98<br />   else      return <span style="background-color:yellow;">{</span>origin, selection<span style="background-color:yellow;">}</span>;           // C++11<br />}
</code></pre>
</p>
<p>
 </p>
<h2>4. When should you use ( ) vs. { } syntax to initialize objects? Why?<br />
</h2>
<p>Here&#8217;s the simple <span style="color:#5b9bd5;">g</span>uideline:
</p>
<blockquote>
<p><strong>Guideline:</strong> Prefer to use initialization with <strong>{ }</strong>, such as <strong>vector&lt;int&gt; v = { 1, 2, 3, 4 };</strong> or <strong>auto v = vector&lt;int&gt;{ 1, 2, 3, 4 };</strong>, because it&#8217;s more consistent, more correct, and avoids having to know about old-style pitfalls at all. In single-argument cases where you prefer to see only the <strong>=</strong> sign, such as <strong>int i = 42;</strong> and <strong>auto x = anything</strong>; omitting the braces is fine. …
</p>
</blockquote>
<p>That covers the vast majority of cases. There is only one main exception:
</p>
<blockquote>
<p>… In rare cases, such as <strong>vector&lt;int&gt; v(10,20);</strong> or <strong>auto v = vector&lt;int&gt;(10,20);</strong>, use initialization with <strong>( )</strong> to explicitly call a constructor that is otherwise hidden by an <strong>initializer_list</strong> constructor.
</p>
</blockquote>
<p>However, the reason this should be generally &#8220;rare&#8221; is because default and copy construction are already special and work fine with <span style="color:#5b9bd5;">{ }</span>, and good class design now mostly avoids the resort-to-<span style="color:#5b9bd5;">( )</span> case for user-defined constructors because of this final design guideline:
</p>
<blockquote>
<p><strong>Guideline: </strong>When you design a class, avoid providing a constructor that ambiguously overloads with an <strong>initializer_list</strong> constructor, so that users won&#8217;t need to use <strong>( )</strong> to reach such a hidden constructor.
</p>
</blockquote>
<p>
 </p>
<h2>Acknowledgments<br />
</h2>
<p>Thanks in particular to the following for their feedback to improve this article: Michal Mocny, Jay Miller, &#8220;Alexey,&#8221; &#8220;praetorian20,&#8221; Francisco Lopes, &#8220;Neil,&#8221; Daryle Walker.</p>
					<p><a href="https://herbsutter.com/2013/05/09/gotw-1-solution/" rel="bookmark" title="Permanent Link to GotW #1 Solution: Variable Initialization – or Is&nbsp;It?">Read Full Post &raquo;</a></p>
				</div>
							</div>

		
			<div class="post-1828 post type-post status-publish format-standard hentry category-gotw" id="post-1828">
				<div class="posttitle">
					<h2><a href="https://herbsutter.com/2013/05/06/gotw-1-variable-initialization-or-is-it-310/" rel="bookmark">GotW #1: Variable Initialization—or Is It?&nbsp;(3/10)</a></h2>
					<p class="post-info">
					Posted in <a href="https://herbsutter.com/category/c/gotw/" rel="category tag">GotW</a> on 2013-05-06|
													<a href="https://herbsutter.com/2013/05/06/gotw-1-variable-initialization-or-is-it-310/#comments">28 Comments &#187;</a>											</p>
				</div>

				<div class="entry">
					<p><span style="color:#5a5a5a;"><em>This first problem highlights the importance of understanding what you write. Here we have a few simple lines of code — most of which mean something different from all the others, even though the syntax varies only slightly.<br />
</em></span></p>
<p>
 </p>
<h1>Problem<br />
</h1>
<h2>JG Question<br />
</h2>
<p>1. What is the difference, if any, among the following?
</p>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code>widget w;                   // (a)<br /><br />widget w();                 // (b)<br />widget w{};                 // (c)<br /><br />widget w(x);                // (d)<br />widget w{x};                // (e)<br /><br />widget w = x;               // (f)<br />widget w = {x};             // (g)<br /><br />auto w = x;                 // (h)<br />auto w = widget{x};         // (i)
</code></pre>
</p>
<h2>Guru Questions<br />
</h2>
<p>2. What do each of the following lines do?
</p>
<p style="background:#ffffcc;margin-left:14pt;">
<pre><code>vector&lt;int&gt; v1( 10, 20 );   // (a)<br /><br />vector&lt;int&gt; v2{ 10, 20 };   // (b)
</code></pre>
</p>
<p>3. Besides the cases above, what other benefits are there to using <span style="color:#2e74b5;">{ }</span> to initialize objects?
</p>
<p>4. When should you use <span style="color:#2e74b5;">( )</span> vs. <span style="color:#2e74b5;">{ }</span> syntax to initialize objects? Why?</p>
					<p><a href="https://herbsutter.com/2013/05/06/gotw-1-variable-initialization-or-is-it-310/" rel="bookmark" title="Permanent Link to GotW #1: Variable Initialization—or Is It?&nbsp;(3/10)">Read Full Post &raquo;</a></p>
				</div>
							</div>

		
		<p align="center"><a href="https://herbsutter.com/category/c/gotw/page/4/" >&laquo; Newer Posts</a> - <a href="https://herbsutter.com/category/c/gotw/page/6/" >Older Posts &raquo;</a></p>

	</div><!-- end id:content-main -->
<div id="sidebar">
<ul>
<li class="sidebox"><h2><label for="subscribe-field">Follow by email</label></h2>
				<form action="https://subscribe.wordpress.com" method="post" accept-charset="utf-8" id="subscribe-blog">
																	<p><input type="text" name="email" style="width: 95%; padding: 1px 2px" placeholder="Enter your email address" value="" id="subscribe-field"/></p>
					
					<p>
						<input type="hidden" name="action" value="subscribe"/>
						<input type="hidden" name="blog_id" value="3379246"/>
						<input type="hidden" name="source" value="https://herbsutter.com/category/c/gotw/page/5/"/>
						<input type="hidden" name="sub-type" value="widget"/>
						<input type="hidden" name="redirect_fragment" value="blog_subscription-3" />
						<input type="hidden" id="_wpnonce" name="_wpnonce" value="4590924cc6" />						<input type="submit" value="Subscribe" />
					</p>
				</form>
			
</li><li class="sidebox"><h2><a href='http://twitter.com/herbsutter'>Tweets</a></h2><ul class='tweets'></ul><a href="http://twitter.com/herbsutter"  class='twitter-follow-button' data-show-count='false' data-link-color='#265e15' data-text-color='#333333'>Follow @herbsutter</a></li><li class="sidebox"><h2>Popular</h2><ul>				<li>
										<a href="https://herbsutter.com/2018/11/13/trip-report-fall-iso-c-standards-meeting-san-diego/" class="bump-view" data-bump-view="tp">
						Trip report: Fall ISO C++ standards meeting (San Diego)					</a>
										</li>
								<li>
										<a href="https://herbsutter.com/gotw/" class="bump-view" data-bump-view="tp">
						GotW					</a>
										</li>
								<li>
										<a href="https://herbsutter.com/2018/09/20/lifetime-profile-v1-0-posted/" class="bump-view" data-bump-view="tp">
						Lifetime profile v1.0 posted					</a>
										</li>
				</ul></li><li class="sidebox"><h2>Categories</h2>		<ul>
				<li class="cat-item cat-item-291"><a href="https://herbsutter.com/category/apple/" >Apple</a>
</li>
	<li class="cat-item cat-item-49277"><a href="https://herbsutter.com/category/c-net/" >C# / .NET</a>
</li>
	<li class="cat-item cat-item-2426 current-cat-parent current-cat-ancestor"><a href="https://herbsutter.com/category/c/" >C++</a>
</li>
	<li class="cat-item cat-item-69816"><a href="https://herbsutter.com/category/cloud/" >Cloud</a>
</li>
	<li class="cat-item cat-item-214618"><a href="https://herbsutter.com/category/concurrency/" >Concurrency</a>
</li>
	<li class="cat-item cat-item-8259773"><a href="https://herbsutter.com/category/effective-concurrency/" >Effective Concurrency</a>
</li>
	<li class="cat-item cat-item-3696745"><a href="https://herbsutter.com/category/friday-thoughts/" >Friday Thoughts</a>
</li>
	<li class="cat-item cat-item-3867746 current-cat"><a href="https://herbsutter.com/category/c/gotw/" >GotW</a>
</li>
	<li class="cat-item cat-item-79"><a href="https://herbsutter.com/category/hardware/" >Hardware</a>
</li>
	<li class="cat-item cat-item-1017"><a href="https://herbsutter.com/category/java/" >Java</a>
</li>
	<li class="cat-item cat-item-637"><a href="https://herbsutter.com/category/microsoft/" >Microsoft</a>
</li>
	<li class="cat-item cat-item-420845"><a href="https://herbsutter.com/category/opinion-editorial/" >Opinion &amp; Editorial</a>
</li>
	<li class="cat-item cat-item-1633077"><a href="https://herbsutter.com/category/reader-qa/" >Reader Q&amp;A</a>
</li>
	<li class="cat-item cat-item-2301"><a href="https://herbsutter.com/category/software-development/" >Software Development</a>
</li>
	<li class="cat-item cat-item-393523"><a href="https://herbsutter.com/category/talks-events/" >Talks &amp; Events</a>
</li>
	<li class="cat-item cat-item-1"><a href="https://herbsutter.com/category/uncategorized/" >Uncategorized</a>
</li>
	<li class="cat-item cat-item-151"><a href="https://herbsutter.com/category/web/" >Web</a>
</li>
		</ul>
			</li></ul>
</div><!-- end id:sidebar -->
</div><!-- end id:content -->
</div><!-- end id:container -->
<div id="footer">
	<div id="colophon">
		<p><a href="https://wordpress.com/?ref=footer_blog">Blog at WordPress.com.</a></p>
		<p>WPThemes.</p>
		<br class="clear" />
	</div><!-- end #colophon-->
</div><!-- end #footer-->
		<script type="text/javascript">
		//<![CDATA[
		var infiniteScroll = {"settings":{"id":"content-main","ajaxurl":"https:\/\/herbsutter.com\/?infinity=scrolling","type":"scroll","wrapper":true,"wrapper_class":"infinite-wrap","footer":true,"click_handle":"1","text":"Older posts","totop":"Scroll back to top","currentday":"06.05.13","order":"DESC","scripts":[],"styles":[],"google_analytics":false,"offset":5,"history":{"host":"herbsutter.com","path":"\/category\/c\/gotw\/page\/%d\/","use_trailing_slashes":true,"parameters":""},"query_args":{"paged":5,"category_name":"gotw","error":"","m":"","p":0,"post_parent":"","subpost":"","subpost_id":"","attachment":"","attachment_id":0,"name":"","pagename":"","page_id":0,"second":"","minute":"","hour":"","day":0,"monthnum":0,"year":0,"w":0,"tag":"","cat":3867746,"tag_id":"","author":"","author_name":"","feed":"","tb":"","meta_key":"","meta_value":"","preview":"","s":"","sentence":"","title":"","fields":"","menu_order":"","embed":"","category__in":[],"category__not_in":[],"category__and":[],"post__in":[],"post__not_in":[],"post_name__in":[],"tag__in":[],"tag__not_in":[],"tag__and":[],"tag_slug__in":[],"tag_slug__and":[],"post_parent__in":[],"post_parent__not_in":[],"author__in":[],"author__not_in":[],"posts_per_page":7,"ignore_sticky_posts":false,"suppress_filters":false,"cache_results":false,"update_post_term_cache":true,"lazy_load_term_meta":true,"update_post_meta_cache":true,"post_type":"","nopaging":false,"comments_per_page":"50","no_found_rows":false,"order":"DESC"},"last_post_date":"2013-05-06 00:26:40","stats":"blog=3379246&v=wpcom&tz=-8&user_id=0&subd=herbsutter&x_pagetype=infinite"}};
		//]]>
		</script>
		<!--  -->
<script type='text/javascript' src='//0.gravatar.com/js/gprofiles.js?ver=201847y'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var WPGroHo = {"my_hash":""};
/* ]]> */
</script>
<script type='text/javascript' src='https://s1.wp.com/wp-content/mu-plugins/gravatar-hovercards/wpgroho.js?m=1380573781h'></script>

	<script>
		//initialize and attach hovercards to all gravatars
		jQuery( document ).ready( function( $ ) {

			if (typeof Gravatar === "undefined"){
				return;
			}

			if ( typeof Gravatar.init !== "function" ) {
				return;
			}			

			Gravatar.profile_cb = function( hash, id ) {
				WPGroHo.syncProfileData( hash, id );
			};
			Gravatar.my_hash = WPGroHo.my_hash;
			Gravatar.init( 'body', '#wp-admin-bar-my-account' );
		});
	</script>

		<div style="display:none">
	</div>
		<div id="infinite-footer">
			<div class="container">
				<div class="blog-info">
					<a id="infinity-blog-title" href="https://herbsutter.com/" rel="home">
						Sutter’s Mill					</a>
				</div>
				<div class="blog-credits">
					<a href="https://wordpress.com/?ref=footer_blog">Blog at WordPress.com.</a> 				</div>
			</div>
		</div><!-- #infinite-footer -->
		
	<div id="carousel-reblog-box">
		<form action="#" name="carousel-reblog">
			<textarea id="carousel-reblog-content" name="carousel-reblog-content" placeholder="Add your thoughts here... (optional)"></textarea>
			<label for="carousel-reblog-to-blog-id" id="carousel-reblog-lblogid">Post to</label>
			<select name="carousel-reblog-to-blog-id" id="carousel-reblog-to-blog-id">
						</select>

			<div class="submit">
				<span class="canceltext"><a href="#" class="cancel">Cancel</a></span>
				<input type="submit" name="carousel-reblog-submit" class="button" id="carousel-reblog-submit" value="Reblog Post" />
				<input type="hidden" id="carousel-reblog-blog-id" value="3379246" />
				<input type="hidden" id="carousel-reblog-blog-url" value="https://herbsutter.com" />
				<input type="hidden" id="carousel-reblog-blog-title" value="Sutter’s Mill" />
				<input type="hidden" id="carousel-reblog-post-url" value="" />
				<input type="hidden" id="carousel-reblog-post-title" value="" />
			</div>

			<input type="hidden" id="_wpnonce" name="_wpnonce" value="c0f0a72e87" /><input type="hidden" name="_wp_http_referer" value="/category/c/gotw/page/5/" />		</form>

		<div class="arrow"></div>
	</div>
<link rel='stylesheet' id='all-css-0-2' href='https://s0.wp.com/wp-content/mu-plugins/carousel/jetpack-carousel.css?m=1524699534h&cssminify=yes' type='text/css' media='all' />
<!--[if lte IE 8]>
<link rel='stylesheet' id='jetpack-carousel-ie8fix-css'  href='https://s1.wp.com/wp-content/mu-plugins/carousel/jetpack-carousel-ie8fix.css?m=1412618825h&#038;ver=20121024' type='text/css' media='all' />
<![endif]-->
<link rel='stylesheet' id='all-css-2-2' href='https://s2.wp.com/wp-content/mu-plugins/tiled-gallery/tiled-gallery.css?m=1443731146h&cssminify=yes' type='text/css' media='all' />
<script type='text/javascript'>
/* <![CDATA[ */
var actionbardata = {"siteID":"3379246","siteName":"Sutter\u2019s Mill","siteURL":"https:\/\/herbsutter.com","icon":"<img alt='' src='https:\/\/secure.gravatar.com\/blavatar\/4554b8d24c7f200dc5e2e1b18db1893f?s=50&d=https%3A%2F%2Fs2.wp.com%2Fi%2Flogo%2Fwpcom-gray-white.png' class='avatar avatar-50' height='50' width='50' \/>","canManageOptions":"","canCustomizeSite":"","isFollowing":"","themeSlug":"pub\/mistylook","signupURL":"https:\/\/wordpress.com\/start\/","loginURL":"https:\/\/herbsutter.wordpress.com\/wp-login.php?redirect_to=https%3A%2F%2Fherbsutter.com%2F2013%2F05%2F16%2Fgotw-4-class-mechanics-710%2F","themeURL":"","xhrURL":"https:\/\/herbsutter.com\/wp-admin\/admin-ajax.php","nonce":"8fb9818ae2","isSingular":"","isFolded":"","isLoggedIn":"","isMobile":"","subscribeNonce":"<input type=\"hidden\" id=\"_wpnonce\" name=\"_wpnonce\" value=\"4590924cc6\" \/>","referer":"https:\/\/herbsutter.com\/category\/c\/gotw\/page\/5\/","canFollow":"1","feedID":"171936","statusMessage":"","customizeLink":"https:\/\/herbsutter.wordpress.com\/wp-admin\/customize.php?url=https%3A%2F%2Fherbsutter.wordpress.com%2Fcategory%2Fc%2Fgotw%2Fpage%2F5%2F","i18n":{"view":"View site","follow":"Follow","following":"Following","edit":"Edit","login":"Log in","signup":"Sign up","customize":"Customize","report":"Report this content","themeInfo":"Get theme: MistyLook","shortlink":"Copy shortlink","copied":"Copied","followedText":"New posts from this site will now appear in your <a href=\"https:\/\/wordpress.com\/\">Reader<\/a>","foldBar":"Collapse this bar","unfoldBar":"Expand this bar","editSubs":"Manage subscriptions","viewReader":"View site in Reader","viewReadPost":"View post in Reader","subscribe":"Sign me up","enterEmail":"Enter your email address","followers":"Join 19,532 other followers","alreadyUser":"Already have a WordPress.com account? <a href=\"https:\/\/herbsutter.wordpress.com\/wp-login.php?redirect_to=https%3A%2F%2Fherbsutter.com%2F2013%2F05%2F16%2Fgotw-4-class-mechanics-710%2F\">Log in now.<\/a>","stats":"Stats"}};
/* ]]> */
</script>
<script type='text/javascript'>
/* <![CDATA[ */
var jetpackCarouselStrings = {"widths":[370,700,1000,1200,1400,2000],"is_logged_in":"","lang":"en","ajaxurl":"https:\/\/herbsutter.com\/wp-admin\/admin-ajax.php","nonce":"665015e67f","display_exif":"1","display_geo":"1","single_image_gallery":"1","single_image_gallery_media_file":"","background_color":"black","comment":"Comment","post_comment":"Post Comment","write_comment":"Write a Comment...","loading_comments":"Loading Comments...","download_original":"View full size <span class=\"photo-size\">{0}<span class=\"photo-size-times\">\u00d7<\/span>{1}<\/span>","no_comment_text":"Please be sure to submit some text with your comment.","no_comment_email":"Please provide an email address to comment.","no_comment_author":"Please provide your name to comment.","comment_post_error":"Sorry, but there was an error posting your comment. Please try again later.","comment_approved":"Your comment was approved.","comment_unapproved":"Your comment is in moderation.","camera":"Camera","aperture":"Aperture","shutter_speed":"Shutter Speed","focal_length":"Focal Length","copyright":"Copyright","comment_registration":"0","require_name_email":"1","login_url":"https:\/\/herbsutter.wordpress.com\/wp-login.php?redirect_to=https%3A%2F%2Fherbsutter.com%2F2013%2F05%2F06%2Fgotw-1-variable-initialization-or-is-it-310%2F","blog_id":"3379246","meta_data":["camera","aperture","shutter_speed","focal_length","copyright"],"local_comments_commenting_as":"<fieldset><label for=\"email\">Email (Required)<\/label> <input type=\"text\" name=\"email\" class=\"jp-carousel-comment-form-field jp-carousel-comment-form-text-field\" id=\"jp-carousel-comment-form-email-field\" \/><\/fieldset><fieldset><label for=\"author\">Name (Required)<\/label> <input type=\"text\" name=\"author\" class=\"jp-carousel-comment-form-field jp-carousel-comment-form-text-field\" id=\"jp-carousel-comment-form-author-field\" \/><\/fieldset><fieldset><label for=\"url\">Website<\/label> <input type=\"text\" name=\"url\" class=\"jp-carousel-comment-form-field jp-carousel-comment-form-text-field\" id=\"jp-carousel-comment-form-url-field\" \/><\/fieldset>","reblog":"Reblog","reblogged":"Reblogged","reblog_add_thoughts":"Add your thoughts here... (optional)","reblogging":"Reblogging...","post_reblog":"Post Reblog","stats_query_args":"blog=3379246&v=wpcom&tz=-8&user_id=0&subd=herbsutter","is_public":"1","reblog_enabled":""};
/* ]]> */
</script>
<script type='text/javascript' src='https://s0.wp.com/_static/??-eJyVUNEOwiAM/CGxGqM+Gb8FWXVFVpCWqX8vmmwxGpf4QHJc77ijcE3GRVZkBS/QYE8O023uZQZvo66YFMqJWCDQGQUuBQu2lpuAeUJMfCQmvY/gUzsI5c5qby2d2lCPYv5mJmJs0xGbg83QWanSikzsMWdqateR+/MFzdadZcrklCI/TSMa1MQulGd4Xapcj/Hg0emvz/e1ZgQrgvoyvO4po0yFO5tjEQzgUVMtagaievbdbrlebZbb7WK98A97a7cy'></script>
<script type='text/javascript' src='https://platform.twitter.com/widgets.js?ver=20111117'></script>
<script type='text/javascript' src='https://s0.wp.com/_static/??-eJyVy0sOQEAMANALqcYvYSHOgmkmpWoyirg9WyuxfIuHZ4BxVSM1XHYIsnvWDe1kM4owSD/OA0cHgQmVDoqkjtWn05bgnxu+Hws58L0IxeutZ3VLm1V5WRVlU+fTDQ0qQ9Y='></script>
<script type="text/javascript">
// <![CDATA[
(function() {
try{
  if ( window.external &&'msIsSiteMode' in window.external) {
    if (window.external.msIsSiteMode()) {
      var jl = document.createElement('script');
      jl.type='text/javascript';
      jl.async=true;
      jl.src='/wp-content/plugins/ie-sitemode/custom-jumplist.php';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(jl, s);
    }
  }
}catch(e){}
})();
// ]]>
</script><script type="text/javascript">
			jQuery.extend( infiniteScroll.settings.scripts, ["jquery-core","jquery-migrate","jquery","mobile-useragent-info","postmessage","jquery_inview","jetpack_resize","spin","jquery.spin","grofiles-cards","wpgroho","devicepx","jetpack_likes_queuehandler","the-neverending-homepage","syntaxhighlighter","wpcom-masterbar-js","wpcom-masterbar-tracks-js","wpcom-actionbar-bar","swfobject","videopress","jetpack-carousel","twitter-widgets","twitter-widgets-infinity","twitter-widgets-pending","tiled-gallery"] );
			jQuery.extend( infiniteScroll.settings.styles, ["jetpack_likes","the-neverending-homepage","infinity-mistylook","wpcom-core-compat-playlist-styles","mp6hacks","wpcom-bbpress2-staff-css","wp-block-library","mistylook","jetpack-top-posts-widget","jetpack-widget-social-icons-styles","noticons","geo-location-flair","reblogging","a8c-global-print","wpcom-actionbar-bar","h4-global","jetpack-carousel","tiled-gallery","jetpack-carousel-ie8fix"] );
		</script><script src="//stats.wp.com/w.js?56" type="text/javascript" async defer></script>
<script type="text/javascript">
_tkq = window._tkq || [];
_stq = window._stq || [];
_tkq.push(['storeContext', {'blog_id':'3379246','blog_tz':'-8','user_lang':'en','blog_lang':'en','user_id':'0'}]);
_stq.push(['view', {'blog':'3379246','v':'wpcom','tz':'-8','user_id':'0','subd':'herbsutter'}]);
_stq.push(['extra', {'crypt':'UE40eW5QN0p8M2Y/RE1TaVhzUzFMbjdWNHpwZGhTayxPSUFCMGNrd29+Smw0TDhnZmRTK0hlRi9QSGh6bi9GXVhBJWIlZlR5U1JMLU8/MkNtblkvY1d1TjBELytHc0k/MXdHUVQyK2IyUVA5SjU1bj9VX3ExLHYsREFpcnlfNHYtXV1HSUIsLkJrcnp0eS5sNk9ONE9GczNGJkhCfGxfSzIsTTFVZWlnc0ZuY2gxOWx5cjdVaF0/TFA5c0pUeHpGYS9pL1BFeTE1al1hcFZyLFM9JXNjM24tais1N1MlejRVRHl2X3kzSS9RUUZ5T2dDUSUrP0loVT1IZ1l1bENTcTBxb000dnlba1dOL3NfWXYwRHxEcDU9ejhiK20tLHFQYiVmcTFCWWxFdzZYajg3T2VHVTJBemNfU1JnbVI/NiYudEY='}]);
_stq.push([ 'clickTrackerInit', '3379246', '0' ]);
	</script>
<noscript><img src="https://pixel.wp.com/b.gif?v=noscript" style="height:0px;width:0px;overflow:hidden" alt="" /></noscript>
<script>
if ( 'object' === typeof wpcom_mobile_user_agent_info ) {

	wpcom_mobile_user_agent_info.init();
	var mobileStatsQueryString = "";
	
	if( false !== wpcom_mobile_user_agent_info.matchedPlatformName )
		mobileStatsQueryString += "&x_" + 'mobile_platforms' + '=' + wpcom_mobile_user_agent_info.matchedPlatformName;
	
	if( false !== wpcom_mobile_user_agent_info.matchedUserAgentName )
		mobileStatsQueryString += "&x_" + 'mobile_devices' + '=' + wpcom_mobile_user_agent_info.matchedUserAgentName;
	
	if( wpcom_mobile_user_agent_info.isIPad() )
		mobileStatsQueryString += "&x_" + 'ipad_views' + '=' + 'views';

	if( "" != mobileStatsQueryString ) {
		new Image().src = document.location.protocol + '//pixel.wp.com/g.gif?v=wpcom-no-pv' + mobileStatsQueryString + '&baba=' + Math.random();
	}
	
}
</script></body>
</html>